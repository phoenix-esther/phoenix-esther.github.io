<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.59" />
    <meta name="theme" content="VuePress Theme Hope" />
    <title>Spring Cloud Gateway | Java 成神之路</title><meta name="description" content="这是我的第一个 VuePress 站点">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d2025;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/assets/style-f1658162.css" as="style"><link rel="stylesheet" href="/assets/style-f1658162.css">
    <link rel="modulepreload" href="/assets/app-671fc831.js"><link rel="modulepreload" href="/assets/framework-5dde3bca.js"><link rel="modulepreload" href="/assets/spring-cloud-gateway.html-b56fde18.js"><link rel="modulepreload" href="/assets/spring-cloud-gateway.html-3b5bcf8b.js"><link rel="prefetch" href="/assets/index.html-95370337.js" as="script"><link rel="prefetch" href="/assets/database-overview.html-03717758.js" as="script"><link rel="prefetch" href="/assets/java-overview.html-44310673.js" as="script"><link rel="prefetch" href="/assets/middleware-overview.html-be4fdd51.js" as="script"><link rel="prefetch" href="/assets/quality-overview.html-a8e9bda4.js" as="script"><link rel="prefetch" href="/assets/spring-cloud-overview.html-87409649.js" as="script"><link rel="prefetch" href="/assets/gitbook.html-fb8a8229.js" as="script"><link rel="prefetch" href="/assets/tools-overview.html-67f69dba.js" as="script"><link rel="prefetch" href="/assets/mongo.html-50bc6f68.js" as="script"><link rel="prefetch" href="/assets/mysql-advance.html-e06a1ce2.js" as="script"><link rel="prefetch" href="/assets/mysql-apply.html-a6b2d1c2.js" as="script"><link rel="prefetch" href="/assets/mysql-base.html-d91fdb11.js" as="script"><link rel="prefetch" href="/assets/mysql-devops.html-0b9fc6f6.js" as="script"><link rel="prefetch" href="/assets/redis-base.html-fbc05584.js" as="script"><link rel="prefetch" href="/assets/redis-cluster.html-07744daf.js" as="script"><link rel="prefetch" href="/assets/redis-overview.html-1bcd1133.js" as="script"><link rel="prefetch" href="/assets/java-base.html-7071cb31.js" as="script"><link rel="prefetch" href="/assets/java-sql.html-c8be449f.js" as="script"><link rel="prefetch" href="/assets/java-time.html-2c855f9e.js" as="script"><link rel="prefetch" href="/assets/java-collection-list.html-2207ee3a.js" as="script"><link rel="prefetch" href="/assets/java-collection-map.html-d30b93e7.js" as="script"><link rel="prefetch" href="/assets/java-concurrent-base.html-8983a76d.js" as="script"><link rel="prefetch" href="/assets/Java-concurrent-container.html-3334407b.js" as="script"><link rel="prefetch" href="/assets/java-concurrent-interview.html-bbc0a621.js" as="script"><link rel="prefetch" href="/assets/java-concurrent-lock.html-ebf0a63c.js" as="script"><link rel="prefetch" href="/assets/java-concurrent-pool.html-7a290f95.js" as="script"><link rel="prefetch" href="/assets/java-concurrent-tools.html-01a740a1.js" as="script"><link rel="prefetch" href="/assets/java-bio.html-ceca2a90.js" as="script"><link rel="prefetch" href="/assets/java-io-base.html-40d5757f.js" as="script"><link rel="prefetch" href="/assets/java-nio.html-b002c449.js" as="script"><link rel="prefetch" href="/assets/Java内存模型.html-13f8a203.js" as="script"><link rel="prefetch" href="/assets/JVM内存结构.html-fb577c69.js" as="script"><link rel="prefetch" href="/assets/JVM垃圾回收.html-852577fd.js" as="script"><link rel="prefetch" href="/assets/JVM概览.html-eda595c7.js" as="script"><link rel="prefetch" href="/assets/JVM类加载器.html-ee6c0eb8.js" as="script"><link rel="prefetch" href="/assets/JVM类文件结构.html-6aca785b.js" as="script"><link rel="prefetch" href="/assets/JVM调优.html-ad63cd2e.js" as="script"><link rel="prefetch" href="/assets/java-servlet.html-ef72b065.js" as="script"><link rel="prefetch" href="/assets/java-lambda.html-c21b5e3b.js" as="script"><link rel="prefetch" href="/assets/java-stream.html-797890ef.js" as="script"><link rel="prefetch" href="/assets/HikariCP-base.html-89b6d274.js" as="script"><link rel="prefetch" href="/assets/HikariCP-source.html-71542b59.js" as="script"><link rel="prefetch" href="/assets/jackson-overview.html-58553b4c.js" as="script"><link rel="prefetch" href="/assets/kafka-broker.html-8091a112.js" as="script"><link rel="prefetch" href="/assets/kafka-consumer.html-f5b2d049.js" as="script"><link rel="prefetch" href="/assets/kafka-old.html-1448d038.js" as="script"><link rel="prefetch" href="/assets/kafka-overview.html-8dd9a49b.js" as="script"><link rel="prefetch" href="/assets/kafka-producer.html-5dc9b65d.js" as="script"><link rel="prefetch" href="/assets/spring-kafka.html-bc75ec45.js" as="script"><link rel="prefetch" href="/assets/log-framework.html-76a57287.js" as="script"><link rel="prefetch" href="/assets/1.Hello World.html-b2ffe65b.js" as="script"><link rel="prefetch" href="/assets/2.Global Config.html-6a02822f.js" as="script"><link rel="prefetch" href="/assets/index.html-f37393b8.js" as="script"><link rel="prefetch" href="/assets/nginx.html-5ca46ccb.js" as="script"><link rel="prefetch" href="/assets/sharding-sphere.html-47e07fb1.js" as="script"><link rel="prefetch" href="/assets/shiro-overview.html-66b81094.js" as="script"><link rel="prefetch" href="/assets/tomcat.html-63e9b96e.js" as="script"><link rel="prefetch" href="/assets/data-structure-list.html-5ba0105d.js" as="script"><link rel="prefetch" href="/assets/data-structure-overview.html-85d0b05a.js" as="script"><link rel="prefetch" href="/assets/data-structure-tree.html-b7a2b7b5.js" as="script"><link rel="prefetch" href="/assets/design-adapter.html-ca7d4d0c.js" as="script"><link rel="prefetch" href="/assets/design-bridge.html-f70c2b16.js" as="script"><link rel="prefetch" href="/assets/design-builder.html-8d44b4e2.js" as="script"><link rel="prefetch" href="/assets/design-chain.html-73c4f586.js" as="script"><link rel="prefetch" href="/assets/design-command.html-d6dfccee.js" as="script"><link rel="prefetch" href="/assets/design-composite.html-756fd116.js" as="script"><link rel="prefetch" href="/assets/design-decorator.html-826f2e24.js" as="script"><link rel="prefetch" href="/assets/design-facade.html-c448fc15.js" as="script"><link rel="prefetch" href="/assets/design-factory.html-902a65a0.js" as="script"><link rel="prefetch" href="/assets/design-flyweight.html-4459624e.js" as="script"><link rel="prefetch" href="/assets/design-interpreter.html-c630c412.js" as="script"><link rel="prefetch" href="/assets/design-iterator.html-ab1b6e0a.js" as="script"><link rel="prefetch" href="/assets/design-mediator.html-0a45de36.js" as="script"><link rel="prefetch" href="/assets/design-memento.html-4208519d.js" as="script"><link rel="prefetch" href="/assets/design-observer.html-7d34acf8.js" as="script"><link rel="prefetch" href="/assets/design-overview.html-8ae1eaca.js" as="script"><link rel="prefetch" href="/assets/design-prototype.html-843f1ba1.js" as="script"><link rel="prefetch" href="/assets/design-proxy.html-b51e83f1.js" as="script"><link rel="prefetch" href="/assets/design-singleton.html-cb4b0e72.js" as="script"><link rel="prefetch" href="/assets/design-state.html-514399be.js" as="script"><link rel="prefetch" href="/assets/design-strategy.html-586d3ac2.js" as="script"><link rel="prefetch" href="/assets/design-template.html-12aa47cf.js" as="script"><link rel="prefetch" href="/assets/design-visitor.html-ed58259a.js" as="script"><link rel="prefetch" href="/assets/滑动窗口.html-d4efa51b.js" as="script"><link rel="prefetch" href="/assets/linux-overview.html-f8205a0e.js" as="script"><link rel="prefetch" href="/assets/encoding.html-bb7cac1e.js" as="script"><link rel="prefetch" href="/assets/encryption-algorithm.html-47d69cef.js" as="script"><link rel="prefetch" href="/assets/temp.html-60b41fd7.js" as="script"><link rel="prefetch" href="/assets/BeanPostProcessor-base.html-9b47aa32.js" as="script"><link rel="prefetch" href="/assets/BeanPostProcessor-ConfigurationClassPostProcessor.html-d4e7a5e5.js" as="script"><link rel="prefetch" href="/assets/spring-source-overview.html-3ac2c8f4.js" as="script"><link rel="prefetch" href="/assets/spring-boot-condition.html-f38f1a16.js" as="script"><link rel="prefetch" href="/assets/spring-cloud-commons-base.html-b68d3933.js" as="script"><link rel="prefetch" href="/assets/spring-cloud-loadbalancer.html-182fff59.js" as="script"><link rel="prefetch" href="/assets/nacos-client-discovery.html-050d84e4.js" as="script"><link rel="prefetch" href="/assets/nacos-overview.html-755394c0.js" as="script"><link rel="prefetch" href="/assets/cloud-openfeign-action.html-6173210d.js" as="script"><link rel="prefetch" href="/assets/spring-cloud-openfeign.html-46fdc141.js" as="script"><link rel="prefetch" href="/assets/spring-cloud-ribbon.html-2f5d4e70.js" as="script"><link rel="prefetch" href="/assets/spring-cloud-alibaba-seate.html-90df4bc0.js" as="script"><link rel="prefetch" href="/assets/sentinel-source.html-db79abe0.js" as="script"><link rel="prefetch" href="/assets/spring-cloud-sentinel.html-031a7566.js" as="script"><link rel="prefetch" href="/assets/git.html-f3d86d29.js" as="script"><link rel="prefetch" href="/assets/gitlab.html-ee616321.js" as="script"><link rel="prefetch" href="/assets/junit4.html-7674a247.js" as="script"><link rel="prefetch" href="/assets/junit5.html-1088960a.js" as="script"><link rel="prefetch" href="/assets/maven.html-c5f718a8.js" as="script"><link rel="prefetch" href="/assets/reactor.html-b7f3a608.js" as="script"><link rel="prefetch" href="/assets/spring-source-web-init.html-76aa84f3.js" as="script"><link rel="prefetch" href="/assets/spring-source-web-listener.html-8020b96c.js" as="script"><link rel="prefetch" href="/assets/404.html-f04ced3e.js" as="script"><link rel="prefetch" href="/assets/index.html-33e4c2a2.js" as="script"><link rel="prefetch" href="/assets/index.html-8ad96e03.js" as="script"><link rel="prefetch" href="/assets/index.html-b23d2171.js" as="script"><link rel="prefetch" href="/assets/index.html-8a709d0c.js" as="script"><link rel="prefetch" href="/assets/index.html-9488715d.js" as="script"><link rel="prefetch" href="/assets/index.html-fb3dd3ef.js" as="script"><link rel="prefetch" href="/assets/index.html-42d88d20.js" as="script"><link rel="prefetch" href="/assets/index.html-87f3d90a.js" as="script"><link rel="prefetch" href="/assets/index.html-4e6c2eaf.js" as="script"><link rel="prefetch" href="/assets/index.html-df28bb11.js" as="script"><link rel="prefetch" href="/assets/index.html-78d325c5.js" as="script"><link rel="prefetch" href="/assets/index.html-0c05d7f0.js" as="script"><link rel="prefetch" href="/assets/database-overview.html-8e20b9c4.js" as="script"><link rel="prefetch" href="/assets/java-overview.html-110664f3.js" as="script"><link rel="prefetch" href="/assets/middleware-overview.html-23551371.js" as="script"><link rel="prefetch" href="/assets/quality-overview.html-c678a80a.js" as="script"><link rel="prefetch" href="/assets/spring-cloud-overview.html-4f455e53.js" as="script"><link rel="prefetch" href="/assets/gitbook.html-82c9e715.js" as="script"><link rel="prefetch" href="/assets/tools-overview.html-ef94410e.js" as="script"><link rel="prefetch" href="/assets/mongo.html-b49ed607.js" as="script"><link rel="prefetch" href="/assets/mysql-advance.html-04da5f50.js" as="script"><link rel="prefetch" href="/assets/mysql-apply.html-93145a97.js" as="script"><link rel="prefetch" href="/assets/mysql-base.html-d6966f7f.js" as="script"><link rel="prefetch" href="/assets/mysql-devops.html-6b9ccca1.js" as="script"><link rel="prefetch" href="/assets/redis-base.html-2d4d81f6.js" as="script"><link rel="prefetch" href="/assets/redis-cluster.html-dd1dc967.js" as="script"><link rel="prefetch" href="/assets/redis-overview.html-7f2546f3.js" as="script"><link rel="prefetch" href="/assets/java-base.html-2a2487a8.js" as="script"><link rel="prefetch" href="/assets/java-sql.html-3235fb3f.js" as="script"><link rel="prefetch" href="/assets/java-time.html-c6bd518b.js" as="script"><link rel="prefetch" href="/assets/java-collection-list.html-1f5f5479.js" as="script"><link rel="prefetch" href="/assets/java-collection-map.html-9eaf3f79.js" as="script"><link rel="prefetch" href="/assets/java-concurrent-base.html-ae299cb8.js" as="script"><link rel="prefetch" href="/assets/Java-concurrent-container.html-ebd6fec8.js" as="script"><link rel="prefetch" href="/assets/java-concurrent-interview.html-07fbfa4a.js" as="script"><link rel="prefetch" href="/assets/java-concurrent-lock.html-994ad73f.js" as="script"><link rel="prefetch" href="/assets/java-concurrent-pool.html-ed4a1de5.js" as="script"><link rel="prefetch" href="/assets/java-concurrent-tools.html-8880da92.js" as="script"><link rel="prefetch" href="/assets/java-bio.html-df6fc911.js" as="script"><link rel="prefetch" href="/assets/java-io-base.html-77f89736.js" as="script"><link rel="prefetch" href="/assets/java-nio.html-bcccb204.js" as="script"><link rel="prefetch" href="/assets/Java内存模型.html-7383b9cd.js" as="script"><link rel="prefetch" href="/assets/JVM内存结构.html-8d99ddf3.js" as="script"><link rel="prefetch" href="/assets/JVM垃圾回收.html-304d9a2d.js" as="script"><link rel="prefetch" href="/assets/JVM概览.html-8bd4b42f.js" as="script"><link rel="prefetch" href="/assets/JVM类加载器.html-77d4aeac.js" as="script"><link rel="prefetch" href="/assets/JVM类文件结构.html-9a5ae840.js" as="script"><link rel="prefetch" href="/assets/JVM调优.html-abf07289.js" as="script"><link rel="prefetch" href="/assets/java-servlet.html-8537acfe.js" as="script"><link rel="prefetch" href="/assets/java-lambda.html-e158a557.js" as="script"><link rel="prefetch" href="/assets/java-stream.html-ad9eb0ed.js" as="script"><link rel="prefetch" href="/assets/HikariCP-base.html-f749e904.js" as="script"><link rel="prefetch" href="/assets/HikariCP-source.html-4651cd3f.js" as="script"><link rel="prefetch" href="/assets/jackson-overview.html-1ff735d9.js" as="script"><link rel="prefetch" href="/assets/kafka-broker.html-78790cd6.js" as="script"><link rel="prefetch" href="/assets/kafka-consumer.html-3872d15c.js" as="script"><link rel="prefetch" href="/assets/kafka-old.html-4a95df91.js" as="script"><link rel="prefetch" href="/assets/kafka-overview.html-03135409.js" as="script"><link rel="prefetch" href="/assets/kafka-producer.html-f9cc0e5f.js" as="script"><link rel="prefetch" href="/assets/spring-kafka.html-0eaac2b9.js" as="script"><link rel="prefetch" href="/assets/log-framework.html-13f8b728.js" as="script"><link rel="prefetch" href="/assets/1.Hello World.html-254e923d.js" as="script"><link rel="prefetch" href="/assets/2.Global Config.html-34377212.js" as="script"><link rel="prefetch" href="/assets/index.html-6f5477e7.js" as="script"><link rel="prefetch" href="/assets/nginx.html-6e2dadda.js" as="script"><link rel="prefetch" href="/assets/sharding-sphere.html-bb3296bb.js" as="script"><link rel="prefetch" href="/assets/shiro-overview.html-f4bdb923.js" as="script"><link rel="prefetch" href="/assets/tomcat.html-107f9ebe.js" as="script"><link rel="prefetch" href="/assets/data-structure-list.html-0f23b38b.js" as="script"><link rel="prefetch" href="/assets/data-structure-overview.html-f1e03c1d.js" as="script"><link rel="prefetch" href="/assets/data-structure-tree.html-a44ba30f.js" as="script"><link rel="prefetch" href="/assets/design-adapter.html-77286312.js" as="script"><link rel="prefetch" href="/assets/design-bridge.html-00672c18.js" as="script"><link rel="prefetch" href="/assets/design-builder.html-27d852c8.js" as="script"><link rel="prefetch" href="/assets/design-chain.html-74047f74.js" as="script"><link rel="prefetch" href="/assets/design-command.html-943a7340.js" as="script"><link rel="prefetch" href="/assets/design-composite.html-463bbe40.js" as="script"><link rel="prefetch" href="/assets/design-decorator.html-34575490.js" as="script"><link rel="prefetch" href="/assets/design-facade.html-6a642241.js" as="script"><link rel="prefetch" href="/assets/design-factory.html-558c3336.js" as="script"><link rel="prefetch" href="/assets/design-flyweight.html-9a7105fb.js" as="script"><link rel="prefetch" href="/assets/design-interpreter.html-19cea0ae.js" as="script"><link rel="prefetch" href="/assets/design-iterator.html-55db2bf3.js" as="script"><link rel="prefetch" href="/assets/design-mediator.html-a639304c.js" as="script"><link rel="prefetch" href="/assets/design-memento.html-6453f1e1.js" as="script"><link rel="prefetch" href="/assets/design-observer.html-ed658ad7.js" as="script"><link rel="prefetch" href="/assets/design-overview.html-03776800.js" as="script"><link rel="prefetch" href="/assets/design-prototype.html-8fdfdb40.js" as="script"><link rel="prefetch" href="/assets/design-proxy.html-d9e3ef89.js" as="script"><link rel="prefetch" href="/assets/design-singleton.html-8c4de69b.js" as="script"><link rel="prefetch" href="/assets/design-state.html-aeddd299.js" as="script"><link rel="prefetch" href="/assets/design-strategy.html-79c37426.js" as="script"><link rel="prefetch" href="/assets/design-template.html-61d102d5.js" as="script"><link rel="prefetch" href="/assets/design-visitor.html-fefdc2c4.js" as="script"><link rel="prefetch" href="/assets/滑动窗口.html-a5cf52bf.js" as="script"><link rel="prefetch" href="/assets/linux-overview.html-4c5f0a4a.js" as="script"><link rel="prefetch" href="/assets/encoding.html-f5906218.js" as="script"><link rel="prefetch" href="/assets/encryption-algorithm.html-9a1f16a2.js" as="script"><link rel="prefetch" href="/assets/temp.html-bc9bd901.js" as="script"><link rel="prefetch" href="/assets/BeanPostProcessor-base.html-f1d5d10e.js" as="script"><link rel="prefetch" href="/assets/BeanPostProcessor-ConfigurationClassPostProcessor.html-a96eba50.js" as="script"><link rel="prefetch" href="/assets/spring-source-overview.html-11cf77bb.js" as="script"><link rel="prefetch" href="/assets/spring-boot-condition.html-925c1f11.js" as="script"><link rel="prefetch" href="/assets/spring-cloud-commons-base.html-08854838.js" as="script"><link rel="prefetch" href="/assets/spring-cloud-loadbalancer.html-6f95c5b7.js" as="script"><link rel="prefetch" href="/assets/nacos-client-discovery.html-79247510.js" as="script"><link rel="prefetch" href="/assets/nacos-overview.html-13cec71c.js" as="script"><link rel="prefetch" href="/assets/cloud-openfeign-action.html-0f222092.js" as="script"><link rel="prefetch" href="/assets/spring-cloud-openfeign.html-80b0fc34.js" as="script"><link rel="prefetch" href="/assets/spring-cloud-ribbon.html-e2d9af9b.js" as="script"><link rel="prefetch" href="/assets/spring-cloud-alibaba-seate.html-37eed2ce.js" as="script"><link rel="prefetch" href="/assets/sentinel-source.html-692a3324.js" as="script"><link rel="prefetch" href="/assets/spring-cloud-sentinel.html-bf9c4618.js" as="script"><link rel="prefetch" href="/assets/git.html-87ad5d64.js" as="script"><link rel="prefetch" href="/assets/gitlab.html-09e004bc.js" as="script"><link rel="prefetch" href="/assets/junit4.html-e113cced.js" as="script"><link rel="prefetch" href="/assets/junit5.html-49a7387c.js" as="script"><link rel="prefetch" href="/assets/maven.html-dfa1482f.js" as="script"><link rel="prefetch" href="/assets/reactor.html-caf126d4.js" as="script"><link rel="prefetch" href="/assets/spring-source-web-init.html-c9794d73.js" as="script"><link rel="prefetch" href="/assets/spring-source-web-listener.html-22512f68.js" as="script"><link rel="prefetch" href="/assets/404.html-f08c28a7.js" as="script"><link rel="prefetch" href="/assets/index.html-da4568d9.js" as="script"><link rel="prefetch" href="/assets/index.html-e93144aa.js" as="script"><link rel="prefetch" href="/assets/index.html-def5ae53.js" as="script"><link rel="prefetch" href="/assets/index.html-0d635afd.js" as="script"><link rel="prefetch" href="/assets/index.html-6a96e1d8.js" as="script"><link rel="prefetch" href="/assets/index.html-855b7bae.js" as="script"><link rel="prefetch" href="/assets/index.html-703427c5.js" as="script"><link rel="prefetch" href="/assets/index.html-d81ead65.js" as="script"><link rel="prefetch" href="/assets/index.html-3f2fdf99.js" as="script"><link rel="prefetch" href="/assets/index.html-89246e48.js" as="script"><link rel="prefetch" href="/assets/index.html-555be4ca.js" as="script"><link rel="prefetch" href="/assets/mermaid.esm.min-bc08675d.js" as="script"><link rel="prefetch" href="/assets/mermaid-mindmap.esm.min-2d34b44a.js" as="script"><link rel="prefetch" href="/assets/markdown.esm-d92a2fc9.js" as="script"><link rel="prefetch" href="/assets/reveal.esm-e5069ce0.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">跳至主要內容</a><!--]--><div class="theme-container has-toc"><!--[--><!--[--><header class="navbar"><div class="navbar-left"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><a href="/" class="brand"><!----><!----><span class="site-name">Java 成神之路</span></a><!--[--><!----><!--]--></div><div class="navbar-center"><!--[--><!----><!--]--><nav class="nav-links"><div class="nav-item hide-in-mobile"><a href="/java/java-overview.html" class="nav-link" aria-label="Java 笔记"><!---->Java 笔记<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="Spring 笔记"><span class="title"><!---->Spring 笔记</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>Spring IOC</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/spring/test02.html" class="nav-link" aria-label="Spring IOC详解"><!---->Spring IOC详解<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>Spring 后置处理器解析</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/spring/spring-bean-post-processor/BeanPostProcessor-base.html" class="nav-link" aria-label="Spring 后置处理器总览"><!---->Spring 后置处理器总览<!----></a></li></ul></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="Spring Cloud"><span class="title"><!---->Spring Cloud</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/spring-cloud/spring-cloud-overview.html" class="nav-link" aria-label="Spring Cloud Overview"><!---->Spring Cloud Overview<!----></a></li><li class="dropdown-item"><a href="/spring-cloud/spring-cloud-alibaba-nacos.md" class="nav-link" aria-label="Spring Cloud Nacos"><!---->Spring Cloud Nacos<!----></a></li><li class="dropdown-item"><a href="/spring-cloud/spring-cloud-alibaba-sentinel.md" class="nav-link" aria-label="Spring Cloud Sentinel"><!---->Spring Cloud Sentinel<!----></a></li><li class="dropdown-item"><a href="/spring-cloud/spring-cloud-alibaba-seate.md" class="nav-link" aria-label="Spring Cloud Seate"><!---->Spring Cloud Seate<!----></a></li><li class="dropdown-item"><a href="/spring-cloud/spring-cloud-ribbon/spring-cloud-ribbon.html" class="nav-link" aria-label="Spring Cloud Ribbon"><!---->Spring Cloud Ribbon<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><a href="/database/database-overview.html" class="nav-link" aria-label="数据库"><!---->数据库<!----></a></div><div class="nav-item hide-in-mobile"><a href="/quality/quality-overview.html" class="nav-link" aria-label="自我修养"><!---->自我修养<!----></a></div><div class="nav-item hide-in-mobile"><a href="/middleware/middleware-overview.html" class="nav-link" aria-label="中间件"><!---->中间件<!----></a></div><div class="nav-item hide-in-mobile"><a href="/tools/tools-overview.html" class="nav-link" aria-label="工具包"><!---->工具包<!----></a></div></nav><!--[--><!----><!--]--></div><div class="navbar-right"><!--[--><!----><!--]--><!----><!----><div class="nav-item hide-in-mobile"><button id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!----><!--[--><!----><!--]--><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><section class="sidebar-group"><p class="sidebar-heading active"><!----><span class="title">微服务架构</span><!----></p><ul class="sidebar-links"><li><!--[--><a href="/spring-cloud/spring-cloud-overview.html" class="nav-link sidebar-link sidebar-page" aria-label="Spring Cloud"><!---->Spring Cloud<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/spring-cloud/spring-cloud-nacos/nacos-client-discovery.html" class="nav-link sidebar-link sidebar-page" aria-label="Nacos服务注册发现原理"><!---->Nacos服务注册发现原理<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/spring-cloud/spring-cloud-nacos/nacos-overview.html" class="nav-link sidebar-link sidebar-page" aria-label="Nacos"><!---->Nacos<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/spring-cloud/spring-cloud-sentinel/sentinel-source.html" class="nav-link sidebar-link sidebar-page" aria-label="Sentinel 源码分析"><!---->Sentinel 源码分析<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/spring-cloud/spring-cloud-alibaba-seate.html" class="nav-link sidebar-link sidebar-page" aria-label="/spring-cloud/spring-cloud-alibaba-seate.html"><!---->/spring-cloud/spring-cloud-alibaba-seate.html<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-current="page" href="/spring-cloud/spring-cloud-gateway/spring-cloud-gateway.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" aria-label="Spring Cloud Gateway"><!---->Spring Cloud Gateway<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/spring-cloud/spring-cloud-gateway/spring-cloud-gateway.html#一、什么是-spring-cloud-gateway" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="一、什么是 Spring Cloud Gateway"><!---->一、什么是 Spring Cloud Gateway<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/spring-cloud/spring-cloud-gateway/spring-cloud-gateway.html#二、什么是服务网关" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="二、什么是服务网关"><!---->二、什么是服务网关<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/spring-cloud/spring-cloud-gateway/spring-cloud-gateway.html#三、为什么要使用网关" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="三、为什么要使用网关"><!---->三、为什么要使用网关<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/spring-cloud/spring-cloud-gateway/spring-cloud-gateway.html#四、网关解决了什么问题" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="四、网关解决了什么问题"><!---->四、网关解决了什么问题<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/spring-cloud/spring-cloud-gateway/spring-cloud-gateway.html#五、常用网关解决方案" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="五、常用网关解决方案"><!---->五、常用网关解决方案<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/spring-cloud/spring-cloud-gateway/spring-cloud-gateway.html#_5-1-nginx-lua" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="5.1 Nginx + Lua"><!---->5.1 Nginx + Lua<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/spring-cloud/spring-cloud-gateway/spring-cloud-gateway.html#_5-2-kong" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="5.2 Kong"><!---->5.2 Kong<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/spring-cloud/spring-cloud-gateway/spring-cloud-gateway.html#_5-3-spring-cloud-netiflx-zuul" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="5.3 Spring Cloud Netiflx Zuul"><!---->5.3 Spring Cloud Netiflx Zuul<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/spring-cloud/spring-cloud-gateway/spring-cloud-gateway.html#_5-4-spring-cloud-gateway" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="5.4 Spring Cloud Gateway"><!---->5.4 Spring Cloud Gateway<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/spring-cloud/spring-cloud-gateway/spring-cloud-gateway.html#六、spring-cloud-gateway实现网关" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="六、Spring Cloud Gateway实现网关"><!---->六、Spring Cloud Gateway实现网关<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/spring-cloud/spring-cloud-gateway/spring-cloud-gateway.html#_6-1-核心概念" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="6.1 核心概念"><!---->6.1 核心概念<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/spring-cloud/spring-cloud-gateway/spring-cloud-gateway.html#_6-2-工作原理" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="6.2 工作原理"><!---->6.2 工作原理<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/spring-cloud/spring-cloud-gateway/spring-cloud-gateway.html#_6-3-路由规则" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="6.3 路由规则"><!---->6.3 路由规则<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/spring-cloud/spring-cloud-gateway/spring-cloud-gateway.html#七、动态路由" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="七、动态路由"><!---->七、动态路由<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/spring-cloud/spring-cloud-gateway/spring-cloud-gateway.html#八、过滤器" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="八、过滤器"><!---->八、过滤器<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/spring-cloud/spring-cloud-gateway/spring-cloud-gateway.html#_8-1-网关过滤器" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.1 网关过滤器"><!---->8.1 网关过滤器<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/spring-cloud/spring-cloud-gateway/spring-cloud-gateway.html#_8-2-全局过滤器" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.2 全局过滤器"><!---->8.2 全局过滤器<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/spring-cloud/spring-cloud-gateway/spring-cloud-gateway.html#_8-3-自定义过滤器" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.3 自定义过滤器"><!---->8.3 自定义过滤器<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/spring-cloud/spring-cloud-gateway/spring-cloud-gateway.html#九、网关限流" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="九、网关限流"><!---->九、网关限流<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/spring-cloud/spring-cloud-gateway/spring-cloud-gateway.html#_9-1-为什么需要限流" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="9.1 为什么需要限流"><!---->9.1 为什么需要限流<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/spring-cloud/spring-cloud-gateway/spring-cloud-gateway.html#_9-2-限流算法" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="9.2 限流算法"><!---->9.2 限流算法<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/spring-cloud/spring-cloud-gateway/spring-cloud-gateway.html#_9-3-计数器法" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="9.3 计数器法"><!---->9.3 计数器法<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li></ul><!--]--></li></ul></section></li><li><section class="sidebar-group"><p class="sidebar-heading"><!----><span class="title">常用组件</span><!----></p><ul class="sidebar-links"><li><!--[--><a href="/spring-cloud/spring-cloud-openfeign/spring-cloud-openfeign.html" class="nav-link sidebar-link sidebar-page" aria-label="Spring Cloud OpenFeign 源码解析"><!---->Spring Cloud OpenFeign 源码解析<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/spring-cloud/spring-cloud-ribbon/spring-cloud-ribbon.html" class="nav-link sidebar-link sidebar-page" aria-label="Spring Cloud Ribbon 源码解析"><!---->Spring Cloud Ribbon 源码解析<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->Spring Cloud Gateway</h1><div class="page-info"><!----><!----><span class="date-info" aria-label="写作日期📅" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2022-12-10T00:00:00.000Z"></span><span class="category-info" aria-label="分类🌈" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><span class="category-item category6 clickable" role="navigation">spring cloud</span><span class="category-item category4 clickable" role="navigation">gateway</span><meta property="articleSection" content="spring cloud,gateway"></span><span class="tag-info" aria-label="标签🏷" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><span class="tag-item tag-item6 clickable" role="navigation">spring cloud</span><span class="tag-item tag-item4 clickable" role="navigation">gateway</span><meta property="keywords" content="spring cloud,gateway"></span><span class="reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 17 分钟</span><meta property="timeRequired" content="PT17M"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><div class="toc-header">此页内容</div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/spring-cloud/spring-cloud-gateway/spring-cloud-gateway.html#一、什么是-spring-cloud-gateway" class="router-link-active router-link-exact-active toc-link level2">一、什么是 Spring Cloud Gateway</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/spring-cloud/spring-cloud-gateway/spring-cloud-gateway.html#二、什么是服务网关" class="router-link-active router-link-exact-active toc-link level2">二、什么是服务网关</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/spring-cloud/spring-cloud-gateway/spring-cloud-gateway.html#三、为什么要使用网关" class="router-link-active router-link-exact-active toc-link level2">三、为什么要使用网关</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/spring-cloud/spring-cloud-gateway/spring-cloud-gateway.html#四、网关解决了什么问题" class="router-link-active router-link-exact-active toc-link level2">四、网关解决了什么问题</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/spring-cloud/spring-cloud-gateway/spring-cloud-gateway.html#五、常用网关解决方案" class="router-link-active router-link-exact-active toc-link level2">五、常用网关解决方案</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/spring-cloud/spring-cloud-gateway/spring-cloud-gateway.html#_5-1-nginx-lua" class="router-link-active router-link-exact-active toc-link level3">5.1 Nginx + Lua</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/spring-cloud/spring-cloud-gateway/spring-cloud-gateway.html#_5-2-kong" class="router-link-active router-link-exact-active toc-link level3">5.2 Kong</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/spring-cloud/spring-cloud-gateway/spring-cloud-gateway.html#_5-3-spring-cloud-netiflx-zuul" class="router-link-active router-link-exact-active toc-link level3">5.3 Spring Cloud Netiflx Zuul</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/spring-cloud/spring-cloud-gateway/spring-cloud-gateway.html#_5-4-spring-cloud-gateway" class="router-link-active router-link-exact-active toc-link level3">5.4 Spring Cloud Gateway</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/spring-cloud/spring-cloud-gateway/spring-cloud-gateway.html#六、spring-cloud-gateway实现网关" class="router-link-active router-link-exact-active toc-link level2">六、Spring Cloud Gateway实现网关</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/spring-cloud/spring-cloud-gateway/spring-cloud-gateway.html#_6-1-核心概念" class="router-link-active router-link-exact-active toc-link level3">6.1 核心概念</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/spring-cloud/spring-cloud-gateway/spring-cloud-gateway.html#_6-2-工作原理" class="router-link-active router-link-exact-active toc-link level3">6.2 工作原理</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/spring-cloud/spring-cloud-gateway/spring-cloud-gateway.html#_6-3-路由规则" class="router-link-active router-link-exact-active toc-link level3">6.3 路由规则</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/spring-cloud/spring-cloud-gateway/spring-cloud-gateway.html#七、动态路由" class="router-link-active router-link-exact-active toc-link level2">七、动态路由</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/spring-cloud/spring-cloud-gateway/spring-cloud-gateway.html#八、过滤器" class="router-link-active router-link-exact-active toc-link level2">八、过滤器</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/spring-cloud/spring-cloud-gateway/spring-cloud-gateway.html#_8-1-网关过滤器" class="router-link-active router-link-exact-active toc-link level3">8.1 网关过滤器</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/spring-cloud/spring-cloud-gateway/spring-cloud-gateway.html#_8-2-全局过滤器" class="router-link-active router-link-exact-active toc-link level3">8.2 全局过滤器</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/spring-cloud/spring-cloud-gateway/spring-cloud-gateway.html#_8-3-自定义过滤器" class="router-link-active router-link-exact-active toc-link level3">8.3 自定义过滤器</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/spring-cloud/spring-cloud-gateway/spring-cloud-gateway.html#九、网关限流" class="router-link-active router-link-exact-active toc-link level2">九、网关限流</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/spring-cloud/spring-cloud-gateway/spring-cloud-gateway.html#_9-1-为什么需要限流" class="router-link-active router-link-exact-active toc-link level3">9.1 为什么需要限流</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/spring-cloud/spring-cloud-gateway/spring-cloud-gateway.html#_9-2-限流算法" class="router-link-active router-link-exact-active toc-link level3">9.2 限流算法</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/spring-cloud/spring-cloud-gateway/spring-cloud-gateway.html#_9-3-计数器法" class="router-link-active router-link-exact-active toc-link level3">9.3 计数器法</a></li><!----><!--]--></ul><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><h1 id="spring-cloud-gateway" tabindex="-1"><a class="header-anchor" href="#spring-cloud-gateway" aria-hidden="true">#</a> Spring Cloud Gateway</h1><h2 id="一、什么是-spring-cloud-gateway" tabindex="-1"><a class="header-anchor" href="#一、什么是-spring-cloud-gateway" aria-hidden="true">#</a> 一、什么是 Spring Cloud Gateway</h2><p>Spring Cloud Gateway 作为 Spring Cloud 生态系统中的网关，目标是替代 Netflix Zuul，其不仅提供统一的路由方式，并且还基于 Filter 链的方式提供了网关基本的功能。目前最新版 Spring Cloud 中引用的还是 Zuul 1.x 版本，而这个版本是基于过滤器的，是阻塞 IO，不支持长连接。</p><p>Zuul 2.x 版本一直跳票，2019 年 5 月，Netflix 终于开源了支持异步调用模式的 Zuul 2.0 版本，真可谓千呼万唤始出来。但是 Spring Cloud 已经不再集成 Zuul 2.x 了，那么是时候了解一下 SpringCloud Gateway 了。</p><p>Spring Cloud Gateway 是基于 Spring 生态系统之上构建的 API 网关，包括：Spring 5，Spring Boot 2 和 Project Reactor。Spring Cloud Gateway 旨在提供一种简单而有效的方法来路由到 API，并为它们提供跨领域的关注点，例如：安全性，监视/指标，限流等。由于 Spring 5.0 支持 Netty，Http2，而 Spring boot 2.0 支持 Spring 5.0，因此 Spring Cloud Gateway 支持 Netty 和 Http2 顺理成章。</p><h2 id="二、什么是服务网关" tabindex="-1"><a class="header-anchor" href="#二、什么是服务网关" aria-hidden="true">#</a> 二、什么是服务网关</h2><p>API Gateway（APIGW / API 网关），顾名思义，是出现在系统边界上的一个面向 API 的、串行集中式的强管控服务，这里的边界是企业 IT 系统的边界，可以理解为企业级应用防火墙，主要起到隔离外部访问与内部系统的作用。在微服务概念的流行之前，API 网关就已经诞生了，例如银行、证券等领域常见的前置机系统，它也是解决访问认证、报文转换、访问统计等问题的。</p><p>API 网关的流行，源于近几年来移动应用与企业间互联需求的兴起。移动应用、企业互联，使得后台服务支持的对象，从以前单一的Web应用，扩展到多种使用场景，且每种使用场景对后台服务的要求都不尽相同。这不仅增加了后台服务的响应量，还增加了后台服务的复杂性。随着微服务架构概念的提出，API网关成为了微服务架构的一个标配组件。</p><p>API 网关是一个服务器，是系统对外的唯一入口。API 网关封装了系统内部架构，为每个客户端提供定制的 API。所有的客户端和消费端都通过统一的网关接入微服务，在网关层处理所有非业务功能。API 网关并不是微服务场景中必须的组件，如下图，不管有没有 API 网关，后端微服务都可以通过 API 很好地支持客户端的访问。</p><p><img src="/assets/image-20221207111802922-621e509c.png" alt="image-20221207111802922"></p><p>但对于服务数量众多、复杂度比较高、规模比较大的业务来说，引入 API 网关也有一系列的好处：</p><ul><li><p>聚合接口使得服务对调用者透明，客户端与后端的耦合度降低</p></li><li><p>聚合后台服务，节省流量，提高性能，提升用户体验</p></li><li><p>提供安全、流控、过滤、缓存、计费、监控等 API 管理功能</p></li></ul><h2 id="三、为什么要使用网关" tabindex="-1"><a class="header-anchor" href="#三、为什么要使用网关" aria-hidden="true">#</a> 三、为什么要使用网关</h2><ul><li>单体应用：浏览器发起请求到单体应用所在的机器，应用从数据库查询数据原路返回给浏览器，对于单体应用来说是不需要网关的。</li><li>微服务：微服务的应用可能部署在不同机房，不同地区，不同域名下。此时客户端（浏览器/手机/软件工具）想要请求对应的服务，都需要知道机器的具体 IP 或者域名 URL，当微服务实例众多时，这是非常难以记忆的，对于客户端来说也太复杂难以维护。此时就有了网关，客户端相关的请求直接发送到网关，由网关根据请求标识解析判断出具体的微服务地址，再把请求转发到微服务实例。这其中的记忆功能就全部交由网关来操作了。</li></ul><p><img src="/assets/image-20221207112013132-7c10b663.png" alt="image-20221207112013132"></p><p><strong>总结</strong></p><p>如果让客户端直接与各个微服务交互：</p><ul><li><p>客户端会多次请求不同的微服务，增加了客户端的复杂性</p></li><li><p>存在跨域请求，在一定场景下处理相对复杂</p></li><li><p>身份认证问题，每个微服务需要独立身份认证</p></li><li><p>难以重构，随着项目的迭代，可能需要重新划分微服务</p></li><li><p>某些微服务可能使用了防火墙/浏览器不友好的协议，直接访问会有一定的困难</p></li></ul><p></p><p>因此，我们需要网关介于客户端与服务器之间的中间层，所有外部请求率先经过微服务网关，客户端只需要与网关交互，只需要知道网关地址即可。这样便简化了开发且有以下优点：</p><ul><li><p>易于监控，可在微服务网关收集监控数据并将其推送到外部系统进行分析</p></li><li><p>易于认证，可在微服务网关上进行认证，然后再将请求转发到后端的微服务，从而无需在每个微服</p></li><li><p>务中进行认证</p></li><li><p>减少了客户端与各个微服务之间的交互次数</p></li></ul><h2 id="四、网关解决了什么问题" tabindex="-1"><a class="header-anchor" href="#四、网关解决了什么问题" aria-hidden="true">#</a> 四、网关解决了什么问题</h2><p><img src="/assets/image-20221207112311005-0190f01e.png" alt="image-20221207112311005"></p><p>网关具有身份认证与安全、审查与监控、动态路由、负载均衡、缓存、请求分片与管理、静态响应处理等功能。当然最主要的职责还是与“外界联系”。</p><p>总结一下，网关应当具备以下功能：</p><ul><li><p>性能：API 高可用，负载均衡，容错机制。</p></li><li><p>安全：权限身份认证、脱敏，流量清洗，后端签名（保证全链路可信调用），黑名单（非法调用的限制）。</p></li><li><p>日志：日志记录，一旦涉及分布式，全链路跟踪必不可少。</p></li><li><p>缓存：数据缓存。</p></li><li><p>监控：记录请求响应数据，API 耗时分析，性能监控。</p></li><li><p>限流：流量控制，错峰流控，可以定义多种限流规则。</p></li><li><p>灰度：线上灰度部署，可以减小风险。</p></li><li><p>路由：动态路由规则。</p></li></ul><h2 id="五、常用网关解决方案" tabindex="-1"><a class="header-anchor" href="#五、常用网关解决方案" aria-hidden="true">#</a> 五、常用网关解决方案</h2><h3 id="_5-1-nginx-lua" tabindex="-1"><a class="header-anchor" href="#_5-1-nginx-lua" aria-hidden="true">#</a> 5.1 Nginx + Lua</h3><p>Nginx 是由 IgorSysoev 为俄罗斯访问量第二的 Rambler.ru 站点开发的，一个高性能的 HTTP 和反向代理服务器。Ngnix 一方面可以做反向代理，另外一方面做可以做静态资源服务器。</p><ul><li><p>Nginx 适合做门户网关，是作为整个全局的网关，对外的处于最外层的那种；而 Gateway 属于业务网关，主要用来对应不同的客户端提供服务，用于聚合业务。各个微服务独立部署，职责单一，对外提供服务的时候需要有一个东西把业务聚合起来。</p></li><li><p>Gateway 可以实现熔断、重试等功能，这是 Nginx 不具备的。</p></li></ul><h3 id="_5-2-kong" tabindex="-1"><a class="header-anchor" href="#_5-2-kong" aria-hidden="true">#</a> 5.2 Kong</h3><p>Kong 是 Mashape 提供的一款 API 管理软件，它本身是基于 Ngnix + Lua 的，但比 Nginx 提供了更简单的配置方式，数据采用了 ApacheCassandra/PostgreSQL 存储，并且提供了一些优秀的插件，比如验证，日志，调用频次限制等。Kong 非常诱人的地方就是提供了大量的插件来扩展应用，通过设置不同的插件可以为服务提供各种增强的功能。</p><ul><li><p>优点：基于 Nginx 所以在性能和稳定性上都没有问题。Kong 作为一款商业软件，在 Nginx 上做了很扩展工作，而且还有很多付费的商业插件。Kong 本身也有付费的企业版，其中包括技术支持、使用培训服务以及 API 分析插件。</p></li><li><p>缺点：如果你使用 Spring Cloud，Kong 如何结合目前已有的服务治理体系？</p></li></ul><h3 id="_5-3-spring-cloud-netiflx-zuul" tabindex="-1"><a class="header-anchor" href="#_5-3-spring-cloud-netiflx-zuul" aria-hidden="true">#</a> 5.3 Spring Cloud Netiflx Zuul</h3><p>Zuul 是 Netflix 公司开源的一个 API 网关组件，Spring Cloud 对其进行二次基于 Spring Boot 的注解式封装做到开箱即用。目前来说，结合 Sring Cloud 提供的服务治理体系，可以做到请求转发，根据配置或者默认的路由规则进行路由和 Load Balance，无缝集成 Hystrix。</p><p>虽然可以通过自定义 Filter 实现我们想要的功能，但是由于 Zuul 本身的设计是基于单线程的接收请求和转发处理，是阻塞 IO，不支持长连接。目前来看 Zuul 就显得很鸡肋，随着 Zuul 2.x 一直跳票</p><p>（2019 年 5 月发布了 Zuul 2.0 版本），Spring Cloud 推出自己的 Spring Cloud Gateway。大意就是：Zuul 已死，Spring Cloud Gateway 永生（手动狗头）。</p><h3 id="_5-4-spring-cloud-gateway" tabindex="-1"><a class="header-anchor" href="#_5-4-spring-cloud-gateway" aria-hidden="true">#</a> 5.4 Spring Cloud Gateway</h3><p>本文主角</p><h2 id="六、spring-cloud-gateway实现网关" tabindex="-1"><a class="header-anchor" href="#六、spring-cloud-gateway实现网关" aria-hidden="true">#</a> 六、Spring Cloud Gateway实现网关</h2><h3 id="_6-1-核心概念" tabindex="-1"><a class="header-anchor" href="#_6-1-核心概念" aria-hidden="true">#</a> 6.1 核心概念</h3><p>**路由（Route）：**路由是网关最基础的部分，路由信息由 ID、目标 URI、一组断言和一组过滤器组成。如果断言路由为真，则说明请求的 URI 和配置匹配。</p><p>**断言（Predicate）：**Java8 中的断言函数。Spring Cloud Gateway 中的断言函数输入类型是 Spring 5.0 框架中的 ServerWebExchange。Spring Cloud Gateway 中的断言函数允许开发者去定义匹配来自于 Http Request 中的任何信息，比如请求头和参数等。</p><p>**过滤器（Filter）：**一个标准的 Spring Web Filter。Spring Cloud Gateway 中的 Filter 分为两种类型，分别是 Gateway Filter 和 Global Filter。过滤器将会对请求和响应进行处理。</p><h3 id="_6-2-工作原理" tabindex="-1"><a class="header-anchor" href="#_6-2-工作原理" aria-hidden="true">#</a> 6.2 工作原理</h3><p><img src="/assets/spring_cloud_gateway_diagram-687f60eb.png" alt="Spring Cloud Gateway Diagram"></p><p>如上图所示，客户端向 Spring Cloud Gateway 发出请求。再由网关处理程序 Gateway Handler Mapping 映射确定与请求相匹配的路由，将其发送到网关 Web 处理程序 Gateway Web Handler 。该处理程序通过指定的过滤器链将请求发送到我们实际的服务执行业务逻辑，然后返回。过滤器由虚线分隔的原因是，过滤器可以在发送代理请求之前和之后运行逻辑。所有 pre 过滤器逻辑均被执行。然后发出代理请求。发出代理请求后，将运行 post 过滤器逻辑。</p><h3 id="_6-3-路由规则" tabindex="-1"><a class="header-anchor" href="#_6-3-路由规则" aria-hidden="true">#</a> 6.3 路由规则</h3><p>Spring Cloud Gateway 创建 Route 对象时， 使用 RoutePredicateFactory 创建 Predicate 对象，Predicate 对象可以赋值给 Route。</p><ul><li><p>Spring Cloud Gateway 包含许多内置的 Route Predicate Factories。</p></li><li><p>所有这些断言都匹配 HTTP 请求的不同属性。</p></li><li><p>多个 Route Predicate Factories 可以通过逻辑与（and）结合起来一起使用。</p></li></ul><p>路由断言工厂 RoutePredicateFactory 包含的主要实现类如图所示，包括 Datetime、 请求的远端地址、 路由权重、 请求头、 Host 地址、 请求方法、 请求路径和请求参数等类型的路由断言。</p><p><img src="/assets/image-20221207171827407-35f5c533.png" alt="image-20221207171827407"></p><p>路由配置的形式有两种</p><p>【1】 简写形式</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> after_route
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//example.org
          <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> Cookie=mycookie<span class="token punctuation">,</span>mycookievalue
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>【2】 完整形式</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> after_route
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//example.org
        <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Cookie
          <span class="token key atrule">args</span><span class="token punctuation">:</span>
            <span class="token key atrule">name</span><span class="token punctuation">:</span> mycookie
            <span class="token key atrule">regexp</span><span class="token punctuation">:</span> mycookievalue
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>接下来我们举例说明其中一部分如何使用，其余等大家工作中需要应用时自行查询。</p><h4 id="_6-3-1-path" tabindex="-1"><a class="header-anchor" href="#_6-3-1-path" aria-hidden="true">#</a> 6.3.1 Path</h4><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
   <span class="token key atrule">name</span><span class="token punctuation">:</span> gateway<span class="token punctuation">-</span>server <span class="token comment"># 应用名称</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token comment"># 路由规则</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> product<span class="token punctuation">-</span>service <span class="token comment"># 路由 ID，唯一</span>
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>7070/ <span class="token comment"># 目标 URI，路由到微服务的地址</span>
          <span class="token key atrule">predicates</span><span class="token punctuation">:</span> <span class="token comment"># 断言（判断条件）</span>
            <span class="token punctuation">-</span> Path=/product/<span class="token important">**</span> <span class="token comment"># 匹配对应 URL 的请求，将匹配到的请求追加在目标URI 之后</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>请求 http://localhost:9000/product/1 将会路由至 http://localhost:7070/product/1</p><h4 id="_6-3-2-query" tabindex="-1"><a class="header-anchor" href="#_6-3-2-query" aria-hidden="true">#</a> 6.3.2 Query</h4><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> gateway<span class="token punctuation">-</span>server <span class="token comment"># 应用名称</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token comment"># 路由规则</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> product<span class="token punctuation">-</span>service <span class="token comment"># 路由 ID，唯一</span>
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>7070/ <span class="token comment"># 目标 URI，路由到微服务的地址</span>
          <span class="token key atrule">predicates</span><span class="token punctuation">:</span> <span class="token comment"># 断言（判断条件）</span>
            <span class="token comment">#- Query=token # 匹配请求参数中包含 token 的请求</span>
            <span class="token punctuation">-</span> Query=token<span class="token punctuation">,</span> abc. <span class="token comment"># 匹配请求参数中包含 token 并且其参数值满足正则表达式 abc. 的请求</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p><code>Query=token</code> ：比如，http://localhost:9000/product/1?token=123</p></li><li><p><code>Query=token, abc</code> ：比如，http://localhost:9000/product/1?token=abc1</p></li></ul><h4 id="_6-3-3-method" tabindex="-1"><a class="header-anchor" href="#_6-3-3-method" aria-hidden="true">#</a> 6.3.3 Method</h4><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> gateway<span class="token punctuation">-</span>server <span class="token comment"># 应用名称</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
    <span class="token comment"># 路由规则</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> product<span class="token punctuation">-</span>service <span class="token comment"># 路由 ID，唯一</span>
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>7070/ <span class="token comment"># 目标 URI，路由到微服务的地址</span>
          <span class="token key atrule">predicates</span><span class="token punctuation">:</span> <span class="token comment"># 断言（判断条件）</span>
            <span class="token punctuation">-</span> Method=GET <span class="token comment"># 匹配任意 GET 请求</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_6-3-4-datetime" tabindex="-1"><a class="header-anchor" href="#_6-3-4-datetime" aria-hidden="true">#</a> 6.3.4 Datetime</h4><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> gateway<span class="token punctuation">-</span>server <span class="token comment"># 应用名称</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
    <span class="token comment"># 路由规则</span>
    <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> product<span class="token punctuation">-</span>service <span class="token comment"># 路由 ID，唯一</span>
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>7070/ <span class="token comment"># 目标 URI，路由到微服务的地址</span>
        <span class="token key atrule">predicates</span><span class="token punctuation">:</span> <span class="token comment"># 断言（判断条件）</span>
          <span class="token comment"># 匹配中国上海时间 2020-02-02 20:20:20 之后的请求</span>
          <span class="token punctuation">-</span> After=2020<span class="token punctuation">-</span>02<span class="token punctuation">-</span>02T20<span class="token punctuation">:</span>20<span class="token punctuation">:</span>20.000+08<span class="token punctuation">:</span>00<span class="token punctuation">[</span>Asia/Shanghai<span class="token punctuation">]</span>
          <span class="token comment"># 配置指定时间之前</span>
          <span class="token punctuation">-</span> Before=2017<span class="token punctuation">-</span>01<span class="token punctuation">-</span>20T17<span class="token punctuation">:</span>42<span class="token punctuation">:</span>47.789<span class="token punctuation">-</span>07<span class="token punctuation">:</span>00<span class="token punctuation">[</span>Asia/Shanghai<span class="token punctuation">]</span>
          <span class="token comment"># 匹配两个时间段之间</span>
          <span class="token punctuation">-</span> Between=2017<span class="token punctuation">-</span>01<span class="token punctuation">-</span>20T17<span class="token punctuation">:</span>42<span class="token punctuation">:</span>47.789<span class="token punctuation">-</span>07<span class="token punctuation">:</span>00<span class="token punctuation">[</span>Asia/Shanghai<span class="token punctuation">]</span><span class="token punctuation">,</span> 2017<span class="token punctuation">-</span>01<span class="token punctuation">-</span>21T17<span class="token punctuation">:</span>42<span class="token punctuation">:</span>47.789<span class="token punctuation">-</span>07<span class="token punctuation">:</span>00<span class="token punctuation">[</span>Asia/Shanghai<span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_6-3-5-remoteaddr" tabindex="-1"><a class="header-anchor" href="#_6-3-5-remoteaddr" aria-hidden="true">#</a> 6.3.5 RemoteAddr</h4><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> gateway<span class="token punctuation">-</span>server <span class="token comment"># 应用名称</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token comment"># 路由规则</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> product<span class="token punctuation">-</span>service <span class="token comment"># 路由 ID，唯一</span>
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>7070/ <span class="token comment"># 目标 URI，路由到微服务的地址</span>
          <span class="token key atrule">predicates</span><span class="token punctuation">:</span> <span class="token comment"># 断言（判断条件）</span>
            <span class="token punctuation">-</span> RemoteAddr=192.168.10.1/0 <span class="token comment"># 匹配远程地址请求是 RemoteAddr 的请求，0表示子网掩码</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>RemoteAddr=192.168.10.1/0 ：比如，http://192.168.10.1:9000/product/1</li></ul><h4 id="_6-3-6-header" tabindex="-1"><a class="header-anchor" href="#_6-3-6-header" aria-hidden="true">#</a> 6.3.6 Header</h4><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> gateway<span class="token punctuation">-</span>server <span class="token comment"># 应用名称</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token comment"># 路由规则</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> product<span class="token punctuation">-</span>service <span class="token comment"># 路由 ID，唯一</span>
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>7070/ <span class="token comment"># 目标 URI，路由到微服务的地址</span>
          <span class="token key atrule">predicates</span><span class="token punctuation">:</span> <span class="token comment"># 断言（判断条件）</span>
          <span class="token comment"># 匹配请求头包含 X-Request-Id 并且其值匹配正则表达式 \d+ 的请求</span>
          <span class="token punctuation">-</span> Header=X<span class="token punctuation">-</span>Request<span class="token punctuation">-</span>Id<span class="token punctuation">,</span> \d+
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_6-3-7-cookie" tabindex="-1"><a class="header-anchor" href="#_6-3-7-cookie" aria-hidden="true">#</a> 6.3.7 Cookie</h4><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token comment"># 路由规则</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> cookie_route
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//example.org
        <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
          <span class="token comment"># Cookie 接收两个值，name 和 regexp, regexp是一个正则表达式的形式</span>
          <span class="token punctuation">-</span> Cookie=chocolate<span class="token punctuation">,</span> ch.p
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_6-3-8-host" tabindex="-1"><a class="header-anchor" href="#_6-3-8-host" aria-hidden="true">#</a> 6.3.8 Host</h4><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> host_route
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//example.org
        <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> Host=<span class="token important">**.somehost.org</span><span class="token punctuation">,</span><span class="token important">**.anotherhost.org</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_6-3-9-weight" tabindex="-1"><a class="header-anchor" href="#_6-3-9-weight" aria-hidden="true">#</a> 6.3.9 Weight</h4><p>Weight路由接收两个参数，group和weight，</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> weight_high
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//weighthigh.org
        <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> Weight=group1<span class="token punctuation">,</span> <span class="token number">8</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> weight_low
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//weightlow.org
        <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> Weight=group1<span class="token punctuation">,</span> <span class="token number">2</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>该配置表示80%的请求转发给weight_high，20%的请求转发给weight_low</p><h2 id="七、动态路由" tabindex="-1"><a class="header-anchor" href="#七、动态路由" aria-hidden="true">#</a> 七、动态路由</h2><h2 id="八、过滤器" tabindex="-1"><a class="header-anchor" href="#八、过滤器" aria-hidden="true">#</a> 八、过滤器</h2><h3 id="_8-1-网关过滤器" tabindex="-1"><a class="header-anchor" href="#_8-1-网关过滤器" aria-hidden="true">#</a> 8.1 网关过滤器</h3><p>网关过滤器用于拦截并链式处理 Web 请求，可以实现横切与应用无关的需求，比如：安全、访问超时的设置等。修改传入的 HTTP 请求或传出 HTTP 响应。Spring Cloud Gateway 包含许多内置的网关过滤器工厂一共有 22 个，包括头部过滤器、 路径类过滤器、Hystrix 过滤器和重写请求 URL 的过滤器， 还有参数和状态码等其他类型的过滤器。根据过滤器工厂的用途来划分，可以分为以下几种：Header、Parameter、Path、Body、Status、Session、Redirect、Retry、RateLimiter 和 Hystrix。</p><p><img src="/assets/image-20221218170347033-ffc4c76f.png" alt="image-20221218170347033"></p><p>接下来我们举例说明其中一部分如何使用。</p><h4 id="_8-1-1-path-路径过滤器" tabindex="-1"><a class="header-anchor" href="#_8-1-1-path-路径过滤器" aria-hidden="true">#</a> 8.1.1 Path 路径过滤器</h4><p>Path 路径过滤器可以实现 URL 重写，通过重写 URL 可以实现隐藏实际路径提高安全性，易于用户记忆和键入，易于被搜索引擎收录等优点。实现方式如下：</p><p>RewritePathGatewayFilterFactory</p><p>RewritePath 网关过滤器工厂采用路径正则表达式参数和替换参数，使用 Java 正则表达式来灵活地重写请求路径。</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> gateway<span class="token punctuation">-</span>server <span class="token comment"># 应用名称</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token comment"># 路由规则</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> product<span class="token punctuation">-</span>service <span class="token comment"># 路由 ID，唯一</span>
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//product<span class="token punctuation">-</span>service <span class="token comment"># lb:// 根据服务名称从注册中心获取服务请求地址</span>
          <span class="token key atrule">predicates</span><span class="token punctuation">:</span> <span class="token comment"># 断言（判断条件）</span>
          <span class="token comment"># 匹配对应 URI 的请求，将匹配到的请求追加在目标 URI 之后</span>
            <span class="token punctuation">-</span> Path=/product/<span class="token important">**</span><span class="token punctuation">,</span> /api<span class="token punctuation">-</span>gateway/<span class="token important">**</span>
          <span class="token key atrule">filters</span><span class="token punctuation">:</span> <span class="token comment"># 网关过滤器</span>
            <span class="token comment"># 将 /api-gateway/product/1 重写为 /product/1</span>
            <span class="token punctuation">-</span> RewritePath=/api<span class="token punctuation">-</span>gateway(<span class="token punctuation">?</span>&lt;segment<span class="token punctuation">&gt;</span>/<span class="token punctuation">?</span>.<span class="token important">*)</span><span class="token punctuation">,</span> $\<span class="token punctuation">{</span>segment<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-2-全局过滤器" tabindex="-1"><a class="header-anchor" href="#_8-2-全局过滤器" aria-hidden="true">#</a> 8.2 全局过滤器</h3><p>全局过滤器不需要在配置文件中配置，作用在所有的路由上，最终通过 GatewayFilterAdapter 包装成 GatewayFilterChain 可识别的过滤器，它是请求业务以及路由的 URI 转换为真实业务服务请求地址的核心过滤器，不需要配置系统初始化时加载，并作用在每个路由上。</p><p><img src="/assets/image-20221218171057170-d72bada1.png" alt="image-20221218171057170"></p><h3 id="_8-3-自定义过滤器" tabindex="-1"><a class="header-anchor" href="#_8-3-自定义过滤器" aria-hidden="true">#</a> 8.3 自定义过滤器</h3><p>即使 Spring Cloud Gateway 自带许多实用的 GatewayFilter Factory、Gateway Filter、Global Filter ，但是在很多情景下我们仍然希望可以自定义自己的过滤器，实现一些骚操作。</p><h4 id="_8-3-1-自定义网关过滤器" tabindex="-1"><a class="header-anchor" href="#_8-3-1-自定义网关过滤器" aria-hidden="true">#</a> 8.3.1 自定义网关过滤器</h4><p>自定义网关过滤器需要实现以下两个接口 ： GatewayFilter ， Ordered 。</p><p>【1】<strong>创建过滤器</strong></p><p>CustomGatewayFilter.java</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>gateway<span class="token punctuation">.</span>filter<span class="token punctuation">.</span></span><span class="token class-name">GatewayFilter</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>gateway<span class="token punctuation">.</span>filter<span class="token punctuation">.</span></span><span class="token class-name">GatewayFilterChain</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">Ordered</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>server<span class="token punctuation">.</span></span><span class="token class-name">ServerWebExchange</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">reactor<span class="token punctuation">.</span>core<span class="token punctuation">.</span>publisher<span class="token punctuation">.</span></span><span class="token class-name">Mono</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * 自定义网关过滤器
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomGatewayFilter</span> <span class="token keyword">implements</span> <span class="token class-name">GatewayFilter</span><span class="token punctuation">,</span> <span class="token class-name">Ordered</span> <span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * 过滤器业务逻辑
     *
     * <span class="token keyword">@param</span> <span class="token parameter">exchange</span>
     * <span class="token keyword">@param</span> <span class="token parameter">chain</span>
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token class-name">ServerWebExchange</span> exchange<span class="token punctuation">,</span> <span class="token class-name">GatewayFilterChain</span> chain<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;自定义网关过滤器被执行&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> chain<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>exchange<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 继续向下执行</span>
    <span class="token punctuation">}</span>
    <span class="token doc-comment comment">/**
     * 过滤器执行顺序，数值越小，优先级越高
     *
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>【2】<strong>注册过滤器</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>yjxxt<span class="token punctuation">.</span>filter<span class="token punctuation">.</span></span><span class="token class-name">CustomGatewayFilter</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>gateway<span class="token punctuation">.</span>route<span class="token punctuation">.</span></span><span class="token class-name">RouteLocator</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>gateway<span class="token punctuation">.</span>route<span class="token punctuation">.</span>builder<span class="token punctuation">.</span></span><span class="token class-name">RouteLocatorBuilder</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span>
<span class="token doc-comment comment">/**
 * 网关路由配置类
 */</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GatewayRoutesConfiguration</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">RouteLocator</span> <span class="token function">routeLocator</span><span class="token punctuation">(</span><span class="token class-name">RouteLocatorBuilder</span> builder<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> builder<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span>r <span class="token operator">-&gt;</span> r
            <span class="token comment">// 断言（判断条件）</span>
            <span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token string">&quot;/product/**&quot;</span><span class="token punctuation">)</span>
            <span class="token comment">// 目标 URI，路由到微服务的地址</span>
            <span class="token punctuation">.</span><span class="token function">uri</span><span class="token punctuation">(</span><span class="token string">&quot;lb://product-service&quot;</span><span class="token punctuation">)</span>
            <span class="token comment">// 注册自定义网关过滤器</span>
            <span class="token punctuation">.</span><span class="token function">filters</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CustomGatewayFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token comment">// 路由 ID，唯一</span>
            <span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token string">&quot;product-service&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_8-3-2-自定义全局过滤器" tabindex="-1"><a class="header-anchor" href="#_8-3-2-自定义全局过滤器" aria-hidden="true">#</a> 8.3.2 自定义全局过滤器</h4><p>自定义全局过滤器需要实现以下两个接口 ： GlobalFilter ， Ordered 。通过全局过滤器可以实现权限校验，安全性验证等功能。</p><p>【1】<strong>创建过滤器</strong></p><p>实现指定接口，添加 @Component 注解即可。</p><p>CustomGlobalFilter.java</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>gateway<span class="token punctuation">.</span>filter<span class="token punctuation">.</span></span><span class="token class-name">GatewayFilterChain</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>gateway<span class="token punctuation">.</span>filter<span class="token punctuation">.</span></span><span class="token class-name">GlobalFilter</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">Ordered</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>server<span class="token punctuation">.</span></span><span class="token class-name">ServerWebExchange</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">reactor<span class="token punctuation">.</span>core<span class="token punctuation">.</span>publisher<span class="token punctuation">.</span></span><span class="token class-name">Mono</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * 自定义全局过滤器
 */</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomGlobalFilter</span> <span class="token keyword">implements</span> <span class="token class-name">GlobalFilter</span><span class="token punctuation">,</span> <span class="token class-name">Ordered</span> <span class="token punctuation">{</span>
    
    <span class="token doc-comment comment">/**
     * 过滤器业务逻辑
     * <span class="token keyword">@param</span> <span class="token parameter">exchange</span>
     * <span class="token keyword">@param</span> <span class="token parameter">chain</span>
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token class-name">ServerWebExchange</span> exchange<span class="token punctuation">,</span> <span class="token class-name">GatewayFilterChain</span> chain<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;自定义全局过滤器被执行&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> chain<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>exchange<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 继续向下执行</span>
    <span class="token punctuation">}</span>
    
    <span class="token doc-comment comment">/**
     * 过滤器执行顺序，数值越小，优先级越高
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_8-3-3-统一鉴权" tabindex="-1"><a class="header-anchor" href="#_8-3-3-统一鉴权" aria-hidden="true">#</a> 8.3.3 统一鉴权</h4><p>接下来我们在网关过滤器中通过 token 判断用户是否登录，完成一个统一鉴权案例。</p><p>【1】<strong>创建过滤器</strong></p><p>AccessFilter.java</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Logger</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">LoggerFactory</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>gateway<span class="token punctuation">.</span>filter<span class="token punctuation">.</span></span><span class="token class-name">GatewayFilterChain</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>gateway<span class="token punctuation">.</span>filter<span class="token punctuation">.</span></span><span class="token class-name">GlobalFilter</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">Ordered</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>core<span class="token punctuation">.</span>io<span class="token punctuation">.</span>buffer<span class="token punctuation">.</span></span><span class="token class-name">DataBuffer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpStatus</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http<span class="token punctuation">.</span>server<span class="token punctuation">.</span>reactive<span class="token punctuation">.</span></span><span class="token class-name">ServerHttpResponse</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>server<span class="token punctuation">.</span></span><span class="token class-name">ServerWebExchange</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">reactor<span class="token punctuation">.</span>core<span class="token punctuation">.</span>publisher<span class="token punctuation">.</span></span><span class="token class-name">Mono</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * 权限验证过滤器
 */</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AccessFilter</span> <span class="token keyword">implements</span> <span class="token class-name">GlobalFilter</span><span class="token punctuation">,</span> <span class="token class-name">Ordered</span> <span class="token punctuation">{</span>    
    
    <span class="token keyword">private</span> <span class="token class-name">Logger</span> logger <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">AccessFilter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * 过滤器业务逻辑
     * <span class="token keyword">@param</span> <span class="token parameter">exchange</span>
     * <span class="token keyword">@param</span> <span class="token parameter">chain</span>
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token class-name">ServerWebExchange</span> exchange<span class="token punctuation">,</span> <span class="token class-name">GatewayFilterChain</span> chain<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 获取请求参数</span>
        <span class="token class-name">String</span> token <span class="token operator">=</span> exchange<span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getQueryParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getFirst</span><span class="token punctuation">(</span><span class="token string">&quot;token&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 业务逻辑处理</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">==</span> token<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        	logger<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">&quot;token is null...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    		<span class="token class-name">ServerHttpResponse</span> response <span class="token operator">=</span> exchange<span class="token punctuation">.</span><span class="token function">getResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 响应类型</span>
            response<span class="token punctuation">.</span><span class="token function">getHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;Content-Type&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;application/json; charset=utf-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 响应状态码，HTTP 401 错误代表用户没有访问权限</span>
            response<span class="token punctuation">.</span><span class="token function">setStatusCode</span><span class="token punctuation">(</span><span class="token class-name">HttpStatus</span><span class="token punctuation">.</span><span class="token constant">UNAUTHORIZED</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 响应内容</span>
            <span class="token class-name">String</span> message <span class="token operator">=</span> <span class="token string">&quot;{\&quot;message\&quot;:\&quot;&quot;</span> <span class="token operator">+</span>
            <span class="token class-name">HttpStatus</span><span class="token punctuation">.</span><span class="token constant">UNAUTHORIZED</span><span class="token punctuation">.</span><span class="token function">getReasonPhrase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;\&quot;}&quot;</span><span class="token punctuation">;</span>
            <span class="token class-name">DataBuffer</span> buffer <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">bufferFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">wrap</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 请求结束，不在继续向下请求</span>
            <span class="token keyword">return</span> response<span class="token punctuation">.</span><span class="token function">writeWith</span><span class="token punctuation">(</span><span class="token class-name">Mono</span><span class="token punctuation">.</span><span class="token function">just</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token punctuation">}</span>
        <span class="token comment">// 使用 token 进行身份验证</span>
        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;token is OK!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> chain<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>exchange<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
    
    <span class="token doc-comment comment">/**
     * 过滤器执行顺序，数值越小，优先级越高
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="九、网关限流" tabindex="-1"><a class="header-anchor" href="#九、网关限流" aria-hidden="true">#</a> 九、网关限流</h2><p>顾名思义，限流就是限制流量，就像你宽带包有 1 个 G 的流量，用完了就没了。通过限流，我们可以很好地控制系统的 QPS，从而达到保护系统的目的。</p><h3 id="_9-1-为什么需要限流" tabindex="-1"><a class="header-anchor" href="#_9-1-为什么需要限流" aria-hidden="true">#</a> 9.1 为什么需要限流</h3><p>比如 Web 服务、对外 API，这种类型的服务有以下几种可能导致机器被拖垮：</p><ul><li><p>用户增长过快（好事）</p></li><li><p>因为某个热点事件（微博热搜）</p></li><li><p>竞争对象爬虫</p></li><li><p>恶意的请求</p></li></ul><p>这些情况都是无法预知的，不知道什么时候会有 10 倍甚至 20 倍的流量打进来，如果真碰上这种情况，扩容是根本来不及的。</p><p><img src="/assets/image-20221218175047145-e0786502.png" alt="image-20221218175047145"></p><p>从上图可以看出，对内而言：上游的 A、B 服务直接依赖了下游的基础服务 C，对于 A，B 服务都依赖的基础服务 C 这种场景，服务 A 和 B 其实处于某种竞争关系，如果服务 A 的并发阈值设置过大，当流量高峰期来临，有可能直接拖垮基础服务 C 并影响服务 B，即雪崩效应。</p><h3 id="_9-2-限流算法" tabindex="-1"><a class="header-anchor" href="#_9-2-限流算法" aria-hidden="true">#</a> 9.2 限流算法</h3><p>常见的限流算法有：</p><ul><li><p>计数器算法</p></li><li><p>漏桶（Leaky Bucket）算法</p></li><li><p>令牌桶（Token Bucket）算法</p></li></ul><h3 id="_9-3-计数器法" tabindex="-1"><a class="header-anchor" href="#_9-3-计数器法" aria-hidden="true">#</a> 9.3 计数器法</h3></div><!----><footer class="page-meta"><!----><div class="meta-item update-time"><span class="label">上次编辑于: </span><!----></div><div class="meta-item contributors"><span class="label">贡献者: </span><!--[--><!--[--><span class="contributor" title="email: 895252461@qq.com">xuliang</span><!--]--><!--]--></div></footer><nav class="page-nav"><a href="/spring-cloud/spring-cloud-alibaba-seate.html" class="nav-link prev" aria-label="/spring-cloud/spring-cloud-alibaba-seate.html"><div class="hint"><span class="arrow left"></span>上一页</div><div class="link"><!---->/spring-cloud/spring-cloud-alibaba-seate.html</div></a><!----></nav><!----><!----><!--]--></main><!--]--><!----><!--]--></div><!--]--><!----><!--]--></div>
    <script type="module" src="/assets/app-671fc831.js" defer></script>
  </body>
</html>
