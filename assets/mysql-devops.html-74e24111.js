import{_ as a,V as s,W as n,X as e}from"./framework-4ec38622.js";const i="/assets/image-20220529154502287-868611de.png",t={},d=e(`<h1 id="mysql-运维篇" tabindex="-1"><a class="header-anchor" href="#mysql-运维篇" aria-hidden="true">#</a> MySQL 运维篇</h1><h2 id="mysql-死锁及解决办法" tabindex="-1"><a class="header-anchor" href="#mysql-死锁及解决办法" aria-hidden="true">#</a> mysql 死锁及解决办法</h2><h3 id="查询死锁" tabindex="-1"><a class="header-anchor" href="#查询死锁" aria-hidden="true">#</a> 查询死锁</h3><h4 id="首先构建一个死锁" tabindex="-1"><a class="header-anchor" href="#首先构建一个死锁" aria-hidden="true">#</a> 首先构建一个死锁</h4><p>开启两个事物A、B。在事物A中更新id为3的行，在事物B中更新id为4的行。然后在事物A中更新id为4的行，在事物B中更新id为3的行。至此，锁成。</p><h4 id="查看正在进行中的事物" tabindex="-1"><a class="header-anchor" href="#查看正在进行中的事物" aria-hidden="true">#</a> 查看正在进行中的事物</h4><p>执行如下SQL：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>SELECT * FROM information_schema.INNODB_TRX
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>查询结果：</p><p><img src="`+i+`" alt="image-20220529154502287"></p><p>字段说明：</p><h4 id="查看正在锁的事物" tabindex="-1"><a class="header-anchor" href="#查看正在锁的事物" aria-hidden="true">#</a> 查看正在锁的事物</h4><p>执行如下SQL：</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment"># MYSQL 8.0 以前版本</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> INFORMATION_SCHEMA<span class="token punctuation">.</span>INNODB_LOCKS<span class="token punctuation">;</span>

<span class="token comment"># MYSQL 8.0 及以后版本</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">\`</span>performance_schema<span class="token punctuation">\`</span></span><span class="token punctuation">.</span>data_locks<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="查看等待锁的事务" tabindex="-1"><a class="header-anchor" href="#查看等待锁的事务" aria-hidden="true">#</a> 查看等待锁的事务</h4><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment"># MYSQL 8.0 以前版本</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> INFORMATION_SCHEMA<span class="token punctuation">.</span>INNODB_LOCK_WAITS<span class="token punctuation">;</span>

<span class="token comment"># MYSQL 8.0 及以后版本</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">\`</span>performance_schema<span class="token punctuation">\`</span></span><span class="token punctuation">.</span>data_lock_waits<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="查询是否锁表" tabindex="-1"><a class="header-anchor" href="#查询是否锁表" aria-hidden="true">#</a> 查询是否锁表</h4><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SHOW</span> <span class="token keyword">OPEN</span> <span class="token keyword">TABLES</span> <span class="token keyword">where</span> In_use <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,18),c=[d];function l(p,o){return s(),n("div",null,c)}const u=a(t,[["render",l],["__file","mysql-devops.html.vue"]]);export{u as default};
