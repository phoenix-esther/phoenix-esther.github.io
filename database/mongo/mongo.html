<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.59" />
    <meta name="theme" content="VuePress Theme Hope" />
    <title>MongoDB | Java æˆç¥ä¹‹è·¯</title><meta name="description" content="è¿™æ˜¯æˆ‘çš„ç¬¬ä¸€ä¸ª VuePress ç«™ç‚¹">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d2025;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/assets/style-f1658162.css" as="style"><link rel="stylesheet" href="/assets/style-f1658162.css">
    <link rel="modulepreload" href="/assets/app-671fc831.js"><link rel="modulepreload" href="/assets/framework-5dde3bca.js"><link rel="modulepreload" href="/assets/mongo.html-b49ed607.js"><link rel="modulepreload" href="/assets/mongo.html-50bc6f68.js"><link rel="prefetch" href="/assets/index.html-95370337.js" as="script"><link rel="prefetch" href="/assets/database-overview.html-03717758.js" as="script"><link rel="prefetch" href="/assets/java-overview.html-44310673.js" as="script"><link rel="prefetch" href="/assets/middleware-overview.html-be4fdd51.js" as="script"><link rel="prefetch" href="/assets/quality-overview.html-a8e9bda4.js" as="script"><link rel="prefetch" href="/assets/spring-cloud-overview.html-87409649.js" as="script"><link rel="prefetch" href="/assets/gitbook.html-fb8a8229.js" as="script"><link rel="prefetch" href="/assets/tools-overview.html-67f69dba.js" as="script"><link rel="prefetch" href="/assets/mysql-advance.html-e06a1ce2.js" as="script"><link rel="prefetch" href="/assets/mysql-apply.html-a6b2d1c2.js" as="script"><link rel="prefetch" href="/assets/mysql-base.html-d91fdb11.js" as="script"><link rel="prefetch" href="/assets/mysql-devops.html-0b9fc6f6.js" as="script"><link rel="prefetch" href="/assets/redis-base.html-fbc05584.js" as="script"><link rel="prefetch" href="/assets/redis-cluster.html-07744daf.js" as="script"><link rel="prefetch" href="/assets/redis-overview.html-1bcd1133.js" as="script"><link rel="prefetch" href="/assets/java-base.html-7071cb31.js" as="script"><link rel="prefetch" href="/assets/java-sql.html-c8be449f.js" as="script"><link rel="prefetch" href="/assets/java-time.html-2c855f9e.js" as="script"><link rel="prefetch" href="/assets/java-collection-list.html-2207ee3a.js" as="script"><link rel="prefetch" href="/assets/java-collection-map.html-d30b93e7.js" as="script"><link rel="prefetch" href="/assets/java-concurrent-base.html-8983a76d.js" as="script"><link rel="prefetch" href="/assets/Java-concurrent-container.html-3334407b.js" as="script"><link rel="prefetch" href="/assets/java-concurrent-interview.html-bbc0a621.js" as="script"><link rel="prefetch" href="/assets/java-concurrent-lock.html-ebf0a63c.js" as="script"><link rel="prefetch" href="/assets/java-concurrent-pool.html-7a290f95.js" as="script"><link rel="prefetch" href="/assets/java-concurrent-tools.html-01a740a1.js" as="script"><link rel="prefetch" href="/assets/java-bio.html-ceca2a90.js" as="script"><link rel="prefetch" href="/assets/java-io-base.html-40d5757f.js" as="script"><link rel="prefetch" href="/assets/java-nio.html-b002c449.js" as="script"><link rel="prefetch" href="/assets/Javaå†…å­˜æ¨¡å‹.html-13f8a203.js" as="script"><link rel="prefetch" href="/assets/JVMå†…å­˜ç»“æ„.html-fb577c69.js" as="script"><link rel="prefetch" href="/assets/JVMåƒåœ¾å›æ”¶.html-852577fd.js" as="script"><link rel="prefetch" href="/assets/JVMæ¦‚è§ˆ.html-eda595c7.js" as="script"><link rel="prefetch" href="/assets/JVMç±»åŠ è½½å™¨.html-ee6c0eb8.js" as="script"><link rel="prefetch" href="/assets/JVMç±»æ–‡ä»¶ç»“æ„.html-6aca785b.js" as="script"><link rel="prefetch" href="/assets/JVMè°ƒä¼˜.html-ad63cd2e.js" as="script"><link rel="prefetch" href="/assets/java-servlet.html-ef72b065.js" as="script"><link rel="prefetch" href="/assets/java-lambda.html-c21b5e3b.js" as="script"><link rel="prefetch" href="/assets/java-stream.html-797890ef.js" as="script"><link rel="prefetch" href="/assets/HikariCP-base.html-89b6d274.js" as="script"><link rel="prefetch" href="/assets/HikariCP-source.html-71542b59.js" as="script"><link rel="prefetch" href="/assets/jackson-overview.html-58553b4c.js" as="script"><link rel="prefetch" href="/assets/kafka-broker.html-8091a112.js" as="script"><link rel="prefetch" href="/assets/kafka-consumer.html-f5b2d049.js" as="script"><link rel="prefetch" href="/assets/kafka-old.html-1448d038.js" as="script"><link rel="prefetch" href="/assets/kafka-overview.html-8dd9a49b.js" as="script"><link rel="prefetch" href="/assets/kafka-producer.html-5dc9b65d.js" as="script"><link rel="prefetch" href="/assets/spring-kafka.html-bc75ec45.js" as="script"><link rel="prefetch" href="/assets/log-framework.html-76a57287.js" as="script"><link rel="prefetch" href="/assets/1.Hello World.html-b2ffe65b.js" as="script"><link rel="prefetch" href="/assets/2.Global Config.html-6a02822f.js" as="script"><link rel="prefetch" href="/assets/index.html-f37393b8.js" as="script"><link rel="prefetch" href="/assets/nginx.html-5ca46ccb.js" as="script"><link rel="prefetch" href="/assets/sharding-sphere.html-47e07fb1.js" as="script"><link rel="prefetch" href="/assets/shiro-overview.html-66b81094.js" as="script"><link rel="prefetch" href="/assets/tomcat.html-63e9b96e.js" as="script"><link rel="prefetch" href="/assets/data-structure-list.html-5ba0105d.js" as="script"><link rel="prefetch" href="/assets/data-structure-overview.html-85d0b05a.js" as="script"><link rel="prefetch" href="/assets/data-structure-tree.html-b7a2b7b5.js" as="script"><link rel="prefetch" href="/assets/design-adapter.html-ca7d4d0c.js" as="script"><link rel="prefetch" href="/assets/design-bridge.html-f70c2b16.js" as="script"><link rel="prefetch" href="/assets/design-builder.html-8d44b4e2.js" as="script"><link rel="prefetch" href="/assets/design-chain.html-73c4f586.js" as="script"><link rel="prefetch" href="/assets/design-command.html-d6dfccee.js" as="script"><link rel="prefetch" href="/assets/design-composite.html-756fd116.js" as="script"><link rel="prefetch" href="/assets/design-decorator.html-826f2e24.js" as="script"><link rel="prefetch" href="/assets/design-facade.html-c448fc15.js" as="script"><link rel="prefetch" href="/assets/design-factory.html-902a65a0.js" as="script"><link rel="prefetch" href="/assets/design-flyweight.html-4459624e.js" as="script"><link rel="prefetch" href="/assets/design-interpreter.html-c630c412.js" as="script"><link rel="prefetch" href="/assets/design-iterator.html-ab1b6e0a.js" as="script"><link rel="prefetch" href="/assets/design-mediator.html-0a45de36.js" as="script"><link rel="prefetch" href="/assets/design-memento.html-4208519d.js" as="script"><link rel="prefetch" href="/assets/design-observer.html-7d34acf8.js" as="script"><link rel="prefetch" href="/assets/design-overview.html-8ae1eaca.js" as="script"><link rel="prefetch" href="/assets/design-prototype.html-843f1ba1.js" as="script"><link rel="prefetch" href="/assets/design-proxy.html-b51e83f1.js" as="script"><link rel="prefetch" href="/assets/design-singleton.html-cb4b0e72.js" as="script"><link rel="prefetch" href="/assets/design-state.html-514399be.js" as="script"><link rel="prefetch" href="/assets/design-strategy.html-586d3ac2.js" as="script"><link rel="prefetch" href="/assets/design-template.html-12aa47cf.js" as="script"><link rel="prefetch" href="/assets/design-visitor.html-ed58259a.js" as="script"><link rel="prefetch" href="/assets/æ»‘åŠ¨çª—å£.html-d4efa51b.js" as="script"><link rel="prefetch" href="/assets/linux-overview.html-f8205a0e.js" as="script"><link rel="prefetch" href="/assets/encoding.html-bb7cac1e.js" as="script"><link rel="prefetch" href="/assets/encryption-algorithm.html-47d69cef.js" as="script"><link rel="prefetch" href="/assets/temp.html-60b41fd7.js" as="script"><link rel="prefetch" href="/assets/BeanPostProcessor-base.html-9b47aa32.js" as="script"><link rel="prefetch" href="/assets/BeanPostProcessor-ConfigurationClassPostProcessor.html-d4e7a5e5.js" as="script"><link rel="prefetch" href="/assets/spring-source-overview.html-3ac2c8f4.js" as="script"><link rel="prefetch" href="/assets/spring-boot-condition.html-f38f1a16.js" as="script"><link rel="prefetch" href="/assets/spring-cloud-commons-base.html-b68d3933.js" as="script"><link rel="prefetch" href="/assets/spring-cloud-gateway.html-b56fde18.js" as="script"><link rel="prefetch" href="/assets/spring-cloud-loadbalancer.html-182fff59.js" as="script"><link rel="prefetch" href="/assets/nacos-client-discovery.html-050d84e4.js" as="script"><link rel="prefetch" href="/assets/nacos-overview.html-755394c0.js" as="script"><link rel="prefetch" href="/assets/cloud-openfeign-action.html-6173210d.js" as="script"><link rel="prefetch" href="/assets/spring-cloud-openfeign.html-46fdc141.js" as="script"><link rel="prefetch" href="/assets/spring-cloud-ribbon.html-2f5d4e70.js" as="script"><link rel="prefetch" href="/assets/spring-cloud-alibaba-seate.html-90df4bc0.js" as="script"><link rel="prefetch" href="/assets/sentinel-source.html-db79abe0.js" as="script"><link rel="prefetch" href="/assets/spring-cloud-sentinel.html-031a7566.js" as="script"><link rel="prefetch" href="/assets/git.html-f3d86d29.js" as="script"><link rel="prefetch" href="/assets/gitlab.html-ee616321.js" as="script"><link rel="prefetch" href="/assets/junit4.html-7674a247.js" as="script"><link rel="prefetch" href="/assets/junit5.html-1088960a.js" as="script"><link rel="prefetch" href="/assets/maven.html-c5f718a8.js" as="script"><link rel="prefetch" href="/assets/reactor.html-b7f3a608.js" as="script"><link rel="prefetch" href="/assets/spring-source-web-init.html-76aa84f3.js" as="script"><link rel="prefetch" href="/assets/spring-source-web-listener.html-8020b96c.js" as="script"><link rel="prefetch" href="/assets/404.html-f04ced3e.js" as="script"><link rel="prefetch" href="/assets/index.html-33e4c2a2.js" as="script"><link rel="prefetch" href="/assets/index.html-8ad96e03.js" as="script"><link rel="prefetch" href="/assets/index.html-b23d2171.js" as="script"><link rel="prefetch" href="/assets/index.html-8a709d0c.js" as="script"><link rel="prefetch" href="/assets/index.html-9488715d.js" as="script"><link rel="prefetch" href="/assets/index.html-fb3dd3ef.js" as="script"><link rel="prefetch" href="/assets/index.html-42d88d20.js" as="script"><link rel="prefetch" href="/assets/index.html-87f3d90a.js" as="script"><link rel="prefetch" href="/assets/index.html-4e6c2eaf.js" as="script"><link rel="prefetch" href="/assets/index.html-df28bb11.js" as="script"><link rel="prefetch" href="/assets/index.html-78d325c5.js" as="script"><link rel="prefetch" href="/assets/index.html-0c05d7f0.js" as="script"><link rel="prefetch" href="/assets/database-overview.html-8e20b9c4.js" as="script"><link rel="prefetch" href="/assets/java-overview.html-110664f3.js" as="script"><link rel="prefetch" href="/assets/middleware-overview.html-23551371.js" as="script"><link rel="prefetch" href="/assets/quality-overview.html-c678a80a.js" as="script"><link rel="prefetch" href="/assets/spring-cloud-overview.html-4f455e53.js" as="script"><link rel="prefetch" href="/assets/gitbook.html-82c9e715.js" as="script"><link rel="prefetch" href="/assets/tools-overview.html-ef94410e.js" as="script"><link rel="prefetch" href="/assets/mysql-advance.html-04da5f50.js" as="script"><link rel="prefetch" href="/assets/mysql-apply.html-93145a97.js" as="script"><link rel="prefetch" href="/assets/mysql-base.html-d6966f7f.js" as="script"><link rel="prefetch" href="/assets/mysql-devops.html-6b9ccca1.js" as="script"><link rel="prefetch" href="/assets/redis-base.html-2d4d81f6.js" as="script"><link rel="prefetch" href="/assets/redis-cluster.html-dd1dc967.js" as="script"><link rel="prefetch" href="/assets/redis-overview.html-7f2546f3.js" as="script"><link rel="prefetch" href="/assets/java-base.html-2a2487a8.js" as="script"><link rel="prefetch" href="/assets/java-sql.html-3235fb3f.js" as="script"><link rel="prefetch" href="/assets/java-time.html-c6bd518b.js" as="script"><link rel="prefetch" href="/assets/java-collection-list.html-1f5f5479.js" as="script"><link rel="prefetch" href="/assets/java-collection-map.html-9eaf3f79.js" as="script"><link rel="prefetch" href="/assets/java-concurrent-base.html-ae299cb8.js" as="script"><link rel="prefetch" href="/assets/Java-concurrent-container.html-ebd6fec8.js" as="script"><link rel="prefetch" href="/assets/java-concurrent-interview.html-07fbfa4a.js" as="script"><link rel="prefetch" href="/assets/java-concurrent-lock.html-994ad73f.js" as="script"><link rel="prefetch" href="/assets/java-concurrent-pool.html-ed4a1de5.js" as="script"><link rel="prefetch" href="/assets/java-concurrent-tools.html-8880da92.js" as="script"><link rel="prefetch" href="/assets/java-bio.html-df6fc911.js" as="script"><link rel="prefetch" href="/assets/java-io-base.html-77f89736.js" as="script"><link rel="prefetch" href="/assets/java-nio.html-bcccb204.js" as="script"><link rel="prefetch" href="/assets/Javaå†…å­˜æ¨¡å‹.html-7383b9cd.js" as="script"><link rel="prefetch" href="/assets/JVMå†…å­˜ç»“æ„.html-8d99ddf3.js" as="script"><link rel="prefetch" href="/assets/JVMåƒåœ¾å›æ”¶.html-304d9a2d.js" as="script"><link rel="prefetch" href="/assets/JVMæ¦‚è§ˆ.html-8bd4b42f.js" as="script"><link rel="prefetch" href="/assets/JVMç±»åŠ è½½å™¨.html-77d4aeac.js" as="script"><link rel="prefetch" href="/assets/JVMç±»æ–‡ä»¶ç»“æ„.html-9a5ae840.js" as="script"><link rel="prefetch" href="/assets/JVMè°ƒä¼˜.html-abf07289.js" as="script"><link rel="prefetch" href="/assets/java-servlet.html-8537acfe.js" as="script"><link rel="prefetch" href="/assets/java-lambda.html-e158a557.js" as="script"><link rel="prefetch" href="/assets/java-stream.html-ad9eb0ed.js" as="script"><link rel="prefetch" href="/assets/HikariCP-base.html-f749e904.js" as="script"><link rel="prefetch" href="/assets/HikariCP-source.html-4651cd3f.js" as="script"><link rel="prefetch" href="/assets/jackson-overview.html-1ff735d9.js" as="script"><link rel="prefetch" href="/assets/kafka-broker.html-78790cd6.js" as="script"><link rel="prefetch" href="/assets/kafka-consumer.html-3872d15c.js" as="script"><link rel="prefetch" href="/assets/kafka-old.html-4a95df91.js" as="script"><link rel="prefetch" href="/assets/kafka-overview.html-03135409.js" as="script"><link rel="prefetch" href="/assets/kafka-producer.html-f9cc0e5f.js" as="script"><link rel="prefetch" href="/assets/spring-kafka.html-0eaac2b9.js" as="script"><link rel="prefetch" href="/assets/log-framework.html-13f8b728.js" as="script"><link rel="prefetch" href="/assets/1.Hello World.html-254e923d.js" as="script"><link rel="prefetch" href="/assets/2.Global Config.html-34377212.js" as="script"><link rel="prefetch" href="/assets/index.html-6f5477e7.js" as="script"><link rel="prefetch" href="/assets/nginx.html-6e2dadda.js" as="script"><link rel="prefetch" href="/assets/sharding-sphere.html-bb3296bb.js" as="script"><link rel="prefetch" href="/assets/shiro-overview.html-f4bdb923.js" as="script"><link rel="prefetch" href="/assets/tomcat.html-107f9ebe.js" as="script"><link rel="prefetch" href="/assets/data-structure-list.html-0f23b38b.js" as="script"><link rel="prefetch" href="/assets/data-structure-overview.html-f1e03c1d.js" as="script"><link rel="prefetch" href="/assets/data-structure-tree.html-a44ba30f.js" as="script"><link rel="prefetch" href="/assets/design-adapter.html-77286312.js" as="script"><link rel="prefetch" href="/assets/design-bridge.html-00672c18.js" as="script"><link rel="prefetch" href="/assets/design-builder.html-27d852c8.js" as="script"><link rel="prefetch" href="/assets/design-chain.html-74047f74.js" as="script"><link rel="prefetch" href="/assets/design-command.html-943a7340.js" as="script"><link rel="prefetch" href="/assets/design-composite.html-463bbe40.js" as="script"><link rel="prefetch" href="/assets/design-decorator.html-34575490.js" as="script"><link rel="prefetch" href="/assets/design-facade.html-6a642241.js" as="script"><link rel="prefetch" href="/assets/design-factory.html-558c3336.js" as="script"><link rel="prefetch" href="/assets/design-flyweight.html-9a7105fb.js" as="script"><link rel="prefetch" href="/assets/design-interpreter.html-19cea0ae.js" as="script"><link rel="prefetch" href="/assets/design-iterator.html-55db2bf3.js" as="script"><link rel="prefetch" href="/assets/design-mediator.html-a639304c.js" as="script"><link rel="prefetch" href="/assets/design-memento.html-6453f1e1.js" as="script"><link rel="prefetch" href="/assets/design-observer.html-ed658ad7.js" as="script"><link rel="prefetch" href="/assets/design-overview.html-03776800.js" as="script"><link rel="prefetch" href="/assets/design-prototype.html-8fdfdb40.js" as="script"><link rel="prefetch" href="/assets/design-proxy.html-d9e3ef89.js" as="script"><link rel="prefetch" href="/assets/design-singleton.html-8c4de69b.js" as="script"><link rel="prefetch" href="/assets/design-state.html-aeddd299.js" as="script"><link rel="prefetch" href="/assets/design-strategy.html-79c37426.js" as="script"><link rel="prefetch" href="/assets/design-template.html-61d102d5.js" as="script"><link rel="prefetch" href="/assets/design-visitor.html-fefdc2c4.js" as="script"><link rel="prefetch" href="/assets/æ»‘åŠ¨çª—å£.html-a5cf52bf.js" as="script"><link rel="prefetch" href="/assets/linux-overview.html-4c5f0a4a.js" as="script"><link rel="prefetch" href="/assets/encoding.html-f5906218.js" as="script"><link rel="prefetch" href="/assets/encryption-algorithm.html-9a1f16a2.js" as="script"><link rel="prefetch" href="/assets/temp.html-bc9bd901.js" as="script"><link rel="prefetch" href="/assets/BeanPostProcessor-base.html-f1d5d10e.js" as="script"><link rel="prefetch" href="/assets/BeanPostProcessor-ConfigurationClassPostProcessor.html-a96eba50.js" as="script"><link rel="prefetch" href="/assets/spring-source-overview.html-11cf77bb.js" as="script"><link rel="prefetch" href="/assets/spring-boot-condition.html-925c1f11.js" as="script"><link rel="prefetch" href="/assets/spring-cloud-commons-base.html-08854838.js" as="script"><link rel="prefetch" href="/assets/spring-cloud-gateway.html-3b5bcf8b.js" as="script"><link rel="prefetch" href="/assets/spring-cloud-loadbalancer.html-6f95c5b7.js" as="script"><link rel="prefetch" href="/assets/nacos-client-discovery.html-79247510.js" as="script"><link rel="prefetch" href="/assets/nacos-overview.html-13cec71c.js" as="script"><link rel="prefetch" href="/assets/cloud-openfeign-action.html-0f222092.js" as="script"><link rel="prefetch" href="/assets/spring-cloud-openfeign.html-80b0fc34.js" as="script"><link rel="prefetch" href="/assets/spring-cloud-ribbon.html-e2d9af9b.js" as="script"><link rel="prefetch" href="/assets/spring-cloud-alibaba-seate.html-37eed2ce.js" as="script"><link rel="prefetch" href="/assets/sentinel-source.html-692a3324.js" as="script"><link rel="prefetch" href="/assets/spring-cloud-sentinel.html-bf9c4618.js" as="script"><link rel="prefetch" href="/assets/git.html-87ad5d64.js" as="script"><link rel="prefetch" href="/assets/gitlab.html-09e004bc.js" as="script"><link rel="prefetch" href="/assets/junit4.html-e113cced.js" as="script"><link rel="prefetch" href="/assets/junit5.html-49a7387c.js" as="script"><link rel="prefetch" href="/assets/maven.html-dfa1482f.js" as="script"><link rel="prefetch" href="/assets/reactor.html-caf126d4.js" as="script"><link rel="prefetch" href="/assets/spring-source-web-init.html-c9794d73.js" as="script"><link rel="prefetch" href="/assets/spring-source-web-listener.html-22512f68.js" as="script"><link rel="prefetch" href="/assets/404.html-f08c28a7.js" as="script"><link rel="prefetch" href="/assets/index.html-da4568d9.js" as="script"><link rel="prefetch" href="/assets/index.html-e93144aa.js" as="script"><link rel="prefetch" href="/assets/index.html-def5ae53.js" as="script"><link rel="prefetch" href="/assets/index.html-0d635afd.js" as="script"><link rel="prefetch" href="/assets/index.html-6a96e1d8.js" as="script"><link rel="prefetch" href="/assets/index.html-855b7bae.js" as="script"><link rel="prefetch" href="/assets/index.html-703427c5.js" as="script"><link rel="prefetch" href="/assets/index.html-d81ead65.js" as="script"><link rel="prefetch" href="/assets/index.html-3f2fdf99.js" as="script"><link rel="prefetch" href="/assets/index.html-89246e48.js" as="script"><link rel="prefetch" href="/assets/index.html-555be4ca.js" as="script"><link rel="prefetch" href="/assets/mermaid.esm.min-bc08675d.js" as="script"><link rel="prefetch" href="/assets/mermaid-mindmap.esm.min-2d34b44a.js" as="script"><link rel="prefetch" href="/assets/markdown.esm-d92a2fc9.js" as="script"><link rel="prefetch" href="/assets/reveal.esm-e5069ce0.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><div class="theme-container has-toc"><!--[--><!--[--><header class="navbar"><div class="navbar-left"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><a href="/" class="brand"><!----><!----><span class="site-name">Java æˆç¥ä¹‹è·¯</span></a><!--[--><!----><!--]--></div><div class="navbar-center"><!--[--><!----><!--]--><nav class="nav-links"><div class="nav-item hide-in-mobile"><a href="/java/java-overview.html" class="nav-link" aria-label="Java ç¬”è®°"><!---->Java ç¬”è®°<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="Spring ç¬”è®°"><span class="title"><!---->Spring ç¬”è®°</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>Spring IOC</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/spring/test02.html" class="nav-link" aria-label="Spring IOCè¯¦è§£"><!---->Spring IOCè¯¦è§£<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>Spring åç½®å¤„ç†å™¨è§£æ</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/spring/spring-bean-post-processor/BeanPostProcessor-base.html" class="nav-link" aria-label="Spring åç½®å¤„ç†å™¨æ€»è§ˆ"><!---->Spring åç½®å¤„ç†å™¨æ€»è§ˆ<!----></a></li></ul></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="Spring Cloud"><span class="title"><!---->Spring Cloud</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/spring-cloud/spring-cloud-overview.html" class="nav-link" aria-label="Spring Cloud Overview"><!---->Spring Cloud Overview<!----></a></li><li class="dropdown-item"><a href="/spring-cloud/spring-cloud-alibaba-nacos.md" class="nav-link" aria-label="Spring Cloud Nacos"><!---->Spring Cloud Nacos<!----></a></li><li class="dropdown-item"><a href="/spring-cloud/spring-cloud-alibaba-sentinel.md" class="nav-link" aria-label="Spring Cloud Sentinel"><!---->Spring Cloud Sentinel<!----></a></li><li class="dropdown-item"><a href="/spring-cloud/spring-cloud-alibaba-seate.md" class="nav-link" aria-label="Spring Cloud Seate"><!---->Spring Cloud Seate<!----></a></li><li class="dropdown-item"><a href="/spring-cloud/spring-cloud-ribbon/spring-cloud-ribbon.html" class="nav-link" aria-label="Spring Cloud Ribbon"><!---->Spring Cloud Ribbon<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><a href="/database/database-overview.html" class="nav-link" aria-label="æ•°æ®åº“"><!---->æ•°æ®åº“<!----></a></div><div class="nav-item hide-in-mobile"><a href="/quality/quality-overview.html" class="nav-link" aria-label="è‡ªæˆ‘ä¿®å…»"><!---->è‡ªæˆ‘ä¿®å…»<!----></a></div><div class="nav-item hide-in-mobile"><a href="/middleware/middleware-overview.html" class="nav-link" aria-label="ä¸­é—´ä»¶"><!---->ä¸­é—´ä»¶<!----></a></div><div class="nav-item hide-in-mobile"><a href="/tools/tools-overview.html" class="nav-link" aria-label="å·¥å…·åŒ…"><!---->å·¥å…·åŒ…<!----></a></div></nav><!--[--><!----><!--]--></div><div class="navbar-right"><!--[--><!----><!--]--><!----><!----><div class="nav-item hide-in-mobile"><button id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!----><!--[--><!----><!--]--><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><!--[--><a href="/database/database-overview.html" class="nav-link sidebar-link sidebar-page" aria-label="æ•°æ®åº“"><!---->æ•°æ®åº“<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">MySQL è¯¦è§£</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">Redis è¯¦è§£</span><span class="arrow right"></span></button><!----></section></li><li><!--[--><a aria-current="page" href="/database/mongo/mongo.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" aria-label="MongoDB è¯¦è§£"><!---->MongoDB è¯¦è§£<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/database/mongo/mongo.html#æ¦‚è¿°" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="æ¦‚è¿°"><!---->æ¦‚è¿°<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/database/mongo/mongo.html#mongodbæ˜¯ä»€ä¹ˆ" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="mongodbæ˜¯ä»€ä¹ˆ"><!---->mongodbæ˜¯ä»€ä¹ˆ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/database/mongo/mongo.html#mongodbçš„ä¼˜ç¼ºç‚¹" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="mongodbçš„ä¼˜ç¼ºç‚¹"><!---->mongodbçš„ä¼˜ç¼ºç‚¹<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/database/mongo/mongo.html#ä½¿ç”¨åœºæ™¯" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="ä½¿ç”¨åœºæ™¯"><!---->ä½¿ç”¨åœºæ™¯<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/database/mongo/mongo.html#æ¡ˆä¾‹åˆ†æ" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="æ¡ˆä¾‹åˆ†æ"><!---->æ¡ˆä¾‹åˆ†æ<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/database/mongo/mongo.html#mongodbåŸºç¡€" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="mongodbåŸºç¡€"><!---->mongodbåŸºç¡€<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/database/mongo/mongo.html#åŸºæœ¬æ¦‚å¿µ" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="åŸºæœ¬æ¦‚å¿µ"><!---->åŸºæœ¬æ¦‚å¿µ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/database/mongo/mongo.html#mongodbçš„åŸºæœ¬ä½¿ç”¨" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="MongoDBçš„åŸºæœ¬ä½¿ç”¨"><!---->MongoDBçš„åŸºæœ¬ä½¿ç”¨<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/database/mongo/mongo.html#bson" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="BSON"><!---->BSON<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/database/mongo/mongo.html#åŸºæœ¬æ“ä½œ-crud" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="åŸºæœ¬æ“ä½œï¼ˆCRUDï¼‰"><!---->åŸºæœ¬æ“ä½œï¼ˆCRUDï¼‰<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/database/mongo/mongo.html#create" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Create"><!---->Create<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/database/mongo/mongo.html#delete" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Delete"><!---->Delete<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/database/mongo/mongo.html#update" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Update"><!---->Update<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/database/mongo/mongo.html#retrieve" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Retrieve"><!---->Retrieve<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/database/mongo/mongo.html#mongodb-èšåˆ" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="MongoDB èšåˆ"><!---->MongoDB èšåˆ<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/database/mongo/mongo.html#èšåˆç®¡é“" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="èšåˆç®¡é“"><!---->èšåˆç®¡é“<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/database/mongo/mongo.html#ç®¡é“æ“ä½œç¬¦" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="ç®¡é“æ“ä½œç¬¦"><!---->ç®¡é“æ“ä½œç¬¦<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/database/mongo/mongo.html#mongodb-map-reduce" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="MongoDB Map-Reduce"><!---->MongoDB Map-Reduce<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/database/mongo/mongo.html#mongodb-gridfs" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="MongoDB GridFS"><!---->MongoDB GridFS<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/database/mongo/mongo.html#chunks" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="chunks"><!---->chunks<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/database/mongo/mongo.html#files" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="files"><!---->files<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/database/mongo/mongo.html#mongodb-å®‰å…¨" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="MongoDB å®‰å…¨"><!---->MongoDB å®‰å…¨<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/database/mongo/mongo.html#mongodb-ç´¢å¼•" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="MongoDB ç´¢å¼•"><!---->MongoDB ç´¢å¼•<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/database/mongo/mongo.html#åŸºç¡€" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="åŸºç¡€"><!---->åŸºç¡€<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/database/mongo/mongo.html#å•å€¼ç´¢å¼•-1" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="å•å€¼ç´¢å¼•"><!---->å•å€¼ç´¢å¼•<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/database/mongo/mongo.html#å¤åˆç´¢å¼•-1" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="å¤åˆç´¢å¼•"><!---->å¤åˆç´¢å¼•<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/database/mongo/mongo.html#æ€§èƒ½åˆ†æ" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="æ€§èƒ½åˆ†æ"><!---->æ€§èƒ½åˆ†æ<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/database/mongo/mongo.html#å‡½æ•°" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="å‡½æ•°"><!---->å‡½æ•°<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/database/mongo/mongo.html#mongodb-äº‹åŠ¡" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="MongoDB äº‹åŠ¡"><!---->MongoDB äº‹åŠ¡<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/database/mongo/mongo.html#å•æ–‡æ¡£äº‹ç‰©" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="å•æ–‡æ¡£äº‹ç‰©"><!---->å•æ–‡æ¡£äº‹ç‰©<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/database/mongo/mongo.html#å¤šæ–‡æ¡£äº‹ç‰©" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="å¤šæ–‡æ¡£äº‹ç‰©"><!---->å¤šæ–‡æ¡£äº‹ç‰©<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/database/mongo/mongo.html#mongodb-replication-å¤åˆ¶" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="MongoDB Replicationï¼ˆå¤åˆ¶ï¼‰"><!---->MongoDB Replicationï¼ˆå¤åˆ¶ï¼‰<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/database/mongo/mongo.html#ç®€å•ä»‹ç»" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="ç®€å•ä»‹ç»"><!---->ç®€å•ä»‹ç»<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/database/mongo/mongo.html#ç®€å•é…ç½®" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="ç®€å•é…ç½®"><!---->ç®€å•é…ç½®<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/database/mongo/mongo.html#mongodb-oplog" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="MongoDB Oplog"><!---->MongoDB Oplog<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/database/mongo/mongo.html#å‰¯æœ¬é›†çš„é«˜å¯ç”¨" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="å‰¯æœ¬é›†çš„é«˜å¯ç”¨"><!---->å‰¯æœ¬é›†çš„é«˜å¯ç”¨<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/database/mongo/mongo.html#mongodb-sharding-åˆ†ç‰‡" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="MongoDB Shardingï¼ˆåˆ†ç‰‡ï¼‰"><!---->MongoDB Shardingï¼ˆåˆ†ç‰‡ï¼‰<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/database/mongo/mongo.html#åˆ†ç‰‡çš„ç›®çš„" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="åˆ†ç‰‡çš„ç›®çš„"><!---->åˆ†ç‰‡çš„ç›®çš„<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/database/mongo/mongo.html#åˆ†ç‰‡é›†ç¾¤ç»„ä»¶" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="åˆ†ç‰‡é›†ç¾¤ç»„ä»¶"><!---->åˆ†ç‰‡é›†ç¾¤ç»„ä»¶<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/database/mongo/mongo.html#æ•°æ®åœ¨é›†ç¾¤ä¸­çš„åˆ†å¸ƒ" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="æ•°æ®åœ¨é›†ç¾¤ä¸­çš„åˆ†å¸ƒ"><!---->æ•°æ®åœ¨é›†ç¾¤ä¸­çš„åˆ†å¸ƒ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/database/mongo/mongo.html#æ•°æ®åˆ†åŒº" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="æ•°æ®åˆ†åŒº"><!---->æ•°æ®åˆ†åŒº<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/database/mongo/mongo.html#mongodb-å­˜å‚¨" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="MongoDB å­˜å‚¨"><!---->MongoDB å­˜å‚¨<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/database/mongo/mongo.html#wiredtiger-storage-engine" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="WiredTiger Storage Engine"><!---->WiredTiger Storage Engine<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li></ul><!--]--></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->MongoDB</h1><div class="page-info"><!----><!----><span class="date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2023-01-22T07:56:20.000Z"></span><!----><!----><span class="reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 46 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT46M"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><div class="toc-header">æ­¤é¡µå†…å®¹</div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/database/mongo/mongo.html#æ¦‚è¿°" class="router-link-active router-link-exact-active toc-link level2">æ¦‚è¿°</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/database/mongo/mongo.html#mongodbæ˜¯ä»€ä¹ˆ" class="router-link-active router-link-exact-active toc-link level3">mongodbæ˜¯ä»€ä¹ˆ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/database/mongo/mongo.html#mongodbçš„ä¼˜ç¼ºç‚¹" class="router-link-active router-link-exact-active toc-link level3">mongodbçš„ä¼˜ç¼ºç‚¹</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/database/mongo/mongo.html#ä½¿ç”¨åœºæ™¯" class="router-link-active router-link-exact-active toc-link level3">ä½¿ç”¨åœºæ™¯</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/database/mongo/mongo.html#æ¡ˆä¾‹åˆ†æ" class="router-link-active router-link-exact-active toc-link level3">æ¡ˆä¾‹åˆ†æ</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/database/mongo/mongo.html#mongodbåŸºç¡€" class="router-link-active router-link-exact-active toc-link level2">mongodbåŸºç¡€</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/database/mongo/mongo.html#åŸºæœ¬æ¦‚å¿µ" class="router-link-active router-link-exact-active toc-link level3">åŸºæœ¬æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/database/mongo/mongo.html#mongodbçš„åŸºæœ¬ä½¿ç”¨" class="router-link-active router-link-exact-active toc-link level3">MongoDBçš„åŸºæœ¬ä½¿ç”¨</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/database/mongo/mongo.html#bson" class="router-link-active router-link-exact-active toc-link level3">BSON</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/database/mongo/mongo.html#åŸºæœ¬æ“ä½œ-crud" class="router-link-active router-link-exact-active toc-link level2">åŸºæœ¬æ“ä½œï¼ˆCRUDï¼‰</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/database/mongo/mongo.html#create" class="router-link-active router-link-exact-active toc-link level3">Create</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/database/mongo/mongo.html#delete" class="router-link-active router-link-exact-active toc-link level3">Delete</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/database/mongo/mongo.html#update" class="router-link-active router-link-exact-active toc-link level3">Update</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/database/mongo/mongo.html#retrieve" class="router-link-active router-link-exact-active toc-link level3">Retrieve</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/database/mongo/mongo.html#mongodb-èšåˆ" class="router-link-active router-link-exact-active toc-link level2">MongoDB èšåˆ</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/database/mongo/mongo.html#èšåˆç®¡é“" class="router-link-active router-link-exact-active toc-link level3">èšåˆç®¡é“</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/database/mongo/mongo.html#ç®¡é“æ“ä½œç¬¦" class="router-link-active router-link-exact-active toc-link level3">ç®¡é“æ“ä½œç¬¦</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/database/mongo/mongo.html#mongodb-map-reduce" class="router-link-active router-link-exact-active toc-link level2">MongoDB Map-Reduce</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/database/mongo/mongo.html#mongodb-gridfs" class="router-link-active router-link-exact-active toc-link level2">MongoDB GridFS</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/database/mongo/mongo.html#chunks" class="router-link-active router-link-exact-active toc-link level3">chunks</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/database/mongo/mongo.html#files" class="router-link-active router-link-exact-active toc-link level3">files</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/database/mongo/mongo.html#mongodb-å®‰å…¨" class="router-link-active router-link-exact-active toc-link level2">MongoDB å®‰å…¨</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/database/mongo/mongo.html#mongodb-ç´¢å¼•" class="router-link-active router-link-exact-active toc-link level2">MongoDB ç´¢å¼•</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/database/mongo/mongo.html#åŸºç¡€" class="router-link-active router-link-exact-active toc-link level3">åŸºç¡€</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/database/mongo/mongo.html#å•å€¼ç´¢å¼•-1" class="router-link-active router-link-exact-active toc-link level3">å•å€¼ç´¢å¼•</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/database/mongo/mongo.html#å¤åˆç´¢å¼•-1" class="router-link-active router-link-exact-active toc-link level3">å¤åˆç´¢å¼•</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/database/mongo/mongo.html#æ€§èƒ½åˆ†æ" class="router-link-active router-link-exact-active toc-link level2">æ€§èƒ½åˆ†æ</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/database/mongo/mongo.html#å‡½æ•°" class="router-link-active router-link-exact-active toc-link level3">å‡½æ•°</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/database/mongo/mongo.html#mongodb-äº‹åŠ¡" class="router-link-active router-link-exact-active toc-link level2">MongoDB äº‹åŠ¡</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/database/mongo/mongo.html#å•æ–‡æ¡£äº‹ç‰©" class="router-link-active router-link-exact-active toc-link level3">å•æ–‡æ¡£äº‹ç‰©</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/database/mongo/mongo.html#å¤šæ–‡æ¡£äº‹ç‰©" class="router-link-active router-link-exact-active toc-link level3">å¤šæ–‡æ¡£äº‹ç‰©</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/database/mongo/mongo.html#mongodb-replication-å¤åˆ¶" class="router-link-active router-link-exact-active toc-link level2">MongoDB Replicationï¼ˆå¤åˆ¶ï¼‰</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/database/mongo/mongo.html#ç®€å•ä»‹ç»" class="router-link-active router-link-exact-active toc-link level3">ç®€å•ä»‹ç»</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/database/mongo/mongo.html#ç®€å•é…ç½®" class="router-link-active router-link-exact-active toc-link level3">ç®€å•é…ç½®</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/database/mongo/mongo.html#mongodb-oplog" class="router-link-active router-link-exact-active toc-link level3">MongoDB Oplog</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/database/mongo/mongo.html#å‰¯æœ¬é›†çš„é«˜å¯ç”¨" class="router-link-active router-link-exact-active toc-link level3">å‰¯æœ¬é›†çš„é«˜å¯ç”¨</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/database/mongo/mongo.html#mongodb-sharding-åˆ†ç‰‡" class="router-link-active router-link-exact-active toc-link level2">MongoDB Shardingï¼ˆåˆ†ç‰‡ï¼‰</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/database/mongo/mongo.html#åˆ†ç‰‡çš„ç›®çš„" class="router-link-active router-link-exact-active toc-link level3">åˆ†ç‰‡çš„ç›®çš„</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/database/mongo/mongo.html#åˆ†ç‰‡é›†ç¾¤ç»„ä»¶" class="router-link-active router-link-exact-active toc-link level3">åˆ†ç‰‡é›†ç¾¤ç»„ä»¶</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/database/mongo/mongo.html#æ•°æ®åœ¨é›†ç¾¤ä¸­çš„åˆ†å¸ƒ" class="router-link-active router-link-exact-active toc-link level3">æ•°æ®åœ¨é›†ç¾¤ä¸­çš„åˆ†å¸ƒ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/database/mongo/mongo.html#æ•°æ®åˆ†åŒº" class="router-link-active router-link-exact-active toc-link level3">æ•°æ®åˆ†åŒº</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/database/mongo/mongo.html#mongodb-å­˜å‚¨" class="router-link-active router-link-exact-active toc-link level2">MongoDB å­˜å‚¨</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/database/mongo/mongo.html#wiredtiger-storage-engine" class="router-link-active router-link-exact-active toc-link level3">WiredTiger Storage Engine</a></li><!----><!--]--></ul><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><h1 id="mongodb" tabindex="-1"><a class="header-anchor" href="#mongodb" aria-hidden="true">#</a> MongoDB</h1><h2 id="æ¦‚è¿°" tabindex="-1"><a class="header-anchor" href="#æ¦‚è¿°" aria-hidden="true">#</a> æ¦‚è¿°</h2><h3 id="mongodbæ˜¯ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#mongodbæ˜¯ä»€ä¹ˆ" aria-hidden="true">#</a> mongodbæ˜¯ä»€ä¹ˆ</h3><p>MongoDBæ˜¯ä¸€ä¸ªåŸºäºåˆ†å¸ƒå¼æ–‡ä»¶å­˜å‚¨ [1] çš„æ•°æ®åº“ã€‚ç”±<a href="https://baike.baidu.com/item/C%2B%2B" target="_blank" rel="noopener noreferrer">C++<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>è¯­è¨€ç¼–å†™ã€‚æ—¨åœ¨ä¸ºWEBåº”ç”¨æä¾›å¯æ‰©å±•çš„é«˜æ€§èƒ½æ•°æ®å­˜å‚¨è§£å†³æ–¹æ¡ˆã€‚</p><p>MongoDBæ˜¯ä¸€ä¸ªä»‹äº<a href="https://baike.baidu.com/item/%E5%85%B3%E7%B3%BB%E6%95%B0%E6%8D%AE%E5%BA%93" target="_blank" rel="noopener noreferrer">å…³ç³»æ•°æ®åº“<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>å’Œéå…³ç³»æ•°æ®åº“ä¹‹é—´çš„äº§å“ï¼Œæ˜¯éå…³ç³»æ•°æ®åº“å½“ä¸­åŠŸèƒ½æœ€ä¸°å¯Œï¼Œæœ€åƒå…³ç³»æ•°æ®åº“çš„ã€‚å®ƒæ”¯æŒçš„æ•°æ®ç»“æ„éå¸¸æ¾æ•£ï¼Œæ˜¯ç±»ä¼¼<a href="https://baike.baidu.com/item/json" target="_blank" rel="noopener noreferrer">json<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>çš„<a href="https://baike.baidu.com/item/bson" target="_blank" rel="noopener noreferrer">bson<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>æ ¼å¼ï¼Œå› æ­¤å¯ä»¥å­˜å‚¨æ¯”è¾ƒå¤æ‚çš„æ•°æ®ç±»å‹ã€‚Mongoæœ€å¤§çš„ç‰¹ç‚¹æ˜¯å®ƒæ”¯æŒçš„æŸ¥è¯¢è¯­è¨€éå¸¸å¼ºå¤§ï¼Œå…¶è¯­æ³•æœ‰ç‚¹ç±»ä¼¼äºé¢å‘å¯¹è±¡çš„æŸ¥è¯¢è¯­è¨€ï¼Œå‡ ä¹å¯ä»¥å®ç°ç±»ä¼¼å…³ç³»æ•°æ®åº“å•è¡¨æŸ¥è¯¢çš„ç»å¤§éƒ¨åˆ†åŠŸèƒ½ï¼Œè€Œä¸”è¿˜æ”¯æŒå¯¹æ•°æ®å»ºç«‹<a href="https://baike.baidu.com/item/%E7%B4%A2%E5%BC%95" target="_blank" rel="noopener noreferrer">ç´¢å¼•<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ã€‚</p><p><strong>ä¸€å¥è¯æ¦‚æ‹¬ï¼šmongodbæ˜¯noSQLç±»å‹çš„æ–‡æ¡£æ•°æ®åº“</strong></p><p><img src="/assets/image-20210224171756418-f59a593a.png" alt="image-20210224171756418"></p><h3 id="mongodbçš„ä¼˜ç¼ºç‚¹" tabindex="-1"><a class="header-anchor" href="#mongodbçš„ä¼˜ç¼ºç‚¹" aria-hidden="true">#</a> mongodbçš„ä¼˜ç¼ºç‚¹</h3><p>ä¼˜ç‚¹ï¼š</p><p>1.åŸºäº JSON çš„æ•°æ®æ¨¡å‹æœ€æ¥è¿‘å¼€å‘è€…çš„é¢å‘å¯¹è±¡çš„è®¾è®¡æ€ç»´ï¼›</p><p>2.çµæ´»åŠ¨æ€çš„æ¨¡å‹æ„å‘³ç€åœ¨éœ€æ±‚å¤šå˜çš„æ—¶å€™æå¤§ç®€åŒ–æ•°æ®åº“è®¾è®¡æµç¨‹ï¼›</p><p>3.ä¸éœ€åˆ†åº“åˆ†è¡¨åœ°å®ç°è‡ªåŠ¨åˆ†ç‰‡ã€å¤šèŠ‚ç‚¹è‡ªåŠ¨åŒæ­¥å’Œè·¨ä¸­å¿ƒèƒ½åŠ›æ”¯æŒå„ç§ç°ä»£åŒ–å¤æ‚éƒ¨ç½²éœ€æ±‚ã€‚</p><p>4.åœ¨å¤§æ•°æ®é‡çº§ï¼Œé«˜å¹¶å‘åœºæ™¯ä¸‹æœ‰ä¼˜åŠ¿ã€‚</p><p>5.åŸç”Ÿæ”¯æŒåœ°ç†ç©ºé—´æ•°æ®çš„å­˜å‚¨ï¼ŒæŸ¥è¯¢</p><p>ä»4.0å¼€å§‹æ”¯æŒäº‹åŠ¡ï¼Œä»4.2ç‰ˆæœ¬å¼€å§‹æ”¯æŒåˆ†å¸ƒå¼äº‹åŠ¡ï¼Œ</p><p>å½“å‰æœ€æ–°ç‰ˆæœ¬ä¸º4.4ç‰ˆæœ¬ï¼Œå‘å¸ƒäº2020.9</p><p>4.0ç‰ˆæœ¬å‘å¸ƒäº2018.8ï¼Œ4.2ç‰ˆæœ¬å‘å¸ƒäº2019.10ã€‚ç½‘ä¸Šå…³äºåˆ†å¸ƒå¼äº‹åŠ¡çš„ç›¸å…³èµ„æ–™å‡ ä¹æ²¡æœ‰ï¼ŒåŸºæœ¬åªèƒ½å‚è€ƒå®˜æ–¹æ–‡æ¡£ã€‚</p><h3 id="ä½¿ç”¨åœºæ™¯" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨åœºæ™¯" aria-hidden="true">#</a> ä½¿ç”¨åœºæ™¯</h3><ul><li><p>ç½‘ç«™æ•°æ®ï¼šMongo éå¸¸é€‚åˆå®æ—¶çš„æ’å…¥ï¼Œæ›´æ–°ä¸æŸ¥è¯¢ï¼Œå¹¶å…·å¤‡ç½‘ç«™å®æ—¶æ•°æ®å­˜å‚¨æ‰€éœ€çš„å¤åˆ¶åŠé«˜åº¦ä¼¸ç¼©æ€§ã€‚</p></li><li><p>ç¼“å­˜ï¼šç”±äºæ€§èƒ½å¾ˆé«˜ï¼ŒMongo ä¹Ÿé€‚åˆä½œä¸ºä¿¡æ¯åŸºç¡€è®¾æ–½çš„ç¼“å­˜å±‚ã€‚åœ¨ç³»ç»Ÿé‡å¯ä¹‹åï¼Œç”±Mongo æ­å»ºçš„æŒä¹…åŒ–ç¼“å­˜å±‚å¯ä»¥é¿å…ä¸‹å±‚çš„æ•°æ®æºè¿‡è½½ã€‚</p></li><li><p>å¤§å°ºå¯¸ã€ä½ä»·å€¼çš„æ•°æ®ï¼šä½¿ç”¨ä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“å­˜å‚¨ä¸€äº›æ•°æ®æ—¶å¯èƒ½ä¼šæ¯”è¾ƒæ˜‚è´µï¼Œåœ¨æ­¤ä¹‹å‰ï¼Œå¾ˆå¤šæ—¶å€™ç¨‹åºå‘˜å¾€å¾€ä¼šé€‰æ‹©ä¼ ç»Ÿçš„æ–‡ä»¶è¿›è¡Œå­˜å‚¨ã€‚</p></li><li><p>é«˜ä¼¸ç¼©æ€§çš„åœºæ™¯ï¼šMongo éå¸¸é€‚åˆç”±æ•°åæˆ–æ•°ç™¾å°æœåŠ¡å™¨ç»„æˆçš„æ•°æ®åº“ï¼ŒMongo çš„è·¯çº¿å›¾ä¸­å·²ç»åŒ…å«å¯¹MapReduce å¼•æ“çš„å†…ç½®æ”¯æŒã€‚</p></li><li><p>ç”¨äºå¯¹è±¡åŠJSON æ•°æ®çš„å­˜å‚¨ï¼šMongo çš„BSON æ•°æ®æ ¼å¼éå¸¸é€‚åˆæ–‡æ¡£åŒ–æ ¼å¼çš„å­˜å‚¨åŠæŸ¥è¯¢ã€‚</p></li></ul><h3 id="æ¡ˆä¾‹åˆ†æ" tabindex="-1"><a class="header-anchor" href="#æ¡ˆä¾‹åˆ†æ" aria-hidden="true">#</a> æ¡ˆä¾‹åˆ†æ</h3><p>å›½å†…å®¢æˆ·ï¼š</p><ul><li><p>äºšä¿¡ç§‘æŠ€ï¼šæ•°æ®ä¸­å°äº§å“ï¼Œå®æ—¶çš„æ•°æ®åˆ†æ</p></li><li><p>å’ªå’•è§†é¢‘ï¼šåµŒå¥—æ–‡æ¡£çš„ä¾¿åˆ©æ€§</p></li><li><p>ä¸œæ–¹èˆªç©ºï¼š åœ¨çº¿å”®ç¥¨é¡¹ç›®ï¼Œä¸ºç”¨æˆ·æä¾›ä¸ªæ€§åŒ–çš„èˆªç­æœç´¢æœåŠ¡ï¼Œæ”¯æŒå¤šç›®çš„åœ°æœç´¢ã€åŸºäºé¢„ç®—èŒƒå›´çš„æœç´¢ã€åŸå¸‚ä¸»é¢˜çš„æœç´¢ã€çµæ„Ÿè¯­ä¹‰çš„æœç´¢ã€å®æ—¶çš„ä½ä»·æ—¥å†æœç´¢ç­‰ã€‚åŒæ—¶ï¼Œçµæ´»ç»„åˆä¸­è½¬è·¯å¾„ï¼Œæé«˜ODèˆªçº¿è¦†ç›–ç‡ã€‚ï¼ˆ2016å¹´çš„æ•°æ®ï¼‰</p></li></ul><p><img src="/assets/image-20210224165802775-7e4114ba.png" alt="image-20210224165802775"></p><ul><li><p>æ³°åº·ä¿é™©ï¼šæ”¯æ’‘äº’è”ç½‘äº§å“çš„å®¢æˆ·ä¸­å¿ƒå’Œè®¢å•ä¸­å¿ƒ</p><p><img src="/assets/image-20210224170818625-6836d22f.png" alt="image-20210224170818625"></p></li><li><p>æ‹›å•†é“¶è¡Œ</p><p><img src="/assets/image-20210224170932317-a12f06aa.png" alt="image-20210224170932317"></p></li></ul><p>ç™¾åº¦ç™¾ç§‘ä¸Šåˆ—ä¸¾çš„æ•°æ®ï¼š</p><ul><li>Craiglistä¸Šä½¿ç”¨MongoDBçš„å­˜æ¡£æ•°åäº¿æ¡è®°å½•ã€‚</li><li>FourSquareï¼ŒåŸºäºä½ç½®çš„ç¤¾äº¤ç½‘ç«™ï¼Œåœ¨Amazon EC2çš„æœåŠ¡å™¨ä¸Šä½¿ç”¨MongoDBåˆ†äº«æ•°æ®ã€‚</li><li>Shutterflyï¼Œä»¥äº’è”ç½‘ä¸ºåŸºç¡€çš„ç¤¾ä¼šå’Œä¸ªäººå‡ºç‰ˆæœåŠ¡ï¼Œä½¿ç”¨MongoDBçš„å„ç§æŒä¹…æ€§æ•°æ®å­˜å‚¨çš„è¦æ±‚ã€‚</li><li>bit.ly, ä¸€ä¸ªåŸºäºWebçš„ç½‘å€ç¼©çŸ­æœåŠ¡ï¼Œä½¿ç”¨MongoDBçš„å­˜å‚¨è‡ªå·±çš„æ•°æ®ã€‚</li><li>spike.comï¼Œä¸€ä¸ªMTVç½‘ç»œçš„è”è¥å…¬å¸ï¼Œ spike.comä½¿ç”¨MongoDBçš„ã€‚</li><li>Intuitå…¬å¸ï¼Œä¸€ä¸ªä¸ºå°ä¼ä¸šå’Œä¸ªäººçš„è½¯ä»¶å’ŒæœåŠ¡æä¾›å•†ï¼Œä¸ºå°å‹ä¼ä¸šä½¿ç”¨MongoDBçš„è·Ÿè¸ªç”¨æˆ·çš„æ•°æ®ã€‚</li><li>sourceforge.netï¼Œèµ„æºç½‘ç«™æŸ¥æ‰¾ï¼Œåˆ›å»ºå’Œå‘å¸ƒå¼€æºè½¯ä»¶å…è´¹ï¼Œä½¿ç”¨MongoDBçš„åç«¯å­˜å‚¨ã€‚</li><li>etsy.com ï¼Œä¸€ä¸ªè´­ä¹°å’Œå‡ºå”®æ‰‹å·¥åˆ¶ä½œç‰©å“ç½‘ç«™ï¼Œä½¿ç”¨MongoDBã€‚</li><li>çº½çº¦æ—¶æŠ¥ï¼Œé¢†å…ˆçš„åœ¨çº¿æ–°é—»é—¨æˆ·ç½‘ç«™ä¹‹ä¸€ï¼Œä½¿ç”¨MongoDBã€‚</li><li>CERNï¼Œè‘—åçš„ç²’å­ç‰©ç†ç ”ç©¶æ‰€ï¼Œæ¬§æ´²æ ¸å­ç ”ç©¶ä¸­å¿ƒå¤§å‹å¼ºå­å¯¹æ’æœºçš„æ•°æ®ä½¿ç”¨MongoDBã€‚</li></ul><h2 id="mongodbåŸºç¡€" tabindex="-1"><a class="header-anchor" href="#mongodbåŸºç¡€" aria-hidden="true">#</a> mongodbåŸºç¡€</h2><h3 id="åŸºæœ¬æ¦‚å¿µ" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬æ¦‚å¿µ" aria-hidden="true">#</a> åŸºæœ¬æ¦‚å¿µ</h3><p>ä¸mysqlå¯¹æ¯”ç†è§£</p><table><thead><tr><th>mysql</th><th>mongodb</th></tr></thead><tbody><tr><td>database</td><td>database</td></tr><tr><td>tableï¼ˆè¡¨ï¼‰</td><td>collectionï¼ˆé›†åˆï¼‰</td></tr><tr><td>rowï¼ˆè¡Œï¼‰</td><td>documentï¼ˆæ–‡æ¡£ï¼‰</td></tr><tr><td>columnï¼ˆåˆ—ï¼‰</td><td>fieldï¼ˆå­—æ®µï¼‰</td></tr></tbody></table><h3 id="mongodbçš„åŸºæœ¬ä½¿ç”¨" tabindex="-1"><a class="header-anchor" href="#mongodbçš„åŸºæœ¬ä½¿ç”¨" aria-hidden="true">#</a> MongoDBçš„åŸºæœ¬ä½¿ç”¨</h3><h4 id="å®‰è£…" tabindex="-1"><a class="header-anchor" href="#å®‰è£…" aria-hidden="true">#</a> å®‰è£…</h4><p>ä¸‹è½½windownsçš„äºŒè¿›åˆ¶åŒ…è§£å‹å³å¯</p><p>é…ç½®æ•°æ®çš„å­˜å‚¨ç›®å½•ï¼ˆé…ç½®æ–‡ä»¶ä½¿ç”¨ymlæ ¼å¼ï¼‰</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">storage</span><span class="token punctuation">:</span>
  <span class="token key atrule">dbPath</span><span class="token punctuation">:</span> D<span class="token punctuation">:</span>\developer\env\mongodb<span class="token punctuation">-</span>4.2.11\data\db
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯åŠ¨æœåŠ¡æŒ‡å®šé…ç½®æ–‡ä»¶</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>bin/mongod.exe <span class="token parameter variable">-f</span> conf/mongo.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>è¿æ¥å®¢æˆ·ç«¯</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>bin/mongo.exe
// æŒ‡å®šè¿œç¨‹åœ°å€
bin/mongo.exe  <span class="token number">192.168</span>.0.5:9999/foo
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>mongdbæ–°ç‰ˆé…ç½®æ–‡ä»¶è¯´æ˜</p><p>https://www.cnblogs.com/lxf1117/p/14267004.html</p><h4 id="æ•°æ®åº“ç®¡ç†" tabindex="-1"><a class="header-anchor" href="#æ•°æ®åº“ç®¡ç†" aria-hidden="true">#</a> æ•°æ®åº“ç®¡ç†</h4><p>ä½¿ç”¨ <code>show dbs</code>å¯ä»¥æŸ¥çœ‹æ•°æ®åº“</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>show dbs
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ä½¿ç”¨useåˆ‡æ¢æ•°æ®åº“ï¼Œå¦‚æœæ•°æ®åº“ä¸å­˜åœ¨ï¼Œä¼šç›´æ¥åˆ›å»ºã€‚å¦‚æœåœ¨ä½¿ç”¨æ—¶ä¸æŒ‡å®šæ•°æ®åº“ï¼Œmongodbé»˜è®¤ä½¿ç”¨testæ•°æ®åº“</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>use database_name
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>mongodbä¼šé»˜è®¤å¸¦<a href="https://blog.csdn.net/qq_42979842/article/details/107105017" target="_blank" rel="noopener noreferrer">ä¸‰ä¸ªåº“<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>admin   0.000GB
config  0.000GB
local   0.000GB
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>adminåº“ç”¨äºå­˜å‚¨ç”¨æˆ·ã€è§’è‰²ç­‰ä¿¡æ¯</p><p>localåº“ä¸»è¦å­˜å‚¨å‰¯æœ¬é›†çš„å…ƒæ•°æ®ä¿¡æ¯</p><p>configåº“ä¸»è¦å­˜å‚¨åˆ†ç‰‡é›†ç¾¤åŸºç¡€ä¿¡æ¯</p><p>åˆ é™¤æ•°æ®åº“</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>db.dropDatabase()
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>åˆ é™¤æ•°æ®åº“çš„æ—¶å€™ï¼Œå…ˆä½¿ç”¨useåˆ‡æ¢åˆ°æŒ‡å®šçš„åº“ï¼Œåœ¨æ‰§è¡Œ<code>db.dropDatabase()</code></p><h4 id="åˆ›å»ºé›†åˆ" tabindex="-1"><a class="header-anchor" href="#åˆ›å»ºé›†åˆ" aria-hidden="true">#</a> åˆ›å»ºé›†åˆ</h4><p>mongodbæ•°æ®åº“æ˜¯æ— æ¨¡å¼çš„ï¼Œå¦‚æœæ²¡æœ‰ç‰¹æ®Šè¦æ±‚ï¼Œä¸éœ€è¦æå‰å¸¸è§é›†åˆã€‚mongodbä¼šæ ¹æ®éœ€è¦è‡ªåŠ¨åˆ›å»ºã€‚</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>db.createCollection(name, options)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>optionsä¸­éƒ½æ˜¯å¯é€‰å‚æ•°ï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p><table><thead><tr><th>å­—æ®µ</th><th>ç±»å‹</th><th>æè¿°</th></tr></thead><tbody><tr><td>capped</td><td>bool</td><td>å¦‚æœä¸º trueï¼Œåˆ™åˆ›å»ºå›ºå®šé›†åˆã€‚å›ºå®šé›†åˆæ˜¯æŒ‡æœ‰ç€å›ºå®šå¤§å°çš„é›†åˆï¼Œå½“è¾¾åˆ°æœ€å¤§å€¼æ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨è¦†ç›–æœ€æ—©çš„æ–‡æ¡£ã€‚<br><strong>å½“è¯¥å€¼ä¸º true æ—¶ï¼Œå¿…é¡»æŒ‡å®š size å‚æ•°ã€‚</strong></td></tr><tr><td>size</td><td>æ•°å€¼</td><td>ä¸ºå›ºå®šé›†åˆæŒ‡å®šä¸€ä¸ªæœ€å¤§å€¼ï¼Œå³å­—èŠ‚æ•°ã€‚<br><strong>å¦‚æœ capped ä¸º trueï¼Œä¹Ÿéœ€è¦æŒ‡å®šè¯¥å­—æ®µã€‚</strong></td></tr><tr><td>max</td><td>æ•°å€¼</td><td>æŒ‡å®šå›ºå®šé›†åˆä¸­åŒ…å«æ–‡æ¡£çš„æœ€å¤§æ•°é‡ã€‚</td></tr></tbody></table><h5 id="å›ºå®šé›†åˆ" tabindex="-1"><a class="header-anchor" href="#å›ºå®šé›†åˆ" aria-hidden="true">#</a> å›ºå®šé›†åˆ</h5><p>å›ºå®šé›†åˆæŒ‡çš„æ˜¯äº‹å…ˆåˆ›å»ºï¼Œå¹¶ä¸”å¤§å°å›ºå®šçš„é›†åˆã€‚</p><p>å›ºå®šé›†åˆç‰¹æ€§ï¼šå›ºå®šé›†åˆå¾ˆåƒç¯å½¢é˜Ÿåˆ—ï¼Œå¦‚æœç©ºé—´ä¸è¶³ï¼Œæœ€æ—©çš„æ–‡æ¡£å°±ä¼šè¢«åˆ é™¤ï¼Œä¸ºæ–°çš„æ–‡æ¡£è…¾å‡ºç©ºé—´ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå›ºå®šé›†åˆé€‚ç”¨äºä»»ä½•æƒ³è¦è‡ªåŠ¨æ·˜æ±°è¿‡æœŸå±æ€§çš„åœºæ™¯ã€‚</p><p>åˆ›å»ºå›ºå®šé›†åˆ</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>db.createCollection(name, {capped:true,size:1000,max:100})
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>å½“é›†åˆçš„å¤§å°è¶…è¿‡sizeæ—¶ï¼Œä¼šåˆ é™¤è¾ƒæ—©çš„æ•°æ®ã€‚</li><li>å½“é›†åˆçš„æ¡æ•°è¶…è¿‡maxæ—¶ï¼Œä¼šåˆ é™¤è¾ƒæ—©çš„æ•°æ®ã€‚</li></ul><h4 id="æŸ¥çœ‹é›†åˆ" tabindex="-1"><a class="header-anchor" href="#æŸ¥çœ‹é›†åˆ" aria-hidden="true">#</a> æŸ¥çœ‹é›†åˆ</h4><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>show collections
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="åˆ é™¤é›†åˆ" tabindex="-1"><a class="header-anchor" href="#åˆ é™¤é›†åˆ" aria-hidden="true">#</a> åˆ é™¤é›†åˆ</h4><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>db.collection.drop()
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="bson" tabindex="-1"><a class="header-anchor" href="#bson" aria-hidden="true">#</a> BSON</h3><p>bsonæ˜¯ä»¥jsonæ ¼å¼ä¸ºåŸºç¡€è¿›è¡Œæ”¹é€ ï¼Œä½¿ç”¨äºŒè¿›åˆ¶å½¢å¼è¿›è¡Œå­˜å‚¨ï¼Œå¢å¼ºäº†æ•°æ®éå†é€Ÿåº¦ï¼ˆä¿å­˜äº†å…ƒç´ çš„é•¿åº¦ï¼‰ï¼Œå¢åŠ äº†æ•°æ®ç±»å‹ã€‚</p><p>è¿™é‡Œå®Œå…¨å¯ä»¥æŠŠbsonçœ‹æˆæ˜¯æ”¯æŒå¤šæ•°æ®ç±»å‹çš„json</p><h4 id="jsonçš„æ•°æ®ç±»å‹" tabindex="-1"><a class="header-anchor" href="#jsonçš„æ•°æ®ç±»å‹" aria-hidden="true">#</a> jsonçš„æ•°æ®ç±»å‹ï¼š</h4><p>å­—ç¬¦ä¸²ã€æ•°å­—ã€å¯¹è±¡ã€æ•°ç»„ã€å¸ƒå°”ã€Null</p><h4 id="bsonçš„æ•°æ®ç±»å‹" tabindex="-1"><a class="header-anchor" href="#bsonçš„æ•°æ®ç±»å‹" aria-hidden="true">#</a> bsonçš„æ•°æ®ç±»å‹</h4><table><thead><tr><th style="text-align:left;">ç±»å‹ Type</th><th style="text-align:left;">å¯¹åº”æ•°å­— Number</th><th style="text-align:left;">åˆ«å Alias</th><th style="text-align:left;">å¤‡æ³¨ Notes</th></tr></thead><tbody><tr><td style="text-align:left;">åŒç²¾åº¦æµ®ç‚¹å‹Double</td><td style="text-align:left;">1</td><td style="text-align:left;">â€œdoubleâ€</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;">å­—ç¬¦ä¸²String</td><td style="text-align:left;">2</td><td style="text-align:left;">â€œstringâ€</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;">å¯¹è±¡Object</td><td style="text-align:left;">3</td><td style="text-align:left;">â€œobjectâ€</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;">æ•°ç»„Array</td><td style="text-align:left;">4</td><td style="text-align:left;">â€œarrayâ€</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;">äºŒè¿›åˆ¶æ•°æ®Binary data</td><td style="text-align:left;">5</td><td style="text-align:left;">â€œbinDataâ€</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;">æœªå®šä¹‰Undefined</td><td style="text-align:left;">6</td><td style="text-align:left;">â€œundefinedâ€</td><td style="text-align:left;">ä¸æ¨èä½¿ç”¨ã€‚</td></tr><tr><td style="text-align:left;">å¯¹è±¡ç¼–å·ObjectId</td><td style="text-align:left;">7</td><td style="text-align:left;">â€œobjectIdâ€</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;">å¸ƒå°”å‹Boolean</td><td style="text-align:left;">8</td><td style="text-align:left;">â€œboolâ€</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;">æ—¥æœŸDate</td><td style="text-align:left;">9</td><td style="text-align:left;">â€œdateâ€</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;">ç©ºå€¼Null</td><td style="text-align:left;">10</td><td style="text-align:left;">â€œnullâ€</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;">æ­£åˆ™è¡¨è¾¾å¼Regular Expression</td><td style="text-align:left;">11</td><td style="text-align:left;">â€œregexâ€</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;">DBPointer</td><td style="text-align:left;">12</td><td style="text-align:left;">â€œdbPointerâ€</td><td style="text-align:left;">ä¸æ¨èä½¿ç”¨ã€‚</td></tr><tr><td style="text-align:left;">JavaScript</td><td style="text-align:left;">13</td><td style="text-align:left;">â€œjavascriptâ€</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;">Symbol</td><td style="text-align:left;">14</td><td style="text-align:left;">â€œsymbolâ€</td><td style="text-align:left;">ä¸æ¨èä½¿ç”¨ã€‚</td></tr><tr><td style="text-align:left;">JavaScript (å¸¦èŒƒå›´)</td><td style="text-align:left;">15</td><td style="text-align:left;">â€œjavascriptWithScopeâ€</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;">32ä½æ•´æ•° 32-bit integer</td><td style="text-align:left;">16</td><td style="text-align:left;">â€œintâ€</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;">æ—¶é—´æˆ³ Timestamp</td><td style="text-align:left;">17</td><td style="text-align:left;">â€œtimestampâ€</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;">64ä½æ•´æ•° 64-bit integer</td><td style="text-align:left;">18</td><td style="text-align:left;">â€œlongâ€</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;">å°æ•°128 Decimal128</td><td style="text-align:left;">19</td><td style="text-align:left;">â€œdecimalâ€</td><td style="text-align:left;">3.4ç‰ˆçš„æ–°åŠŸèƒ½ã€‚</td></tr><tr><td style="text-align:left;">æœ€å°é”® Min key</td><td style="text-align:left;">-1</td><td style="text-align:left;">â€œminKeyâ€</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;">æœ€å¤§é”® Max key</td><td style="text-align:left;">127</td><td style="text-align:left;">â€œmaxKeyâ€</td><td style="text-align:left;"></td></tr></tbody></table><h2 id="åŸºæœ¬æ“ä½œ-crud" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬æ“ä½œ-crud" aria-hidden="true">#</a> åŸºæœ¬æ“ä½œï¼ˆCRUDï¼‰</h2><h3 id="create" tabindex="-1"><a class="header-anchor" href="#create" aria-hidden="true">#</a> Create</h3><p>æ’å…¥æ–‡æ¡£æ—¶ï¼Œå¦‚æœæŒ‡å®šé›†åˆä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºé›†åˆ</p><p>æ’å…¥æ–‡æ¡£æ—¶ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®<code>_id</code>å­—æ®µï¼Œmongoä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ª<code>ObjectId</code></p><p>mongodbæä¾›çš„æ’å…¥æ–‡æ¡£çš„api</p><table><thead><tr><th>å‡½æ•°</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>db.collection.insertOne()</td><td>å°†å•ä¸ªæ–‡æ¡£æ’å…¥åˆ°é›†åˆä¸­ã€‚</td></tr><tr><td>db.collection.insertMany()</td><td>å°†å¤šä¸ªæ–‡ä»¶æ’å…¥é›†åˆä¸­ã€‚</td></tr><tr><td>db.collection.insert()</td><td>å°†å•ä¸ªæ–‡æ¡£æˆ–å¤šä¸ªæ–‡æ¡£æ’å…¥åˆ°é›†åˆä¸­ã€‚</td></tr></tbody></table><p>ä½¿ç”¨ç¤ºä¾‹ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>db.users.insert({name:&quot;user1&quot;,age:10})

db.users.insert([
	{name:&quot;user2&quot;,age:20},
	{name:&quot;user3&quot;,age:30}
])

db.users.insertOne({&quot;name&quot;:&quot;user4&quot;,age:40})

db.users.insertMany([
	{name:&quot;user5&quot;,age:50},
	{name:&quot;user6&quot;,age:60}
])
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>éªŒè¯ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>db.users.find({&quot;name&quot;:&quot;user1&quot;})

db.users.find({&quot;name&quot;:{&quot;$in&quot;:[&quot;user2&quot;,&quot;user3&quot;]}})

db.users.find({&quot;name&quot;:&quot;user4&quot;})

db.users.find({&quot;name&quot;:{&quot;$in&quot;:[&quot;user5&quot;,&quot;user6&quot;]}})
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="delete" tabindex="-1"><a class="header-anchor" href="#delete" aria-hidden="true">#</a> Delete</h3><table><thead><tr><th>æ–¹æ³•</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>db.collection.deleteOne()</td><td>å³ä½¿å¤šä¸ªæ–‡æ¡£å¯èƒ½ä¸æŒ‡å®šè¿‡æ»¤å™¨åŒ¹é…ï¼Œä¹Ÿæœ€å¤šåˆ é™¤ä¸€ä¸ªä¸æŒ‡å®šè¿‡æ»¤å™¨åŒ¹é…çš„æ–‡æ¡£ã€‚</td></tr><tr><td>db.collection.deleteMany()</td><td>åˆ é™¤æ‰€æœ‰ä¸æŒ‡å®šè¿‡æ»¤å™¨åŒ¹é…çš„æ–‡æ¡£ã€‚</td></tr><tr><td>db.collection.remove()</td><td>åˆ é™¤å•ä¸ªæ–‡æ¡£æˆ–ä¸æŒ‡å®šè¿‡æ»¤å™¨åŒ¹é…çš„æ‰€æœ‰æ–‡æ¡£ã€‚</td></tr></tbody></table><p>ä½¿ç”¨ç¤ºä¾‹</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>db.users.remove({&quot;name&quot;:&quot;user1&quot;})

db.users.remove({&quot;name&quot;:{&quot;$in&quot;:[&quot;user2&quot;,&quot;user3&quot;]}})

db.users.deleteOne({&quot;name&quot;:{&quot;$in&quot;:[&quot;user5&quot;,&quot;user6&quot;]}})

db.users.deleteMany({&quot;name&quot;:{&quot;$in&quot;:[&quot;user5&quot;,&quot;user6&quot;]}})
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="update" tabindex="-1"><a class="header-anchor" href="#update" aria-hidden="true">#</a> Update</h3><h4 id="æ–¹æ³•åˆ—è¡¨" tabindex="-1"><a class="header-anchor" href="#æ–¹æ³•åˆ—è¡¨" aria-hidden="true">#</a> æ–¹æ³•åˆ—è¡¨</h4><table><thead><tr><th style="text-align:left;">æ–¹æ³•</th><th style="text-align:left;">è¯´æ˜</th></tr></thead><tbody><tr><td style="text-align:left;">db.collection.updateOne()</td><td style="text-align:left;">å³ä½¿å¤šä¸ªæ–‡æ¡£å¯èƒ½ä¸æŒ‡å®šçš„è¿‡æ»¤å™¨åŒ¹é…ï¼Œæœ€å¤šæ›´æ–°ä¸æŒ‡å®šçš„è¿‡æ»¤å™¨åŒ¹é…çš„å•ä¸ªæ–‡æ¡£ã€‚</td></tr><tr><td style="text-align:left;">db.collection.updateMany()</td><td style="text-align:left;">æ›´æ–°æ‰€æœ‰ä¸æŒ‡å®šè¿‡æ»¤å™¨åŒ¹é…çš„æ–‡æ¡£ã€‚</td></tr><tr><td style="text-align:left;">db.collection.replaceOne()</td><td style="text-align:left;">å³ä½¿å¤šä¸ªæ–‡æ¡£å¯èƒ½ä¸æŒ‡å®šè¿‡æ»¤å™¨åŒ¹é…ï¼Œä¹Ÿæœ€å¤šæ›¿æ¢ä¸€ä¸ªä¸æŒ‡å®šè¿‡æ»¤å™¨åŒ¹é…çš„æ–‡æ¡£ã€‚</td></tr><tr><td style="text-align:left;">db.collection.update()</td><td style="text-align:left;">æ›´æ–°æˆ–æ›¿æ¢ä¸æŒ‡å®šè¿‡æ»¤å™¨åŒ¹é…çš„å•ä¸ªæ–‡æ¡£ï¼Œæˆ–æ›´æ–°ä¸æŒ‡å®šè¿‡æ»¤å™¨åŒ¹é…çš„æ‰€æœ‰æ–‡æ¡£ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œdb.collection.update()æ–¹æ³•æ›´æ–°å•ä¸ªæ–‡æ¡£ã€‚ è¦æ›´æ–°å¤šä¸ªæ–‡æ¡£ï¼Œè¯·ä½¿ç”¨<strong>multi</strong>é€‰é¡¹ã€‚</td></tr></tbody></table><h4 id="è¯­æ³•è¯´æ˜" tabindex="-1"><a class="header-anchor" href="#è¯­æ³•è¯´æ˜" aria-hidden="true">#</a> è¯­æ³•è¯´æ˜</h4><p>update()</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>db.collection.update(
   &lt;query&gt;,
   &lt;update&gt;,
   {
     upsert: &lt;boolean&gt;,
     multi: &lt;boolean&gt;,
     writeConcern: &lt;document&gt;,
     collation: &lt;document&gt;,
     arrayFilters: [ &lt;filterdocument1&gt;, ... ],
     hint:  &lt;document|string&gt;        // Available starting in MongoDB 4.2
   }
)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>updateOne()</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>db.collection.updateOne(
   &lt;filter&gt;,
   &lt;update&gt;,
   {
     upsert: &lt;boolean&gt;,
     writeConcern: &lt;document&gt;,
     collation: &lt;document&gt;,
     arrayFilters: [ &lt;filterdocument1&gt;, ... ],
     hint:  &lt;document|string&gt;        // Available starting in MongoDB 4.2.1
   }
)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>updateMany()</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>db.collection.updateMany(
   &lt;filter&gt;,
   &lt;update&gt;,
   {
     upsert: &lt;boolean&gt;,
     writeConcern: &lt;document&gt;,
     collation: &lt;document&gt;,
     arrayFilters: [ &lt;filterdocument1&gt;, ... ],
     hint:  &lt;document|string&gt;        // Available starting in MongoDB 4.2.1
   }
)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><em><strong>options</strong></em><strong>å‚æ•°è¯´æ˜</strong></p><p>optionsä¸­çš„å‚æ•°éƒ½æ˜¯å¯é€‰çš„ï¼Œä¸‹é¢åˆ—å‡ºå‚æ•°çš„åŠŸèƒ½ï¼š</p><table><thead><tr><th>option</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>upsert <code>boolean</code></td><td>é»˜è®¤ä¸º<strong>false</strong><br>å½“upsertä¸º<strong>true</strong>æ—¶ï¼Œå¦‚æœfilteræ²¡æœ‰åŒ¹é…åˆ°æ–‡æ¡£ï¼Œåˆ™å°†<code>update</code>ä¸­çš„å‚æ•°ä¿å­˜èµ·æ¥ã€‚å¦‚æœ<code>filter</code>ä¸­å‚æ•°ä¸­æŒ‡å®šäº†idï¼Œåœ¨ä¿å­˜æ—¶ä½¿ç”¨æŒ‡å®šçš„idï¼Œæ²¡æŒ‡å®šå°±è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªidã€‚<br>å½“upsertä¸º<strong>false</strong>æ—¶ï¼ŒfilteråŒ¹é…ä¸Šå°±æ›´æ–°æ–‡æ¡£ï¼Œæ²¡åŒ¹é…ä¸Šä¸åšä»»ä½•æ“ä½œ</td></tr><tr><td>multi <code>boolean</code></td><td>é»˜è®¤ä¸ºfalse<br>å½“multiä¸ºtrueæ—¶ï¼Œupdateæ“ä½œä¼šæ›´æ–°é›†åˆä¸­æ‰€æœ‰åŒ¹é…åˆ°çš„æ–‡æ¡£ï¼Œ<br>å½“multiä¸ºfalseæ—¶ï¼Œupdateæ“ä½œé»˜è®¤åªæ›´æ–°é›†åˆä¸­åŒ¹é…åˆ°çš„ç¬¬ä¸€ä¸ªæ–‡æ¡£</td></tr><tr><td>writeConcern</td><td></td></tr><tr><td>collation</td><td></td></tr><tr><td>arrayFilters</td><td></td></tr><tr><td>hint</td><td>æŒ‡å®šæŸ¥è¯¢æ—¶ä½¿ç”¨çš„ç´¢å¼•</td></tr></tbody></table><h4 id="æ›´æ–°è¿ç®—ç¬¦" tabindex="-1"><a class="header-anchor" href="#æ›´æ–°è¿ç®—ç¬¦" aria-hidden="true">#</a> æ›´æ–°è¿ç®—ç¬¦</h4><h5 id="å­—æ®µæ›´æ–°è¿ç®—ç¬¦" tabindex="-1"><a class="header-anchor" href="#å­—æ®µæ›´æ–°è¿ç®—ç¬¦" aria-hidden="true">#</a> å­—æ®µæ›´æ–°è¿ç®—ç¬¦</h5><table><thead><tr><th>operator</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>$currentDate</td><td>å°†å­—æ®µçš„å€¼è®¾ç½®ä¸ºå½“å‰æ—¥æœŸï¼Œå³æ—¥æœŸæˆ–æ—¶é—´æˆ³ã€‚</td></tr><tr><td>$inc</td><td>å°†å­—æ®µçš„å€¼å¢åŠ æŒ‡å®šçš„æ•°é‡ã€‚</td></tr><tr><td>$min</td><td>ä»…å½“æŒ‡å®šå€¼å°äºç°æœ‰å­—æ®µå€¼æ—¶æ‰æ›´æ–°è¯¥å­—æ®µã€‚</td></tr><tr><td>$max</td><td>ä»…å½“æŒ‡å®šå€¼å¤§äºç°æœ‰å­—æ®µå€¼æ—¶æ‰æ›´æ–°è¯¥å­—æ®µã€‚</td></tr><tr><td>$mul</td><td>å°†å­—æ®µçš„å€¼ä¹˜ä»¥æŒ‡å®šçš„æ•°é‡ã€‚</td></tr><tr><td>$rename</td><td>é‡å‘½åå­—æ®µã€‚</td></tr><tr><td>$set</td><td>è®¾ç½®æ–‡æ¡£ä¸­å­—æ®µçš„å€¼ã€‚</td></tr><tr><td>$setOnInsert</td><td>å¦‚æœæ›´æ–°å¯¼è‡´æ’å…¥æ–‡æ¡£ï¼Œåˆ™è®¾ç½®å­—æ®µçš„å€¼ã€‚å¯¹ä¿®æ”¹ç°æœ‰æ–‡æ¡£çš„æ›´æ–°æ“ä½œæ²¡æœ‰å½±å“ã€‚</td></tr><tr><td>$unset</td><td>ä»æ–‡æ¡£ä¸­åˆ é™¤æŒ‡å®šçš„å­—æ®µã€‚</td></tr></tbody></table><p>ç¤ºä¾‹ï¼š</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// ä¸ä½¿ç”¨æ“ä½œç¬¦ï¼Œåªä¼šç®€å•çš„æ›¿æ¢æ•´ä¸ªæ–‡æ¡£</span>
db<span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;user4&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string-property property">&quot;username&quot;</span><span class="token operator">:</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">,</span><span class="token string-property property">&quot;addr&quot;</span><span class="token operator">:</span><span class="token string">&quot;beijing&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

db<span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>
    <span class="token punctuation">{</span><span class="token string-property property">&quot;username&quot;</span><span class="token operator">:</span><span class="token string">&quot;user1&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
    	<span class="token string-property property">&quot;$currentDate&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string-property property">&quot;pron&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token string-property property">&quot;test.date&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string-property property">&quot;$type&quot;</span><span class="token operator">:</span><span class="token number">17</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;$set&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string-property property">&quot;test.desc&quot;</span><span class="token operator">:</span><span class="token string">&quot;test desc&quot;</span><span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">)</span>
db<span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>
    <span class="token punctuation">{</span><span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;user1&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">[</span>
        <span class="token punctuation">{</span><span class="token literal-property property">$set</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string-property property">&quot;pron&quot;</span><span class="token operator">:</span><span class="token string">&quot;$$NOW&quot;</span><span class="token punctuation">,</span><span class="token string-property property">&quot;test.date&quot;</span><span class="token operator">:</span><span class="token string">&quot;$$CLUSTER_TIME&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">)</span>

db<span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;user1&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string-property property">&quot;$inc&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token literal-property property">age</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

db<span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;user1&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string-property property">&quot;$min&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string-property property">&quot;age&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

db<span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;user1&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string-property property">&quot;$max&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string-property property">&quot;age&quot;</span><span class="token operator">:</span><span class="token number">30</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

db<span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string-property property">&quot;username&quot;</span><span class="token operator">:</span><span class="token string">&quot;user1&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string-property property">&quot;$mul&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string-property property">&quot;age&quot;</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

db<span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string-property property">&quot;username&quot;</span><span class="token operator">:</span><span class="token string">&quot;user1&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string-property property">&quot;$rename&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string-property property">&quot;age&quot;</span><span class="token operator">:</span><span class="token string">&quot;agee&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

db<span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string-property property">&quot;username&quot;</span><span class="token operator">:</span><span class="token string">&quot;user1&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string-property property">&quot;$set&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string-property property">&quot;age&quot;</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

db<span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string-property property">&quot;username&quot;</span><span class="token operator">:</span><span class="token string">&quot;user111&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string-property property">&quot;$set&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string-property property">&quot;age&quot;</span><span class="token operator">:</span><span class="token number">11</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string-property property">&quot;$setOnInsert&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string-property property">&quot;pron&quot;</span><span class="token operator">:</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
db<span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;user111&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string-property property">&quot;$set&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string-property property">&quot;age&quot;</span><span class="token operator">:</span><span class="token number">11</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string-property property">&quot;$setOnInsert&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string-property property">&quot;pron&quot;</span><span class="token operator">:</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string-property property">&quot;upsert&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

db<span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string-property property">&quot;username&quot;</span><span class="token operator">:</span><span class="token string">&quot;user1&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string-property property">&quot;$unset&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string-property property">&quot;agee&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="æ•°ç»„æ›´æ–°è¿ç®—ç¬¦" tabindex="-1"><a class="header-anchor" href="#æ•°ç»„æ›´æ–°è¿ç®—ç¬¦" aria-hidden="true">#</a> æ•°ç»„æ›´æ–°è¿ç®—ç¬¦</h5><table><thead><tr><th>operator</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>$</td><td>å……å½“å ä½ç¬¦ï¼Œä»¥æ›´æ–°ä¸æŸ¥è¯¢æ¡ä»¶åŒ¹é…çš„ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚</td></tr><tr><td>$[]</td><td>å……å½“å ä½ç¬¦ï¼Œä»¥æ›´æ–°åŒ¹é…æŸ¥è¯¢æ¡ä»¶çš„æ–‡æ¡£çš„æ•°ç»„ä¸­çš„æ‰€æœ‰å…ƒç´ ã€‚</td></tr><tr><td>$[<code>identifier</code>]</td><td>å……å½“å ä½ç¬¦ï¼Œä»¥æ›´æ–°<code>arrayFilters</code>ä¸æŸ¥è¯¢æ¡ä»¶åŒ¹é…çš„æ–‡æ¡£ä¸­æ‰€æœ‰ä¸æ¡ä»¶åŒ¹é…çš„å…ƒç´ ã€‚</td></tr><tr><td>$addToSet</td><td>ä»…å½“å…ƒç´ ä¸å­˜åœ¨äºé›†åˆä¸­æ—¶æ‰å°†å®ƒä»¬æ·»åŠ åˆ°æ•°ç»„ä¸­ã€‚</td></tr><tr><td>$pop</td><td>åˆ é™¤æ•°ç»„çš„ç¬¬ä¸€é¡¹æˆ–æœ€åä¸€é¡¹ã€‚</td></tr><tr><td>$pull</td><td>åˆ é™¤ä¸æŒ‡å®šæŸ¥è¯¢åŒ¹é…çš„æ‰€æœ‰æ•°ç»„å…ƒç´ ã€‚</td></tr><tr><td>$push</td><td>å°†é¡¹ç›®æ·»åŠ åˆ°æ•°ç»„ã€‚</td></tr><tr><td>$pullAll</td><td>ä»æ•°ç»„ä¸­åˆ é™¤æ‰€æœ‰åŒ¹é…çš„å€¼ã€‚</td></tr></tbody></table><p>æ›´æ–°ä¿®é¥°ç¬¦</p><table><thead><tr><th>åç§°</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>$each</td><td>ä¿®æ”¹<code>$push</code>å’Œ<code>$addToSet</code>è¿ç®—ç¬¦ä»¥é™„åŠ å¤šä¸ªé¡¹ä»¥è¿›è¡Œæ•°ç»„æ›´æ–°ã€‚</td></tr><tr><td>$position</td><td>ä¿®æ”¹<code>$push</code>è¿ç®—ç¬¦ä»¥æŒ‡å®šè¦æ·»åŠ å…ƒç´ çš„æ•°ç»„ä¸­çš„ä½ç½®ã€‚</td></tr><tr><td>$slice</td><td>ä¿®æ”¹<code>$push</code>è¿ç®—ç¬¦ä»¥é™åˆ¶æ›´æ–°æ•°ç»„çš„å¤§å°ã€‚</td></tr><tr><td>$sort</td><td>ä¿®æ”¹<code>$push</code>è¿ç®—ç¬¦ä»¥å¯¹å­˜å‚¨åœ¨æ•°ç»„ä¸­çš„æ–‡æ¡£é‡æ–°æ’åºã€‚</td></tr></tbody></table><p><strong>è¯­æ³•</strong></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>$
<span class="token comment">// é’ˆå¯¹æ•°ç»„ä¸­æ˜¯å…ƒç´ çš„æƒ…å†µ</span>
db<span class="token punctuation">.</span>collection<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>
   <span class="token punctuation">{</span> <span class="token operator">&lt;</span>array<span class="token operator">&gt;</span><span class="token operator">:</span> value <span class="token operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
   <span class="token punctuation">{</span> <span class="token operator">&lt;</span>update operator<span class="token operator">&gt;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token string-property property">&quot;&lt;array&gt;.$&quot;</span> <span class="token operator">:</span> value <span class="token punctuation">}</span> <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
<span class="token comment">// é’ˆå¯¹æ•°ç»„ä¸­æ˜¯æ–‡æ¡£çš„æƒ…å†µ</span>
db<span class="token punctuation">.</span>collection<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>
   <span class="token punctuation">{</span> <span class="token operator">&lt;</span>query selector<span class="token operator">&gt;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
   <span class="token punctuation">{</span> <span class="token operator">&lt;</span>update operator<span class="token operator">&gt;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token string-property property">&quot;array.$.field&quot;</span> <span class="token operator">:</span> value <span class="token punctuation">}</span> <span class="token punctuation">}</span>
<span class="token punctuation">)</span>

$<span class="token punctuation">[</span><span class="token punctuation">]</span>
db<span class="token punctuation">.</span>collection<span class="token punctuation">.</span><span class="token function">updateMany</span><span class="token punctuation">(</span>
   <span class="token punctuation">{</span> <span class="token operator">&lt;</span>query conditions<span class="token operator">&gt;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
   <span class="token punctuation">{</span> <span class="token operator">&lt;</span>update operator<span class="token operator">&gt;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token string-property property">&quot;&lt;array&gt;.$[]&quot;</span> <span class="token operator">:</span> value <span class="token punctuation">}</span> <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
db<span class="token punctuation">.</span>collection<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>
   <span class="token punctuation">{</span> <span class="token operator">&lt;</span>query selector<span class="token operator">&gt;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
   <span class="token punctuation">{</span> <span class="token operator">&lt;</span>update operator<span class="token operator">&gt;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token string-property property">&quot;array.$[].field&quot;</span> <span class="token operator">:</span> value <span class="token punctuation">}</span> <span class="token punctuation">}</span>
<span class="token punctuation">)</span>

$addToSet

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç¤ºä¾‹ï¼š</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// åˆ›å»ºæ•°æ®</span>
db<span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>
	<span class="token punctuation">{</span><span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;user1&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">{</span><span class="token string-property property">&quot;$set&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token literal-property property">item</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token literal-property property">book</span><span class="token operator">:</span><span class="token punctuation">[</span>
        	<span class="token punctuation">{</span><span class="token literal-property property">bid</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;aaa&quot;</span><span class="token punctuation">,</span><span class="token literal-property property">page</span><span class="token operator">:</span><span class="token number">300</span><span class="token punctuation">,</span><span class="token literal-property property">date</span><span class="token operator">:</span><span class="token number">2018</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span><span class="token literal-property property">bid</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;bbb&quot;</span><span class="token punctuation">,</span><span class="token literal-property property">page</span><span class="token operator">:</span><span class="token number">400</span><span class="token punctuation">,</span><span class="token literal-property property">date</span><span class="token operator">:</span><span class="token number">2019</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span><span class="token literal-property property">bid</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;ccc&quot;</span><span class="token punctuation">,</span><span class="token literal-property property">page</span><span class="token operator">:</span><span class="token number">500</span><span class="token punctuation">,</span><span class="token literal-property property">date</span><span class="token operator">:</span><span class="token number">2020</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span>

<span class="token comment">// åŒ¹é…å•ä¸€å…ƒç´ ï¼ˆfilteråŒ¹é…å¤šä¸ªæ—¶ï¼Œåªä¼šæ›´æ–°ç¬¬ä¸€ä¸ªï¼‰</span>
db<span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;user1&quot;</span><span class="token punctuation">,</span><span class="token literal-property property">item</span><span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token literal-property property">$set</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string-property property">&quot;item.$&quot;</span><span class="token operator">:</span><span class="token number">40</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
db<span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;user1&quot;</span><span class="token punctuation">,</span><span class="token string-property property">&quot;book.bid&quot;</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string-property property">&quot;$set&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string-property property">&quot;book.$.page&quot;</span><span class="token operator">:</span><span class="token number">480</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
db<span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;user1&quot;</span><span class="token punctuation">,</span><span class="token string-property property">&quot;book&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token literal-property property">$elemMatch</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token literal-property property">page</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token literal-property property">$gte</span><span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token literal-property property">$set</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string-property property">&quot;book.$.std&quot;</span><span class="token operator">:</span> <span class="token number">6</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// $[] é»˜è®¤åŒ¹é…å…¨éƒ¨å…ƒç´ ï¼Œå¯ä½¿ç”¨arrayFiltersè¿›è¡Œè¿‡æ»¤</span>
db<span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;user1&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token literal-property property">$inc</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string-property property">&quot;item.$[]&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
db<span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;user1&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token literal-property property">$inc</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string-property property">&quot;book.$[].page&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
db<span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;user1&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token literal-property property">$inc</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string-property property">&quot;book.$[bok].page&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">{</span><span class="token literal-property property">arrayFilters</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string-property property">&quot;bok.date&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token literal-property property">$lte</span><span class="token operator">:</span><span class="token number">2019</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// $addToSet(æ·»åŠ å¤šå…ƒç´ æ—¶ï¼Œè¦ç”¨$eachä¿®é¥°ä¸€ä¸‹)</span>
db<span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;user1&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token literal-property property">$addToSet</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token literal-property property">item</span><span class="token operator">:</span><span class="token number">5</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
db<span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;user1&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token literal-property property">$addToSet</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token literal-property property">item</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token literal-property property">$each</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// $pop ä»æ•°ç»„å¤´æˆ–å°¾åˆ é™¤ä¸€ä¸ªå…ƒç´ </span>
db<span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;user1&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token literal-property property">$pop</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string-property property">&quot;item&quot;</span><span class="token operator">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">//$pull æŠŠæ‰€æœ‰åŒ¹é…çš„éƒ½åˆ é™¤</span>
db<span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;user1&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token literal-property property">$pull</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token literal-property property">item</span><span class="token operator">:</span><span class="token number">11</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
db<span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;user1&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token literal-property property">$pull</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token literal-property property">item</span><span class="token operator">:</span><span class="token punctuation">{</span>$<span class="token keyword">in</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

db<span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;user1&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token literal-property property">$pullAll</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token literal-property property">item</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">28</span><span class="token punctuation">,</span><span class="token number">40</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// $push</span>
db<span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;user1&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token literal-property property">$push</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token literal-property property">item</span><span class="token operator">:</span><span class="token punctuation">{</span>
    <span class="token literal-property property">$each</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">19</span><span class="token punctuation">,</span><span class="token number">28</span><span class="token punctuation">,</span><span class="token number">40</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">$sort</span><span class="token operator">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token literal-property property">$slice</span><span class="token operator">:</span><span class="token number">10</span>
<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="æŒ‰ä½æ›´æ–°è¿ç®—ç¬¦" tabindex="-1"><a class="header-anchor" href="#æŒ‰ä½æ›´æ–°è¿ç®—ç¬¦" aria-hidden="true">#</a> æŒ‰ä½æ›´æ–°è¿ç®—ç¬¦</h5><table><thead><tr><th>åç§°</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>$bit</td><td>æ‰§è¡ŒæŒ‰ä½<code>AND</code>ï¼Œ<code>OR</code>å’Œ<code>XOR</code>æ•´æ•°å€¼çš„æ›´æ–°ã€‚</td></tr></tbody></table><p>è¯­æ³•</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>{ $bit: { &lt;field&gt;: { &lt;and|or|xor&gt;: &lt;int&gt; } } }
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ç¤ºä¾‹ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>{ _id: 1, expdata: NumberInt(13) }
===============================================
db.switches.update(
   { _id: 1 },
   { $bit: { expdata: { and: NumberInt(10) } } }
)
================================================
1101
1010
----
1000
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="retrieve" tabindex="-1"><a class="header-anchor" href="#retrieve" aria-hidden="true">#</a> Retrieve</h3><h4 id="æ–¹æ³•åˆ—è¡¨-1" tabindex="-1"><a class="header-anchor" href="#æ–¹æ³•åˆ—è¡¨-1" aria-hidden="true">#</a> æ–¹æ³•åˆ—è¡¨</h4><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>db.users.find()               
db.users.findOne()            
db.users.findOneAndReplace()
db.users.findAndModify()     
db.users.findOneAndDelete() 
db.users.findOneAndUpdate()
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="è¯­æ³•è¯´æ˜-1" tabindex="-1"><a class="header-anchor" href="#è¯­æ³•è¯´æ˜-1" aria-hidden="true">#</a> è¯­æ³•è¯´æ˜</h4><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>db.collections.find(
	&lt;query&gt;,
	&lt;projection&gt;
) 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å‚æ•°è¯´æ˜ï¼š</p><table><thead><tr><th style="text-align:left;">å‚æ•°</th><th style="text-align:left;">ç±»å‹</th><th style="text-align:left;">æè¿°</th></tr></thead><tbody><tr><td style="text-align:left;"><code>query</code></td><td style="text-align:left;">document</td><td style="text-align:left;">å¯é€‰çš„ã€‚ä½¿ç”¨query operatorsæŒ‡å®šé€‰æ‹©è¿‡æ»¤å™¨ã€‚è¦ return é›†åˆä¸­çš„æ‰€æœ‰æ–‡æ¡£ï¼Œè¯·çœç•¥æ­¤å‚æ•°æˆ–ä¼ é€’ç©ºæ–‡æ¡£(<code>{}</code>)ã€‚</td></tr><tr><td style="text-align:left;"><code>projection</code></td><td style="text-align:left;">document</td><td style="text-align:left;">å¯é€‰çš„ã€‚æŒ‡å®š_retch æŸ¥è¯¢è¿‡æ»¤å™¨çš„æ–‡æ¡£ä¸­çš„ return å­—æ®µã€‚è¦_retret åŒ¹é…æ–‡æ¡£ä¸­çš„æ‰€æœ‰å­—æ®µï¼Œè¯·çœç•¥æ­¤å‚æ•°ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…æŠ•å½±ã€‚</td></tr></tbody></table><h4 id="è¿ç®—ç¬¦" tabindex="-1"><a class="header-anchor" href="#è¿ç®—ç¬¦" aria-hidden="true">#</a> è¿ç®—ç¬¦</h4><h5 id="æ¯”è¾ƒè¿ç®—ç¬¦" tabindex="-1"><a class="header-anchor" href="#æ¯”è¾ƒè¿ç®—ç¬¦" aria-hidden="true">#</a> æ¯”è¾ƒè¿ç®—ç¬¦</h5><table><thead><tr><th>åç§°</th><th>ç»“æœ</th></tr></thead><tbody><tr><td>$eq</td><td>åŒ¹é…ç­‰äºæŒ‡å®šå€¼çš„å€¼ã€‚</td></tr><tr><td>$ne</td><td>åŒ¹é…æ‰€æœ‰ä¸ç­‰äºæŒ‡å®šå€¼çš„å€¼ã€‚</td></tr><tr><td>$gt</td><td>åŒ¹é…å¤§äºæŒ‡å®šå€¼çš„å€¼</td></tr><tr><td>$gte</td><td>åŒ¹é…å¤§äºæˆ–ç­‰äºæŒ‡å®šå€¼çš„å€¼ã€‚</td></tr><tr><td>$lt</td><td>åŒ¹é…å°äºæŒ‡å®šå€¼çš„å€¼ã€‚</td></tr><tr><td>$lte</td><td>åŒ¹é…å°äºæˆ–ç­‰äºæŒ‡å®šå€¼çš„å€¼ã€‚</td></tr><tr><td>$in</td><td>åŒ¹é…æ•°ç»„ä¸­æŒ‡å®šçš„ä»»ä½•å€¼ã€‚</td></tr><tr><td>$nin</td><td>ä¸åŒ¹é…æ•°ç»„ä¸­æŒ‡å®šçš„ä»»ä½•å€¼ã€‚</td></tr></tbody></table><p>ç¤ºä¾‹ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>db.users.find({&quot;name&quot;:{&quot;$eq&quot;:&quot;user1&quot;}})

db.users.find({&quot;age&quot;:{&quot;$lt&quot;:50,&quot;$gte&quot;:20}})

....
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="é€»è¾‘è¿ç®—ç¬¦" tabindex="-1"><a class="header-anchor" href="#é€»è¾‘è¿ç®—ç¬¦" aria-hidden="true">#</a> é€»è¾‘è¿ç®—ç¬¦</h5><table><thead><tr><th>åç§°</th><th>æè¿°</th></tr></thead><tbody><tr><td>$and</td><td>ä½¿ç”¨é€»è¾‘<code>AND</code>è¿æ¥æŸ¥è¯¢å­å¥ï¼Œè¿”å›ä¸è¿™ä¸¤ä¸ªå­å¥æ¡ä»¶åŒ¹é…çš„æ‰€æœ‰æ–‡æ¡£ã€‚</td></tr><tr><td>$not</td><td>åè½¬æŸ¥è¯¢è¡¨è¾¾å¼çš„æ•ˆæœï¼Œå¹¶è¿”å›ä¸æŸ¥è¯¢è¡¨è¾¾å¼<em>ä¸</em>åŒ¹é…çš„æ–‡æ¡£ã€‚</td></tr><tr><td>$nor</td><td>ç”¨é€»è¾‘<code>NOR</code>è¿æ¥æŸ¥è¯¢å­å¥ï¼Œè¿”å›æ‰€æœ‰ä¸èƒ½åŒ¹é…è¿™ä¸¤ä¸ªå­å¥çš„æ–‡æ¡£ã€‚</td></tr><tr><td>$or</td><td>ç”¨é€»è¾‘<code>OR</code>è¿æ¥æŸ¥è¯¢å­å¥ï¼Œè¿”å›ä¸ä»»ä¸€å­å¥æ¡ä»¶åŒ¹é…çš„æ‰€æœ‰æ–‡æ¡£ã€‚</td></tr></tbody></table><p>ç¤ºä¾‹ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>db.users.find({&quot;$and&quot;:[{&quot;name&quot;:{&quot;$ne&quot;:&quot;user1&quot;}},{&quot;age&quot;:{&quot;$lte&quot;:60}}]})

// notçš„å‚æ•°åªèƒ½ä½¿ç”¨æ­£åˆ™æˆ–è€…document
db.users.find({&quot;name&quot;:{&quot;$not&quot;:{$eq:&quot;user1&quot;}}})
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="å…ƒç´ " tabindex="-1"><a class="header-anchor" href="#å…ƒç´ " aria-hidden="true">#</a> å…ƒç´ </h5><table><thead><tr><th>åç§°</th><th>æè¿°</th></tr></thead><tbody><tr><td>$exists</td><td>åŒ¹é…å…·æœ‰æŒ‡å®šå­—æ®µçš„æ–‡æ¡£ã€‚</td></tr><tr><td>$type</td><td>å¦‚æœå­—æ®µæ˜¯æŒ‡å®šç±»å‹ï¼Œåˆ™é€‰æ‹©æ–‡æ¡£ã€‚</td></tr></tbody></table><h5 id="æ•°ç»„" tabindex="-1"><a class="header-anchor" href="#æ•°ç»„" aria-hidden="true">#</a> æ•°ç»„</h5><table><thead><tr><th>åç§°</th><th>æè¿°</th></tr></thead><tbody><tr><td>$all</td><td>åŒ¹é…åŒ…å«æŸ¥è¯¢ä¸­æŒ‡å®šçš„æ‰€æœ‰å…ƒç´ çš„æ•°ç»„ã€‚</td></tr><tr><td>$elemMatch</td><td>å¦‚æœarrayå­—æ®µä¸­çš„å…ƒç´ ç¬¦åˆæ‰€æœ‰æŒ‡å®š<code>$elemMatch</code>æ¡ä»¶ï¼Œåˆ™é€‰æ‹©æ–‡æ¡£ã€‚</td></tr><tr><td>$size</td><td>å¦‚æœæ•°ç»„å­—æ®µä¸ºæŒ‡å®šå¤§å°ï¼Œåˆ™é€‰æ‹©æ–‡æ¡£ã€‚</td></tr></tbody></table><h5 id="æŒ‰ä½" tabindex="-1"><a class="header-anchor" href="#æŒ‰ä½" aria-hidden="true">#</a> æŒ‰ä½</h5><table><thead><tr><th>åç§°</th><th>æè¿°</th></tr></thead><tbody><tr><td>$bitsAllClear</td><td>åŒ¹é…æ•°å­—æˆ–äºŒè¿›åˆ¶å€¼ï¼Œå…¶ä¸­ä¸€ç»„ä½çš„<em>æ‰€æœ‰</em>å€¼å‡ä¸º<code>0</code>ã€‚</td></tr><tr><td>$bitsAllSet</td><td>åŒ¹é…æ•°å­—æˆ–äºŒè¿›åˆ¶å€¼ï¼Œå…¶ä¸­ä¸€ç»„ä½çš„<em>æ‰€æœ‰</em>å€¼å‡ä¸º<code>1</code>ã€‚</td></tr><tr><td>$bigsAnyClear</td><td>åŒ¹é…æ•°å€¼æˆ–äºŒè¿›åˆ¶å€¼ï¼Œåœ¨è¿™äº›æ•°å€¼æˆ–äºŒè¿›åˆ¶å€¼ä¸­ï¼Œä¸€ç»„ä½çš„ä½ç½®ä¸­<em>ä»»ä½•</em>ä½çš„å€¼ä¸º<code>0</code>ã€‚</td></tr><tr><td>$bigsAnySet</td><td>åŒ¹é…æ•°å€¼æˆ–äºŒè¿›åˆ¶å€¼ï¼Œåœ¨è¿™äº›æ•°å€¼æˆ–äºŒè¿›åˆ¶å€¼ä¸­ï¼Œä¸€ç»„ä½çš„ä½ç½®ä¸­<em>ä»»ä½•</em>ä½çš„å€¼ä¸º<code>1</code>ã€‚</td></tr></tbody></table><h5 id="æ˜ å°„è¿ç®—ç¬¦" tabindex="-1"><a class="header-anchor" href="#æ˜ å°„è¿ç®—ç¬¦" aria-hidden="true">#</a> æ˜ å°„è¿ç®—ç¬¦</h5><table><thead><tr><th>åç§°</th><th>æè¿°</th></tr></thead><tbody><tr><td>$</td><td>æ•°ç»„ä¸­åŒ¹é…æŸ¥è¯¢æ¡ä»¶çš„ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚</td></tr><tr><td>$elemMatch</td><td>ç¬¦åˆæŒ‡å®š$elemMatchæ¡ä»¶çš„æ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚</td></tr><tr><td>$meta</td><td>é¡¹ç›®åœ¨$textæ“ä½œæœŸé—´åˆ†é…çš„æ–‡æ¡£åˆ†æ•°ã€‚</td></tr><tr><td>$slice</td><td>é™åˆ¶ä»æ•°ç»„ä¸­æŠ•å½±çš„å…ƒç´ æ•°é‡ã€‚æ”¯æŒ<code>limit</code>å’Œ<code>skip</code>ã€‚</td></tr></tbody></table><h4 id="åŸºæœ¬æŸ¥è¯¢" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬æŸ¥è¯¢" aria-hidden="true">#</a> åŸºæœ¬æŸ¥è¯¢</h4><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>// é€šè¿‡æ¡ä»¶è¿‡æ»¤
db.inventory.find({qty:25})

// æŒ‡å®šå¤šä¸ªæ¡ä»¶
db.inventory.find({qty:25, item: &quot;journal&quot;})

// å¤šæ¡ä»¶æŸ¥è¯¢
db.inventory.find( { status: &quot;A&quot;, qty: { $lt: 30 } } )

// ä½¿ç”¨é€»è¾‘è¿ç®—ç¬¦ï¼š$in
db.inventory.find({item: {$in : [&quot;canvas&quot;,&quot;mat&quot;] }})

// ä½¿ç”¨é€»è¾‘è¿ç®—ç¬¦ï¼š$or
db.inventory.find({$or :[{qty: 25}, {item: &quot;mat&quot;}]})

// å¤åˆæ¡ä»¶æŸ¥è¯¢ï¼Œæ”¯æŒæ­£åˆ™
db.inventory.find( {
     status: &quot;A&quot;,
     $or: [ { qty: { $lt: 30 } }, { item: /^p/ } ]
} )
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="é™åˆ¶è¿”å›çš„å­—æ®µ" tabindex="-1"><a class="header-anchor" href="#é™åˆ¶è¿”å›çš„å­—æ®µ" aria-hidden="true">#</a> é™åˆ¶è¿”å›çš„å­—æ®µ</h4><p>å¯ä»¥é€šè¿‡ç¬¬äºŒä¸ªå‚æ•°æ¥é™åˆ¶è¿”å›çš„å­—æ®µ</p><ul><li>1ï¼šæ ‡è¯†åŒ…å«ï¼Œ0ï¼šæ ‡è¯†æ’é™¤</li><li>_idå­—æ®µé»˜è®¤åŒ…å«ï¼Œè¦æ’é™¤éœ€è¦æ˜¾ç¤ºæŒ‡å®š</li><li>å¯ä»¥ä½¿ç”¨åŒ…å«æ–¹å¼ï¼Œæˆ–è€…æ’é™¤æ–¹å¼</li></ul><p>æµ‹è¯•æ•°æ®ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>db.inventory.insertMany( [ 
    { item: &quot;journal&quot;, status: &quot;A&quot;, size: { h: 14, w: 21, uom: &quot;cm&quot; }, instock: [ { warehouse: &quot;A&quot;, qty: 5 } ] },
    { item: &quot;notebook&quot;, status: &quot;A&quot;,  size: { h: 8.5, w: 11, uom: &quot;in&quot; }, instock: [ { warehouse: &quot;C&quot;, qty: 5 } ] },
    { item: &quot;paper&quot;, status: &quot;D&quot;, size: { h: 8.5, w: 11, uom: &quot;in&quot; }, instock: [ { warehouse: &quot;A&quot;, qty: 60 } ] },
    { item: &quot;planner&quot;, status: &quot;D&quot;, size: { h: 22.85, w: 30, uom: &quot;cm&quot; }, instock: [ { warehouse: &quot;A&quot;, qty: 40 } ] },
    { item: &quot;postcard&quot;, status: &quot;A&quot;, size: { h: 10, w: 15.25, uom: &quot;cm&quot; }, instock: [ { warehouse: &quot;B&quot;, qty: 15 }, { warehouse: &quot;C&quot;, qty: 35 } ] }
]);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>// é€šè¿‡ç¬¬äºŒä¸ªå‚æ•°æ¥é™åˆ¶è¿”å›çš„å­—æ®µï¼Œ1ï¼šè¿”å›ï¼Œ0ï¼šä¸è¿”å›ï¼Œ_idå­—æ®µæ—¶é»˜è®¤è¿”å›çš„ï¼Œè‹¥è¦ç¦æ­¢éœ€è¦æ˜¾ç¤ºè®¾ç½®
db.inventory.find({&quot;instock.qty&quot;:25}, {item:1,&quot;instock.qty&quot;:1})
// ç¦æ­¢_idå­—æ®µ
db.inventory.find({qty:25}, {item:1,qty:1,_id:0})

// æŒ‡å®šåµŒå¥—çš„å­—æ®µ
db.inventory.find( { status: &quot;A&quot; }, { item: 1, status: 1, &quot;size.uom&quot;: 1 })

// è¿”å›é™¤äº†è¢«æ’é™¤çš„å­—æ®µä¹‹å¤–çš„æ‰€æœ‰å­—æ®µ
db.inventory.find( { status: &quot;A&quot; }, { status: 0, instock: 0 } )

// ç¦æ­¢åµŒå…¥æ–‡æ¡£ä¸­çš„ç‰¹å®šå­—æ®µ
db.inventory.find( { status: &quot;A&quot; },{ &quot;size.uom&quot;: 0 })

// æ•°ç»„ä¸­åµŒå…¥å¼æ–‡æ¡£çš„
db.inventory.find( { status: &quot;A&quot; }, { item: 1, status: 1, &quot;instock.qty&quot;: 1 } )

/**
 * æ•°ç»„åˆ‡ç‰‡
 * $slice: 1  æ­£åºè¿”å›ä¸€ä¸ªï¼Œè´Ÿæ•°è¡¨ç¤ºå€’åºè¿”å›
 * $slice: [20, 10]  ä»ç¬¬20ä¸ªå¼€å§‹ï¼Œè¿”å›10ä¸ªå…ƒç´ 
 */
db.inventory.find( { status: &quot;A&quot; }, { item: 1, status: 1, instock: { $slice: -1 } } )

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="æŸ¥è¯¢ç©ºå­—æ®µ" tabindex="-1"><a class="header-anchor" href="#æŸ¥è¯¢ç©ºå­—æ®µ" aria-hidden="true">#</a> æŸ¥è¯¢ç©ºå­—æ®µ</h4><p>æµ‹è¯•æ•°æ®</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>db.inventory.insertMany([
   { _id: 1, item: null },
   { _id: 2 }
])
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç¤ºä¾‹ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>// {itemï¼šnull}æŸ¥è¯¢åŒ¹é…åŒ…å«å€¼æ˜¯nullçš„itemå­—æ®µæˆ–ä¸åŒ…å«itemå­—æ®µçš„æ–‡æ¡£ã€‚
db.inventory.find( { item: null } )

// {itemï¼š{$ typeï¼š10}}æŸ¥è¯¢åªåŒ¹é…åŒ…å«itemå­—æ®µå€¼ä¸ºnullçš„æ–‡æ¡£ï¼› å³itemå­—æ®µçš„å€¼ä¸ºBSON Typeä¸ºNullï¼ˆç±»å‹ç¼–å·10ï¼‰
db.inventory.find( { item : { $type: 10 } } )

// {itemï¼š{$ existsï¼šfalse}}æŸ¥è¯¢ä¸ä¸åŒ…å«itemå­—æ®µçš„æ–‡æ¡£åŒ¹é…ï¼š
db.inventory.find( { item : { $exists: false } } )
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="æŸ¥è¯¢æ•°ç»„-æ•°ç»„å…ƒç´ æ˜¯å€¼çš„æƒ…å†µ" tabindex="-1"><a class="header-anchor" href="#æŸ¥è¯¢æ•°ç»„-æ•°ç»„å…ƒç´ æ˜¯å€¼çš„æƒ…å†µ" aria-hidden="true">#</a> æŸ¥è¯¢æ•°ç»„ï¼ˆæ•°ç»„å…ƒç´ æ˜¯å€¼çš„æƒ…å†µï¼‰</h4><p>æµ‹è¯•æ•°æ®ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>db.inventory.insertMany([
    { item: &quot;journal&quot;, qty: 25, tags: [&quot;blank&quot;, &quot;red&quot;], dim_cm: [ 14, 21 ] }, 
    { item: &quot;notebook&quot;, qty: 50, tags: [&quot;red&quot;, &quot;blank&quot;], dim_cm: [ 14, 21 ] },
    { item: &quot;paper&quot;, qty: 100, tags: [&quot;red&quot;, &quot;blank&quot;, &quot;plain&quot;], dim_cm: [ 14, 21 ] },
    { item: &quot;planner&quot;, qty: 75, tags: [&quot;blank&quot;, &quot;red&quot;], dim_cm: [ 22.85, 30 ] },  
    { item: &quot;postcard&quot;, qty: 45, tags: [&quot;blue&quot;], dim_cm: [ 10, 15.25 ] }
]);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç¤ºä¾‹ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>// é¡ºåºå¿…é¡»å®Œå…¨ä¸€è‡´
db.inventory.find( { tags: [&quot;red&quot;, &quot;blank&quot;] } )
// æ‰¾åˆ°ä¸€ä¸ªåŒæ—¶åŒ…å«å…ƒç´ â€œ redâ€å’Œâ€œ blankâ€çš„æ•°ç»„
db.inventory.find( { tags: { $all: [&quot;red&quot;, &quot;blank&quot;] } } )
// tagæ˜¯ä¸€ä¸ªåŒ…å«å­—ç¬¦ä¸²â€œ redâ€ä½œä¸ºå…¶å…ƒç´ ä¹‹ä¸€çš„æ•°ç»„
db.inventory.find( { tags: &quot;red&quot; } )
// æŸ¥è¯¢æ•°ç»„dim_cmåŒ…å«è‡³å°‘ä¸€ä¸ªå€¼å¤§äº25çš„å…ƒç´ çš„æ‰€æœ‰æ–‡æ¡£ã€‚
db.inventory.find( { dim_cm: { $gt: 25 } } )

// åªè¦å­˜åœ¨å…ƒç´ å¤§äº15ï¼Œå°äº20å³å¯ï¼Œä¸ä¸€å®šæ˜¯åŒä¸€ä¸ª
db.inventory.find( { dim_cm: { $gt: 15, $lt: 20 } } )
//æŸ¥è¯¢åœ¨dim_cmæ•°ç»„ä¸­åŒ…å«è‡³å°‘ä¸€ä¸ªåŒæ—¶å¤§äº($gt)22å’Œå°äº ($lt) 30çš„å…ƒç´ çš„æ–‡æ¡£
db.inventory.find( { dim_cm: { $elemMatch: { $gt: 22, $lt: 30 } } } )
// æŒ‡å®šæ•°ç»„çš„ç´¢å¼•
db.inventory.find( { &quot;dim_cm.1&quot;: { $gt: 25 } } )
// é€‰æ‹©æ•°ç»„tagså…·æœ‰3ä¸ªå…ƒç´ çš„æ–‡æ¡£
db.inventory.find( { &quot;tags&quot;: { $size: 3 } } )
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="æŸ¥è¯¢æ•°ç»„-æ•°ç»„å…ƒç´ æ˜¯æ–‡æ¡£çš„æƒ…å†µ" tabindex="-1"><a class="header-anchor" href="#æŸ¥è¯¢æ•°ç»„-æ•°ç»„å…ƒç´ æ˜¯æ–‡æ¡£çš„æƒ…å†µ" aria-hidden="true">#</a> æŸ¥è¯¢æ•°ç»„ï¼ˆæ•°ç»„å…ƒç´ æ˜¯æ–‡æ¡£çš„æƒ…å†µï¼‰</h4><p>åˆ›å»ºæµ‹è¯•æ•°æ®</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>db.inventory.insertMany( [
    { item: &quot;journal&quot;, instock: [ { warehouse: &quot;A&quot;, qty: 5 }, { warehouse: &quot;C&quot;, qty: 15 } ] },  
    { item: &quot;notebook&quot;, instock: [ { warehouse: &quot;C&quot;, qty: 5 } ] },
    { item: &quot;paper&quot;, instock: [ { warehouse: &quot;A&quot;, qty: 60 }, { warehouse: &quot;B&quot;, qty: 15 } ] },
    { item: &quot;planner&quot;, instock: [ { warehouse: &quot;A&quot;, qty: 40 }, { warehouse: &quot;B&quot;, qty: 5 } ] }, 
    { item: &quot;postcard&quot;, instock: [ { warehouse: &quot;B&quot;, qty: 15 }, { warehouse: &quot;C&quot;, qty: 35 } ] }
]);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç¤ºä¾‹ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>// æŸ¥è¯¢æ•°ç»„ä¸­çš„å…ƒç´ ä¸æŒ‡å®šæ–‡æ¡£åŒ¹é…çš„æ‰€æœ‰æ–‡æ¡£ï¼ˆè¦æ±‚å®Œå…¨åŒ¹é…ï¼ŒåŒ…æ‹¬é¡ºåºï¼‰
db.inventory.find( { &quot;instock&quot;: { warehouse: &quot;A&quot;, qty: 5 } } )
// é”™è¯¯ç¤ºä¾‹ï¼Œ é¡ºåºä¸å¯¹æ—¶æŸ¥è¯¢ä¸åˆ°çš„
db.inventory.find( { &quot;instock&quot;: { qty: 5, warehouse: &quot;A&quot; } } )

// æŒ‡å®šæŸ¥è¯¢æ¡ä»¶(æ•°ç»„å†…åªæœ‰ç”±ä¸€æ¡æ•°æ®ç¬¦åˆå°±å¯ä»¥)
db.inventory.find( {&#39;instock.qty&#39;: { $lte: 20 }}, {instock:1} )

// å¯ä»¥æŒ‡å®šæ•°ç»„ç´¢å¼•
db.inventory.find( {&#39;instock.0.qty&#39;: { $lte: 20 }}, {instock:1})

// $elemMatch  æŒ‡å®šå¤šæ¡ä»¶
db.inventory.find( { &quot;instock&quot;: { $elemMatch: { qty: 5, warehouse: &quot;A&quot; } } } )
db.inventory.find( { &quot;instock&quot;: { $elemMatch: { qty: { $gt: 10, $lte: 20 } } } } )

//å…ƒç´ ç»„åˆæ»¡è¶³æ ‡å‡†
db.inventory.find( { &quot;instock.qty&quot;: { $gt: 10,  $lte: 20 } } )
db.inventory.find( { &quot;instock.qty&quot;: 5, &quot;instock.warehouse&quot;: &quot;A&quot; } )

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="æŸ¥è¯¢åµŒå¥—æ–‡æ¡£" tabindex="-1"><a class="header-anchor" href="#æŸ¥è¯¢åµŒå¥—æ–‡æ¡£" aria-hidden="true">#</a> æŸ¥è¯¢åµŒå¥—æ–‡æ¡£</h4><p>æµ‹è¯•æ•°æ®ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>db.inventory.insertMany( [
    { item: &quot;journal&quot;, qty: 25, size: { h: 14, w: 21, uom: &quot;cm&quot; }, status: &quot;A&quot; },
    { item: &quot;notebook&quot;, qty: 50, size: { h: 8.5, w: 11, uom: &quot;in&quot; }, status: &quot;A&quot; },
    { item: &quot;paper&quot;, qty: 100, size: { h: 8.5, w: 11, uom: &quot;in&quot; }, status: &quot;D&quot; },
    { item: &quot;planner&quot;, qty: 75, size: { h: 22.85, w: 30, uom: &quot;cm&quot; }, status: &quot;D&quot; },
    { item: &quot;postcard&quot;, qty: 45, size: { h: 10, w: 15.25, uom: &quot;cm&quot; }, status: &quot;A&quot; }
]);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç¤ºä¾‹ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>// æŸ¥è¯¢å­—æ®µsizeç­‰äºæ–‡æ¡£{hï¼š14ï¼Œwï¼š21ï¼Œuomï¼šâ€œ cmâ€}çš„æ‰€æœ‰æ–‡æ¡£,åŒ…æ‹¬å­—æ®µé¡ºåº
db.inventory.find( { size: { h: 14, w: 21, uom: &quot;cm&quot; } } )

db.inventory.find( { &quot;size.uom&quot;: &quot;in&quot; } )

db.inventory.find( { &quot;size.h&quot;: { $lt: 15 } } )

db.inventory.find( { &quot;size.h&quot;: { $lt: 15 }, &quot;size.uom&quot;: &quot;in&quot;, status: &quot;D&quot; } )
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="mongodb-èšåˆ" tabindex="-1"><a class="header-anchor" href="#mongodb-èšåˆ" aria-hidden="true">#</a> MongoDB èšåˆ</h2><p>èšåˆæ“ä½œå¤„ç†æ•°æ®è®°å½•å’Œ return è®¡ç®—ç»“æœã€‚èšåˆæ“ä½œå°†æ¥è‡ªå¤šä¸ªæ–‡æ¡£çš„å€¼ç»„åˆåœ¨ä¸€èµ·ï¼Œå¹¶ä¸”å¯ä»¥å¯¹åˆ†ç»„æ•°æ®æ‰§è¡Œå„ç§æ“ä½œä»¥è¿”å›å•ä¸ªç»“æœã€‚ MongoDB æä¾›äº†ä¸‰ç§æ‰§è¡Œèšåˆçš„æ–¹æ³•ï¼šèšåˆç®¡é“ï¼Œmap-reduce functionå’Œå•ä¸€ç›®çš„èšåˆæ–¹æ³•</p><h3 id="èšåˆç®¡é“" tabindex="-1"><a class="header-anchor" href="#èšåˆç®¡é“" aria-hidden="true">#</a> èšåˆç®¡é“</h3><p>èšåˆç®¡é“æ˜¯ç”¨äºæ•°æ®èšåˆçš„æ¡†æ¶ï¼Œå…¶æ¨¡å‹åŸºäºæ•°æ®å¤„ç†ç®¡é“çš„æ¦‚å¿µã€‚æ–‡æ¡£è¿›å…¥å¤šé˜¶æ®µç®¡é“ï¼Œå°†æ–‡æ¡£è½¬æ¢ä¸ºèšåˆç»“æœã€‚</p><p>ä¸‹é¢ç»™å‡ºä¸€ä¸ªç®€å•çš„ä¾‹å­</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>db.users.aggregate([
	{$match:{&quot;gender&quot;:0}},
	{$group:{_id:&quot;$age&quot;,count:{$sum:1}}}
])
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥å°†èšåˆç®¡é“ç±»æ¯”ä¸ºJavaä¸­çš„æµè®¡ç®—</p><h3 id="ç®¡é“æ“ä½œç¬¦" tabindex="-1"><a class="header-anchor" href="#ç®¡é“æ“ä½œç¬¦" aria-hidden="true">#</a> ç®¡é“æ“ä½œç¬¦</h3><h4 id="match" tabindex="-1"><a class="header-anchor" href="#match" aria-hidden="true">#</a> $match</h4><p>$matchä¸»è¦ç”¨äºå¯¹é›†åˆä¸­æ–‡æ¡£çš„ç­›é€‰</p><h4 id="project" tabindex="-1"><a class="header-anchor" href="#project" aria-hidden="true">#</a> $project</h4><p>$projectå¯ä»¥æå–å­—æ®µï¼Œé‡å‘½åå­—æ®µï¼ŒåŒ…å«æˆ–æ’é™¤å­—æ®µï¼Œè¿˜å¯ä»¥ç»„åˆå’ŒåµŒå¥—æ“ä½œç¬¦ï¼Œæ˜¯ä¸€ä¸ªå¾ˆå¼ºå¤§çš„æ“ä½œç¬¦ã€‚</p><p><strong>ç®¡é“è¡¨è¾¾å¼</strong></p><p>ç®€å•çš„åŒ…å«å’Œæ’é™¤å­—æ®µ</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>db.users.aggregate({
	$project:{&quot;userId&quot;:&quot;$_id&quot;, &quot;_id&quot;:0, &quot;name&quot;:1}
})
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æ•°å­¦è¡¨è¾¾å¼</strong></p><ul><li>$add:[expr1,[expr2...exprN]]</li></ul><p>æ¥æ”¶å¤šä¸ªå‚æ•°ï¼Œæ±‚å’Œ</p><ul><li>$subtract:[expr1,expr2]</li></ul><p>æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œexpr1-expr2</p><ul><li>$multiply:[expr1,[expr2...exprN]]</li></ul><p>æ¥æ”¶å¤šä¸ªå‚æ•°ï¼Œç›¸ä¹˜</p><ul><li>$divide:[expr1,expr2]</li></ul><p>æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œæ±‚å•†</p><ul><li>$mod:[expr1,expr2]</li></ul><p>æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œå–ä½™</p><p><strong>æ—¥æœŸè¡¨è¾¾å¼</strong></p><p>è¡¨è¾¾å¼å¯ä»¥ä»æ—¥æœŸç±»å‹çš„å­—æ®µä¸­æå–æ—¥æœŸ</p><p>$year</p><p>$month</p><p>$week</p><p>$dayOfMonth</p><p>$dayOfWeek</p><p>$dayOfYear</p><p>$hour</p><p>$minute</p><p>$second</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>db.users.aggregate({
	$project:{&quot;day&quot;:{$month:new Date(&quot;2021-04-01&quot;)}}
})
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>å­—ç¬¦ä¸²è¡¨è¾¾å¼</strong></p><ul><li>$substr: [expr, startOffset, numToReturn]</li></ul><p>exprå¿…é¡»æ˜¯å­—ç¬¦ä¸²ï¼Œä»startOffsetå­—èŠ‚å¼€å§‹ï¼ŒnumToReturnä¸ªå­—èŠ‚è¿”å›ã€‚</p><ul><li>$concat: [expr1, [expr2, ..., exprN]]</li></ul><p>è¿æ¥å­—ç¬¦ä¸²</p><ul><li>$toLower: expr</li></ul><p>è½¬å°å†™</p><ul><li>$toUpper: epxr</li></ul><p>è½¬å¤§å†™</p><p><strong>é€»è¾‘è¡¨è¾¾å¼</strong></p><p>$cmp: [expr1, expr2]</p><p>æ¯”è¾ƒexpr1ä¸expr2ï¼Œexpr1=expr2 è¿”å›0ï¼Œexpr1&lt;expr2 è¿”å›è´Ÿæ•°ï¼Œexpr1&gt;expr2 è¿”å›æ­£æ•°ï¼Œ</p><p>$strcasecmp: [string1, string2]</p><p>$eq/$ne/$gt/$gte/$lt/$lte/ : [expr1, expr2]</p><p>æ¯”è¾ƒexpr1ä¸expr2ï¼Œè¿”å›trueæˆ–false</p><p>$and: [expr1, [expr2, ..., exprN]] ä¸</p><p>$or: [expr1, [expr2, ..., exprN]] æˆ–</p><p>$not: epxr å–å</p><p>$cond: [booleanExpr, trueExpr, falseExpr] ç±»ä¼¼ä¸‰ç›®è¿ç®—</p><p>$ifNull: [expr, replacementExpr] å¦‚æœexprä¸ºç©ºï¼Œè¿”å›replacementExprï¼Œå¦åˆ™è¿”å›expr</p><p>ç¤ºä¾‹ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>// æµ‹è¯•æ•°æ®
{
  &quot;_id&quot; : 1,
  title: &quot;abc123&quot;,
  isbn: &quot;0001122223334&quot;,
  author: { last: &quot;zzz&quot;, first: &quot;aaa&quot; },
  copies: 5,
  lastModified: &quot;2016-07-28&quot;
}
{
  &quot;_id&quot; : 2,
  title: &quot;Baked Goods&quot;,
  isbn: &quot;9999999999999&quot;,
  author: { last: &quot;xyz&quot;, first: &quot;abc&quot;, middle: &quot;&quot; },
  copies: 2,
  lastModified: &quot;2017-07-21&quot;
}
{
  &quot;_id&quot; : 3,
  title: &quot;Ice Cream Cakes&quot;,
  isbn: &quot;8888888888888&quot;,
  author: { last: &quot;xyz&quot;, first: &quot;abc&quot;, middle: &quot;mmm&quot; },
  copies: 5,
  lastModified: &quot;2017-07-22&quot;
}

// ç¤ºä¾‹
db.books.aggregate( [
   {
      $project: {
         title: 1,
         &quot;author.first&quot;: 1,
         &quot;author.last&quot; : 1,
         &quot;author.middle&quot;: {
            $cond: {
               if: { $eq: [ &quot;&quot;, &quot;$author.middle&quot; ] },
               then: &quot;$$REMOVE&quot;,
               else: &quot;$author.middle&quot;
            }
         }
      }
   }
] )

// ç¤ºä¾‹
db.books.aggregate(
   [
      {
         $project: {
            title: 1,
            isbn: {
               prefix: { $substr: [ &quot;$isbn&quot;, 0, 3 ] },
               group: { $substr: [ &quot;$isbn&quot;, 3, 2 ] },
               publisher: { $substr: [ &quot;$isbn&quot;, 5, 4 ] },
               title: { $substr: [ &quot;$isbn&quot;, 9, 3 ] },
               checkDigit: { $substr: [ &quot;$isbn&quot;, 12, 1] }
            },
            lastName: &quot;$author.last&quot;,
            copiesSold: &quot;$copies&quot;
         }
      }
   ]
)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="group" tabindex="-1"><a class="header-anchor" href="#group" aria-hidden="true">#</a> $group</h4><p>åˆ†ç»„å‡½æ•°</p><p>$groupé˜¶æ®µé™åˆ¶çš„å†…å­˜å¤§å°ä¸º100MBï¼Œå¦‚æœæ•°æ®è¶…è¿‡100MBå°±ä¼šæŠ¥é”™ï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹allowdiskuseé€‰é¡¹æ¥å…è®¸å¤„ç†å¤§å‹æ•°æ®é›†</p><p>è¯­æ³•</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>{
  $group:
    {
      _id: &lt;expression&gt;, // Group By Expression
      &lt;field1&gt;: { &lt;accumulator1&gt; : &lt;expression1&gt; },
      ...
    }
 }
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>_id å­—æ®µå¯ä»¥æ˜¯å­—æ®µæˆ–æ–‡æ¡£</p><p>å‚æ•°åˆ—è¡¨ï¼š</p><table><thead><tr><th style="text-align:left;">Name</th><th style="text-align:left;">Description</th></tr></thead><tbody><tr><td style="text-align:left;"><a href="https://docs.mongodb.com/manual/reference/operator/aggregation/accumulator/#grp._S_accumulator" target="_blank" rel="noopener noreferrer"><code>$accumulator</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></td><td style="text-align:left;">è¿”å›ç”¨æˆ·å®šä¹‰çš„ç´¯åŠ å™¨å‡½æ•°çš„ç»“æœï¼ˆç±»ä¼¼UDAFå‡½æ•°ï¼‰</td></tr><tr><td style="text-align:left;"><a href="https://docs.mongodb.com/manual/reference/operator/aggregation/addToSet/#grp._S_addToSet" target="_blank" rel="noopener noreferrer"><code>$addToSet</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></td><td style="text-align:left;">Returns an array of <em>unique</em> expression values for each group. Order of the array elements is undefined.</td></tr><tr><td style="text-align:left;"><a href="https://docs.mongodb.com/manual/reference/operator/aggregation/avg/#grp._S_avg" target="_blank" rel="noopener noreferrer"><code>$avg</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></td><td style="text-align:left;">è®¡ç®—å¹³å‡å€¼ï¼Œå¿½ç•¥éæ•°å€¼å…ƒç´ </td></tr><tr><td style="text-align:left;"><a href="https://docs.mongodb.com/manual/reference/operator/aggregation/first/#grp._S_first" target="_blank" rel="noopener noreferrer"><code>$first</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></td><td style="text-align:left;">è¿”å›æ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªå€¼ï¼Œé€šå¸¸æƒ…å†µä¸‹å…ˆæ’åºã€‚</td></tr><tr><td style="text-align:left;"><a href="https://docs.mongodb.com/manual/reference/operator/aggregation/last/#grp._S_last" target="_blank" rel="noopener noreferrer"><code>$last</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></td><td style="text-align:left;">è¿”å›æ•°ç»„ä¸­çš„æœ€åä¸€ä¸ªå€¼ï¼Œé€šå¸¸æƒ…å†µä¸‹å…ˆæ’åº</td></tr><tr><td style="text-align:left;"><a href="https://docs.mongodb.com/manual/reference/operator/aggregation/max/#grp._S_max" target="_blank" rel="noopener noreferrer"><code>$max</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></td><td style="text-align:left;">è¿”å›groupä¸­çš„æœ€å¤§å€¼</td></tr><tr><td style="text-align:left;"><a href="https://docs.mongodb.com/manual/reference/operator/aggregation/mergeObjects/#exp._S_mergeObjects" target="_blank" rel="noopener noreferrer"><code>$mergeObjects</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></td><td style="text-align:left;">Returns a document created by combining the input documents for each group.</td></tr><tr><td style="text-align:left;"><a href="https://docs.mongodb.com/manual/reference/operator/aggregation/min/#grp._S_min" target="_blank" rel="noopener noreferrer"><code>$min</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></td><td style="text-align:left;">è¿”å›groupä¸­çš„æœ€å°å€¼</td></tr><tr><td style="text-align:left;"><a href="https://docs.mongodb.com/manual/reference/operator/aggregation/push/#grp._S_push" target="_blank" rel="noopener noreferrer"><code>$push</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></td><td style="text-align:left;">Returns an array of expression values for each group.</td></tr><tr><td style="text-align:left;"><a href="https://docs.mongodb.com/manual/reference/operator/aggregation/stdDevPop/#grp._S_stdDevPop" target="_blank" rel="noopener noreferrer"><code>$stdDevPop</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></td><td style="text-align:left;">Returns the population standard deviation of the input values.</td></tr><tr><td style="text-align:left;"><a href="https://docs.mongodb.com/manual/reference/operator/aggregation/stdDevSamp/#grp._S_stdDevSamp" target="_blank" rel="noopener noreferrer"><code>$stdDevSamp</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></td><td style="text-align:left;">Returns the sample standard deviation of the input values.</td></tr><tr><td style="text-align:left;"><a href="https://docs.mongodb.com/manual/reference/operator/aggregation/sum/#grp._S_sum" target="_blank" rel="noopener noreferrer"><code>$sum</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></td><td style="text-align:left;">å¯¹groupä¸­çš„æ‰€æœ‰å…ƒç´ æ±‚å’Œï¼Œå¿½ç•¥éæ•°å€¼å…ƒç´ </td></tr></tbody></table><p>$groupç¤ºä¾‹</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>// æµ‹è¯•æ•°æ®
db.sales.insertMany([
  { &quot;_id&quot; : 1, &quot;item&quot; : &quot;abc&quot;, &quot;price&quot; : NumberDecimal(&quot;10&quot;), &quot;quantity&quot; : NumberInt(&quot;2&quot;), &quot;date&quot; : ISODate(&quot;2014-03-01T08:00:00Z&quot;) },
  { &quot;_id&quot; : 2, &quot;item&quot; : &quot;jkl&quot;, &quot;price&quot; : NumberDecimal(&quot;20&quot;), &quot;quantity&quot; : NumberInt(&quot;1&quot;), &quot;date&quot; : ISODate(&quot;2014-03-01T09:00:00Z&quot;) },
  { &quot;_id&quot; : 3, &quot;item&quot; : &quot;xyz&quot;, &quot;price&quot; : NumberDecimal(&quot;5&quot;), &quot;quantity&quot; : NumberInt( &quot;10&quot;), &quot;date&quot; : ISODate(&quot;2014-03-15T09:00:00Z&quot;) },
  { &quot;_id&quot; : 4, &quot;item&quot; : &quot;xyz&quot;, &quot;price&quot; : NumberDecimal(&quot;5&quot;), &quot;quantity&quot; :  NumberInt(&quot;20&quot;) , &quot;date&quot; : ISODate(&quot;2014-04-04T11:21:39.736Z&quot;) },
  { &quot;_id&quot; : 5, &quot;item&quot; : &quot;abc&quot;, &quot;price&quot; : NumberDecimal(&quot;10&quot;), &quot;quantity&quot; : NumberInt(&quot;10&quot;) , &quot;date&quot; : ISODate(&quot;2014-04-04T21:23:13.331Z&quot;) },
  { &quot;_id&quot; : 6, &quot;item&quot; : &quot;def&quot;, &quot;price&quot; : NumberDecimal(&quot;7.5&quot;), &quot;quantity&quot;: NumberInt(&quot;5&quot; ) , &quot;date&quot; : ISODate(&quot;2015-06-04T05:08:13Z&quot;) },
  { &quot;_id&quot; : 7, &quot;item&quot; : &quot;def&quot;, &quot;price&quot; : NumberDecimal(&quot;7.5&quot;), &quot;quantity&quot;: NumberInt(&quot;10&quot;) , &quot;date&quot; : ISODate(&quot;2015-09-10T08:43:00Z&quot;) },
  { &quot;_id&quot; : 8, &quot;item&quot; : &quot;abc&quot;, &quot;price&quot; : NumberDecimal(&quot;10&quot;), &quot;quantity&quot; : NumberInt(&quot;5&quot; ) , &quot;date&quot; : ISODate(&quot;2016-02-06T20:20:13Z&quot;) },
])

// è®¡ç®—æ–‡æ¡£æ€»æ•°
db.sales.aggregate( [
  {
    $group: {
       _id: null,
       count: { $sum: 1 }
    }
  }
] )
// è®¡ç®—é”€å”®ä¸ªæ€»é‡å¤§äº100çš„item
db.sales.aggregate(
  [
    // First Stage
    {
      $group :
        {
          _id : &quot;$item&quot;,
          totalSaleAmount: { $sum: { $multiply: [ &quot;$price&quot;, &quot;$quantity&quot; ] } }
        }
     },
     // Second Stage
     {
       $match: { &quot;totalSaleAmount&quot;: { $gte: 100 } }
     }
   ]
 )

// æŒ‰æ—¥æœŸåˆ†ç»„
db.sales.aggregate([
  // First Stage
  {
    $match : { &quot;date&quot;: { $gte: new ISODate(&quot;2014-01-01&quot;), $lt: new ISODate(&quot;2015-01-01&quot;) } }
  },
  // Second Stage
  {
    $group : {
       _id : { $dateToString: { format: &quot;%Y-%m-%d&quot;, date: &quot;$date&quot; } },
       totalSaleAmount: { $sum: { $multiply: [ &quot;$price&quot;, &quot;$quantity&quot; ] } },
       averageQuantity: { $avg: &quot;$quantity&quot; },
       count: { $sum: 1 }
    }
  },
  // Third Stage
  {
    $sort : { totalSaleAmount: -1 }
  }
 ])

// ç»“æœ
{ &quot;_id&quot; : &quot;2014-04-04&quot;, &quot;totalSaleAmount&quot; : NumberDecimal(&quot;200&quot;), &quot;averageQuantity&quot; : 15, &quot;count&quot; : 2 }
{ &quot;_id&quot; : &quot;2014-03-15&quot;, &quot;totalSaleAmount&quot; : NumberDecimal(&quot;50&quot;), &quot;averageQuantity&quot; : 10, &quot;count&quot; : 1 }
{ &quot;_id&quot; : &quot;2014-03-01&quot;, &quot;totalSaleAmount&quot; : NumberDecimal(&quot;40&quot;), &quot;averageQuantity&quot; : 1.5, &quot;count&quot; : 2 }

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="unwind" tabindex="-1"><a class="header-anchor" href="#unwind" aria-hidden="true">#</a> $unwind</h4><p>å°†æ•°ç»„ä¸­çš„æ¯ä¸€ä¸ªå€¼æ‹†åˆ†ä¸ºç‹¬ç«‹çš„æ–‡æ¡£ã€‚</p><p>è¯­æ³•</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>{
  $unwind:
    {
      path: &lt;field path&gt;,
      includeArrayIndex: &lt;string&gt;,  // æ·»åŠ æ•°ç»„ç´¢å¼•
      preserveNullAndEmptyArrays: &lt;boolean&gt; // ä¿ç•™ä¸åŒ…å«pathï¼Œæˆ–pathä¸ºnullçš„å€¼
    }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç¤ºä¾‹ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>// æ’å…¥æ•°æ®
db.inventory.insertOne({ &quot;_id&quot; : 1, &quot;item&quot; : &quot;ABC1&quot;, sizes: [ &quot;S&quot;, &quot;M&quot;, &quot;L&quot;] })
// æ‹†åˆ†
db.inventory.aggregate( [ { $unwind : &quot;$sizes&quot; } ] )
db.inventory2.aggregate( [ { $unwind: { path: &quot;$sizes&quot; } } ] )

// ç»“æœ
{ &quot;_id&quot; : 1, &quot;item&quot; : &quot;ABC1&quot;, &quot;sizes&quot; : &quot;S&quot; }
{ &quot;_id&quot; : 1, &quot;item&quot; : &quot;ABC1&quot;, &quot;sizes&quot; : &quot;M&quot; }
{ &quot;_id&quot; : 1, &quot;item&quot; : &quot;ABC1&quot;, &quot;sizes&quot; : &quot;L&quot; }


db.inventory2.insertMany([
  { &quot;_id&quot; : 1, &quot;item&quot; : &quot;ABC&quot;, price: NumberDecimal(&quot;80&quot;), &quot;sizes&quot;: [ &quot;S&quot;, &quot;M&quot;, &quot;L&quot;] },
  { &quot;_id&quot; : 2, &quot;item&quot; : &quot;EFG&quot;, price: NumberDecimal(&quot;120&quot;), &quot;sizes&quot; : [ ] },
  { &quot;_id&quot; : 3, &quot;item&quot; : &quot;IJK&quot;, price: NumberDecimal(&quot;160&quot;), &quot;sizes&quot;: &quot;M&quot; },
  { &quot;_id&quot; : 4, &quot;item&quot; : &quot;LMN&quot; , price: NumberDecimal(&quot;10&quot;) },
  { &quot;_id&quot; : 5, &quot;item&quot; : &quot;XYZ&quot;, price: NumberDecimal(&quot;5.75&quot;), &quot;sizes&quot; : null }
])

// æ·»åŠ æ•°ç»„ç´¢å¼•
db.inventory2.aggregate( [
  {
    $unwind:
      {
        path: &quot;$sizes&quot;,
        includeArrayIndex: &quot;arrayIndex&quot;
      }
   }
])

{ &quot;_id&quot; : 1, &quot;item&quot; : &quot;ABC&quot;, &quot;price&quot; : NumberDecimal(&quot;80&quot;), &quot;sizes&quot; : &quot;S&quot;, &quot;arrayIndex&quot; : NumberLong(0) }
{ &quot;_id&quot; : 1, &quot;item&quot; : &quot;ABC&quot;, &quot;price&quot; : NumberDecimal(&quot;80&quot;), &quot;sizes&quot; : &quot;M&quot;, &quot;arrayIndex&quot; : NumberLong(1) }
{ &quot;_id&quot; : 1, &quot;item&quot; : &quot;ABC&quot;, &quot;price&quot; : NumberDecimal(&quot;80&quot;), &quot;sizes&quot; : &quot;L&quot;, &quot;arrayIndex&quot; : NumberLong(2) }
{ &quot;_id&quot; : 3, &quot;item&quot; : &quot;IJK&quot;, &quot;price&quot; : NumberDecimal(&quot;160&quot;), &quot;sizes&quot; : &quot;M&quot;, &quot;arrayIndex&quot; : null }


// ä¿ç•™ç©ºå€¼
db.inventory2.aggregate( [
   { $unwind: { path: &quot;$sizes&quot;, preserveNullAndEmptyArrays: true } }
] )

{ &quot;_id&quot; : 1, &quot;item&quot; : &quot;ABC&quot;, &quot;price&quot; : NumberDecimal(&quot;80&quot;), &quot;sizes&quot; : &quot;S&quot; }
{ &quot;_id&quot; : 1, &quot;item&quot; : &quot;ABC&quot;, &quot;price&quot; : NumberDecimal(&quot;80&quot;), &quot;sizes&quot; : &quot;M&quot; }
{ &quot;_id&quot; : 1, &quot;item&quot; : &quot;ABC&quot;, &quot;price&quot; : NumberDecimal(&quot;80&quot;), &quot;sizes&quot; : &quot;L&quot; }
{ &quot;_id&quot; : 2, &quot;item&quot; : &quot;EFG&quot;, &quot;price&quot; : NumberDecimal(&quot;120&quot;) }
{ &quot;_id&quot; : 3, &quot;item&quot; : &quot;IJK&quot;, &quot;price&quot; : NumberDecimal(&quot;160&quot;), &quot;sizes&quot; : &quot;M&quot; }
{ &quot;_id&quot; : 4, &quot;item&quot; : &quot;LMN&quot;, &quot;price&quot; : NumberDecimal(&quot;10&quot;) }
{ &quot;_id&quot; : 5, &quot;item&quot; : &quot;XYZ&quot;, &quot;price&quot; : NumberDecimal(&quot;5.75&quot;), &quot;sizes&quot; : null }

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="sort" tabindex="-1"><a class="header-anchor" href="#sort" aria-hidden="true">#</a> $sort</h4><p>æ ¹æ®å­—æ®µæ’åº</p><p>è¯­æ³•</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>{ $sort: { &lt;field1&gt;: &lt;sort order&gt;, &lt;field2&gt;: &lt;sort order&gt; ... } }
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ç¤ºä¾‹</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>db.restaurants.insertMany( [
   { &quot;_id&quot; : 1, &quot;name&quot; : &quot;Central Park Cafe&quot;, &quot;borough&quot; : &quot;Manhattan&quot;},
   { &quot;_id&quot; : 2, &quot;name&quot; : &quot;Rock A Feller Bar and Grill&quot;, &quot;borough&quot; : &quot;Queens&quot;},
   { &quot;_id&quot; : 3, &quot;name&quot; : &quot;Empire State Pub&quot;, &quot;borough&quot; : &quot;Brooklyn&quot;},
   { &quot;_id&quot; : 4, &quot;name&quot; : &quot;Stan&#39;s Pizzaria&quot;, &quot;borough&quot; : &quot;Manhattan&quot;},
   { &quot;_id&quot; : 5, &quot;name&quot; : &quot;Jane&#39;s Deli&quot;, &quot;borough&quot; : &quot;Brooklyn&quot;},
] );

db.restaurants.aggregate(
   [
     { $sort : { borough : 1 } }
   ]
)
// æ³¨æ„ï¼Œ å½“ä¸¤æ¡æ•°æ®å…·æœ‰ç›¸åŒå€¼æ—¶ï¼Œæ’åºå¯èƒ½ä¸åŒ
{ &quot;_id&quot; : 3, &quot;name&quot; : &quot;Empire State Pub&quot;, &quot;borough&quot; : &quot;Brooklyn&quot; }
{ &quot;_id&quot; : 5, &quot;name&quot; : &quot;Jane&#39;s Deli&quot;, &quot;borough&quot; : &quot;Brooklyn&quot; }
{ &quot;_id&quot; : 1, &quot;name&quot; : &quot;Central Park Cafe&quot;, &quot;borough&quot; : &quot;Manhattan&quot; }
{ &quot;_id&quot; : 4, &quot;name&quot; : &quot;Stan&#39;s Pizzaria&quot;, &quot;borough&quot; : &quot;Manhattan&quot; }
{ &quot;_id&quot; : 2, &quot;name&quot; : &quot;Rock A Feller Bar and Grill&quot;, &quot;borough&quot; : &quot;Queens&quot; }

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="limit" tabindex="-1"><a class="header-anchor" href="#limit" aria-hidden="true">#</a> $limit</h4><p>è¿”å›ç»“æœé›†ä¸­çš„å‰nä¸ªæ–‡æ¡£</p><p>è¯­æ³•</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>{ $limit: &lt;positive integer&gt; }
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>db.restaurants.aggregate([
   { $limit : 2 }
]);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="skip" tabindex="-1"><a class="header-anchor" href="#skip" aria-hidden="true">#</a> $skip</h4><p>è·³è¿‡ç»“æœé›†ä¸­çš„å‰nä¸ªæ–‡æ¡£</p><p>è¯­æ³•</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>{ $skip: &lt;positive integer&gt; }
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ç¤ºä¾‹ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>db.restaurants.aggregate([
   { $skip : 2 }
]);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="mongodb-map-reduce" tabindex="-1"><a class="header-anchor" href="#mongodb-map-reduce" aria-hidden="true">#</a> MongoDB Map-Reduce</h2><p>åŸºæœ¬è¯­æ³•</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>db.collection.mapReduce(
   function() {emit(key,value);},  //map å‡½æ•°
   function(key,values) {return reduceFunction},   //reduce å‡½æ•°
   {
      out: collection,
      query: document,
      sort: document,
      limit: number
   }
)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½¿ç”¨ MapReduce è¦å®ç°ä¸¤ä¸ªå‡½æ•° Map å‡½æ•°å’Œ Reduce å‡½æ•°,Map å‡½æ•°è°ƒç”¨ emit(key, value), éå† collection ä¸­æ‰€æœ‰çš„è®°å½•, å°† key ä¸ value ä¼ é€’ç»™ Reduce å‡½æ•°è¿›è¡Œå¤„ç†ã€‚</p><p>Map å‡½æ•°å¿…é¡»è°ƒç”¨ emit(key, value) è¿”å›é”®å€¼å¯¹ã€‚</p><p>å‚æ•°è¯´æ˜</p><ul><li><strong>map</strong> ï¼šæ˜ å°„å‡½æ•° (ç”Ÿæˆé”®å€¼å¯¹åºåˆ—,ä½œä¸º reduce å‡½æ•°å‚æ•°)ã€‚</li><li><strong>reduce</strong> ç»Ÿè®¡å‡½æ•°ï¼Œreduceå‡½æ•°çš„ä»»åŠ¡å°±æ˜¯å°†key-valueså˜æˆkey-valueï¼Œä¹Ÿå°±æ˜¯æŠŠvaluesæ•°ç»„å˜æˆä¸€ä¸ªå•ä¸€çš„å€¼valueã€‚ã€‚</li><li><strong>out</strong> ç»Ÿè®¡ç»“æœå­˜æ”¾é›†åˆ (ä¸æŒ‡å®šåˆ™ä½¿ç”¨ä¸´æ—¶é›†åˆ,åœ¨å®¢æˆ·ç«¯æ–­å¼€åè‡ªåŠ¨åˆ é™¤)ã€‚</li><li><strong>query</strong> ä¸€ä¸ªç­›é€‰æ¡ä»¶ï¼Œåªæœ‰æ»¡è¶³æ¡ä»¶çš„æ–‡æ¡£æ‰ä¼šè°ƒç”¨mapå‡½æ•°ã€‚ï¼ˆqueryã€‚limitï¼Œsortå¯ä»¥éšæ„ç»„åˆï¼‰</li><li><strong>sort</strong> å’Œlimitç»“åˆçš„sortæ’åºå‚æ•°ï¼ˆä¹Ÿæ˜¯åœ¨å‘å¾€mapå‡½æ•°å‰ç»™æ–‡æ¡£æ’åºï¼‰ï¼Œå¯ä»¥ä¼˜åŒ–åˆ†ç»„æœºåˆ¶</li><li><strong>limit</strong> å‘å¾€mapå‡½æ•°çš„æ–‡æ¡£æ•°é‡çš„ä¸Šé™ï¼ˆè¦æ˜¯æ²¡æœ‰limitï¼Œå•ç‹¬ä½¿ç”¨sortçš„ç”¨å¤„ä¸å¤§ï¼‰</li></ul><p>ç¤ºä¾‹ï¼š</p><p><img src="/assets/map-reduce.bakedsvg-861f1b66.svg" alt="img"></p><h2 id="mongodb-gridfs" tabindex="-1"><a class="header-anchor" href="#mongodb-gridfs" aria-hidden="true">#</a> MongoDB GridFS</h2><p>GridFSä¼šå°†æ–‡ä»¶åˆ‡åˆ†ä¸ºä¸€ä¸ªä¸ªçš„å°å—(chunk)ï¼Œå¹¶å•ç‹¬çš„ä¿å­˜åˆ°é›†åˆä¸­ã€‚å—å„¿çš„å¤§å°é»˜è®¤ä¸º255K</p><p>GridFSä½¿ç”¨ä¸¤ä¸ªé›†åˆå­˜å‚¨æ–‡ä»¶</p><ul><li>chunksï¼šå­˜å‚¨äºŒè¿›åˆ¶å—</li><li>filesï¼šå­˜å‚¨æ–‡ä»¶çš„å…ƒæ•°æ®ä¿¡æ¯</li></ul><h3 id="chunks" tabindex="-1"><a class="header-anchor" href="#chunks" aria-hidden="true">#</a> chunks</h3><p>chunksä¸­å­˜å‚¨çš„schema</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>{
  &quot;_id&quot; : &lt;ObjectId&gt;,
  &quot;files_id&quot; : &lt;ObjectId&gt;,
  &quot;n&quot; : &lt;num&gt;,
  &quot;data&quot; : &lt;binary&gt;
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>chunks._id</li></ul><p>The unique ObjectId of the chunk.</p><ul><li>chunks.files_id</li></ul><p>The _id of the â€œparentâ€ document, as specified in the files collection.</p><ul><li>chunks.n</li></ul><p>The sequence number of the chunk. GridFS numbers all chunks, starting with 0.</p><ul><li>chunks.data</li></ul><p>The chunkâ€™s payload as a BSON Binary type.</p><h3 id="files" tabindex="-1"><a class="header-anchor" href="#files" aria-hidden="true">#</a> files</h3><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>{
  &quot;_id&quot; : &lt;ObjectId&gt;,
  &quot;length&quot; : &lt;num&gt;,
  &quot;chunkSize&quot; : &lt;num&gt;,
  &quot;uploadDate&quot; : &lt;timestamp&gt;,
  &quot;md5&quot; : &lt;hash&gt;,
  &quot;filename&quot; : &lt;string&gt;,
  &quot;contentType&quot; : &lt;string&gt;,
  &quot;aliases&quot; : &lt;string array&gt;,
  &quot;metadata&quot; : &lt;any&gt;,
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="mongodb-å®‰å…¨" tabindex="-1"><a class="header-anchor" href="#mongodb-å®‰å…¨" aria-hidden="true">#</a> MongoDB å®‰å…¨</h2><p><img src="/assets/image-20210224112302614-446b3b7e.png" alt="image-20210224112302614"></p><h2 id="mongodb-ç´¢å¼•" tabindex="-1"><a class="header-anchor" href="#mongodb-ç´¢å¼•" aria-hidden="true">#</a> MongoDB ç´¢å¼•</h2><p>å»ºç«‹æµ‹è¯•æ•°æ®</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">for</span> <span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">100000</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	db<span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>
    	<span class="token punctuation">{</span>
            <span class="token string-property property">&quot;i&quot;</span><span class="token operator">:</span>i<span class="token punctuation">,</span>
            <span class="token string-property property">&quot;username&quot;</span><span class="token operator">:</span><span class="token string">&quot;user&quot;</span><span class="token operator">+</span>i<span class="token punctuation">,</span>
            <span class="token string-property property">&quot;gender&quot;</span><span class="token operator">:</span>Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string-property property">&quot;age&quot;</span><span class="token operator">:</span>Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">120</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string-property property">&quot;created&quot;</span><span class="token operator">:</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœæ²¡æœ‰ç´¢å¼•ï¼Œmongodbåœ¨æŸ¥è¯¢æ—¶éœ€è¦æ‰§è¡Œé›†åˆæ‰«æï¼Œå½“æ•°æ®é‡è¿‡å¤§æ—¶ä¼šå¸¦æ¥æ€§èƒ½é—®é¢˜ã€‚å»ºç«‹æœ‰æ•ˆçš„ç´¢å¼•ï¼Œä¼šæå‡æŸ¥è¯¢æ€§èƒ½ã€‚</p><h3 id="åŸºç¡€" tabindex="-1"><a class="header-anchor" href="#åŸºç¡€" aria-hidden="true">#</a> åŸºç¡€</h3><h4 id="é»˜è®¤ç´¢å¼•" tabindex="-1"><a class="header-anchor" href="#é»˜è®¤ç´¢å¼•" aria-hidden="true">#</a> é»˜è®¤ç´¢å¼•</h4><p>mongodbé»˜è®¤åœ¨_idå­—æ®µä¸Šåˆ›å»ºç´¢å¼•ï¼Œå¹¶ä¸”ä¸èƒ½åˆ é™¤ã€‚</p><h4 id="ç´¢å¼•ç®¡ç†" tabindex="-1"><a class="header-anchor" href="#ç´¢å¼•ç®¡ç†" aria-hidden="true">#</a> ç´¢å¼•ç®¡ç†</h4><p><strong>åˆ›å»ºç´¢å¼•</strong></p><p>åˆ›å»ºç´¢å¼•æ—¶å¯ä»¥æŒ‡å®šæ’åºè§„åˆ™ï¼š1ï¼šå‡åºæ’åºï¼Œ-1ï¼šé™åºæ’åº</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>db.collection.createIndex({&quot;username&quot;:1,&quot;age&quot;:-1})
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>ç´¢å¼•åç§°</strong></p><p>ç´¢å¼•åç§°é»˜è®¤ä½¿ç”¨key+valyeå½¢å¼ï¼Œå¤šå­—æ®µç´¢å¼•ä½¿ç”¨<code>_</code>é“¾æ¥</p><p>ä¸Šé¢åˆ›å»ºçš„ç´¢å¼•é»˜è®¤ä¸ºï¼š<code>username1_age-1</code></p><p>å¯ä»¥é€šè¿‡å‚æ•°çš„å½¢å¼æŒ‡å®šç´¢å¼•åç§°</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>db.collection.createIndex({&quot;username&quot;:1,&quot;age&quot;:-1}, {&quot;name&quot;:&quot;special&quot;})
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>åˆ é™¤ç´¢å¼•</strong></p><p>_idå­—æ®µä¸Šçš„ç´¢å¼•ä¸èƒ½åˆ é™¤</p><p>ä¸åŠ å‚æ•°æ—¶åˆ é™¤é›†åˆä¸Šçš„å…¨éƒ¨ç´¢å¼•</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>db.collection.dropIndexes()
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å‚æ•°å¯ä»¥æ—¶ç´¢å¼•æ–‡æ¡£æˆ–ç´¢å¼•åç§°æˆ–å­—ç¬¦æ•°ç»„ï¼Œä¾‹å¦‚ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>db.collection.dropIndexes({&quot;username&quot;:1,&quot;age&quot;:-1})
db.collection.dropIndexes(&quot;username1_age-1&quot;)
// åˆ é™¤ç´¢å¼•æ—¶ä½¿ç”¨æ•°ç»„æŒ‡å®š
db.collection.dropIndexes([&quot;username1_age-1&quot;])
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>è·å–ç´¢å¼•</strong></p><p>è·å–æ–‡æ¡£çš„å…¨éƒ¨ç´¢å¼•</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>db.collection.getIndexes()
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>é‡å»ºç´¢å¼•</strong></p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>db.collection.reIndex()
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="ç´¢å¼•ç±»å‹" tabindex="-1"><a class="header-anchor" href="#ç´¢å¼•ç±»å‹" aria-hidden="true">#</a> ç´¢å¼•ç±»å‹</h4><h5 id="å•å€¼ç´¢å¼•" tabindex="-1"><a class="header-anchor" href="#å•å€¼ç´¢å¼•" aria-hidden="true">#</a> å•å€¼ç´¢å¼•</h5><p>åœ¨åˆ›å»ºç´¢å¼•æ—¶ï¼ŒæŒ‡å®šå•ä¸ªå­—æ®µï¼Œä¾‹å¦‚</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>db.collection.createIndex({&quot;username&quot;:1})
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>åœ¨å•ä¸ªå­—æ®µä¸Šè¿›è¡Œç´¢å¼•ã€‚å¯¹å•ä¸ªç´¢å¼•çš„æ’åºé¡ºåºå¹¶ä¸é‡è¦ï¼Œå› ä¸ºMongodbå¯ä»¥ä»ä»»ä½•æ–¹å‘ä¸Šè¿›è¡Œéå†ç´¢å¼•</p><h5 id="å¤åˆç´¢å¼•" tabindex="-1"><a class="header-anchor" href="#å¤åˆç´¢å¼•" aria-hidden="true">#</a> å¤åˆç´¢å¼•</h5><p>åœ¨åˆ›å»ºç´¢å¼•æ—¶ï¼ŒæŒ‡å®šå¤šä¸ªå­—æ®µï¼Œä¾‹å¦‚ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>db.collection.createIndex({&quot;username&quot;:1,&quot;age&quot;:-1})
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å¤åˆç´¢å¼•çš„æ•°æ®ç»“æ„å¦‚ä¸‹ï¼š</p><img src="/assets/2019092521124393-29085d09.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" style="zoom:50%;alert:left;"><p>æ‰€ä»¥ï¼Œåœ¨åˆ›å»ºå¤åˆç´¢å¼•æ—¶ï¼Œç´¢å¼•å­—æ®µçš„é¡ºåºï¼Œä»¥åŠå­—æ®µçš„æ’åºé¡ºåºéƒ½æ˜¯éœ€è¦è€ƒè™‘çš„ã€‚ä¸è¿‡mongoDBåœ¨éå†ç´¢å¼•æ—¶å¯ä»¥æ­£åºéå†ï¼Œä¹Ÿå¯ä»¥å€’å™éå†ï¼Œæ‰€ä»¥{&quot;username&quot;:1,&quot;age&quot;:-1}å’Œ{&quot;username&quot;:-1,&quot;age&quot;:1}çš„é¡ºåºå¯ä»¥çœ‹ä½œæ—¶ç›¸åŒçš„ç´¢å¼•ã€‚</p><p><strong>ç´¢å¼•å‰ç¼€</strong></p><p>ç´¢å¼•å‰ç¼€æ—¶å¤åˆç´¢å¼•çš„å¼€å§‹å­é›†ï¼Œä¾‹å¦‚ç”±å¦‚ä¸‹ç´¢å¼•ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>db.collection.createIndex({&quot;username&quot;:1,&quot;age&quot;:-1,&quot;created&quot;:1})
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>åŒ…å«ä»¥ä¸‹ç´¢å¼•å‰ç¼€ï¼š</p><ul><li>{&quot;username&quot;:1}</li><li>{&quot;username&quot;:1,&quot;age&quot;:-1}</li><li>{&quot;username&quot;:1,&quot;age&quot;:-1,&quot;created&quot;:1}</li></ul><p>åœ¨æŸ¥è¯¢usernameå­—æ®µã€username and age å­—æ®µä»¥åŠ username and age and created å­—æ®µæ—¶ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªç´¢å¼•ã€‚</p><p>åœ¨æŸ¥è¯¢username and created å­—æ®µæ—¶ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨è¿™ä¸ªç´¢å¼•ï¼Œä½†æ˜¯æ€§èƒ½æ²¡æœ‰å‰é¢çš„æŸ¥è¯¢é«˜ã€‚</p><p>åœ¨æŸ¥è¯¢ageã€createdã€age and created å­—æ®µæ—¶æ— æ³•ä½¿ç”¨è¿™ä¸ªç´¢å¼•ã€‚</p><h5 id="å¤šé”®ç´¢å¼•" tabindex="-1"><a class="header-anchor" href="#å¤šé”®ç´¢å¼•" aria-hidden="true">#</a> å¤šé”®ç´¢å¼•</h5><h5 id="åœ°ç†ç©ºé—´ç´¢å¼•" tabindex="-1"><a class="header-anchor" href="#åœ°ç†ç©ºé—´ç´¢å¼•" aria-hidden="true">#</a> åœ°ç†ç©ºé—´ç´¢å¼•</h5><h5 id="æ–‡æœ¬ç´¢å¼•" tabindex="-1"><a class="header-anchor" href="#æ–‡æœ¬ç´¢å¼•" aria-hidden="true">#</a> æ–‡æœ¬ç´¢å¼•</h5><h5 id="hashedç´¢å¼•" tabindex="-1"><a class="header-anchor" href="#hashedç´¢å¼•" aria-hidden="true">#</a> Hashedç´¢å¼•</h5><h4 id="ç´¢å¼•äº¤é›†" tabindex="-1"><a class="header-anchor" href="#ç´¢å¼•äº¤é›†" aria-hidden="true">#</a> ç´¢å¼•äº¤é›†</h4><p>mongodbå¯ä»¥ä½¿ç”¨ç´¢å¼•çš„äº¤é›†æ¥å®ŒæˆæŸ¥è¯¢ã€‚ä¾‹å¦‚usersé›†åˆæœ‰ä»¥ä¸‹ç´¢å¼•ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>{&quot;username&quot;:1}
{&quot;age&quot;:&quot;1&quot;}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>mongodbå¯ä»¥ç”¨æ¥æ”¯æŒä¸€ä¸‹çš„æŸ¥è¯¢ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>db.users.find({&quot;username&quot;:&quot;user1&quot;,age:{&quot;$gt&quot;:20}})
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p>ç´¢å¼•å‰ç¼€äº¤é›†</p><p>ç´¢å¼•äº¤é›†å’Œå¤åˆç´¢å¼•</p></blockquote><p><strong>ç´¢å¼•äº¤é›†å’Œæ’åº</strong></p><p>å½“ç´¢å¼•å’ŒæŸ¥è¯¢è°“è¯å®Œå…¨åˆ†å¼€æ—¶ï¼Œç´¢å¼•äº¤é›†ä¸é€‚ç”¨</p><h3 id="å•å€¼ç´¢å¼•-1" tabindex="-1"><a class="header-anchor" href="#å•å€¼ç´¢å¼•-1" aria-hidden="true">#</a> å•å€¼ç´¢å¼•</h3><p>å»ºç«‹ç´¢å¼•</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>db.users.createIndex({&quot;username&quot;:1})
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>æŸ¥è¯¢è¯­å¥</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>db.users.find({&quot;username&quot;:&quot;user101&quot;}).explain(&quot;executionStats&quot;)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>æŸ¥è¯¢åˆ†æ</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>{
    &quot;queryPlanner&quot; : {
        &quot;plannerVersion&quot; : 1,
        &quot;namespace&quot; : &quot;test.users&quot;,
        &quot;indexFilterSet&quot; : false,
        &quot;parsedQuery&quot; : {
            &quot;username&quot; : {
                &quot;$eq&quot; : &quot;user101&quot;
            }
        },
        &quot;winningPlan&quot; : {
            &quot;stage&quot; : &quot;FETCH&quot;,
            // å­é˜¶æ®µ
            &quot;inputStage&quot; : {
                // ç´¢å¼•æ‰«æ
                &quot;stage&quot; : &quot;IXSCAN&quot;,
                // è¯¥æ‰§è¡Œè®¡åˆ’æ‰«æçš„ç´¢å¼•
                &quot;keyPattern&quot; : {
                    &quot;username&quot; : 1
                },
                // ç´¢å¼•åç§°
                &quot;indexName&quot; : &quot;username_1&quot;,
                // æ˜¯å¦ä¸ºMultikeyï¼Œå¦‚æœç´¢å¼•å»ºç«‹åœ¨arrayå­—æ®µä¸Šï¼Œè¿”å›true
                &quot;isMultiKey&quot; : false,
                &quot;multiKeyPaths&quot; : {
                    &quot;username&quot; : [ ]
                },
                &quot;isUnique&quot; : false,
                &quot;isSparse&quot; : false,
                &quot;isPartial&quot; : false,
                &quot;indexVersion&quot; : 2,
                &quot;direction&quot; : &quot;forward&quot;,
                // æ‰«æçš„ç´¢å¼•èŒƒå›´
                &quot;indexBounds&quot; : {
                    &quot;username&quot; : [
                        &quot;[\&quot;user101\&quot;, \&quot;user101\&quot;]&quot;
                    ]
                }
            }
        },
        &quot;rejectedPlans&quot; : [ ]
    },
    &quot;executionStats&quot; : {
        &quot;executionSuccess&quot; : true,
        &quot;nReturned&quot; : 1,
        &quot;executionTimeMillis&quot; : 0,
        &quot;totalKeysExamined&quot; : 1,
        &quot;totalDocsExamined&quot; : 1,
        &quot;executionStages&quot; : {
            &quot;stage&quot; : &quot;FETCH&quot;,
            &quot;nReturned&quot; : 1,
            &quot;executionTimeMillisEstimate&quot; : 0,
            &quot;works&quot; : 2,
            &quot;advanced&quot; : 1,
            &quot;needTime&quot; : 0,
            &quot;needYield&quot; : 0,
            &quot;saveState&quot; : 0,
            &quot;restoreState&quot; : 0,
            &quot;isEOF&quot; : 1,
            &quot;docsExamined&quot; : 1,
            &quot;alreadyHasObj&quot; : 0,
            &quot;inputStage&quot; : {
                &quot;stage&quot; : &quot;IXSCAN&quot;,
                &quot;nReturned&quot; : 1,
                &quot;executionTimeMillisEstimate&quot; : 0,
                &quot;works&quot; : 2,
                &quot;advanced&quot; : 1,
                &quot;needTime&quot; : 0,
                &quot;needYield&quot; : 0,
                &quot;saveState&quot; : 0,
                &quot;restoreState&quot; : 0,
                &quot;isEOF&quot; : 1,
                &quot;keyPattern&quot; : {
                    &quot;username&quot; : 1
                },
                &quot;indexName&quot; : &quot;username_1&quot;,
                &quot;isMultiKey&quot; : false,
                &quot;multiKeyPaths&quot; : {
                    &quot;username&quot; : [ ]
                },
                &quot;isUnique&quot; : false,
                &quot;isSparse&quot; : false,
                &quot;isPartial&quot; : false,
                &quot;indexVersion&quot; : 2,
                &quot;direction&quot; : &quot;forward&quot;,
                &quot;indexBounds&quot; : {
                    &quot;username&quot; : [
                        &quot;[\&quot;user101\&quot;, \&quot;user101\&quot;]&quot;
                    ]
                },
                &quot;keysExamined&quot; : 1,
                &quot;seeks&quot; : 1,
                &quot;dupsTested&quot; : 0,
                &quot;dupsDropped&quot; : 0
            }
        }
    },
    &quot;serverInfo&quot; : {
        &quot;host&quot; : &quot;xuliang&quot;,
        &quot;port&quot; : 27017,
        &quot;version&quot; : &quot;4.2.11&quot;,
        &quot;gitVersion&quot; : &quot;ea38428f0c6742c7c2c7f677e73d79e17a2aab96&quot;
    },
    &quot;ok&quot; : 1
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å¤åˆç´¢å¼•-1" tabindex="-1"><a class="header-anchor" href="#å¤åˆç´¢å¼•-1" aria-hidden="true">#</a> å¤åˆç´¢å¼•</h3><p>åœ¨å»ºç«‹ä¸¤ä¸ªå•å€¼ç´¢å¼•æ‰§è¡ŒæŸ¥è¯¢</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>db.users.createIndex({&quot;username&quot;:1})
db.users.createIndex({&quot;age&quot;:1})
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>æŸ¥è¯¢è¯­å¥</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>db.users.find().sort({&quot;age&quot;:1, &quot;username&quot;:1}).explain(&quot;executionStats&quot;)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>è¿‡ç¨‹åˆ†æ</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;queryPlanner&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;plannerVersion&quot;</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token property">&quot;namespace&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;test.users&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;indexFilterSet&quot;</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token property">&quot;parsedQuery&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>

        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;winningPlan&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;stage&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;SORT&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;sortPattern&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">&quot;age&quot;</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
                <span class="token property">&quot;username&quot;</span> <span class="token operator">:</span> <span class="token number">1</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token property">&quot;inputStage&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">&quot;stage&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;SORT_KEY_GENERATOR&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;inputStage&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token property">&quot;stage&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;COLLSCAN&quot;</span><span class="token punctuation">,</span>
                    <span class="token property">&quot;direction&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;forward&quot;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;rejectedPlans&quot;</span> <span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;executionStats&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;executionSuccess&quot;</span> <span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">&quot;nReturned&quot;</span> <span class="token operator">:</span> <span class="token number">100000</span><span class="token punctuation">,</span>
        <span class="token property">&quot;executionTimeMillis&quot;</span> <span class="token operator">:</span> <span class="token number">437</span><span class="token punctuation">,</span>
        <span class="token comment">// æ²¡æœ‰ä½¿ç”¨ç´¢å¼•</span>
        <span class="token property">&quot;totalKeysExamined&quot;</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token property">&quot;totalDocsExamined&quot;</span> <span class="token operator">:</span> <span class="token number">100000</span><span class="token punctuation">,</span>
        <span class="token property">&quot;executionStages&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;stage&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;SORT&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;nReturned&quot;</span> <span class="token operator">:</span> <span class="token number">100000</span><span class="token punctuation">,</span>
            <span class="token property">&quot;executionTimeMillisEstimate&quot;</span> <span class="token operator">:</span> <span class="token number">197</span><span class="token punctuation">,</span>
            <span class="token property">&quot;works&quot;</span> <span class="token operator">:</span> <span class="token number">200004</span><span class="token punctuation">,</span>
            <span class="token property">&quot;advanced&quot;</span> <span class="token operator">:</span> <span class="token number">100000</span><span class="token punctuation">,</span>
            <span class="token property">&quot;needTime&quot;</span> <span class="token operator">:</span> <span class="token number">100003</span><span class="token punctuation">,</span>
            <span class="token property">&quot;needYield&quot;</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
            <span class="token property">&quot;saveState&quot;</span> <span class="token operator">:</span> <span class="token number">1563</span><span class="token punctuation">,</span>
            <span class="token property">&quot;restoreState&quot;</span> <span class="token operator">:</span> <span class="token number">1563</span><span class="token punctuation">,</span>
            <span class="token property">&quot;isEOF&quot;</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token property">&quot;sortPattern&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">&quot;age&quot;</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
                <span class="token property">&quot;username&quot;</span> <span class="token operator">:</span> <span class="token number">1</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token property">&quot;memUsage&quot;</span> <span class="token operator">:</span> <span class="token number">9488890</span><span class="token punctuation">,</span>
            <span class="token property">&quot;memLimit&quot;</span> <span class="token operator">:</span> <span class="token number">33554432</span><span class="token punctuation">,</span>
            <span class="token property">&quot;inputStage&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">&quot;stage&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;SORT_KEY_GENERATOR&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;nReturned&quot;</span> <span class="token operator">:</span> <span class="token number">100000</span><span class="token punctuation">,</span>
                <span class="token property">&quot;executionTimeMillisEstimate&quot;</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
                <span class="token property">&quot;works&quot;</span> <span class="token operator">:</span> <span class="token number">100003</span><span class="token punctuation">,</span>
                <span class="token property">&quot;advanced&quot;</span> <span class="token operator">:</span> <span class="token number">100000</span><span class="token punctuation">,</span>
                <span class="token property">&quot;needTime&quot;</span> <span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
                <span class="token property">&quot;needYield&quot;</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
                <span class="token property">&quot;saveState&quot;</span> <span class="token operator">:</span> <span class="token number">1563</span><span class="token punctuation">,</span>
                <span class="token property">&quot;restoreState&quot;</span> <span class="token operator">:</span> <span class="token number">1563</span><span class="token punctuation">,</span>
                <span class="token property">&quot;isEOF&quot;</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
                <span class="token property">&quot;inputStage&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token property">&quot;stage&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;COLLSCAN&quot;</span><span class="token punctuation">,</span>
                    <span class="token property">&quot;nReturned&quot;</span> <span class="token operator">:</span> <span class="token number">100000</span><span class="token punctuation">,</span>
                    <span class="token property">&quot;executionTimeMillisEstimate&quot;</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
                    <span class="token property">&quot;works&quot;</span> <span class="token operator">:</span> <span class="token number">100002</span><span class="token punctuation">,</span>
                    <span class="token property">&quot;advanced&quot;</span> <span class="token operator">:</span> <span class="token number">100000</span><span class="token punctuation">,</span>
                    <span class="token property">&quot;needTime&quot;</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
                    <span class="token property">&quot;needYield&quot;</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
                    <span class="token property">&quot;saveState&quot;</span> <span class="token operator">:</span> <span class="token number">1563</span><span class="token punctuation">,</span>
                    <span class="token property">&quot;restoreState&quot;</span> <span class="token operator">:</span> <span class="token number">1563</span><span class="token punctuation">,</span>
                    <span class="token property">&quot;isEOF&quot;</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
                    <span class="token property">&quot;direction&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;forward&quot;</span><span class="token punctuation">,</span>
                    <span class="token property">&quot;docsExamined&quot;</span> <span class="token operator">:</span> <span class="token number">100000</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;serverInfo&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;host&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;xuliang&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;port&quot;</span> <span class="token operator">:</span> <span class="token number">27017</span><span class="token punctuation">,</span>
        <span class="token property">&quot;version&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;4.2.11&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;gitVersion&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;ea38428f0c6742c7c2c7f677e73d79e17a2aab96&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;ok&quot;</span> <span class="token operator">:</span> <span class="token number">1</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å»ºç«‹å¤åˆç´¢å¼•</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>db.users.createIndex({&quot;username&quot;:1,&quot;sort&quot;:1})
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>æŸ¥è¯¢è¯­å¥</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>db.users.find({},{&quot;username&quot;:1,&quot;age&quot;:1}).sort({&quot;username&quot;:1,&quot;age&quot;:1}).limit(100)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>è¿‡ç¨‹åˆ†æ</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="æ€§èƒ½åˆ†æ" tabindex="-1"><a class="header-anchor" href="#æ€§èƒ½åˆ†æ" aria-hidden="true">#</a> æ€§èƒ½åˆ†æ</h2><h3 id="å‡½æ•°" tabindex="-1"><a class="header-anchor" href="#å‡½æ•°" aria-hidden="true">#</a> å‡½æ•°</h3><h4 id="explain-å‡½æ•°" tabindex="-1"><a class="header-anchor" href="#explain-å‡½æ•°" aria-hidden="true">#</a> explain()å‡½æ•°</h4><p>explain()å‡½æ•°å¯ä»¥å°±æ”¶ä¸åŒçš„å‚æ•°ï¼š</p><ul><li>queryPlannerï¼šqueryPlanneræ˜¯é»˜è®¤å‚æ•°ï¼›</li><li>executionStatsï¼šä¼šè¿”å›æ‰§è¡Œè®¡åˆ’çš„ä¸€äº›ç»Ÿè®¡ä¿¡æ¯</li><li>allPlansExecutionï¼šç”¨æ¥è·å–æ‰€æœ‰çš„æ‰§è¡Œè®¡åˆ’ï¼Œç»“æœå‚æ•°åŸºæœ¬ç›¸åŒ</li></ul><p>åœ¨æŸ¥è¯¢çš„å‡½æ•°åç›´æ¥è¿½åŠ explain()å‡½æ•°</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>// queryPlanneræ˜¯é»˜è®¤å‚æ•°
db.users.find({&quot;username&quot;:&quot;user1000&quot;}).explain()
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>æŸ¥è¯¢ç»“æœ</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token comment">// æ²¡æœ‰å»ºç«‹ç´¢å¼•çš„æŸ¥è¯¢åˆ†æ</span>
<span class="token punctuation">{</span>
    <span class="token comment">// queryPlanner:æŸ¥è¯¢è®¡åˆ’</span>
    <span class="token property">&quot;queryPlanner&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// æŸ¥è¯¢è®¡åˆ’ç‰ˆæœ¬</span>
        <span class="token property">&quot;plannerVersion&quot;</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token comment">// è¦æŸ¥è¯¢çš„é›†åˆ</span>
        <span class="token property">&quot;namespace&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;test.users&quot;</span><span class="token punctuation">,</span>
        <span class="token comment">// é’ˆå¯¹è¯¥queryæ˜¯å¦æœ‰indexfilter</span>
        <span class="token property">&quot;indexFilterSet&quot;</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token comment">// æŸ¥è¯¢æ¡ä»¶</span>
        <span class="token property">&quot;parsedQuery&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;username&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">&quot;$eq&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;user101&quot;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;queryHash&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;379E82C5&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;planCacheKey&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;379E82C5&quot;</span><span class="token punctuation">,</span>
        <span class="token comment">// æœ€ä½³æ‰§è¡Œè®¡åˆ’</span>
        <span class="token property">&quot;winningPlan&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token comment">// æŸ¥è¯¢æ–¹å¼ï¼šCOLLSCANï¼šå…¨è¡¨æ‰«æï¼ŒIXSCANï¼šç´¢å¼•æ‰«æï¼Œ</span>
            <span class="token property">&quot;stage&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;COLLSCAN&quot;</span><span class="token punctuation">,</span>
            <span class="token comment">// è¿‡æ»¤æ¡ä»¶</span>
            <span class="token property">&quot;filter&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">&quot;username&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token property">&quot;$eq&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;user101&quot;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token comment">// æ ‡è¯†queryçš„æŸ¥è¯¢é¡ºåº</span>
            <span class="token property">&quot;direction&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;forward&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token comment">// æ‹’ç»çš„æ‰§è¡Œè®¡åˆ’</span>
        <span class="token property">&quot;rejectedPlans&quot;</span> <span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// å±•ç¤ºæœåŠ¡çš„åŸºæœ¬ä¿¡æ¯</span>
    <span class="token property">&quot;serverInfo&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;host&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;xuliang&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;port&quot;</span> <span class="token operator">:</span> <span class="token number">27017</span><span class="token punctuation">,</span>
        <span class="token property">&quot;version&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;4.2.11&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;gitVersion&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;ea38428f0c6742c7c2c7f677e73d79e17a2aab96&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;ok&quot;</span> <span class="token operator">:</span> <span class="token number">1</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>stageç±»å‹åˆ—ä¸¾</p><ul><li><p>COLLSCANï¼šå…¨è¡¨æ‰«æ</p></li><li><p>IXSCANï¼šç´¢å¼•æ‰«æ</p></li><li><p>FETCHï¼šæ ¹æ®ç´¢å¼•æ£€ç´¢æŒ‡å®šdocument</p></li><li><p>SHARD_MERGEï¼šå°†å„ä¸ªåˆ†ç‰‡è¿”å›æ•°æ®è¿›è¡Œmerge</p></li><li><p>SORTï¼šè¡¨æ˜åœ¨å†…å­˜ä¸­è¿›è¡Œäº†æ’åº</p></li><li><p>LIMITï¼šä½¿ç”¨limité™åˆ¶è¿”å›æ•°</p></li><li><p>SKIPï¼šä½¿ç”¨skipè¿›è¡Œè·³è¿‡</p></li><li><p>IDKACHï¼šé’ˆå¯¹_idè¿›è¡ŒæŸ¥è¯¢</p></li><li><p>SHARDING_FILTERï¼šé€šè¿‡mongoså¯¹åˆ†ç‰‡æ•°æ®è¿›è¡ŒæŸ¥è¯¢</p></li><li><p>COUNTï¼šåˆ©ç”¨db.coll.explain().count()ä¹‹ç±»è¿›è¡Œcountè¿ç®—</p></li><li><p>COUNTSCANï¼šcountä¸ä½¿ç”¨Indexè¿›è¡Œcountæ—¶çš„stageè¿”å›</p></li><li><p>COUNT_SCANï¼šcountä½¿ç”¨äº†Indexè¿›è¡Œcountæ—¶çš„stageè¿”å›</p></li><li><p>SUBPLAï¼šæœªä½¿ç”¨åˆ°ç´¢å¼•çš„$oræŸ¥è¯¢çš„stageè¿”å›</p></li><li><p>TEXTï¼šä½¿ç”¨å…¨æ–‡ç´¢å¼•è¿›è¡ŒæŸ¥è¯¢æ—¶å€™çš„stageè¿”å›</p></li><li><p>PROJECTIONï¼šé™å®šè¿”å›å­—æ®µæ—¶å€™stageçš„è¿”å›</p></li></ul><p>ä½¿ç”¨executionStatså‚æ•°</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>db.users.find({&quot;username&quot;:&quot;user1000&quot;}).explain(&quot;executionStats&quot;)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>è¿”å›å‚æ•°ï¼š</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;queryPlanner&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;plannerVersion&quot;</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token property">&quot;namespace&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;test.users&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;indexFilterSet&quot;</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token property">&quot;parsedQuery&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;username&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">&quot;$eq&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;user101&quot;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;winningPlan&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;stage&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;COLLSCAN&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;filter&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">&quot;username&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token property">&quot;$eq&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;user101&quot;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token property">&quot;direction&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;forward&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;rejectedPlans&quot;</span> <span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// ç»Ÿè®¡ä¿¡æ¯</span>
    <span class="token property">&quot;executionStats&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// æ˜¯å¦æ‰§è¡ŒæˆåŠŸ</span>
        <span class="token property">&quot;executionSuccess&quot;</span> <span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token comment">// queryè¿”å›çš„ç»“æœæ•°</span>
        <span class="token property">&quot;nReturned&quot;</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token comment">// queryæ‰§è¡Œè€—æ—¶</span>
        <span class="token property">&quot;executionTimeMillis&quot;</span> <span class="token operator">:</span> <span class="token number">67</span><span class="token punctuation">,</span>
        <span class="token comment">// ç´¢å¼•æ‰«ææ¬¡æ•°</span>
        <span class="token property">&quot;totalKeysExamined&quot;</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token comment">// æ€»çš„æ–‡æ¡£æ‰«ææ¡ç›®</span>
        <span class="token property">&quot;totalDocsExamined&quot;</span> <span class="token operator">:</span> <span class="token number">100000</span><span class="token punctuation">,</span>
        <span class="token comment">// æ‰§è¡Œè®¡åˆ’</span>
        <span class="token property">&quot;executionStages&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token comment">// æ‰«ææ–¹å¼ï¼šå…¨è¡¨æ‰«æ</span>
            <span class="token property">&quot;stage&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;COLLSCAN&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;filter&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">&quot;username&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token property">&quot;$eq&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;user101&quot;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token property">&quot;nReturned&quot;</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token comment">// æ ¹æ®ç´¢å¼•æŸ¥è¯¢æ•°æ®æ‰€ç”¨çš„æ—¶é—´ï¼ˆå½“å‰æ²¡æœ‰ç´¢å¼•ï¼‰</span>
            <span class="token property">&quot;executionTimeMillisEstimate&quot;</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
            <span class="token comment">// å·¥ä½œå•å…ƒæ•°</span>
            <span class="token property">&quot;works&quot;</span> <span class="token operator">:</span> <span class="token number">100002</span><span class="token punctuation">,</span>
            <span class="token comment">// ä¼˜å…ˆè¿”å›çš„ç»“æœæ•°ç›®</span>
            <span class="token property">&quot;advanced&quot;</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token property">&quot;needTime&quot;</span> <span class="token operator">:</span> <span class="token number">100000</span><span class="token punctuation">,</span>
            <span class="token property">&quot;needYield&quot;</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
            <span class="token property">&quot;saveState&quot;</span> <span class="token operator">:</span> <span class="token number">781</span><span class="token punctuation">,</span>
            <span class="token property">&quot;restoreState&quot;</span> <span class="token operator">:</span> <span class="token number">781</span><span class="token punctuation">,</span>
            <span class="token property">&quot;isEOF&quot;</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token comment">// æ‰§è¡Œæ–¹å‘</span>
            <span class="token property">&quot;direction&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;forward&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;docsExamined&quot;</span> <span class="token operator">:</span> <span class="token number">100000</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;serverInfo&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;host&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;xuliang&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;port&quot;</span> <span class="token operator">:</span> <span class="token number">27017</span><span class="token punctuation">,</span>
        <span class="token property">&quot;version&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;4.2.11&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;gitVersion&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;ea38428f0c6742c7c2c7f677e73d79e17a2aab96&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;ok&quot;</span> <span class="token operator">:</span> <span class="token number">1</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åˆ›å»ºç´¢å¼•å</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token comment">// ä½¿ç”¨exectionStatså‚æ•°</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="mongodb-äº‹åŠ¡" tabindex="-1"><a class="header-anchor" href="#mongodb-äº‹åŠ¡" aria-hidden="true">#</a> MongoDB äº‹åŠ¡</h2><h3 id="å•æ–‡æ¡£äº‹ç‰©" tabindex="-1"><a class="header-anchor" href="#å•æ–‡æ¡£äº‹ç‰©" aria-hidden="true">#</a> å•æ–‡æ¡£äº‹ç‰©</h3><p><strong>åœ¨MongoDBä¸­æ‰€æœ‰å¯¹å•æ–‡æ¡£çš„æ“ä½œéƒ½æ˜¯åŸå­æ€§çš„ã€‚</strong>ï¼Œåœ¨å®é™…çš„ä½¿ç”¨ä¸­ï¼Œå¯ä»¥é€šè¿‡åˆç†çš„è®¾è®¡åµŒå…¥å¼æ–‡æ¡£æ¥åˆ©ç”¨è¿™ä¸€ç‰¹æ€§ã€‚</p><h3 id="å¤šæ–‡æ¡£äº‹ç‰©" tabindex="-1"><a class="header-anchor" href="#å¤šæ–‡æ¡£äº‹ç‰©" aria-hidden="true">#</a> å¤šæ–‡æ¡£äº‹ç‰©</h3><p>ä»4.0ç‰ˆæœ¬å¼€å§‹æ”¯æŒå‰¯æœ¬é›†ä¸Šçš„å¤šæ–‡æ¡£äº‹åŠ¡</p><p>ä»4.2ç‰ˆæœ¬å¼€å§‹æ”¯æŒåˆ†å¸ƒå¼äº‹åŠ¡ï¼ˆæ”¯æŒåˆ†ç‰‡é›†ç¾¤ä¸Šçš„å¤šæ–‡æ¡£äº‹åŠ¡ï¼Œå¹¶é›†æˆäº†å‰¯æœ¬é›†çš„å¤šæ–‡æ¡£äº‹åŠ¡ï¼‰</p><p>ç‰ˆæœ¬æ—¶é—´çº¿ï¼š</p><p>4.4ç‰ˆæœ¬ï¼š2020.9</p><p>4.2ç‰ˆæœ¬ï¼š2019.10</p><p>4.0ç‰ˆæœ¬ï¼š2018.8</p><p>https://docs.mongodb.com/master/release-notes/4.4/</p><p>WiredTigeräº‹åŠ¡å®ç°è§£æ</p><p>https://blog.csdn.net/daaikuaichuan/article/details/97893552</p><h4 id="ä½¿ç”¨ä¸­çš„æ³¨æ„ç‚¹" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨ä¸­çš„æ³¨æ„ç‚¹" aria-hidden="true">#</a> ä½¿ç”¨ä¸­çš„æ³¨æ„ç‚¹</h4><p>è¿™é‡Œåªåˆ—å‡ºäº†éƒ¨åˆ†</p><ul><li>åœ¨ç°æœ‰é›†åˆä¸ŠæŒ‡å®šè¯»/å†™(CRUD)æ“ä½œã€‚é›†åˆå¯ä»¥åœ¨ä¸åŒçš„æ•°æ®åº“ä¸­ã€‚</li><li>ä¸èƒ½å†™cappedé›†åˆï¼ˆå›ºå®šé›†åˆï¼‰</li><li>æ— æ³•åœ¨<code>config</code>ï¼Œ<code>admin</code>æˆ–<code>local</code>æ•°æ®åº“ä¸­è¯»å–/å†™å…¥é›†åˆ</li><li>æ— æ³•å†™å…¥<code>system.*</code>é›†åˆã€‚ï¼ˆsystem.*é›†åˆä¸»è¦å­˜åœ¨ä¸configã€adminã€localé›†åˆä¸­ï¼‰</li><li>åœ¨äº‹åŠ¡ä¸­å¯ä»¥åˆ›å»ºé›†åˆå’Œç´¢å¼•ï¼ˆåœ¨4.4ç‰ˆæœ¬ä¸­å¼€å§‹æ”¯æŒï¼Œä¹‹å‰ç‰ˆæœ¬ä¸å¯ç”¨ï¼‰</li><li>åœ¨äº‹åŠ¡ä¸­åˆ›å»ºçš„æ¸¸æ ‡ï¼Œæ— æ³•åœ¨äº‹åŠ¡ä¹‹å¤–ä½¿ç”¨</li><li>åœ¨äº‹åŠ¡ä¹‹å¤–åˆ›å»ºçš„æ¸¸æ ‡ï¼Œæ— æ³•åœ¨äº‹åŠ¡ä¸­ä½¿ç”¨</li></ul><h4 id="å®˜ç½‘ç»™å‡ºçš„ä¸€ä¸ªä¾‹å­" tabindex="-1"><a class="header-anchor" href="#å®˜ç½‘ç»™å‡ºçš„ä¸€ä¸ªä¾‹å­" aria-hidden="true">#</a> å®˜ç½‘ç»™å‡ºçš„ä¸€ä¸ªä¾‹å­</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">final</span> <span class="token class-name">MongoClient</span> client <span class="token operator">=</span> <span class="token class-name">MongoClients</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>uri<span class="token punctuation">)</span><span class="token punctuation">;</span>

client<span class="token punctuation">.</span><span class="token function">getDatabase</span><span class="token punctuation">(</span><span class="token string">&quot;mydb1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getCollection</span><span class="token punctuation">(</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">withWriteConcern</span><span class="token punctuation">(</span><span class="token class-name">WriteConcern</span><span class="token punctuation">.</span><span class="token constant">MAJORITY</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">insertOne</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Document</span><span class="token punctuation">(</span><span class="token string">&quot;abc&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
client<span class="token punctuation">.</span><span class="token function">getDatabase</span><span class="token punctuation">(</span><span class="token string">&quot;mydb2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getCollection</span><span class="token punctuation">(</span><span class="token string">&quot;bar&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">withWriteConcern</span><span class="token punctuation">(</span><span class="token class-name">WriteConcern</span><span class="token punctuation">.</span><span class="token constant">MAJORITY</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">insertOne</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Document</span><span class="token punctuation">(</span><span class="token string">&quot;xyz&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/* Step 1: Start a client session. */</span>

<span class="token keyword">final</span> <span class="token class-name">ClientSession</span> clientSession <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">startSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/* Step 2: Optional. Define options to use for the transaction. */</span>

<span class="token class-name">TransactionOptions</span> txnOptions <span class="token operator">=</span> <span class="token class-name">TransactionOptions</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">readPreference</span><span class="token punctuation">(</span><span class="token class-name">ReadPreference</span><span class="token punctuation">.</span><span class="token function">primary</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">readConcern</span><span class="token punctuation">(</span><span class="token class-name">ReadConcern</span><span class="token punctuation">.</span><span class="token constant">LOCAL</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">writeConcern</span><span class="token punctuation">(</span><span class="token class-name">WriteConcern</span><span class="token punctuation">.</span><span class="token constant">MAJORITY</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/* Step 3: Define the sequence of operations to perform inside the transactions. */</span>

<span class="token class-name">TransactionBody</span> txnBody <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TransactionBody</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">MongoCollection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Document</span><span class="token punctuation">&gt;</span></span> coll1 <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">getDatabase</span><span class="token punctuation">(</span><span class="token string">&quot;mydb1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getCollection</span><span class="token punctuation">(</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">MongoCollection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Document</span><span class="token punctuation">&gt;</span></span> coll2 <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">getDatabase</span><span class="token punctuation">(</span><span class="token string">&quot;mydb2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getCollection</span><span class="token punctuation">(</span><span class="token string">&quot;bar&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">/*
           Important:: You must pass the session to the operations.
         */</span>
        coll1<span class="token punctuation">.</span><span class="token function">insertOne</span><span class="token punctuation">(</span>clientSession<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Document</span><span class="token punctuation">(</span><span class="token string">&quot;abc&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        coll2<span class="token punctuation">.</span><span class="token function">insertOne</span><span class="token punctuation">(</span>clientSession<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Document</span><span class="token punctuation">(</span><span class="token string">&quot;xyz&quot;</span><span class="token punctuation">,</span> <span class="token number">999</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">&quot;Inserted into collections in different databases&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token comment">/*
       Step 4: Use .withTransaction() to start a transaction,
       execute the callback, and commit (or abort on error).
    */</span>

    clientSession<span class="token punctuation">.</span><span class="token function">withTransaction</span><span class="token punctuation">(</span>txnBody<span class="token punctuation">,</span> txnOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">RuntimeException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// some error handling</span>
<span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
    clientSession<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="è¯»åå¥½-read-preference" tabindex="-1"><a class="header-anchor" href="#è¯»åå¥½-read-preference" aria-hidden="true">#</a> è¯»åå¥½ï¼ˆRead Preferenceï¼‰</h4><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œclientæ—¶ä»å‰¯æœ¬é›†ä¸­çš„Primaryæ¥è¯»å–æ•°æ®</p><p>å¯ä»¥é€šè¿‡è®¾ç½®è¯»åå¥½ï¼ˆRead Preferenceï¼‰ä¸»è¦ç”¨æ¥æ§åˆ¶clientä»Primaryè¯»å–æ•°æ®ï¼Œè¿˜æ˜¯ä»Secondaryè¯»å–æ•°æ®</p><table><thead><tr><th>æ¨¡å¼</th><th>æè¿°</th></tr></thead><tbody><tr><td>primary</td><td>é»˜è®¤æ¨¡å¼ï¼Œæ‰€æœ‰çš„è¯»å–æ“ä½œéƒ½ä»å‰¯æœ¬é›†ä¸­çš„primaryè¯»å–<br>åœ¨å¤šæ–‡æ¡£äº‹åŠ¡ä¸­çš„è¯»æ“ä½œï¼Œéƒ½åå¥½å¿…é¡»è®¾ç½®ä¸ºprimaryï¼Œåœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œæ‰€æœ‰çš„æ“ä½œå¿…é¡»è·¯ç”±åˆ°ä¸€ä¸ªæˆå‘˜ä¸Š</td></tr><tr><td>primaryPreferred</td><td>é»˜è®¤åœ¨primaryä¸Šè¯»å–ï¼Œå¦‚æœprimaryä¸å¯ç”¨ï¼Œåˆ™ä»secondaryè¯»å–</td></tr><tr><td>secondary</td><td>ä»secondaryä¸Šè¯»å–æ•°æ®</td></tr><tr><td>secondaryPreferred</td><td>é»˜è®¤åœ¨secondaryä¸Šè¯»å–æ•°æ®ï¼Œå¦‚æœsecondaryä¸å¯ç”¨ï¼Œä»primaryä¸Šè¯»å–æ•°æ®</td></tr><tr><td>nearest</td><td>ä»è·ç¦»æœ€è¿‘çš„èŠ‚ç‚¹è¯»å–æ•°æ®ï¼ˆå¤šä¸ªå¤åˆï¼Œéšæœºé€‰å–ï¼‰</td></tr></tbody></table><h4 id="è¯»å…³æ³¨-read-concern" tabindex="-1"><a class="header-anchor" href="#è¯»å…³æ³¨-read-concern" aria-hidden="true">#</a> è¯»å…³æ³¨ï¼ˆRead Concernï¼‰</h4><p>è¯»å…³æ³¨æ˜¯ç”¨æ¥æ§åˆ¶ä»å‰¯æœ¬é›†å’Œåˆ†ç‰‡ä¸­è¯»å–æ•°æ®çš„ä¸€è‡´æ€§å’Œéš”ç¦»æ€§</p><p>åœ¨äº‹åŠ¡ä¸­ä½¿ç”¨äº‹åŠ¡çº§åˆ«çš„è¯»å…³æ³¨ï¼Œä¼šå¿½ç•¥åœ¨é›†åˆæˆ–æ•°æ®åº“çº§åˆ«è®¾ç½®çš„è¯»å…³æ³¨</p><p>åœ¨äº‹åŠ¡ä¸­æ”¯æŒå¦‚ä¸‹çš„è¯»å–å…³æ³¨ï¼š</p><table><thead><tr><th>level</th><th>æè¿°</th></tr></thead><tbody><tr><td>local</td><td>ä»localèŠ‚ç‚¹è·å–æœ€æ–°çš„æ•°æ®è¿”å›ï¼Œä½†æ˜¯æ•°æ®å¯èƒ½ä¼šå›æ»š</td></tr><tr><td>majority</td><td>ä¼šè¿”å›è¢«é›†ç¾¤ä¸­å¤šæ•°èŠ‚ç‚¹æ‰¿è®¤çš„æ•°æ®ï¼ˆæ•°æ®ä¸ä¼šå›æ»šï¼‰ï¼Œå‰ææ˜¯äº‹åŠ¡æäº¤æ—¶ä½¿ç”¨å†™å…³æ³¨majority</td></tr><tr><td>snapshot</td><td>ä»å¤§å¤šæ•°å·²æäº¤æ•°æ®çš„å¿«ç…§ä¸­è¿”å›æ•°æ®ï¼Œå‰ææ˜¯äº‹åŠ¡æäº¤æ—¶ä½¿ç”¨å†™å…³æ³¨majority</td></tr></tbody></table><h4 id="å†™å…³æ³¨-write-concern" tabindex="-1"><a class="header-anchor" href="#å†™å…³æ³¨-write-concern" aria-hidden="true">#</a> å†™å…³æ³¨ï¼ˆWrite Concernï¼‰</h4><p>å†™å…³æ³¨æ˜¯ç”¨æ¥æ§åˆ¶å¯¹å‰¯æœ¬é›†æˆ–åˆ†ç‰‡å†™æ“ä½œçš„ç¡®è®¤çº§åˆ«</p><p>åœ¨äº‹åŠ¡ä¸­æ”¯æŒçš„valueï¼š</p><table><thead><tr><th>value</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>w: 1</td><td>æäº¤åœ¨primaryèŠ‚ç‚¹æ‰§è¡Œå®Œæˆåç«‹å³è¿”å›</td></tr><tr><td>w: &quot;majority&quot;</td><td>æäº¤åœ¨é›†ç¾¤ä¸­çš„å¤šæ•°èŠ‚ç‚¹ä¿å­˜åè¿”å›</td></tr></tbody></table><h2 id="mongodb-replication-å¤åˆ¶" tabindex="-1"><a class="header-anchor" href="#mongodb-replication-å¤åˆ¶" aria-hidden="true">#</a> MongoDB Replicationï¼ˆå¤åˆ¶ï¼‰</h2><h3 id="ç®€å•ä»‹ç»" tabindex="-1"><a class="header-anchor" href="#ç®€å•ä»‹ç»" aria-hidden="true">#</a> ç®€å•ä»‹ç»</h3><p>MongoDBå‰¯æœ¬é›†æœ‰Primaryã€Secondaryã€Arbiterä¸‰ç§è§’è‰²</p><ul><li><p>Primaryæ˜¯ä¸»èŠ‚ç‚¹ï¼Œæ¥å—æ‰€æœ‰çš„å†™æ“ä½œ</p></li><li><p>Secondaryæ˜¯ä»èŠ‚ç‚¹ï¼Œé€šè¿‡å¤åˆ¶ä¸»èŠ‚ç‚¹çš„æ“ä½œæ¥ç»´æŠ¤ä¸€ä¸ªç›¸åŒçš„æ•°æ®é›†</p></li><li><p>Arbiteræ˜¯ä»²è£èŠ‚ç‚¹ï¼Œä»²è£èŠ‚ç‚¹å‚ä¸é€‰ä¸¾ä½†ä¸æŒæœ‰æ•°æ®ã€‚</p></li></ul><p>MongoDBå‰¯æœ¬é›†æ¶æ„å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="/assets/1-10f0c988.jpg" alt="1"></p><h3 id="ç®€å•é…ç½®" tabindex="-1"><a class="header-anchor" href="#ç®€å•é…ç½®" aria-hidden="true">#</a> ç®€å•é…ç½®</h3><p>å¯åŠ¨ä¸‰ä¸ªæœåŠ¡(è¿™é‡Œä½¿ç”¨æŒ‡å®šé…ç½®æ–‡ä»¶çš„æ–¹å¼)</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>mongod.exe -f conf/mongo.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>mongo.conf</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">net</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">27017</span>
<span class="token key atrule">storage</span><span class="token punctuation">:</span>
  <span class="token key atrule">dbPath</span><span class="token punctuation">:</span> D<span class="token punctuation">:</span>\developer\env\mongodb<span class="token punctuation">-</span>4.2.11\data\db
<span class="token key atrule">replication</span><span class="token punctuation">:</span>
  <span class="token comment"># æŒ‡å®šå¤åˆ¶é›†çš„åç§°ï¼ˆåŒä¸€ä¸ªå‰¯æœ¬é›†ï¼Œå¿…é¡»æœ‰ç›¸åŒçš„åç§°ï¼‰</span>
  <span class="token key atrule">replSetName</span><span class="token punctuation">:</span> rs0
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>mongod.exe -f conf/slave01.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>slave01.conf</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>net:
  port: 27018
storage:
  dbPath: D:\developer\env\mongodb-4.2.11\data\slave01
replication:
  replSetName: rs0
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>mongod.exe -f conf/slave02.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>slave02.conf</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>net:
  port: 27019
storage:
  dbPath: D:\developer\env\mongodb-4.2.11\data\slave02
replication:
  replSetName: rs0
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åˆå§‹åŒ–å‰¯æœ¬é›†</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>// åˆå§‹åŒ–å®Œæˆä¹‹åï¼Œå½“å‰èŠ‚ç‚¹å°±ä¼šå˜æˆä¸»èŠ‚ç‚¹ï¼Œå¯ä»¥é€šè¿‡ db.isMaster() æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€
rs.initiate()
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>æ·»åŠ ä»èŠ‚ç‚¹</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>rs.add(&quot;localhost:27018&quot;)
rs.add(&quot;localhost:27019&quot;)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="mongodb-oplog" tabindex="-1"><a class="header-anchor" href="#mongodb-oplog" aria-hidden="true">#</a> MongoDB Oplog</h3><p>MongoDB Oplogæ˜¯MongoDB Primaryå’ŒSecondaryåœ¨å¤åˆ¶å»ºç«‹æœŸé—´å’Œå»ºç«‹å®Œæˆä¹‹åçš„å¤åˆ¶ä»‹è´¨ï¼Œå°±æ˜¯Primaryä¸­æ‰€æœ‰çš„å†™å…¥æ“ä½œéƒ½ä¼šè®°å½•åˆ°MongoDB Oplogä¸­ï¼Œç„¶åä»åº“ä¼šæ¥ä¸»åº“ä¸€ç›´æ‹‰å–Oplogå¹¶åº”ç”¨åˆ°è‡ªå·±çš„æ•°æ®åº“ä¸­ã€‚è¿™é‡Œçš„Oplogæ˜¯MongoDB localæ•°æ®åº“çš„ä¸€ä¸ªé›†åˆï¼Œå®ƒæ˜¯Capped collectionï¼Œé€šä¿—æ„æ€å°±æ˜¯å®ƒæ˜¯å›ºå®šå¤§å°ï¼Œå¾ªç¯ä½¿ç”¨çš„ã€‚å¦‚ä¸‹å›¾ï¼š</p><p><img src="/assets/2-2cd94cea.jpg" alt="2"></p><p>MongoDB Oplogä¸­çš„å†…å®¹åŠå­—æ®µä»‹ç»ï¼š</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
<span class="token property">&quot;ts&quot;</span> <span class="token operator">:</span> Timestamp(<span class="token number">1446011584</span><span class="token punctuation">,</span> <span class="token number">2</span>)<span class="token punctuation">,</span>
<span class="token property">&quot;h&quot;</span> <span class="token operator">:</span> NumberLong(<span class="token string">&quot;1687359108795812092&quot;</span>)<span class="token punctuation">,</span>
<span class="token property">&quot;v&quot;</span> <span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
<span class="token property">&quot;op&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;i&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;ns&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;test.nosql&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;o&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">&quot;_id&quot;</span> <span class="token operator">:</span> ObjectId(<span class="token string">&quot;563062c0b085733f34ab4129&quot;</span>)<span class="token punctuation">,</span> <span class="token property">&quot;name&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;mongodb&quot;</span><span class="token punctuation">,</span> <span class="token property">&quot;score&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;100&quot;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

tsï¼š æ“ä½œæ—¶é—´ï¼Œå½“å‰timestamp + è®¡æ•°å™¨ï¼Œè®¡æ•°å™¨æ¯ç§’éƒ½è¢«é‡ç½®
hï¼šæ“ä½œçš„å…¨å±€å”¯ä¸€æ ‡è¯†
vï¼šoplogç‰ˆæœ¬ä¿¡æ¯
opï¼šæ“ä½œç±»å‹
    iï¼šæ’å…¥æ“ä½œ
    uï¼šæ›´æ–°æ“ä½œ
    dï¼šåˆ é™¤æ“ä½œ
    cï¼šæ‰§è¡Œå‘½ä»¤ï¼ˆå¦‚createDatabaseï¼ŒdropDatabaseï¼‰
nï¼šç©ºæ“ä½œï¼Œç‰¹æ®Šç”¨é€”
nsï¼šæ“ä½œé’ˆå¯¹çš„é›†åˆ
oï¼šæ“ä½œå†…å®¹ï¼Œå¦‚æœæ˜¯æ›´æ–°æ“ä½œ
o2ï¼šæ“ä½œæŸ¥è¯¢æ¡ä»¶ï¼Œä»…updateæ“ä½œåŒ…å«è¯¥å­—æ®µ
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å‰¯æœ¬é›†çš„é«˜å¯ç”¨" tabindex="-1"><a class="header-anchor" href="#å‰¯æœ¬é›†çš„é«˜å¯ç”¨" aria-hidden="true">#</a> å‰¯æœ¬é›†çš„é«˜å¯ç”¨</h3><p>å½“å‰¯æœ¬é›†ä¸­çš„ä¸»èŠ‚ç‚¹å‡ºç°ä¸€äº›çªå‘æƒ…å†µæ—¶ï¼Œä¼šæ‰§è¡Œä¸»ä»åˆ‡æ¢é€»è¾‘ï¼Œæ¥ä¿è¯é›†ç¾¤çš„é«˜å¯ç”¨ã€‚</p><h4 id="è§¦å‘åœºæ™¯" tabindex="-1"><a class="header-anchor" href="#è§¦å‘åœºæ™¯" aria-hidden="true">#</a> è§¦å‘åœºæ™¯</h4><p>1ã€ æ–°åˆå§‹åŒ–ä¸€å¥—å‰¯æœ¬é›†</p><p>2ã€ ä»åº“ä¸èƒ½è¿æ¥åˆ°ä¸»åº“ï¼ˆé»˜è®¤è¶…è¿‡10sï¼Œå¯é€šè¿‡heartbeatTimeoutSecså‚æ•°æ§åˆ¶ï¼‰ï¼Œä»åº“å‘èµ·é€‰ä¸¾</p><p>3ã€ ä¸»åº“ä¸»åŠ¨æ”¾å¼ƒprimary è§’è‰²</p><p>4ã€ ç§»é™¤ä»åº“çš„æ—¶å€™</p><h4 id="åˆ‡æ¢é€»è¾‘" tabindex="-1"><a class="header-anchor" href="#åˆ‡æ¢é€»è¾‘" aria-hidden="true">#</a> åˆ‡æ¢é€»è¾‘</h4><p>1ã€ä»åº“æ— æ³•è¿æ¥åˆ°ä¸»åº“ï¼Œæˆ–è€…ä¸»åº“æ”¾å¼ƒPrimaryè§’è‰²ã€‚</p><p>2ã€ä»åº“ä¼šæ ¹æ®å¿ƒè·³æ¶ˆæ¯è·å–å½“å‰è¯¥èŠ‚ç‚¹çš„è§’è‰²å¹¶ä¸ä¹‹å‰è¿›è¡Œå¯¹æ¯”</p><p>3ã€å¦‚æœè§’è‰²å‘ç”Ÿæ”¹å˜å°±å¼€å§‹æ‰§è¡ŒmsgCheckNewStateæ–¹æ³•</p><p>4ã€åœ¨msgCheckNewState æ–¹æ³•ä¸­æœ€ç»ˆè°ƒç”¨electSelf æ–¹æ³•ï¼ˆä¼šæœ‰ä¸€äº›åˆ¤æ–­æ¥å†³å®šæ˜¯å¦æœ€ç»ˆè°ƒç”¨electSelfæ–¹æ³•ï¼‰</p><p>5ã€electSelf æ–¹æ³•æœ€ç»ˆå‘å‰¯æœ¬é›†å…¶ä»–èŠ‚ç‚¹å‘é€replSetElectå‘½ä»¤æ¥è¯·æ±‚æŠ•ç¥¨ã€‚</p><p>6ã€å…¶ä»–å‰¯æœ¬é›†æ”¶åˆ°replSetElectä¼šå¯¹æ¯”cfgverä¿¡æ¯ï¼Œä¼šç¡®è®¤å‘é€è¯¥å‘½ä»¤çš„èŠ‚ç‚¹æ˜¯å¦åœ¨å‰¯æœ¬é›†ä¸­ï¼Œç¡®è®¤è¯¥èŠ‚ç‚¹çš„ä¼˜å…ˆçº§æ˜¯å¦æ˜¯è¯¥å‰¯æœ¬é›†æ‰€æœ‰èŠ‚ç‚¹ä¸­ä¼˜å…ˆçº§æœ€å¤§çš„ã€‚æœ€åæ»¡è¶³æ¡ä»¶æ‰ä¼šç»™è¯¥èŠ‚ç‚¹å‘é€æŠ•ç¥¨ä¿¡æ¯ã€‚</p><p>7ã€å‘èµ·æŠ•ç¥¨çš„èŠ‚ç‚¹æœ€åä¼šç»Ÿè®¡æ‰€å¾—ç¥¨æ•°å¤§äºå‰¯æœ¬é›†å¯å‚ä¸æŠ•ç¥¨æ•°é‡çš„ä¸€åŠï¼Œåˆ™æŠ¢å æˆåŠŸï¼Œæˆä¸ºæ–°çš„Primaryã€‚</p><p>8ã€å…¶ä»–ä»åº“å¦‚æœå‘ç°è‡ªå·±çš„åŒæ­¥æºè§’è‰²å‘ç”Ÿå˜åŒ–ï¼Œåˆ™ä¼šè§¦å‘é‡æ–°é€‰å–åŒæ­¥æºã€‚</p><h2 id="mongodb-sharding-åˆ†ç‰‡" tabindex="-1"><a class="header-anchor" href="#mongodb-sharding-åˆ†ç‰‡" aria-hidden="true">#</a> MongoDB Shardingï¼ˆåˆ†ç‰‡ï¼‰</h2><p>mongdbå‰¯æœ¬é›†è™½ç„¶è§£å†³äº†æ•°æ®çš„å•ç‚¹é—®é¢˜ï¼Œå¹¶æä¾›äº†è¯»å†™åˆ†ç¦»ï¼Œä½†è¿˜æ˜¯å­˜åœ¨æ•°æ®å®¹é‡çš„ç“¶é¢ˆï¼ˆæ‰€æœ‰æ•°éƒ½å­˜åœ¨ä¸€å°æœºå™¨ä¸Šï¼‰ã€‚æ‰€ä»¥å‡ºç°äº†åˆ†ç‰‡åŠŸèƒ½</p><p>åˆ†ç‰‡åŠŸèƒ½å’Œmysqlçš„åˆ†åŒºåŠŸèƒ½ç±»æ¯”æ¥ç†è§£ï¼Œä¸è¿‡mysqlåˆ†åŒºåæœŸçš„ç»´æŠ¤éœ€è¦æ‰‹åŠ¨å®Œæˆï¼Œä½†mongodbçš„åˆ†ç‰‡å‡ ä¹æ˜¯è‡ªåŠ¨å®Œæˆæ‰€æœ‰äº‹æƒ…ã€‚</p><h3 id="åˆ†ç‰‡çš„ç›®çš„" tabindex="-1"><a class="header-anchor" href="#åˆ†ç‰‡çš„ç›®çš„" aria-hidden="true">#</a> åˆ†ç‰‡çš„ç›®çš„</h3><p>é«˜æ•°æ®é‡å’Œååé‡çš„æ•°æ®åº“åº”ç”¨ä¼šå¯¹å•æœºçš„æ€§èƒ½é€ æˆè¾ƒå¤§å‹åŠ›,å¤§çš„æŸ¥è¯¢é‡ä¼šå°†å•æœºçš„CPUè€—å°½,å¤§çš„æ•°æ®é‡å¯¹å•æœºçš„å­˜å‚¨å‹åŠ›è¾ƒå¤§,æœ€ç»ˆä¼šè€—å°½ç³»ç»Ÿçš„å†…å­˜è€Œå°†å‹åŠ›è½¬ç§»åˆ°ç£ç›˜IOä¸Šã€‚</p><p>ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜,æœ‰ä¸¤ä¸ªåŸºæœ¬çš„æ–¹æ³•: å‚ç›´æ‰©å±•å’Œæ°´å¹³æ‰©å±•ã€‚</p><ul><li><p>å‚ç›´æ‰©å±•ï¼šå¢åŠ æ›´å¤šçš„CPUå’Œå­˜å‚¨èµ„æºæ¥æ‰©å±•å®¹é‡ã€‚</p></li><li><p>æ°´å¹³æ‰©å±•ï¼šå°†æ•°æ®é›†åˆ†å¸ƒåœ¨å¤šä¸ªæœåŠ¡å™¨ä¸Šã€‚æ°´å¹³æ‰©å±•å³åˆ†ç‰‡ã€‚</p></li></ul><h3 id="åˆ†ç‰‡é›†ç¾¤ç»„ä»¶" tabindex="-1"><a class="header-anchor" href="#åˆ†ç‰‡é›†ç¾¤ç»„ä»¶" aria-hidden="true">#</a> åˆ†ç‰‡é›†ç¾¤ç»„ä»¶</h3><ul><li><p>åˆ†ç‰‡ï¼šæ¯ä¸ªshardï¼ˆåˆ†ç‰‡ï¼‰åŒ…å«è¢«åˆ†ç‰‡çš„æ•°æ®é›†ä¸­çš„ä¸€ä¸ªå­é›†ã€‚æ¯ä¸ªåˆ†ç‰‡å¯ä»¥è¢«éƒ¨ç½²ä¸ºå‰¯æœ¬é›†æ¶æ„ã€‚</p></li><li><p>mongosï¼š<code>mongos</code>å……å½“æŸ¥è¯¢è·¯ç”±å™¨ï¼Œåœ¨å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºå’Œåˆ†ç‰‡é›†ç¾¤ä¹‹é—´æä¾›æ¥å£ã€‚</p></li><li><p>config serverï¼šconfig serverså­˜å‚¨äº†åˆ†ç‰‡é›†ç¾¤çš„å…ƒæ•°æ®å’Œé…ç½®ä¿¡æ¯ã€‚</p></li></ul><p>å¦‚å›¾ï¼š</p><p><img src="/assets/sharded-cluster-production-architecture.bakedsvg-7bc23549.svg" alt="sharded-cluster-production-architecture.bakedsvg"></p><p>é›†ç¾¤çš„æ•´ä½“ç»“æ„ï¼š</p><p><img src="/assets/20160919130723606-6501f594.png" alt="img"></p><h3 id="æ•°æ®åœ¨é›†ç¾¤ä¸­çš„åˆ†å¸ƒ" tabindex="-1"><a class="header-anchor" href="#æ•°æ®åœ¨é›†ç¾¤ä¸­çš„åˆ†å¸ƒ" aria-hidden="true">#</a> æ•°æ®åœ¨é›†ç¾¤ä¸­çš„åˆ†å¸ƒ</h3><h4 id="chunk" tabindex="-1"><a class="header-anchor" href="#chunk" aria-hidden="true">#</a> Chunk</h4><p>chunkæ˜¯shard serverå†…éƒ¨ä¿å­˜æ•°æ®çš„æœ€å°å•ä½ï¼Œé»˜è®¤64Mï¼Œå½“chunkçš„å¤§å°è¶…è¿‡64Måï¼Œmongoä¼šè‡ªåŠ¨åˆ‡åˆ†ï¼Œé¿å…å½¢æˆè¿‡å¤§çš„chunkã€‚</p><p>åœ¨mongoä¸­è¿˜ä¼šæœ‰ä¸€ä¸ªbalancerè¿›ç¨‹ï¼Œä¸»è¦è´Ÿè´£chunkåœ¨shard serveré—´çš„è¿ç§»ï¼Œä»è€Œå‡è¡¡shard serverçš„è´Ÿè½½ã€‚</p><blockquote><p>ï¼ˆ1ï¼‰ä½¿ç”¨chunkæ¥å­˜å‚¨æ•°æ®</p><p>ï¼ˆ2ï¼‰é›†ç¾¤æ­å»ºå®Œæˆä¹‹åï¼Œé»˜è®¤å¼€å¯ä¸€ä¸ªchunkï¼Œå¤§å°æ˜¯64Mï¼Œ</p><p>ï¼ˆ3ï¼‰å­˜å‚¨éœ€æ±‚è¶…è¿‡64Mï¼Œchunkä¼šè¿›è¡Œåˆ†è£‚ï¼Œå¦‚æœå•ä½æ—¶é—´å­˜å‚¨éœ€æ±‚å¾ˆå¤§ï¼Œè®¾ç½®æ›´å¤§çš„chunk</p><p>ï¼ˆ4ï¼‰chunkä¼šè¢«è‡ªåŠ¨å‡è¡¡è¿ç§»ã€‚</p></blockquote><h4 id="chunksizeçš„é€‰æ‹©" tabindex="-1"><a class="header-anchor" href="#chunksizeçš„é€‰æ‹©" aria-hidden="true">#</a> ChunkSizeçš„é€‰æ‹©</h4><p>chunksizeè¿‡å°ï¼šæ•°æ®åˆ†å¸ƒæ›´å‡åŒ€ï¼Œåˆ†è£‚æ›´é¢‘ç¹ï¼Œè¿ç§»é€Ÿåº¦æ›´å¿«ã€‚åˆ†è£‚å’Œè¿ç§»è¿‡ç¨‹ä¸­ä¼šæ¶ˆè€—IOèµ„æº</p><p>chunksizeè¿‡å¤§ï¼šæ•°æ®åˆ†è£‚å°‘ï¼Œæ¶ˆè€—IOèµ„æºæ¯”è¾ƒé›†ä¸­</p><h4 id="chunkåˆ†è£‚è¿ç§»" tabindex="-1"><a class="header-anchor" href="#chunkåˆ†è£‚è¿ç§»" aria-hidden="true">#</a> chunkåˆ†è£‚è¿ç§»</h4><p>éšç€æ•°æ®çš„å¢é•¿ï¼Œå…¶ä¸­çš„æ•°æ®å¤§å°è¶…è¿‡äº†é…ç½®çš„chunk sizeï¼Œé»˜è®¤æ˜¯64Mï¼Œåˆ™è¿™ä¸ªchunkå°±ä¼šåˆ†è£‚æˆä¸¤ä¸ªã€‚æ•°æ®çš„å¢é•¿ä¼šè®©chunkåˆ†è£‚å¾—è¶Šæ¥è¶Šå¤šã€‚</p><img src="/assets/285763-20190418161324100-576146571-7cc6f590.png" alt="img" style="zoom:50%;"><p>è¿™æ—¶å€™ï¼Œå„ä¸ªshard ä¸Šçš„chunkæ•°é‡å°±ä¼šä¸å¹³è¡¡ã€‚è¿™æ—¶å€™ï¼Œmongosä¸­çš„ä¸€ä¸ªç»„ä»¶balancer å°±ä¼šæ‰§è¡Œè‡ªåŠ¨å¹³è¡¡ã€‚æŠŠchunkä»chunkæ•°é‡æœ€å¤šçš„shardèŠ‚ç‚¹æŒªåŠ¨åˆ°æ•°é‡æœ€å°‘çš„èŠ‚ç‚¹ã€‚</p><img src="/assets/285763-20190418161413324-957658228-cec38d6c.png" alt="img" style="zoom:50%;"><h4 id="chunksizeå¯¹åˆ†è£‚å’Œè¿ç§»çš„å½±å“" tabindex="-1"><a class="header-anchor" href="#chunksizeå¯¹åˆ†è£‚å’Œè¿ç§»çš„å½±å“" aria-hidden="true">#</a> chunkSizeå¯¹åˆ†è£‚å’Œè¿ç§»çš„å½±å“</h4><p>MongoDB é»˜è®¤çš„ chunkSize ä¸º64MBï¼Œå¦‚æ— ç‰¹æ®Šéœ€æ±‚ï¼Œå»ºè®®ä¿æŒé»˜è®¤å€¼ï¼›chunkSize ä¼šç›´æ¥å½±å“åˆ° chunk åˆ†è£‚ã€è¿ç§»çš„è¡Œä¸ºã€‚</p><p>chunkSize è¶Šå°ï¼Œchunk åˆ†è£‚åŠè¿ç§»è¶Šå¤šï¼Œæ•°æ®åˆ†å¸ƒè¶Šå‡è¡¡ï¼›åä¹‹ï¼ŒchunkSize è¶Šå¤§ï¼Œchunk åˆ†è£‚åŠè¿ç§»ä¼šæ›´å°‘ï¼Œä½†å¯èƒ½å¯¼è‡´æ•°æ®åˆ†å¸ƒä¸å‡ã€‚å¯èƒ½é€ æˆçƒ­ç‚¹æ•°æ®é—®é¢˜</p><p>chunkSize å¤ªå°ï¼Œå®¹æ˜“å‡ºç° jumbo chunkï¼ˆå³shardKey çš„æŸä¸ªå–å€¼å‡ºç°é¢‘ç‡å¾ˆé«˜ï¼Œè¿™äº›æ–‡æ¡£åªèƒ½æ”¾åˆ°ä¸€ä¸ª chunk é‡Œï¼Œæ— æ³•å†åˆ†è£‚ï¼‰è€Œæ— æ³•è¿ç§»ï¼›chunkSize è¶Šå¤§ï¼Œåˆ™å¯èƒ½å‡ºç° chunk å†…æ–‡æ¡£æ•°å¤ªå¤šï¼ˆchunk å†…æ–‡æ¡£æ•°ä¸èƒ½è¶…è¿‡ 250000 ï¼‰è€Œæ— æ³•è¿ç§»ã€‚</p><p>chunk è‡ªåŠ¨åˆ†è£‚åªä¼šåœ¨æ•°æ®å†™å…¥æ—¶è§¦å‘ï¼Œæ‰€ä»¥å¦‚æœå°† chunkSize æ”¹å°ï¼Œç³»ç»Ÿéœ€è¦ä¸€å®šçš„æ—¶é—´æ¥å°† chunk åˆ†è£‚åˆ°æŒ‡å®šçš„å¤§å°ã€‚</p><p>chunk åªä¼šåˆ†è£‚ï¼Œä¸ä¼šåˆå¹¶ï¼Œæ‰€ä»¥å³ä½¿å°† chunkSize æ”¹å¤§ï¼Œç°æœ‰çš„ chunk æ•°é‡ä¸ä¼šå‡å°‘ï¼Œä½† chunk å¤§å°ä¼šéšç€å†™å…¥ä¸æ–­å¢é•¿ï¼Œç›´åˆ°è¾¾åˆ°ç›®æ ‡å¤§å°ã€‚</p><h3 id="æ•°æ®åˆ†åŒº" tabindex="-1"><a class="header-anchor" href="#æ•°æ®åˆ†åŒº" aria-hidden="true">#</a> æ•°æ®åˆ†åŒº</h3><h4 id="åˆ†ç‰‡é”®shard-key" tabindex="-1"><a class="header-anchor" href="#åˆ†ç‰‡é”®shard-key" aria-hidden="true">#</a> åˆ†ç‰‡é”®shard key</h4><p>MongoDBä¸­æ•°æ®çš„åˆ†ç‰‡æ˜¯ä»¥é›†åˆä¸ºåŸºæœ¬å•ä½çš„ï¼Œé›†åˆä¸­çš„æ•°æ®é€šè¿‡ç‰‡é”®ï¼ˆShard keyï¼‰è¢«åˆ†æˆå¤šéƒ¨åˆ†ã€‚å…¶å®ç‰‡é”®å°±æ˜¯åœ¨é›†åˆä¸­é€‰ä¸€ä¸ªé”®ï¼Œç”¨è¯¥é”®çš„å€¼ä½œä¸ºæ•°æ®æ‹†åˆ†çš„ä¾æ®ã€‚</p><p>æ‰€ä»¥ä¸€ä¸ªå¥½çš„ç‰‡é”®å¯¹åˆ†ç‰‡è‡³å…³é‡è¦ã€‚<strong>ç‰‡é”®å¿…é¡»æ˜¯ä¸€ä¸ªç´¢å¼•</strong>ï¼Œé€šè¿‡sh.shardCollectionåŠ ä¼šè‡ªåŠ¨åˆ›å»ºç´¢å¼•ï¼ˆå‰ææ˜¯æ­¤é›†åˆä¸å­˜åœ¨çš„æƒ…å†µä¸‹ï¼‰ã€‚ä¸€ä¸ªè‡ªå¢çš„ç‰‡é”®å¯¹å†™å…¥å’Œæ•°æ®å‡åŒ€åˆ†å¸ƒå°±ä¸æ˜¯å¾ˆå¥½ï¼Œå› ä¸ºè‡ªå¢çš„ç‰‡é”®æ€»ä¼šåœ¨ä¸€ä¸ªåˆ†ç‰‡ä¸Šå†™å…¥ï¼Œåç»­è¾¾åˆ°æŸä¸ªé˜€å€¼å¯èƒ½ä¼šå†™åˆ°åˆ«çš„åˆ†ç‰‡ã€‚ä½†æ˜¯æŒ‰ç…§ç‰‡é”®æŸ¥è¯¢ä¼šéå¸¸é«˜æ•ˆã€‚</p><p>éšæœºç‰‡é”®å¯¹æ•°æ®çš„å‡åŒ€åˆ†å¸ƒæ•ˆæœå¾ˆå¥½ã€‚æ³¨æ„å°½é‡é¿å…åœ¨å¤šä¸ªåˆ†ç‰‡ä¸Šè¿›è¡ŒæŸ¥è¯¢ã€‚åœ¨æ‰€æœ‰åˆ†ç‰‡ä¸ŠæŸ¥è¯¢ï¼Œmongosä¼šå¯¹ç»“æœè¿›è¡Œå½’å¹¶æ’åºã€‚</p><p>å¯¹é›†åˆè¿›è¡Œåˆ†ç‰‡æ—¶ï¼Œä½ éœ€è¦é€‰æ‹©ä¸€ä¸ªç‰‡é”®ï¼Œ<strong>ç‰‡é”®æ˜¯æ¯æ¡è®°å½•éƒ½å¿…é¡»åŒ…å«çš„</strong>ï¼Œä¸”å»ºç«‹äº†ç´¢å¼•çš„å•ä¸ªå­—æ®µæˆ–å¤åˆå­—æ®µï¼ŒMongoDBæŒ‰ç…§ç‰‡é”®å°†æ•°æ®åˆ’åˆ†åˆ°ä¸åŒçš„æ•°æ®å—ä¸­ï¼Œå¹¶å°†æ•°æ®å—å‡è¡¡åœ°åˆ†å¸ƒåˆ°æ‰€æœ‰åˆ†ç‰‡ä¸­ã€‚</p><p>ä¸ºäº†æŒ‰ç…§ç‰‡é”®åˆ’åˆ†æ•°æ®å—ï¼ŒMongoDBä½¿ç”¨åŸºäº<strong>èŒƒå›´çš„åˆ†ç‰‡</strong>æ–¹å¼æˆ–è€… åŸºäº<strong>å“ˆå¸Œçš„åˆ†ç‰‡</strong>æ–¹å¼ã€‚</p><blockquote><p>åˆ†ç‰‡é”®æ˜¯ä¸å¯å˜ã€‚</p><p>åˆ†ç‰‡é”®å¿…é¡»æœ‰ç´¢å¼•ã€‚</p><p>åˆ†ç‰‡é”®å¤§å°é™åˆ¶512bytesã€‚</p><p>åˆ†ç‰‡é”®ç”¨äºè·¯ç”±æŸ¥è¯¢ã€‚</p><p>MongoDBä¸æ¥å—å·²è¿›è¡Œcollectionçº§åˆ†ç‰‡çš„collectionä¸Šæ’å…¥æ— åˆ†ç‰‡é”®çš„æ–‡æ¡£ï¼ˆä¹Ÿä¸æ”¯æŒç©ºå€¼æ’å…¥ï¼‰</p></blockquote><h4 id="åŸºäºèŒƒå›´çš„åˆ†ç‰‡" tabindex="-1"><a class="header-anchor" href="#åŸºäºèŒƒå›´çš„åˆ†ç‰‡" aria-hidden="true">#</a> åŸºäºèŒƒå›´çš„åˆ†ç‰‡</h4><p>Sharded Clusteræ”¯æŒå°†å•ä¸ªé›†åˆçš„æ•°æ®åˆ†æ•£å­˜å‚¨åœ¨å¤šshardä¸Šï¼Œç”¨æˆ·å¯ä»¥æŒ‡å®šæ ¹æ®é›†åˆå†…æ–‡æ¡£çš„æŸä¸ªå­—æ®µå³shard keyæ¥è¿›è¡ŒèŒƒå›´åˆ†ç‰‡ï¼ˆrange shardingï¼‰</p><p><img src="/assets/285763-20190418162312653-1231291425-94f596a4.png" alt="img"></p><p>å¯¹äºåŸºäºèŒƒå›´çš„åˆ†ç‰‡ï¼ŒMongoDBæŒ‰ç…§ç‰‡é”®çš„èŒƒå›´æŠŠæ•°æ®åˆ†æˆä¸åŒéƒ¨åˆ†ã€‚</p><p>å‡è®¾æœ‰ä¸€ä¸ªæ•°å­—çš„ç‰‡é”®:æƒ³è±¡ä¸€ä¸ªä»è´Ÿæ— ç©·åˆ°æ­£æ— ç©·çš„ç›´çº¿ï¼Œæ¯ä¸€ä¸ªç‰‡é”®çš„å€¼éƒ½åœ¨ç›´çº¿ä¸Šç”»äº†ä¸€ä¸ªç‚¹ã€‚MongoDBæŠŠè¿™æ¡ç›´çº¿åˆ’åˆ†ä¸ºæ›´çŸ­çš„ä¸é‡å çš„ç‰‡æ®µï¼Œå¹¶ç§°ä¹‹ä¸ºæ•°æ®å—ï¼Œæ¯ä¸ªæ•°æ®å—åŒ…å«äº†ç‰‡é”®åœ¨ä¸€å®šèŒƒå›´å†…çš„æ•°æ®ã€‚åœ¨ä½¿ç”¨ç‰‡é”®åšèŒƒå›´åˆ’åˆ†çš„ç³»ç»Ÿä¸­ï¼Œæ‹¥æœ‰â€ç›¸è¿‘â€ç‰‡é”®çš„æ–‡æ¡£å¾ˆå¯èƒ½å­˜å‚¨åœ¨åŒä¸€ä¸ªæ•°æ®å—ä¸­ï¼Œå› æ­¤ä¹Ÿä¼šå­˜å‚¨åœ¨åŒä¸€ä¸ªåˆ†ç‰‡ä¸­ã€‚</p><h4 id="åŸºäºå“ˆå¸Œçš„åˆ†ç‰‡" tabindex="-1"><a class="header-anchor" href="#åŸºäºå“ˆå¸Œçš„åˆ†ç‰‡" aria-hidden="true">#</a> åŸºäºå“ˆå¸Œçš„åˆ†ç‰‡</h4><p>åˆ†ç‰‡è¿‡ç¨‹ä¸­åˆ©ç”¨å“ˆå¸Œç´¢å¼•ä½œä¸ºåˆ†ç‰‡çš„å•ä¸ªé”®ï¼Œä¸”å“ˆå¸Œåˆ†ç‰‡çš„ç‰‡é”®åªèƒ½ä½¿ç”¨ä¸€ä¸ªå­—æ®µï¼Œè€ŒåŸºäºå“ˆå¸Œç‰‡é”®æœ€å¤§çš„å¥½å¤„å°±æ˜¯ä¿è¯æ•°æ®åœ¨å„ä¸ªèŠ‚ç‚¹åˆ†å¸ƒåŸºæœ¬å‡åŒ€ã€‚</p><p><img src="/assets/285763-20190418162325618-2139414121-78c6c233.png" alt="img"></p><p>å¯¹äºåŸºäºå“ˆå¸Œçš„åˆ†ç‰‡ï¼ŒMongoDBè®¡ç®—ä¸€ä¸ªå­—æ®µçš„å“ˆå¸Œå€¼ï¼Œå¹¶ç”¨è¿™ä¸ªå“ˆå¸Œå€¼æ¥åˆ›å»ºæ•°æ®å—ã€‚åœ¨ä½¿ç”¨åŸºäºå“ˆå¸Œåˆ†ç‰‡çš„ç³»ç»Ÿä¸­ï¼Œæ‹¥æœ‰â€ç›¸è¿‘â€ç‰‡é”®çš„æ–‡æ¡£å¾ˆå¯èƒ½ä¸ä¼šå­˜å‚¨åœ¨åŒä¸€ä¸ªæ•°æ®å—ä¸­ï¼Œå› æ­¤æ•°æ®çš„åˆ†ç¦»æ€§æ›´å¥½ä¸€äº›ã€‚</p><p>Hashåˆ†ç‰‡ä¸èŒƒå›´åˆ†ç‰‡äº’è¡¥ï¼Œèƒ½å°†æ–‡æ¡£éšæœºçš„åˆ†æ•£åˆ°å„ä¸ªchunkï¼Œå……åˆ†çš„æ‰©å±•å†™èƒ½åŠ›ï¼Œå¼¥è¡¥äº†èŒƒå›´åˆ†ç‰‡çš„ä¸è¶³ï¼Œä½†ä¸èƒ½é«˜æ•ˆçš„æœåŠ¡èŒƒå›´æŸ¥è¯¢ï¼Œæ‰€æœ‰çš„èŒƒå›´æŸ¥è¯¢è¦åˆ†å‘åˆ°åç«¯æ‰€æœ‰çš„Shardæ‰èƒ½æ‰¾å‡ºæ»¡è¶³æ¡ä»¶çš„æ–‡æ¡£ã€‚</p><h4 id="åˆ†ç‰‡é”®é€‰æ‹©å»ºè®®" tabindex="-1"><a class="header-anchor" href="#åˆ†ç‰‡é”®é€‰æ‹©å»ºè®®" aria-hidden="true">#</a> åˆ†ç‰‡é”®é€‰æ‹©å»ºè®®</h4><p>é€‰æ‹©åˆé€‚çš„ç‰‡é”®ï¼Œå½±å“ç‰‡é”®æ•ˆç‡çš„ä¸»è¦å› ç´ ï¼š</p><ul><li>å–å€¼åŸºæ•°ï¼ˆcardinalityï¼‰</li><li>å–å€¼åˆ†å¸ƒ</li><li>åˆ†æ•£å†™ï¼Œé›†ä¸­è¯»</li><li>è¢«å°½å¯èƒ½å¤šçš„ä¸šåŠ¡åœºæ™¯ç”¨åˆ°</li><li>é¿å…å•è°ƒé€’å¢æˆ–é€’å‡çš„ç‰‡é”®</li></ul><h5 id="_1ã€é€’å¢çš„sharding-key" tabindex="-1"><a class="header-anchor" href="#_1ã€é€’å¢çš„sharding-key" aria-hidden="true">#</a> 1ã€é€’å¢çš„sharding key</h5><p>æ•°æ®æ–‡ä»¶æŒªåŠ¨å°ã€‚ï¼ˆä¼˜åŠ¿ï¼‰</p><p>å› ä¸ºæ•°æ®æ–‡ä»¶é€’å¢ï¼Œæ‰€ä»¥ä¼šæŠŠinsertçš„å†™IOæ°¸ä¹…æ”¾åœ¨æœ€åä¸€ç‰‡ä¸Šï¼Œé€ æˆæœ€åä¸€ç‰‡çš„å†™çƒ­ç‚¹ã€‚åŒæ—¶ï¼Œéšç€æœ€åä¸€ç‰‡çš„æ•°æ®é‡å¢å¤§ï¼Œå°†ä¸æ–­çš„å‘ç”Ÿè¿ç§»è‡³ä¹‹å‰çš„ç‰‡ä¸Šã€‚</p><h5 id="_2ã€éšæœºçš„sharding-key" tabindex="-1"><a class="header-anchor" href="#_2ã€éšæœºçš„sharding-key" aria-hidden="true">#</a> 2ã€éšæœºçš„sharding key</h5><p>æ•°æ®åˆ†å¸ƒå‡åŒ€ï¼Œinsertçš„å†™IOå‡åŒ€åˆ†å¸ƒåœ¨å¤šä¸ªç‰‡ä¸Šã€‚ï¼ˆä¼˜åŠ¿ï¼‰</p><p>å¤§é‡çš„éšæœºIOï¼Œç£ç›˜ä¸å ªé‡è·ã€‚</p><h5 id="_3ã€æ··åˆå‹key" tabindex="-1"><a class="header-anchor" href="#_3ã€æ··åˆå‹key" aria-hidden="true">#</a> 3ã€æ··åˆå‹key</h5><p>å¤§æ–¹å‘éšæœºé€’å¢ï¼Œå°èŒƒå›´éšæœºåˆ†å¸ƒã€‚</p><p>ä¸ºäº†é˜²æ­¢å‡ºç°å¤§é‡çš„chunkå‡è¡¡è¿ç§»ï¼Œå¯èƒ½é€ æˆçš„IOå‹åŠ›ã€‚æˆ‘ä»¬éœ€è¦è®¾ç½®åˆç†åˆ†ç‰‡ä½¿ç”¨ç­–ç•¥ï¼ˆç‰‡é”®çš„é€‰æ‹©ã€åˆ†ç‰‡ç®—æ³•ï¼ˆrangeã€hashï¼‰ï¼‰</p><h2 id="mongodb-å­˜å‚¨" tabindex="-1"><a class="header-anchor" href="#mongodb-å­˜å‚¨" aria-hidden="true">#</a> MongoDB å­˜å‚¨</h2><h3 id="wiredtiger-storage-engine" tabindex="-1"><a class="header-anchor" href="#wiredtiger-storage-engine" aria-hidden="true">#</a> WiredTiger Storage Engine</h3><p>ä»Mongodb3.2ç‰ˆæœ¬ä»¥åï¼ŒWiredTiger å°†ä½œä¸ºé»˜è®¤çš„å­˜å‚¨å¼•æ“ã€‚</p><h4 id="æ–‡æ¡£çº§å¹¶å‘" tabindex="-1"><a class="header-anchor" href="#æ–‡æ¡£çº§å¹¶å‘" aria-hidden="true">#</a> æ–‡æ¡£çº§å¹¶å‘</h4><p>WiredTigerä½¿ç”¨document-level å¹¶å‘æ¥æ§åˆ¶å†™æ“ä½œï¼Œå› æ­¤ï¼Œå…è®¸å¤šclientåŒæ—¶ä¿®æ”¹ç»Ÿä¸€é›†åˆä¸­çš„ä¸åŒæ–‡æ¡£ã€‚</p><h4 id="snapshotsã€checkpointsã€journal" tabindex="-1"><a class="header-anchor" href="#snapshotsã€checkpointsã€journal" aria-hidden="true">#</a> Snapshotsã€Checkpointsã€Journal</h4><p>snapshotï¼šmongodbä½¿ç”¨å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼Œsnapshotåˆ™æ˜¯ä¸€ä¸ªåŸºäºå†…å­˜çš„æ—¶é—´ç‚¹å¿«ç…§ã€‚operationå°±æ˜¯åœ¨è¿™ä¸ªå¿«ç…§ä¸Šå®Œæˆçš„ã€‚</p><p>checkpointï¼š æ¯ä¸ª60ç§’åˆ›å»ºä¸€ä¸ªcheckpointï¼Œæ–°çš„checkpointåˆ›å»ºæœŸé—´ï¼Œæ—§çš„checkpointä»ç„¶å¯ç”¨ï¼ŒçŸ¥é“mongoå°†å¼•ç”¨æ›´æ–°(åŸå­æ›´æ–°)åˆ°æ–°çš„checkpointä¸Šã€‚</p><p>Journalï¼šæ˜¯Mongodbçš„ä¸€ä¸ªå†™æ—¥å¿—çš„åŠŸèƒ½ï¼Œå…¶å®å°±æ˜¯é¢„å†™æ—¥å¿—åŠŸèƒ½ï¼ˆWrite-ahead loggingï¼Œ ç¼©å†™WALï¼‰mongodbå®•æœºåçš„æ•°æ®æ¢å¤å°±æ˜¯é€šè¿‡checkpointå’ŒJournalæ¥å®ç°çš„ã€‚</p><h4 id="å†…å­˜ä½¿ç”¨" tabindex="-1"><a class="header-anchor" href="#å†…å­˜ä½¿ç”¨" aria-hidden="true">#</a> å†…å­˜ä½¿ç”¨</h4><p>mongoåˆ©ç”¨ç¼“å­˜å¤§å°çš„è®¡ç®—æ–¹å¼æ˜¯ä¸€ä¸‹ä¸¤ç§æ–¹å¼çš„æœ€å¤§è€…</p><p>50% of (RAM â€“ 1 GB) or 256 MB.</p><h4 id="æ•°æ®å‹ç¼©" tabindex="-1"><a class="header-anchor" href="#æ•°æ®å‹ç¼©" aria-hidden="true">#</a> æ•°æ®å‹ç¼©</h4><p>æ”¯æŒå¯¹collectionså’Œindexçš„å‹ç¼©ï¼Œé»˜è®¤ä½¿ç”¨snappyåº“è¿›è¡Œå‹ç¼©</p><p>å¯¹äºcollectionsï¼Œè¿˜æä¾›ä¸€ä¸‹å‹ç¼©ç®—æ³•</p><ul><li>zlib</li><li>zstdï¼ˆä»mongodb4.2ç‰ˆæœ¬å¼€å§‹ï¼‰</li></ul></div><!----><footer class="page-meta"><!----><div class="meta-item update-time"><span class="label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><!----></div><div class="meta-item contributors"><span class="label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="contributor" title="email: 895252461@qq.com">xuliang</span>,<!--]--><!--[--><span class="contributor" title="email: 895252461@qq.com">è¯—äººéƒ½è—åœ¨æ°´åº•</span><!--]--><!--]--></div></footer><!----><!----><!----><!--]--></main><!--]--><!----><!--]--></div><!--]--><!----><!--]--></div>
    <script type="module" src="/assets/app-671fc831.js" defer></script>
  </body>
</html>
