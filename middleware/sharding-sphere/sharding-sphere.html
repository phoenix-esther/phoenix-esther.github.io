<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.59" />
    <meta name="theme" content="VuePress Theme Hope" />
    <title>Sharding-Sphere | Java æˆç¥ä¹‹è·¯</title><meta name="description" content="è¿™æ˜¯æˆ‘çš„ç¬¬ä¸€ä¸ª VuePress ç«™ç‚¹">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d2025;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/assets/style-f1658162.css" as="style"><link rel="stylesheet" href="/assets/style-f1658162.css">
    <link rel="modulepreload" href="/assets/app-fb3896f3.js"><link rel="modulepreload" href="/assets/framework-5dde3bca.js"><link rel="modulepreload" href="/assets/sharding-sphere.html-47e07fb1.js"><link rel="modulepreload" href="/assets/sharding-sphere.html-bb3296bb.js"><link rel="prefetch" href="/assets/index.html-95370337.js" as="script"><link rel="prefetch" href="/assets/database-overview.html-03717758.js" as="script"><link rel="prefetch" href="/assets/java-overview.html-44310673.js" as="script"><link rel="prefetch" href="/assets/middleware-overview.html-be4fdd51.js" as="script"><link rel="prefetch" href="/assets/quality-overview.html-a8e9bda4.js" as="script"><link rel="prefetch" href="/assets/spring-cloud-overview.html-87409649.js" as="script"><link rel="prefetch" href="/assets/gitbook.html-fb8a8229.js" as="script"><link rel="prefetch" href="/assets/tools-overview.html-67f69dba.js" as="script"><link rel="prefetch" href="/assets/mysql-advance.html-e06a1ce2.js" as="script"><link rel="prefetch" href="/assets/mysql-apply.html-a6b2d1c2.js" as="script"><link rel="prefetch" href="/assets/mysql-base.html-d91fdb11.js" as="script"><link rel="prefetch" href="/assets/mysql-devops.html-0b9fc6f6.js" as="script"><link rel="prefetch" href="/assets/redis-base.html-fbc05584.js" as="script"><link rel="prefetch" href="/assets/redis-cluster.html-07744daf.js" as="script"><link rel="prefetch" href="/assets/redis-overview.html-1bcd1133.js" as="script"><link rel="prefetch" href="/assets/java-base.html-7071cb31.js" as="script"><link rel="prefetch" href="/assets/java-sql.html-c8be449f.js" as="script"><link rel="prefetch" href="/assets/java-time.html-2c855f9e.js" as="script"><link rel="prefetch" href="/assets/java-collection-list.html-2207ee3a.js" as="script"><link rel="prefetch" href="/assets/java-collection-map.html-d30b93e7.js" as="script"><link rel="prefetch" href="/assets/java-concurrent-base.html-8983a76d.js" as="script"><link rel="prefetch" href="/assets/Java-concurrent-container.html-3334407b.js" as="script"><link rel="prefetch" href="/assets/java-concurrent-interview.html-bbc0a621.js" as="script"><link rel="prefetch" href="/assets/java-concurrent-lock.html-ebf0a63c.js" as="script"><link rel="prefetch" href="/assets/java-concurrent-pool.html-7a290f95.js" as="script"><link rel="prefetch" href="/assets/java-concurrent-tools.html-01a740a1.js" as="script"><link rel="prefetch" href="/assets/java-bio.html-ceca2a90.js" as="script"><link rel="prefetch" href="/assets/java-io-base.html-40d5757f.js" as="script"><link rel="prefetch" href="/assets/java-nio.html-42380996.js" as="script"><link rel="prefetch" href="/assets/Javaå†…å­˜æ¨¡å‹.html-13f8a203.js" as="script"><link rel="prefetch" href="/assets/JVMå†…å­˜ç»“æ„.html-fb577c69.js" as="script"><link rel="prefetch" href="/assets/JVMåƒåœ¾å›æ”¶.html-852577fd.js" as="script"><link rel="prefetch" href="/assets/JVMæ¦‚è§ˆ.html-eda595c7.js" as="script"><link rel="prefetch" href="/assets/JVMç±»åŠ è½½å™¨.html-ee6c0eb8.js" as="script"><link rel="prefetch" href="/assets/JVMç±»æ–‡ä»¶ç»“æ„.html-6aca785b.js" as="script"><link rel="prefetch" href="/assets/JVMè°ƒä¼˜.html-ad63cd2e.js" as="script"><link rel="prefetch" href="/assets/java-servlet.html-ef72b065.js" as="script"><link rel="prefetch" href="/assets/java-lambda.html-c21b5e3b.js" as="script"><link rel="prefetch" href="/assets/java-stream.html-797890ef.js" as="script"><link rel="prefetch" href="/assets/HikariCP-base.html-89b6d274.js" as="script"><link rel="prefetch" href="/assets/HikariCP-source.html-71542b59.js" as="script"><link rel="prefetch" href="/assets/jackson-overview.html-58553b4c.js" as="script"><link rel="prefetch" href="/assets/kafka-broker.html-8091a112.js" as="script"><link rel="prefetch" href="/assets/kafka-consumer.html-f5b2d049.js" as="script"><link rel="prefetch" href="/assets/kafka-overview.html-9271b058.js" as="script"><link rel="prefetch" href="/assets/kafka-producer.html-9da86206.js" as="script"><link rel="prefetch" href="/assets/spring-kafka.html-bc75ec45.js" as="script"><link rel="prefetch" href="/assets/log-framework.html-76a57287.js" as="script"><link rel="prefetch" href="/assets/1.Hello World.html-b2ffe65b.js" as="script"><link rel="prefetch" href="/assets/2.Global Config.html-6a02822f.js" as="script"><link rel="prefetch" href="/assets/index.html-f37393b8.js" as="script"><link rel="prefetch" href="/assets/shiro-overview.html-66b81094.js" as="script"><link rel="prefetch" href="/assets/tomcat.html-63e9b96e.js" as="script"><link rel="prefetch" href="/assets/data-structure-list.html-5ba0105d.js" as="script"><link rel="prefetch" href="/assets/data-structure-overview.html-85d0b05a.js" as="script"><link rel="prefetch" href="/assets/data-structure-tree.html-b7a2b7b5.js" as="script"><link rel="prefetch" href="/assets/design-adapter.html-ebba49b6.js" as="script"><link rel="prefetch" href="/assets/design-chain.html-73c4f586.js" as="script"><link rel="prefetch" href="/assets/design-composite.html-2f613fc0.js" as="script"><link rel="prefetch" href="/assets/design-decorator.html-478149b0.js" as="script"><link rel="prefetch" href="/assets/design-factory.html-7b417896.js" as="script"><link rel="prefetch" href="/assets/design-overview.html-f84589f0.js" as="script"><link rel="prefetch" href="/assets/design-proxy.html-fee7f0ab.js" as="script"><link rel="prefetch" href="/assets/design-singleton.html-194172a2.js" as="script"><link rel="prefetch" href="/assets/design-strategy.html-586d3ac2.js" as="script"><link rel="prefetch" href="/assets/æ»‘åŠ¨çª—å£.html-d4efa51b.js" as="script"><link rel="prefetch" href="/assets/linux-overview.html-f8205a0e.js" as="script"><link rel="prefetch" href="/assets/encoding.html-bb7cac1e.js" as="script"><link rel="prefetch" href="/assets/encryption-algorithm.html-47d69cef.js" as="script"><link rel="prefetch" href="/assets/temp.html-60b41fd7.js" as="script"><link rel="prefetch" href="/assets/BeanPostProcessor-base.html-9b47aa32.js" as="script"><link rel="prefetch" href="/assets/BeanPostProcessor-ConfigurationClassPostProcessor.html-d4e7a5e5.js" as="script"><link rel="prefetch" href="/assets/spring-source-overview.html-3ac2c8f4.js" as="script"><link rel="prefetch" href="/assets/spring-boot-condition.html-f38f1a16.js" as="script"><link rel="prefetch" href="/assets/spring-cloud-commons-base.html-b68d3933.js" as="script"><link rel="prefetch" href="/assets/spring-cloud-gateway.html-b56fde18.js" as="script"><link rel="prefetch" href="/assets/spring-cloud-loadbalancer.html-182fff59.js" as="script"><link rel="prefetch" href="/assets/nacos-client-discovery.html-050d84e4.js" as="script"><link rel="prefetch" href="/assets/nacos-overview.html-755394c0.js" as="script"><link rel="prefetch" href="/assets/cloud-openfeign-action.html-6173210d.js" as="script"><link rel="prefetch" href="/assets/spring-cloud-openfeign.html-46fdc141.js" as="script"><link rel="prefetch" href="/assets/spring-cloud-ribbon.html-2f5d4e70.js" as="script"><link rel="prefetch" href="/assets/spring-cloud-alibaba-seate.html-90df4bc0.js" as="script"><link rel="prefetch" href="/assets/sentinel-source.html-db79abe0.js" as="script"><link rel="prefetch" href="/assets/spring-cloud-sentinel.html-031a7566.js" as="script"><link rel="prefetch" href="/assets/git.html-f3d86d29.js" as="script"><link rel="prefetch" href="/assets/gitlab.html-ee616321.js" as="script"><link rel="prefetch" href="/assets/junit4.html-7674a247.js" as="script"><link rel="prefetch" href="/assets/junit5.html-1088960a.js" as="script"><link rel="prefetch" href="/assets/maven.html-c5f718a8.js" as="script"><link rel="prefetch" href="/assets/reactor.html-b7f3a608.js" as="script"><link rel="prefetch" href="/assets/spring-source-web-init.html-76aa84f3.js" as="script"><link rel="prefetch" href="/assets/spring-source-web-listener.html-8020b96c.js" as="script"><link rel="prefetch" href="/assets/404.html-f04ced3e.js" as="script"><link rel="prefetch" href="/assets/index.html-33e4c2a2.js" as="script"><link rel="prefetch" href="/assets/index.html-8ad96e03.js" as="script"><link rel="prefetch" href="/assets/index.html-b23d2171.js" as="script"><link rel="prefetch" href="/assets/index.html-8a709d0c.js" as="script"><link rel="prefetch" href="/assets/index.html-9488715d.js" as="script"><link rel="prefetch" href="/assets/index.html-fb3dd3ef.js" as="script"><link rel="prefetch" href="/assets/index.html-42d88d20.js" as="script"><link rel="prefetch" href="/assets/index.html-87f3d90a.js" as="script"><link rel="prefetch" href="/assets/index.html-4e6c2eaf.js" as="script"><link rel="prefetch" href="/assets/index.html-df28bb11.js" as="script"><link rel="prefetch" href="/assets/index.html-78d325c5.js" as="script"><link rel="prefetch" href="/assets/index.html-0c05d7f0.js" as="script"><link rel="prefetch" href="/assets/database-overview.html-8e20b9c4.js" as="script"><link rel="prefetch" href="/assets/java-overview.html-110664f3.js" as="script"><link rel="prefetch" href="/assets/middleware-overview.html-23551371.js" as="script"><link rel="prefetch" href="/assets/quality-overview.html-c678a80a.js" as="script"><link rel="prefetch" href="/assets/spring-cloud-overview.html-4f455e53.js" as="script"><link rel="prefetch" href="/assets/gitbook.html-82c9e715.js" as="script"><link rel="prefetch" href="/assets/tools-overview.html-ef94410e.js" as="script"><link rel="prefetch" href="/assets/mysql-advance.html-04da5f50.js" as="script"><link rel="prefetch" href="/assets/mysql-apply.html-93145a97.js" as="script"><link rel="prefetch" href="/assets/mysql-base.html-d6966f7f.js" as="script"><link rel="prefetch" href="/assets/mysql-devops.html-6b9ccca1.js" as="script"><link rel="prefetch" href="/assets/redis-base.html-2d4d81f6.js" as="script"><link rel="prefetch" href="/assets/redis-cluster.html-dd1dc967.js" as="script"><link rel="prefetch" href="/assets/redis-overview.html-7f2546f3.js" as="script"><link rel="prefetch" href="/assets/java-base.html-2a2487a8.js" as="script"><link rel="prefetch" href="/assets/java-sql.html-3235fb3f.js" as="script"><link rel="prefetch" href="/assets/java-time.html-c6bd518b.js" as="script"><link rel="prefetch" href="/assets/java-collection-list.html-1f5f5479.js" as="script"><link rel="prefetch" href="/assets/java-collection-map.html-9eaf3f79.js" as="script"><link rel="prefetch" href="/assets/java-concurrent-base.html-ae299cb8.js" as="script"><link rel="prefetch" href="/assets/Java-concurrent-container.html-ebd6fec8.js" as="script"><link rel="prefetch" href="/assets/java-concurrent-interview.html-07fbfa4a.js" as="script"><link rel="prefetch" href="/assets/java-concurrent-lock.html-994ad73f.js" as="script"><link rel="prefetch" href="/assets/java-concurrent-pool.html-ed4a1de5.js" as="script"><link rel="prefetch" href="/assets/java-concurrent-tools.html-8880da92.js" as="script"><link rel="prefetch" href="/assets/java-bio.html-df6fc911.js" as="script"><link rel="prefetch" href="/assets/java-io-base.html-77f89736.js" as="script"><link rel="prefetch" href="/assets/java-nio.html-54a3f8b5.js" as="script"><link rel="prefetch" href="/assets/Javaå†…å­˜æ¨¡å‹.html-7383b9cd.js" as="script"><link rel="prefetch" href="/assets/JVMå†…å­˜ç»“æ„.html-8d99ddf3.js" as="script"><link rel="prefetch" href="/assets/JVMåƒåœ¾å›æ”¶.html-304d9a2d.js" as="script"><link rel="prefetch" href="/assets/JVMæ¦‚è§ˆ.html-8bd4b42f.js" as="script"><link rel="prefetch" href="/assets/JVMç±»åŠ è½½å™¨.html-77d4aeac.js" as="script"><link rel="prefetch" href="/assets/JVMç±»æ–‡ä»¶ç»“æ„.html-9a5ae840.js" as="script"><link rel="prefetch" href="/assets/JVMè°ƒä¼˜.html-abf07289.js" as="script"><link rel="prefetch" href="/assets/java-servlet.html-8537acfe.js" as="script"><link rel="prefetch" href="/assets/java-lambda.html-e158a557.js" as="script"><link rel="prefetch" href="/assets/java-stream.html-ad9eb0ed.js" as="script"><link rel="prefetch" href="/assets/HikariCP-base.html-f749e904.js" as="script"><link rel="prefetch" href="/assets/HikariCP-source.html-4651cd3f.js" as="script"><link rel="prefetch" href="/assets/jackson-overview.html-1ff735d9.js" as="script"><link rel="prefetch" href="/assets/kafka-broker.html-78790cd6.js" as="script"><link rel="prefetch" href="/assets/kafka-consumer.html-3872d15c.js" as="script"><link rel="prefetch" href="/assets/kafka-overview.html-a21ac13c.js" as="script"><link rel="prefetch" href="/assets/kafka-producer.html-c1f29639.js" as="script"><link rel="prefetch" href="/assets/spring-kafka.html-0eaac2b9.js" as="script"><link rel="prefetch" href="/assets/log-framework.html-13f8b728.js" as="script"><link rel="prefetch" href="/assets/1.Hello World.html-254e923d.js" as="script"><link rel="prefetch" href="/assets/2.Global Config.html-34377212.js" as="script"><link rel="prefetch" href="/assets/index.html-6f5477e7.js" as="script"><link rel="prefetch" href="/assets/shiro-overview.html-f4bdb923.js" as="script"><link rel="prefetch" href="/assets/tomcat.html-107f9ebe.js" as="script"><link rel="prefetch" href="/assets/data-structure-list.html-0f23b38b.js" as="script"><link rel="prefetch" href="/assets/data-structure-overview.html-f1e03c1d.js" as="script"><link rel="prefetch" href="/assets/data-structure-tree.html-a44ba30f.js" as="script"><link rel="prefetch" href="/assets/design-adapter.html-6c1e88fc.js" as="script"><link rel="prefetch" href="/assets/design-chain.html-74047f74.js" as="script"><link rel="prefetch" href="/assets/design-composite.html-4089df67.js" as="script"><link rel="prefetch" href="/assets/design-decorator.html-45ec3651.js" as="script"><link rel="prefetch" href="/assets/design-factory.html-0c38b519.js" as="script"><link rel="prefetch" href="/assets/design-overview.html-16465e26.js" as="script"><link rel="prefetch" href="/assets/design-proxy.html-6cd81938.js" as="script"><link rel="prefetch" href="/assets/design-singleton.html-cb24f2c3.js" as="script"><link rel="prefetch" href="/assets/design-strategy.html-79c37426.js" as="script"><link rel="prefetch" href="/assets/æ»‘åŠ¨çª—å£.html-a5cf52bf.js" as="script"><link rel="prefetch" href="/assets/linux-overview.html-4c5f0a4a.js" as="script"><link rel="prefetch" href="/assets/encoding.html-f5906218.js" as="script"><link rel="prefetch" href="/assets/encryption-algorithm.html-9a1f16a2.js" as="script"><link rel="prefetch" href="/assets/temp.html-bc9bd901.js" as="script"><link rel="prefetch" href="/assets/BeanPostProcessor-base.html-f1d5d10e.js" as="script"><link rel="prefetch" href="/assets/BeanPostProcessor-ConfigurationClassPostProcessor.html-a96eba50.js" as="script"><link rel="prefetch" href="/assets/spring-source-overview.html-11cf77bb.js" as="script"><link rel="prefetch" href="/assets/spring-boot-condition.html-925c1f11.js" as="script"><link rel="prefetch" href="/assets/spring-cloud-commons-base.html-08854838.js" as="script"><link rel="prefetch" href="/assets/spring-cloud-gateway.html-3b5bcf8b.js" as="script"><link rel="prefetch" href="/assets/spring-cloud-loadbalancer.html-6f95c5b7.js" as="script"><link rel="prefetch" href="/assets/nacos-client-discovery.html-79247510.js" as="script"><link rel="prefetch" href="/assets/nacos-overview.html-13cec71c.js" as="script"><link rel="prefetch" href="/assets/cloud-openfeign-action.html-0f222092.js" as="script"><link rel="prefetch" href="/assets/spring-cloud-openfeign.html-80b0fc34.js" as="script"><link rel="prefetch" href="/assets/spring-cloud-ribbon.html-e2d9af9b.js" as="script"><link rel="prefetch" href="/assets/spring-cloud-alibaba-seate.html-37eed2ce.js" as="script"><link rel="prefetch" href="/assets/sentinel-source.html-692a3324.js" as="script"><link rel="prefetch" href="/assets/spring-cloud-sentinel.html-bf9c4618.js" as="script"><link rel="prefetch" href="/assets/git.html-87ad5d64.js" as="script"><link rel="prefetch" href="/assets/gitlab.html-09e004bc.js" as="script"><link rel="prefetch" href="/assets/junit4.html-e113cced.js" as="script"><link rel="prefetch" href="/assets/junit5.html-49a7387c.js" as="script"><link rel="prefetch" href="/assets/maven.html-dfa1482f.js" as="script"><link rel="prefetch" href="/assets/reactor.html-caf126d4.js" as="script"><link rel="prefetch" href="/assets/spring-source-web-init.html-c9794d73.js" as="script"><link rel="prefetch" href="/assets/spring-source-web-listener.html-22512f68.js" as="script"><link rel="prefetch" href="/assets/404.html-f08c28a7.js" as="script"><link rel="prefetch" href="/assets/index.html-e93144aa.js" as="script"><link rel="prefetch" href="/assets/index.html-0d635afd.js" as="script"><link rel="prefetch" href="/assets/index.html-555be4ca.js" as="script"><link rel="prefetch" href="/assets/index.html-89246e48.js" as="script"><link rel="prefetch" href="/assets/index.html-6a96e1d8.js" as="script"><link rel="prefetch" href="/assets/index.html-855b7bae.js" as="script"><link rel="prefetch" href="/assets/index.html-d81ead65.js" as="script"><link rel="prefetch" href="/assets/index.html-703427c5.js" as="script"><link rel="prefetch" href="/assets/index.html-3f2fdf99.js" as="script"><link rel="prefetch" href="/assets/index.html-def5ae53.js" as="script"><link rel="prefetch" href="/assets/index.html-da4568d9.js" as="script"><link rel="prefetch" href="/assets/mermaid.esm.min-bc08675d.js" as="script"><link rel="prefetch" href="/assets/mermaid-mindmap.esm.min-c7b5fd15.js" as="script"><link rel="prefetch" href="/assets/markdown.esm-d92a2fc9.js" as="script"><link rel="prefetch" href="/assets/reveal.esm-e5069ce0.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><div class="theme-container has-toc"><!--[--><!--[--><header class="navbar"><div class="navbar-left"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><a href="/" class="brand"><!----><!----><span class="site-name">Java æˆç¥ä¹‹è·¯</span></a><!--[--><!----><!--]--></div><div class="navbar-center"><!--[--><!----><!--]--><nav class="nav-links"><div class="nav-item hide-in-mobile"><a href="/java/java-overview.html" class="nav-link" aria-label="Java ç¬”è®°"><!---->Java ç¬”è®°<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="Spring ç¬”è®°"><span class="title"><!---->Spring ç¬”è®°</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>Spring IOC</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/spring/test02.html" class="nav-link" aria-label="Spring IOCè¯¦è§£"><!---->Spring IOCè¯¦è§£<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>Spring åç½®å¤„ç†å™¨è§£æ</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/spring/spring-bean-post-processor/BeanPostProcessor-base.html" class="nav-link" aria-label="Spring åç½®å¤„ç†å™¨æ€»è§ˆ"><!---->Spring åç½®å¤„ç†å™¨æ€»è§ˆ<!----></a></li></ul></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="Spring Cloud"><span class="title"><!---->Spring Cloud</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/spring-cloud/spring-cloud-overview.html" class="nav-link" aria-label="Spring Cloud Overview"><!---->Spring Cloud Overview<!----></a></li><li class="dropdown-item"><a href="/spring-cloud/spring-cloud-alibaba-nacos.md" class="nav-link" aria-label="Spring Cloud Nacos"><!---->Spring Cloud Nacos<!----></a></li><li class="dropdown-item"><a href="/spring-cloud/spring-cloud-alibaba-sentinel.md" class="nav-link" aria-label="Spring Cloud Sentinel"><!---->Spring Cloud Sentinel<!----></a></li><li class="dropdown-item"><a href="/spring-cloud/spring-cloud-alibaba-seate.md" class="nav-link" aria-label="Spring Cloud Seate"><!---->Spring Cloud Seate<!----></a></li><li class="dropdown-item"><a href="/spring-cloud/spring-cloud-ribbon/spring-cloud-ribbon.html" class="nav-link" aria-label="Spring Cloud Ribbon"><!---->Spring Cloud Ribbon<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><a href="/database/database-overview.html" class="nav-link" aria-label="æ•°æ®åº“"><!---->æ•°æ®åº“<!----></a></div><div class="nav-item hide-in-mobile"><a href="/quality/quality-overview.html" class="nav-link" aria-label="è‡ªæˆ‘ä¿®å…»"><!---->è‡ªæˆ‘ä¿®å…»<!----></a></div><div class="nav-item hide-in-mobile"><a href="/middleware/middleware-overview.html" class="nav-link" aria-label="ä¸­é—´ä»¶"><!---->ä¸­é—´ä»¶<!----></a></div><div class="nav-item hide-in-mobile"><a href="/tools/tools-overview.html" class="nav-link" aria-label="å·¥å…·åŒ…"><!---->å·¥å…·åŒ…<!----></a></div></nav><!--[--><!----><!--]--></div><div class="navbar-right"><!--[--><!----><!--]--><!----><!----><div class="nav-item hide-in-mobile"><button id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!----><!--[--><!----><!--]--><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><!--[--><a href="/middleware/middleware-overview.html" class="nav-link sidebar-link sidebar-page" aria-label="å¸¸ç”¨å·¥å…·æ€»ç»“"><!---->å¸¸ç”¨å·¥å…·æ€»ç»“<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">Mybatis æ€»ç»“</span><span class="arrow right"></span></button><!----></section></li><li><!--[--><a href="/middleware/shiro/shiro-overview.html" class="nav-link sidebar-link sidebar-page" aria-label="Shiro æ€»ç»“"><!---->Shiro æ€»ç»“<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" aria-label="Sharding-Sphere æ€»ç»“"><!---->Sharding-Sphere æ€»ç»“<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#ç¬¬01ç« -é«˜æ€§èƒ½æ¶æ„æ¨¡å¼" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="ç¬¬01ç«  é«˜æ€§èƒ½æ¶æ„æ¨¡å¼"><!---->ç¬¬01ç«  é«˜æ€§èƒ½æ¶æ„æ¨¡å¼<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#_1ã€è¯»å†™åˆ†ç¦»æ¶æ„" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1ã€è¯»å†™åˆ†ç¦»æ¶æ„"><!---->1ã€è¯»å†™åˆ†ç¦»æ¶æ„<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#_2ã€æ•°æ®åº“åˆ†ç‰‡æ¶æ„" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2ã€æ•°æ®åº“åˆ†ç‰‡æ¶æ„"><!---->2ã€æ•°æ®åº“åˆ†ç‰‡æ¶æ„<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#_3ã€è¯»å†™åˆ†ç¦»å’Œæ•°æ®åˆ†ç‰‡æ¶æ„" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3ã€è¯»å†™åˆ†ç¦»å’Œæ•°æ®åˆ†ç‰‡æ¶æ„"><!---->3ã€è¯»å†™åˆ†ç¦»å’Œæ•°æ®åˆ†ç‰‡æ¶æ„<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#_4ã€å®ç°æ–¹å¼" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="4ã€å®ç°æ–¹å¼"><!---->4ã€å®ç°æ–¹å¼<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#ç¬¬02ç« -shardingsphere" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="ç¬¬02ç«  ShardingSphere"><!---->ç¬¬02ç«  ShardingSphere<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#_1ã€ç®€ä»‹" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1ã€ç®€ä»‹"><!---->1ã€ç®€ä»‹<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#_2ã€shardingsphere-jdbc" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2ã€ShardingSphere-JDBC"><!---->2ã€ShardingSphere-JDBC<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#_3ã€shardingsphere-proxy" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3ã€ShardingSphere-Proxy"><!---->3ã€ShardingSphere-Proxy<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#ç¬¬03ç« -mysqlä¸»ä»åŒæ­¥" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="ç¬¬03ç«  MySQLä¸»ä»åŒæ­¥"><!---->ç¬¬03ç«  MySQLä¸»ä»åŒæ­¥<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#_1ã€mysqlä¸»ä»åŒæ­¥åŸç†" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1ã€MySQLä¸»ä»åŒæ­¥åŸç†"><!---->1ã€MySQLä¸»ä»åŒæ­¥åŸç†<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#_2ã€ä¸€ä¸»å¤šä»é…ç½®" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2ã€ä¸€ä¸»å¤šä»é…ç½®"><!---->2ã€ä¸€ä¸»å¤šä»é…ç½®<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#ç¬¬04ç« -shardingsphere-jdbcè¯»å†™åˆ†ç¦»" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="ç¬¬04ç«  ShardingSphere-JDBCè¯»å†™åˆ†ç¦»"><!---->ç¬¬04ç«  ShardingSphere-JDBCè¯»å†™åˆ†ç¦»<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#_1ã€åˆ›å»ºspringbootç¨‹åº" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1ã€åˆ›å»ºSpringBootç¨‹åº"><!---->1ã€åˆ›å»ºSpringBootç¨‹åº<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#_2ã€æµ‹è¯•" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2ã€æµ‹è¯•"><!---->2ã€æµ‹è¯•<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#ç¬¬05ç« -shardingsphere-jdbcå‚ç›´åˆ†ç‰‡" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="ç¬¬05ç«  ShardingSphere-JDBCå‚ç›´åˆ†ç‰‡"><!---->ç¬¬05ç«  ShardingSphere-JDBCå‚ç›´åˆ†ç‰‡<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#_1ã€å‡†å¤‡æœåŠ¡å™¨" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1ã€å‡†å¤‡æœåŠ¡å™¨"><!---->1ã€å‡†å¤‡æœåŠ¡å™¨<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#_2ã€ç¨‹åºå®ç°" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2ã€ç¨‹åºå®ç°"><!---->2ã€ç¨‹åºå®ç°<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#_3ã€æµ‹è¯•å‚ç›´åˆ†ç‰‡" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3ã€æµ‹è¯•å‚ç›´åˆ†ç‰‡"><!---->3ã€æµ‹è¯•å‚ç›´åˆ†ç‰‡<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#ç¬¬06ç« -shardingsphere-jdbcæ°´å¹³åˆ†ç‰‡" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="ç¬¬06ç«  ShardingSphere-JDBCæ°´å¹³åˆ†ç‰‡"><!---->ç¬¬06ç«  ShardingSphere-JDBCæ°´å¹³åˆ†ç‰‡<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#_1ã€å‡†å¤‡æœåŠ¡å™¨-1" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1ã€å‡†å¤‡æœåŠ¡å™¨"><!---->1ã€å‡†å¤‡æœåŠ¡å™¨<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#_1-2ã€åˆ›å»ºserver-order1å®¹å™¨" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.2ã€åˆ›å»ºserver-order1å®¹å™¨"><!---->1.2ã€åˆ›å»ºserver-order1å®¹å™¨<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#_2ã€åŸºæœ¬æ°´å¹³åˆ†ç‰‡" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2ã€åŸºæœ¬æ°´å¹³åˆ†ç‰‡"><!---->2ã€åŸºæœ¬æ°´å¹³åˆ†ç‰‡<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#_2-4ã€è¡Œè¡¨è¾¾å¼" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.4ã€è¡Œè¡¨è¾¾å¼"><!---->2.4ã€è¡Œè¡¨è¾¾å¼<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#_2-5ã€åˆ†ç‰‡ç®—æ³•é…ç½®" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.5ã€åˆ†ç‰‡ç®—æ³•é…ç½®"><!---->2.5ã€åˆ†ç‰‡ç®—æ³•é…ç½®<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#_2-6ã€åˆ†å¸ƒå¼åºåˆ—ç®—æ³•" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.6ã€åˆ†å¸ƒå¼åºåˆ—ç®—æ³•"><!---->2.6ã€åˆ†å¸ƒå¼åºåˆ—ç®—æ³•<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#_3ã€å¤šè¡¨å…³è”" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3ã€å¤šè¡¨å…³è”"><!---->3ã€å¤šè¡¨å…³è”<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#_4ã€ç»‘å®šè¡¨" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="4ã€ç»‘å®šè¡¨"><!---->4ã€ç»‘å®šè¡¨<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#_5ã€å¹¿æ’­è¡¨" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="5ã€å¹¿æ’­è¡¨"><!---->5ã€å¹¿æ’­è¡¨<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#ç¬¬07ç« -å¯åŠ¨shardingsphere-proxy" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="ç¬¬07ç«  å¯åŠ¨ShardingSphere-Proxy"><!---->ç¬¬07ç«  å¯åŠ¨ShardingSphere-Proxy<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#_1ã€è·å–" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1ã€è·å–"><!---->1ã€è·å–<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#_2ã€ä½¿ç”¨äºŒè¿›åˆ¶å‘å¸ƒåŒ…å®‰è£…" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2ã€ä½¿ç”¨äºŒè¿›åˆ¶å‘å¸ƒåŒ…å®‰è£…"><!---->2ã€ä½¿ç”¨äºŒè¿›åˆ¶å‘å¸ƒåŒ…å®‰è£…<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#_3ã€ä½¿ç”¨dockerå®‰è£…" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3ã€ä½¿ç”¨Dockerå®‰è£…"><!---->3ã€ä½¿ç”¨Dockerå®‰è£…<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#ç¬¬08ç« -shardingsphere-proxyè¯»å†™åˆ†ç¦»" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="ç¬¬08ç«  ShardingSphere-Proxyè¯»å†™åˆ†ç¦»"><!---->ç¬¬08ç«  ShardingSphere-Proxyè¯»å†™åˆ†ç¦»<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#_1ã€ä¿®æ”¹é…ç½®æ–‡ä»¶" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1ã€ä¿®æ”¹é…ç½®æ–‡ä»¶"><!---->1ã€ä¿®æ”¹é…ç½®æ–‡ä»¶<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#_2ã€å®æ—¶æŸ¥çœ‹æ—¥å¿—" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2ã€å®æ—¶æŸ¥çœ‹æ—¥å¿—"><!---->2ã€å®æ—¶æŸ¥çœ‹æ—¥å¿—<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#_3ã€è¿œç¨‹è®¿é—®æµ‹è¯•" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3ã€è¿œç¨‹è®¿é—®æµ‹è¯•"><!---->3ã€è¿œç¨‹è®¿é—®æµ‹è¯•<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#_4ã€åº”ç”¨ç¨‹åºè®¿é—®proxy" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="4ã€åº”ç”¨ç¨‹åºè®¿é—®Proxy"><!---->4ã€åº”ç”¨ç¨‹åºè®¿é—®Proxy<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#ç¬¬09ç« -shardingsphere-proxyå‚ç›´åˆ†ç‰‡" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="ç¬¬09ç«  ShardingSphere-Proxyå‚ç›´åˆ†ç‰‡"><!---->ç¬¬09ç«  ShardingSphere-Proxyå‚ç›´åˆ†ç‰‡<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#_1ã€ä¿®æ”¹é…ç½®æ–‡ä»¶-1" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1ã€ä¿®æ”¹é…ç½®æ–‡ä»¶"><!---->1ã€ä¿®æ”¹é…ç½®æ–‡ä»¶<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#_2ã€å®æ—¶æŸ¥çœ‹æ—¥å¿—-1" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2ã€å®æ—¶æŸ¥çœ‹æ—¥å¿—"><!---->2ã€å®æ—¶æŸ¥çœ‹æ—¥å¿—<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#_3ã€è¿œç¨‹è®¿é—®æµ‹è¯•-1" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3ã€è¿œç¨‹è®¿é—®æµ‹è¯•"><!---->3ã€è¿œç¨‹è®¿é—®æµ‹è¯•<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#ç¬¬10ç« -shardingsphere-proxyæ°´å¹³åˆ†ç‰‡" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="ç¬¬10ç«  ShardingSphere-Proxyæ°´å¹³åˆ†ç‰‡"><!---->ç¬¬10ç«  ShardingSphere-Proxyæ°´å¹³åˆ†ç‰‡<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#_1ã€ä¿®æ”¹é…ç½®æ–‡ä»¶-2" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1ã€ä¿®æ”¹é…ç½®æ–‡ä»¶"><!---->1ã€ä¿®æ”¹é…ç½®æ–‡ä»¶<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#_2ã€å®æ—¶æŸ¥çœ‹æ—¥å¿—-2" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2ã€å®æ—¶æŸ¥çœ‹æ—¥å¿—"><!---->2ã€å®æ—¶æŸ¥çœ‹æ—¥å¿—<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#_3ã€è¿œç¨‹è®¿é—®æµ‹è¯•-2" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3ã€è¿œç¨‹è®¿é—®æµ‹è¯•"><!---->3ã€è¿œç¨‹è®¿é—®æµ‹è¯•<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li></ul><!--]--></li><li><section class="sidebar-group"><p class="sidebar-heading"><!----><span class="title">Tomcat ä¸“é¢˜</span><!----></p><ul class="sidebar-links"><li><!--[--><a href="/middleware/tomcat/tomcat.html" class="nav-link sidebar-link sidebar-page" aria-label="Tomcatä¸“é¢˜"><!---->Tomcatä¸“é¢˜<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="sidebar-group"><p class="sidebar-heading"><!----><span class="title">Kafka ä¸“é¢˜</span><!----></p><ul class="sidebar-links"><li><!--[--><a href="/middleware/kafka/kafka-overview.html" class="nav-link sidebar-link sidebar-page" aria-label="Kafka Overview"><!---->Kafka Overview<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/middleware/kafka/kafka-consumer.html" class="nav-link sidebar-link sidebar-page" aria-label="Kafka Consumer"><!---->Kafka Consumer<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/middleware/kafka/kafka-producer.html" class="nav-link sidebar-link sidebar-page" aria-label="Kafka ç”Ÿäº§è€…"><!---->Kafka ç”Ÿäº§è€…<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/middleware/kafka/kafka-broker.html" class="nav-link sidebar-link sidebar-page" aria-label="Kafka Broker"><!---->Kafka Broker<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/middleware/kafka/spring-kafka.html" class="nav-link sidebar-link sidebar-page" aria-label="Spring Kafka"><!---->Spring Kafka<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="sidebar-group"><p class="sidebar-heading"><!----><span class="title">Redis ä¸“é¢˜</span><!----></p><ul class="sidebar-links"><li><!--[--><a href="/middleware/redis/redis-overview.md" class="nav-link sidebar-link sidebar-page" aria-label="/middleware/redis/redis-overview.md"><!---->/middleware/redis/redis-overview.md<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/middleware/redis/redis-cluster.md" class="nav-link sidebar-link sidebar-page" aria-label="/middleware/redis/redis-cluster.md"><!---->/middleware/redis/redis-cluster.md<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><!--[--><a href="/middleware/log/log-framework.html" class="nav-link sidebar-link sidebar-page" aria-label="æ—¥å¿—çš„ä½¿ç”¨"><!---->æ—¥å¿—çš„ä½¿ç”¨<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/middleware/jackson/jackson-overview.html" class="nav-link sidebar-link sidebar-page" aria-label="Jackson è¯¦è§£"><!---->Jackson è¯¦è§£<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">HikariCP è¯¦è§£</span><span class="arrow right"></span></button><!----></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->Sharding-Sphere</h1><div class="page-info"><!----><!----><span class="date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2022-11-24T11:37:09.000Z"></span><!----><!----><span class="reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 34 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT34M"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><div class="toc-header">æ­¤é¡µå†…å®¹</div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#ç¬¬01ç« -é«˜æ€§èƒ½æ¶æ„æ¨¡å¼" class="router-link-active router-link-exact-active toc-link level2">ç¬¬01ç«  é«˜æ€§èƒ½æ¶æ„æ¨¡å¼</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#_1ã€è¯»å†™åˆ†ç¦»æ¶æ„" class="router-link-active router-link-exact-active toc-link level3">1ã€è¯»å†™åˆ†ç¦»æ¶æ„</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#_2ã€æ•°æ®åº“åˆ†ç‰‡æ¶æ„" class="router-link-active router-link-exact-active toc-link level3">2ã€æ•°æ®åº“åˆ†ç‰‡æ¶æ„</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#_3ã€è¯»å†™åˆ†ç¦»å’Œæ•°æ®åˆ†ç‰‡æ¶æ„" class="router-link-active router-link-exact-active toc-link level3">3ã€è¯»å†™åˆ†ç¦»å’Œæ•°æ®åˆ†ç‰‡æ¶æ„</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#_4ã€å®ç°æ–¹å¼" class="router-link-active router-link-exact-active toc-link level3">4ã€å®ç°æ–¹å¼</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#ç¬¬02ç« -shardingsphere" class="router-link-active router-link-exact-active toc-link level2">ç¬¬02ç«  ShardingSphere</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#_1ã€ç®€ä»‹" class="router-link-active router-link-exact-active toc-link level3">1ã€ç®€ä»‹</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#_2ã€shardingsphere-jdbc" class="router-link-active router-link-exact-active toc-link level3">2ã€ShardingSphere-JDBC</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#_3ã€shardingsphere-proxy" class="router-link-active router-link-exact-active toc-link level3">3ã€ShardingSphere-Proxy</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#ç¬¬03ç« -mysqlä¸»ä»åŒæ­¥" class="router-link-active router-link-exact-active toc-link level2">ç¬¬03ç«  MySQLä¸»ä»åŒæ­¥</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#_1ã€mysqlä¸»ä»åŒæ­¥åŸç†" class="router-link-active router-link-exact-active toc-link level3">1ã€MySQLä¸»ä»åŒæ­¥åŸç†</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#_2ã€ä¸€ä¸»å¤šä»é…ç½®" class="router-link-active router-link-exact-active toc-link level3">2ã€ä¸€ä¸»å¤šä»é…ç½®</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#ç¬¬04ç« -shardingsphere-jdbcè¯»å†™åˆ†ç¦»" class="router-link-active router-link-exact-active toc-link level2">ç¬¬04ç«  ShardingSphere-JDBCè¯»å†™åˆ†ç¦»</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#_1ã€åˆ›å»ºspringbootç¨‹åº" class="router-link-active router-link-exact-active toc-link level3">1ã€åˆ›å»ºSpringBootç¨‹åº</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#_2ã€æµ‹è¯•" class="router-link-active router-link-exact-active toc-link level3">2ã€æµ‹è¯•</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#ç¬¬05ç« -shardingsphere-jdbcå‚ç›´åˆ†ç‰‡" class="router-link-active router-link-exact-active toc-link level2">ç¬¬05ç«  ShardingSphere-JDBCå‚ç›´åˆ†ç‰‡</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#_1ã€å‡†å¤‡æœåŠ¡å™¨" class="router-link-active router-link-exact-active toc-link level3">1ã€å‡†å¤‡æœåŠ¡å™¨</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#_2ã€ç¨‹åºå®ç°" class="router-link-active router-link-exact-active toc-link level3">2ã€ç¨‹åºå®ç°</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#_3ã€æµ‹è¯•å‚ç›´åˆ†ç‰‡" class="router-link-active router-link-exact-active toc-link level3">3ã€æµ‹è¯•å‚ç›´åˆ†ç‰‡</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#ç¬¬06ç« -shardingsphere-jdbcæ°´å¹³åˆ†ç‰‡" class="router-link-active router-link-exact-active toc-link level2">ç¬¬06ç«  ShardingSphere-JDBCæ°´å¹³åˆ†ç‰‡</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#_1ã€å‡†å¤‡æœåŠ¡å™¨-1" class="router-link-active router-link-exact-active toc-link level3">1ã€å‡†å¤‡æœåŠ¡å™¨</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#_1-2ã€åˆ›å»ºserver-order1å®¹å™¨" class="router-link-active router-link-exact-active toc-link level3">1.2ã€åˆ›å»ºserver-order1å®¹å™¨</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#_2ã€åŸºæœ¬æ°´å¹³åˆ†ç‰‡" class="router-link-active router-link-exact-active toc-link level3">2ã€åŸºæœ¬æ°´å¹³åˆ†ç‰‡</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#_2-4ã€è¡Œè¡¨è¾¾å¼" class="router-link-active router-link-exact-active toc-link level3">2.4ã€è¡Œè¡¨è¾¾å¼</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#_2-5ã€åˆ†ç‰‡ç®—æ³•é…ç½®" class="router-link-active router-link-exact-active toc-link level3">2.5ã€åˆ†ç‰‡ç®—æ³•é…ç½®</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#_2-6ã€åˆ†å¸ƒå¼åºåˆ—ç®—æ³•" class="router-link-active router-link-exact-active toc-link level3">2.6ã€åˆ†å¸ƒå¼åºåˆ—ç®—æ³•</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#_3ã€å¤šè¡¨å…³è”" class="router-link-active router-link-exact-active toc-link level3">3ã€å¤šè¡¨å…³è”</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#_4ã€ç»‘å®šè¡¨" class="router-link-active router-link-exact-active toc-link level3">4ã€ç»‘å®šè¡¨</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#_5ã€å¹¿æ’­è¡¨" class="router-link-active router-link-exact-active toc-link level3">5ã€å¹¿æ’­è¡¨</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#ç¬¬07ç« -å¯åŠ¨shardingsphere-proxy" class="router-link-active router-link-exact-active toc-link level2">ç¬¬07ç«  å¯åŠ¨ShardingSphere-Proxy</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#_1ã€è·å–" class="router-link-active router-link-exact-active toc-link level3">1ã€è·å–</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#_2ã€ä½¿ç”¨äºŒè¿›åˆ¶å‘å¸ƒåŒ…å®‰è£…" class="router-link-active router-link-exact-active toc-link level3">2ã€ä½¿ç”¨äºŒè¿›åˆ¶å‘å¸ƒåŒ…å®‰è£…</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#_3ã€ä½¿ç”¨dockerå®‰è£…" class="router-link-active router-link-exact-active toc-link level3">3ã€ä½¿ç”¨Dockerå®‰è£…</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#ç¬¬08ç« -shardingsphere-proxyè¯»å†™åˆ†ç¦»" class="router-link-active router-link-exact-active toc-link level2">ç¬¬08ç«  ShardingSphere-Proxyè¯»å†™åˆ†ç¦»</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#_1ã€ä¿®æ”¹é…ç½®æ–‡ä»¶" class="router-link-active router-link-exact-active toc-link level3">1ã€ä¿®æ”¹é…ç½®æ–‡ä»¶</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#_2ã€å®æ—¶æŸ¥çœ‹æ—¥å¿—" class="router-link-active router-link-exact-active toc-link level3">2ã€å®æ—¶æŸ¥çœ‹æ—¥å¿—</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#_3ã€è¿œç¨‹è®¿é—®æµ‹è¯•" class="router-link-active router-link-exact-active toc-link level3">3ã€è¿œç¨‹è®¿é—®æµ‹è¯•</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#_4ã€åº”ç”¨ç¨‹åºè®¿é—®proxy" class="router-link-active router-link-exact-active toc-link level3">4ã€åº”ç”¨ç¨‹åºè®¿é—®Proxy</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#ç¬¬09ç« -shardingsphere-proxyå‚ç›´åˆ†ç‰‡" class="router-link-active router-link-exact-active toc-link level2">ç¬¬09ç«  ShardingSphere-Proxyå‚ç›´åˆ†ç‰‡</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#_1ã€ä¿®æ”¹é…ç½®æ–‡ä»¶-1" class="router-link-active router-link-exact-active toc-link level3">1ã€ä¿®æ”¹é…ç½®æ–‡ä»¶</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#_2ã€å®æ—¶æŸ¥çœ‹æ—¥å¿—-1" class="router-link-active router-link-exact-active toc-link level3">2ã€å®æ—¶æŸ¥çœ‹æ—¥å¿—</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#_3ã€è¿œç¨‹è®¿é—®æµ‹è¯•-1" class="router-link-active router-link-exact-active toc-link level3">3ã€è¿œç¨‹è®¿é—®æµ‹è¯•</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#ç¬¬10ç« -shardingsphere-proxyæ°´å¹³åˆ†ç‰‡" class="router-link-active router-link-exact-active toc-link level2">ç¬¬10ç«  ShardingSphere-Proxyæ°´å¹³åˆ†ç‰‡</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#_1ã€ä¿®æ”¹é…ç½®æ–‡ä»¶-2" class="router-link-active router-link-exact-active toc-link level3">1ã€ä¿®æ”¹é…ç½®æ–‡ä»¶</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#_2ã€å®æ—¶æŸ¥çœ‹æ—¥å¿—-2" class="router-link-active router-link-exact-active toc-link level3">2ã€å®æ—¶æŸ¥çœ‹æ—¥å¿—</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/middleware/sharding-sphere/sharding-sphere.html#_3ã€è¿œç¨‹è®¿é—®æµ‹è¯•-2" class="router-link-active router-link-exact-active toc-link level3">3ã€è¿œç¨‹è®¿é—®æµ‹è¯•</a></li><!----><!--]--></ul><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><h1 id="sharding-sphere" tabindex="-1"><a class="header-anchor" href="#sharding-sphere" aria-hidden="true">#</a> Sharding-Sphere</h1><h2 id="ç¬¬01ç« -é«˜æ€§èƒ½æ¶æ„æ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#ç¬¬01ç« -é«˜æ€§èƒ½æ¶æ„æ¨¡å¼" aria-hidden="true">#</a> ç¬¬01ç«  é«˜æ€§èƒ½æ¶æ„æ¨¡å¼</h2><p>äº’è”ç½‘ä¸šåŠ¡å…´èµ·ä¹‹åï¼Œæµ·é‡ç”¨æˆ·åŠ ä¸Šæµ·é‡æ•°æ®çš„ç‰¹ç‚¹ï¼Œå•ä¸ªæ•°æ®åº“æœåŠ¡å™¨å·²ç»éš¾ä»¥æ»¡è¶³ä¸šåŠ¡éœ€è¦ï¼Œå¿…é¡»è€ƒè™‘æ•°æ®åº“é›†ç¾¤çš„æ–¹å¼æ¥æå‡æ€§èƒ½ã€‚é«˜æ€§èƒ½æ•°æ®åº“é›†ç¾¤çš„<code>ç¬¬ä¸€ç§æ–¹å¼æ˜¯â€œè¯»å†™åˆ†ç¦»â€</code>ï¼Œ<code>ç¬¬äºŒç§æ–¹å¼æ˜¯â€œæ•°æ®åº“åˆ†ç‰‡â€</code>ã€‚</p><h3 id="_1ã€è¯»å†™åˆ†ç¦»æ¶æ„" tabindex="-1"><a class="header-anchor" href="#_1ã€è¯»å†™åˆ†ç¦»æ¶æ„" aria-hidden="true">#</a> 1ã€è¯»å†™åˆ†ç¦»æ¶æ„</h3><p>**è¯»å†™åˆ†ç¦»åŸç†ï¼š**è¯»å†™åˆ†ç¦»çš„åŸºæœ¬åŸç†æ˜¯å°†æ•°æ®åº“è¯»å†™æ“ä½œåˆ†æ•£åˆ°ä¸åŒçš„èŠ‚ç‚¹ä¸Šï¼Œä¸‹é¢æ˜¯å…¶åŸºæœ¬æ¶æ„å›¾ï¼š</p><p><img src="/assets/362d22168bf344687ec0c206aa115807-844a4732.jpg" alt="img"></p><p><strong>è¯»å†™åˆ†ç¦»çš„åŸºæœ¬å®ç°ï¼š</strong></p><ul><li><code>ä¸»åº“è´Ÿè´£å¤„ç†äº‹åŠ¡æ€§çš„å¢åˆ æ”¹æ“ä½œï¼Œä»åº“è´Ÿè´£å¤„ç†æŸ¥è¯¢æ“ä½œ</code>ï¼Œèƒ½å¤Ÿæœ‰æ•ˆçš„é¿å…ç”±æ•°æ®æ›´æ–°å¯¼è‡´çš„è¡Œé”ï¼Œä½¿å¾—æ•´ä¸ªç³»ç»Ÿçš„æŸ¥è¯¢æ€§èƒ½å¾—åˆ°æå¤§çš„æ”¹å–„ã€‚</li><li>è¯»å†™åˆ†ç¦»æ˜¯<code>æ ¹æ® SQL è¯­ä¹‰çš„åˆ†æ</code>ï¼Œ<code>å°†è¯»æ“ä½œå’Œå†™æ“ä½œåˆ†åˆ«è·¯ç”±è‡³ä¸»åº“ä¸ä»åº“</code>ã€‚</li><li>é€šè¿‡<code>ä¸€ä¸»å¤šä»</code>çš„é…ç½®æ–¹å¼ï¼Œå¯ä»¥å°†æŸ¥è¯¢è¯·æ±‚å‡åŒ€çš„åˆ†æ•£åˆ°å¤šä¸ªæ•°æ®å‰¯æœ¬ï¼Œèƒ½å¤Ÿè¿›ä¸€æ­¥çš„æå‡ç³»ç»Ÿçš„å¤„ç†èƒ½åŠ›ã€‚</li><li>ä½¿ç”¨<code>å¤šä¸»å¤šä»</code>çš„æ–¹å¼ï¼Œä¸ä½†èƒ½å¤Ÿæå‡ç³»ç»Ÿçš„ååé‡ï¼Œè¿˜èƒ½å¤Ÿæå‡ç³»ç»Ÿçš„å¯ç”¨æ€§ï¼Œå¯ä»¥è¾¾åˆ°åœ¨ä»»ä½•ä¸€ä¸ªæ•°æ®åº“å®•æœºï¼Œç”šè‡³ç£ç›˜ç‰©ç†æŸåçš„æƒ…å†µä¸‹ä»ç„¶ä¸å½±å“ç³»ç»Ÿçš„æ­£å¸¸è¿è¡Œã€‚</li></ul><p><strong>ä¸‹å›¾å±•ç¤ºäº†æ ¹æ®ä¸šåŠ¡éœ€è¦ï¼Œå°†ç”¨æˆ·è¡¨çš„å†™æ“ä½œå’Œè¯»æ“è·¯ç”±åˆ°ä¸åŒçš„æ•°æ®åº“çš„æ–¹æ¡ˆï¼š</strong></p><p><img src="/assets/image-20220804223138651-d4a51eb7.png" alt="image-20220804223138651"></p><p><strong>CAP ç†è®ºï¼š</strong></p><p>CAP å®šç†ï¼ˆCAP theoremï¼‰åˆè¢«ç§°ä½œå¸ƒé²å°”å®šç†ï¼ˆBrewer&#39;s theoremï¼‰ï¼Œæ˜¯åŠ å·å¤§å­¦ä¼¯å…‹åˆ©åˆ†æ ¡çš„è®¡ç®—æœºç§‘å­¦å®¶åŸƒé‡Œå…‹Â·å¸ƒé²å°”ï¼ˆEric Brewerï¼‰åœ¨ 2000 å¹´çš„ ACM PODC ä¸Šæå‡ºçš„ä¸€ä¸ªçŒœæƒ³ã€‚<code>å¯¹äºè®¾è®¡åˆ†å¸ƒå¼ç³»ç»Ÿçš„æ¶æ„å¸ˆæ¥è¯´ï¼ŒCAP æ˜¯å¿…é¡»æŒæ¡çš„ç†è®ºã€‚</code></p><p>åœ¨ä¸€ä¸ª<code>åˆ†å¸ƒå¼ç³»ç»Ÿä¸­</code>ï¼Œå½“æ¶‰åŠè¯»å†™æ“ä½œæ—¶ï¼Œåªèƒ½ä¿è¯ä¸€è‡´æ€§ï¼ˆConsistenceï¼‰ã€å¯ç”¨æ€§ï¼ˆAvailabilityï¼‰ã€åˆ†åŒºå®¹é”™æ€§ï¼ˆPartition Toleranceï¼‰ä¸‰è€…ä¸­çš„ä¸¤ä¸ªï¼Œå¦å¤–ä¸€ä¸ªå¿…é¡»è¢«ç‰ºç‰²ã€‚</p><ul><li>C ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ï¼šå¯¹æŸä¸ªæŒ‡å®šçš„å®¢æˆ·ç«¯æ¥è¯´ï¼Œè¯»æ“ä½œä¿è¯èƒ½å¤Ÿè¿”å›æœ€æ–°çš„å†™æ“ä½œç»“æœ</li><li>A å¯ç”¨æ€§ï¼ˆAvailabilityï¼‰ï¼šéæ•…éšœçš„èŠ‚ç‚¹åœ¨åˆç†çš„æ—¶é—´å†…è¿”å›åˆç†çš„å“åº”<code>ï¼ˆä¸æ˜¯é”™è¯¯å’Œè¶…æ—¶çš„å“åº”ï¼‰</code></li><li>P åˆ†åŒºå®¹å¿æ€§ï¼ˆPartition Toleranceï¼‰ï¼šå½“å‡ºç°ç½‘ç»œåˆ†åŒºå<code>ï¼ˆå¯èƒ½æ˜¯ä¸¢åŒ…ï¼Œä¹Ÿå¯èƒ½æ˜¯è¿æ¥ä¸­æ–­ï¼Œè¿˜å¯èƒ½æ˜¯æ‹¥å¡ï¼‰</code>ï¼Œç³»ç»Ÿèƒ½å¤Ÿç»§ç»­â€œå±¥è¡ŒèŒè´£â€</li></ul><p><strong>CAPç‰¹ç‚¹ï¼š</strong></p><ul><li><p>åœ¨å®é™…è®¾è®¡è¿‡ç¨‹ä¸­ï¼Œæ¯ä¸ªç³»ç»Ÿä¸å¯èƒ½åªå¤„ç†ä¸€ç§æ•°æ®ï¼Œè€Œæ˜¯åŒ…å«å¤šç§ç±»å‹çš„æ•°æ®ï¼Œ<code>æœ‰çš„æ•°æ®å¿…é¡»é€‰æ‹© CPï¼Œæœ‰çš„æ•°æ®å¿…é¡»é€‰æ‹© APï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿç†è®ºä¸Šä¸å¯èƒ½é€‰æ‹© CA æ¶æ„ã€‚</code></p><ul><li>CPï¼šå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œ<code>ä¸ºäº†ä¿è¯ä¸€è‡´æ€§</code>ï¼Œå½“å‘ç”Ÿåˆ†åŒºç°è±¡åï¼ŒN1 èŠ‚ç‚¹ä¸Šçš„æ•°æ®å·²ç»æ›´æ–°åˆ° yï¼Œä½†ç”±äº N1 å’Œ N2 ä¹‹é—´çš„å¤åˆ¶é€šé“ä¸­æ–­ï¼Œæ•°æ® y æ— æ³•åŒæ­¥åˆ° N2ï¼ŒN2 èŠ‚ç‚¹ä¸Šçš„æ•°æ®è¿˜æ˜¯ xã€‚<code>è¿™æ—¶å®¢æˆ·ç«¯ C è®¿é—® N2 æ—¶ï¼ŒN2 éœ€è¦è¿”å› Errorï¼Œæç¤ºå®¢æˆ·ç«¯ Câ€œç³»ç»Ÿç°åœ¨å‘ç”Ÿäº†é”™è¯¯â€ï¼Œ</code>è¿™ç§å¤„ç†æ–¹å¼<code>è¿èƒŒäº†å¯ç”¨æ€§</code>ï¼ˆAvailabilityï¼‰çš„è¦æ±‚ï¼Œå› æ­¤ CAP ä¸‰è€…åªèƒ½æ»¡è¶³ CPã€‚</li></ul><p><img src="/assets/6e7d7bd54d7a4eb67918080863d354d7-d9e56280.png" alt="img"></p><ul><li>APï¼šå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œ<code>ä¸ºäº†ä¿è¯å¯ç”¨æ€§</code>ï¼Œå½“å‘ç”Ÿåˆ†åŒºç°è±¡åï¼ŒN1 èŠ‚ç‚¹ä¸Šçš„æ•°æ®å·²ç»æ›´æ–°åˆ° yï¼Œä½†ç”±äº N1 å’Œ N2 ä¹‹é—´çš„å¤åˆ¶é€šé“ä¸­æ–­ï¼Œæ•°æ® y æ— æ³•åŒæ­¥åˆ° N2ï¼ŒN2 èŠ‚ç‚¹ä¸Šçš„æ•°æ®è¿˜æ˜¯ xã€‚<code>è¿™æ—¶å®¢æˆ·ç«¯ C è®¿é—® N2 æ—¶ï¼ŒN2 å°†å½“å‰è‡ªå·±æ‹¥æœ‰çš„æ•°æ® x è¿”å›ç»™å®¢æˆ·ç«¯ C äº†</code>ï¼Œè€Œå®é™…ä¸Šå½“å‰æœ€æ–°çš„æ•°æ®å·²ç»æ˜¯ y äº†ï¼Œè¿™å°±<code>ä¸æ»¡è¶³ä¸€è‡´æ€§</code>ï¼ˆConsistencyï¼‰çš„è¦æ±‚äº†ï¼Œå› æ­¤ CAP ä¸‰è€…åªèƒ½æ»¡è¶³ APã€‚æ³¨æ„ï¼šè¿™é‡Œ N2 èŠ‚ç‚¹è¿”å› xï¼Œè™½ç„¶ä¸æ˜¯ä¸€ä¸ªâ€œæ­£ç¡®â€çš„ç»“æœï¼Œä½†æ˜¯ä¸€ä¸ªâ€œåˆç†â€çš„ç»“æœï¼Œå› ä¸º x æ˜¯æ—§çš„æ•°æ®ï¼Œå¹¶ä¸æ˜¯ä¸€ä¸ªé”™ä¹±çš„å€¼ï¼Œåªæ˜¯ä¸æ˜¯æœ€æ–°çš„æ•°æ®è€Œå·²ã€‚</li></ul></li></ul><p><img src="/assets/2ccafe41de9bd7f8dec4658f004310d6-7489f071.png" alt="img"></p><ul><li><p>CAP ç†è®ºä¸­çš„ <code>C åœ¨å®è·µä¸­æ˜¯ä¸å¯èƒ½å®Œç¾å®ç°çš„</code>ï¼Œåœ¨æ•°æ®å¤åˆ¶çš„è¿‡ç¨‹ä¸­ï¼ŒèŠ‚ç‚¹N1 å’ŒèŠ‚ç‚¹ N2 çš„æ•°æ®å¹¶ä¸ä¸€è‡´ï¼ˆå¼ºä¸€è‡´æ€§ï¼‰ã€‚å³ä½¿æ— æ³•åšåˆ°<code>å¼ºä¸€è‡´æ€§</code>ï¼Œä½†åº”ç”¨å¯ä»¥é‡‡ç”¨é€‚åˆçš„æ–¹å¼è¾¾åˆ°<code>æœ€ç»ˆä¸€è‡´æ€§</code>ã€‚å…·æœ‰å¦‚ä¸‹ç‰¹ç‚¹ï¼š</p><ul><li>åŸºæœ¬å¯ç”¨ï¼ˆBasically Availableï¼‰ï¼šåˆ†å¸ƒå¼ç³»ç»Ÿåœ¨å‡ºç°æ•…éšœæ—¶ï¼Œå…è®¸æŸå¤±éƒ¨åˆ†å¯ç”¨æ€§ï¼Œå³ä¿è¯æ ¸å¿ƒå¯ç”¨ã€‚</li><li>è½¯çŠ¶æ€ï¼ˆSoft Stateï¼‰ï¼šå…è®¸ç³»ç»Ÿå­˜åœ¨ä¸­é—´çŠ¶æ€ï¼Œè€Œè¯¥ä¸­é—´çŠ¶æ€ä¸ä¼šå½±å“ç³»ç»Ÿæ•´ä½“å¯ç”¨æ€§ã€‚è¿™é‡Œçš„ä¸­é—´çŠ¶æ€å°±æ˜¯ CAP ç†è®ºä¸­çš„æ•°æ®ä¸ä¸€è‡´ã€‚</li><li><code>æœ€ç»ˆä¸€è‡´æ€§ï¼ˆEventual Consistencyï¼‰ï¼šç³»ç»Ÿä¸­çš„æ‰€æœ‰æ•°æ®å‰¯æœ¬ç»è¿‡ä¸€å®šæ—¶é—´åï¼Œæœ€ç»ˆèƒ½å¤Ÿè¾¾åˆ°ä¸€è‡´çš„çŠ¶æ€ã€‚</code></li></ul></li></ul><h3 id="_2ã€æ•°æ®åº“åˆ†ç‰‡æ¶æ„" tabindex="-1"><a class="header-anchor" href="#_2ã€æ•°æ®åº“åˆ†ç‰‡æ¶æ„" aria-hidden="true">#</a> 2ã€æ•°æ®åº“åˆ†ç‰‡æ¶æ„</h3><p><strong>è¯»å†™åˆ†ç¦»çš„é—®é¢˜ï¼š</strong></p><p>è¯»å†™åˆ†ç¦»åˆ†æ•£äº†æ•°æ®åº“è¯»å†™æ“ä½œçš„å‹åŠ›ï¼Œä½†æ²¡æœ‰åˆ†æ•£å­˜å‚¨å‹åŠ›ï¼Œä¸ºäº†æ»¡è¶³ä¸šåŠ¡æ•°æ®å­˜å‚¨çš„éœ€æ±‚ï¼Œå°±éœ€è¦<code>å°†å­˜å‚¨åˆ†æ•£åˆ°å¤šå°æ•°æ®åº“æœåŠ¡å™¨ä¸Š</code>ã€‚</p><p><strong>æ•°æ®åˆ†ç‰‡ï¼š</strong></p><p>å°†å­˜æ”¾åœ¨å•ä¸€æ•°æ®åº“ä¸­çš„æ•°æ®åˆ†æ•£åœ°å­˜æ”¾è‡³å¤šä¸ªæ•°æ®åº“æˆ–è¡¨ä¸­ï¼Œä»¥è¾¾åˆ°æå‡æ€§èƒ½ç“¶é¢ˆä»¥åŠå¯ç”¨æ€§çš„æ•ˆæœã€‚ æ•°æ®åˆ†ç‰‡çš„æœ‰æ•ˆæ‰‹æ®µæ˜¯å¯¹å…³ç³»å‹æ•°æ®åº“è¿›è¡Œ<code>åˆ†åº“å’Œåˆ†è¡¨</code>ã€‚æ•°æ®åˆ†ç‰‡çš„æ‹†åˆ†æ–¹å¼åˆåˆ†ä¸º<code>å‚ç›´åˆ†ç‰‡å’Œæ°´å¹³åˆ†ç‰‡</code>ã€‚</p><h4 id="_2-1ã€å‚ç›´åˆ†ç‰‡" tabindex="-1"><a class="header-anchor" href="#_2-1ã€å‚ç›´åˆ†ç‰‡" aria-hidden="true">#</a> 2.1ã€å‚ç›´åˆ†ç‰‡</h4><p><strong>å‚ç›´åˆ†åº“ï¼š</strong></p><p><code>æŒ‰ç…§ä¸šåŠ¡æ‹†åˆ†çš„æ–¹å¼ç§°ä¸ºå‚ç›´åˆ†ç‰‡ï¼Œåˆç§°ä¸ºçºµå‘æ‹†åˆ†</code>ï¼Œå®ƒçš„æ ¸å¿ƒç†å¿µæ˜¯ä¸“åº“ä¸“ç”¨ã€‚ åœ¨æ‹†åˆ†ä¹‹å‰ï¼Œä¸€ä¸ªæ•°æ®åº“ç”±å¤šä¸ªæ•°æ®è¡¨æ„æˆï¼Œæ¯ä¸ªè¡¨å¯¹åº”ç€ä¸åŒçš„ä¸šåŠ¡ã€‚è€Œæ‹†åˆ†ä¹‹åï¼Œåˆ™æ˜¯æŒ‰ç…§ä¸šåŠ¡å°†è¡¨è¿›è¡Œå½’ç±»ï¼Œåˆ†å¸ƒåˆ°ä¸åŒçš„æ•°æ®åº“ä¸­ï¼Œä»è€Œå°†å‹åŠ›åˆ†æ•£è‡³ä¸åŒçš„æ•°æ®åº“ã€‚</p><p><img src="/assets/71f41d46cc5c0405f4d4dc944b4350c9-32068474.jpg" alt="img"></p><p>ä¸‹å›¾å±•ç¤ºäº†æ ¹æ®ä¸šåŠ¡éœ€è¦ï¼Œå°†ç”¨æˆ·è¡¨å’Œè®¢å•è¡¨å‚ç›´åˆ†ç‰‡åˆ°ä¸åŒçš„æ•°æ®åº“çš„æ–¹æ¡ˆï¼š</p><p><img src="/assets/image-20220804221855449-e997b714.png" alt="image-20220804221855449"></p><p>å‚ç›´æ‹†åˆ†å¯ä»¥ç¼“è§£æ•°æ®é‡å’Œè®¿é—®é‡å¸¦æ¥çš„é—®é¢˜ï¼Œä½†æ— æ³•æ ¹æ²»ã€‚<code>å¦‚æœå‚ç›´æ‹†åˆ†ä¹‹åï¼Œè¡¨ä¸­çš„æ•°æ®é‡ä¾ç„¶è¶…è¿‡å•èŠ‚ç‚¹æ‰€èƒ½æ‰¿è½½çš„é˜ˆå€¼ï¼Œåˆ™éœ€è¦æ°´å¹³åˆ†ç‰‡æ¥è¿›ä¸€æ­¥å¤„ç†ã€‚</code></p><p><strong>å‚ç›´åˆ†è¡¨ï¼š</strong></p><p><code>å‚ç›´åˆ†è¡¨é€‚åˆå°†è¡¨ä¸­æŸäº›ä¸å¸¸ç”¨çš„åˆ—ï¼Œæˆ–è€…æ˜¯å äº†å¤§é‡ç©ºé—´çš„åˆ—æ‹†åˆ†å‡ºå»ã€‚</code></p><p>å‡è®¾æˆ‘ä»¬æ˜¯ä¸€ä¸ªå©šæ‹ç½‘ç«™ï¼Œç”¨æˆ·åœ¨ç­›é€‰å…¶ä»–ç”¨æˆ·çš„æ—¶å€™ï¼Œä¸»è¦æ˜¯ç”¨ age å’Œ sex ä¸¤ä¸ªå­—æ®µè¿›è¡ŒæŸ¥è¯¢ï¼Œè€Œ nickname å’Œ description ä¸¤ä¸ªå­—æ®µä¸»è¦ç”¨äºå±•ç¤ºï¼Œä¸€èˆ¬ä¸ä¼šåœ¨ä¸šåŠ¡æŸ¥è¯¢ä¸­ç”¨åˆ°ã€‚description æœ¬èº«åˆæ¯”è¾ƒé•¿ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å°†è¿™ä¸¤ä¸ªå­—æ®µç‹¬ç«‹åˆ°å¦å¤–ä¸€å¼ è¡¨ä¸­ï¼Œè¿™æ ·åœ¨æŸ¥è¯¢ age å’Œ sex æ—¶ï¼Œå°±èƒ½å¸¦æ¥ä¸€å®šçš„æ€§èƒ½æå‡ã€‚</p><p>å‚ç›´åˆ†è¡¨å¼•å…¥çš„å¤æ‚æ€§ä¸»è¦ä½“ç°åœ¨è¡¨æ“ä½œçš„æ•°é‡è¦å¢åŠ ã€‚ä¾‹å¦‚ï¼ŒåŸæ¥åªè¦ä¸€æ¬¡æŸ¥è¯¢å°±å¯ä»¥è·å– nameã€ageã€sexã€nicknameã€descriptionï¼Œç°åœ¨éœ€è¦ä¸¤æ¬¡æŸ¥è¯¢ï¼Œä¸€æ¬¡æŸ¥è¯¢è·å– nameã€ageã€sexï¼Œå¦å¤–ä¸€æ¬¡æŸ¥è¯¢è·å– nicknameã€descriptionã€‚</p><p><img src="/assets/136bc2f01919edcb8271df6f7e71af40-48c6c6a1.jpg" alt="img"></p><p><code>æ°´å¹³åˆ†è¡¨é€‚åˆè¡¨è¡Œæ•°ç‰¹åˆ«å¤§çš„è¡¨ï¼Œæ°´å¹³åˆ†è¡¨å±äºæ°´å¹³åˆ†ç‰‡</code>ã€‚</p><h4 id="_2-2ã€æ°´å¹³åˆ†ç‰‡" tabindex="-1"><a class="header-anchor" href="#_2-2ã€æ°´å¹³åˆ†ç‰‡" aria-hidden="true">#</a> 2.2ã€æ°´å¹³åˆ†ç‰‡</h4><p><code>æ°´å¹³åˆ†ç‰‡åˆç§°ä¸ºæ¨ªå‘æ‹†åˆ†ã€‚</code> ç›¸å¯¹äºå‚ç›´åˆ†ç‰‡ï¼Œå®ƒä¸å†å°†æ•°æ®æ ¹æ®ä¸šåŠ¡é€»è¾‘åˆ†ç±»ï¼Œè€Œæ˜¯é€šè¿‡æŸä¸ªå­—æ®µï¼ˆæˆ–æŸå‡ ä¸ªå­—æ®µï¼‰ï¼Œæ ¹æ®æŸç§è§„åˆ™å°†æ•°æ®åˆ†æ•£è‡³å¤šä¸ªåº“æˆ–è¡¨ä¸­ï¼Œæ¯ä¸ªåˆ†ç‰‡ä»…åŒ…å«æ•°æ®çš„ä¸€éƒ¨åˆ†ã€‚ ä¾‹å¦‚ï¼šæ ¹æ®ä¸»é”®åˆ†ç‰‡ï¼Œå¶æ•°ä¸»é”®çš„è®°å½•æ”¾å…¥ 0 åº“ï¼ˆæˆ–è¡¨ï¼‰ï¼Œå¥‡æ•°ä¸»é”®çš„è®°å½•æ”¾å…¥ 1 åº“ï¼ˆæˆ–è¡¨ï¼‰ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src="/assets/image-20220804222212087-650991ff.png" alt="image-20220804222212087"></p><p><code>å•è¡¨è¿›è¡Œåˆ‡åˆ†åï¼Œæ˜¯å¦å°†å¤šä¸ªè¡¨åˆ†æ•£åœ¨ä¸åŒçš„æ•°æ®åº“æœåŠ¡å™¨ä¸­ï¼Œå¯ä»¥æ ¹æ®å®é™…çš„åˆ‡åˆ†æ•ˆæœæ¥ç¡®å®šã€‚</code></p><ul><li><p>**æ°´å¹³åˆ†è¡¨ï¼š**å•è¡¨åˆ‡åˆ†ä¸ºå¤šè¡¨åï¼Œæ–°çš„è¡¨å³ä½¿åœ¨åŒä¸€ä¸ªæ•°æ®åº“æœåŠ¡å™¨ä¸­ï¼Œä¹Ÿå¯èƒ½å¸¦æ¥å¯è§‚çš„æ€§èƒ½æå‡ï¼Œå¦‚æœæ€§èƒ½èƒ½å¤Ÿæ»¡è¶³ä¸šåŠ¡è¦æ±‚ï¼Œå¯ä»¥ä¸æ‹†åˆ†åˆ°å¤šå°æ•°æ®åº“æœåŠ¡å™¨ï¼Œæ¯•ç«Ÿä¸šåŠ¡åˆ†åº“ä¹Ÿä¼šå¼•å…¥å¾ˆå¤šå¤æ‚æ€§ï¼›</p></li><li><p>**æ°´å¹³åˆ†åº“ï¼š**å¦‚æœå•è¡¨æ‹†åˆ†ä¸ºå¤šè¡¨åï¼Œå•å°æœåŠ¡å™¨ä¾ç„¶æ— æ³•æ»¡è¶³æ€§èƒ½è¦æ±‚ï¼Œé‚£å°±éœ€è¦å°†å¤šä¸ªè¡¨åˆ†æ•£åœ¨ä¸åŒçš„æ•°æ®åº“æœåŠ¡å™¨ä¸­ã€‚</p></li></ul><blockquote><p><strong>é˜¿é‡Œå·´å·´Javaå¼€å‘æ‰‹å†Œï¼š</strong></p><p>ã€æ¨èã€‘å•è¡¨è¡Œæ•°è¶…è¿‡ 500 ä¸‡è¡Œæˆ–è€…å•è¡¨å®¹é‡è¶…è¿‡ 2GBï¼Œæ‰æ¨èè¿›è¡Œåˆ†åº“åˆ†è¡¨ã€‚</p><p>è¯´æ˜ï¼šå¦‚æœé¢„è®¡ä¸‰å¹´åçš„æ•°æ®é‡æ ¹æœ¬è¾¾ä¸åˆ°è¿™ä¸ªçº§åˆ«ï¼Œ<code>è¯·ä¸è¦åœ¨åˆ›å»ºè¡¨æ—¶å°±åˆ†åº“åˆ†è¡¨</code>ã€‚</p></blockquote><h3 id="_3ã€è¯»å†™åˆ†ç¦»å’Œæ•°æ®åˆ†ç‰‡æ¶æ„" tabindex="-1"><a class="header-anchor" href="#_3ã€è¯»å†™åˆ†ç¦»å’Œæ•°æ®åˆ†ç‰‡æ¶æ„" aria-hidden="true">#</a> 3ã€è¯»å†™åˆ†ç¦»å’Œæ•°æ®åˆ†ç‰‡æ¶æ„</h3><p>ä¸‹å›¾å±•ç°äº†å°†æ•°æ®åˆ†ç‰‡ä¸è¯»å†™åˆ†ç¦»ä¸€åŒä½¿ç”¨æ—¶ï¼Œåº”ç”¨ç¨‹åºä¸æ•°æ®åº“é›†ç¾¤ä¹‹é—´çš„å¤æ‚æ‹“æ‰‘å…³ç³»ã€‚</p><p><img src="/assets/image-20220804223321167-fbb6710b.png" alt="image-20220804223321167"></p><h3 id="_4ã€å®ç°æ–¹å¼" tabindex="-1"><a class="header-anchor" href="#_4ã€å®ç°æ–¹å¼" aria-hidden="true">#</a> 4ã€å®ç°æ–¹å¼</h3><p>è¯»å†™åˆ†ç¦»å’Œæ•°æ®åˆ†ç‰‡å…·ä½“çš„å®ç°æ–¹å¼ä¸€èˆ¬æœ‰ä¸¤ç§ï¼š <code>ç¨‹åºä»£ç å°è£…</code>å’Œ<code>ä¸­é—´ä»¶å°è£…</code>ã€‚</p><h4 id="_4-1ã€ç¨‹åºä»£ç å°è£…" tabindex="-1"><a class="header-anchor" href="#_4-1ã€ç¨‹åºä»£ç å°è£…" aria-hidden="true">#</a> 4.1ã€ç¨‹åºä»£ç å°è£…</h4><p>ç¨‹åºä»£ç å°è£…æŒ‡åœ¨ä»£ç ä¸­æŠ½è±¡ä¸€ä¸ª<code>æ•°æ®è®¿é—®å±‚ï¼ˆæˆ–ä¸­é—´å±‚å°è£…ï¼‰</code>ï¼Œå®ç°è¯»å†™æ“ä½œåˆ†ç¦»å’Œæ•°æ®åº“æœåŠ¡å™¨è¿æ¥çš„ç®¡ç†ã€‚</p><p>**å…¶åŸºæœ¬æ¶æ„æ˜¯ï¼š**ä»¥è¯»å†™åˆ†ç¦»ä¸ºä¾‹</p><p><img src="/assets/f8d538f9201e3ebee37dfdcd1922e9df-cdff05e3.jpg" alt="img"></p><h4 id="_4-2ã€ä¸­é—´ä»¶å°è£…" tabindex="-1"><a class="header-anchor" href="#_4-2ã€ä¸­é—´ä»¶å°è£…" aria-hidden="true">#</a> 4.2ã€ä¸­é—´ä»¶å°è£…</h4><p>ä¸­é—´ä»¶å°è£…æŒ‡çš„æ˜¯<code>ç‹¬ç«‹ä¸€å¥—ç³»ç»Ÿå‡ºæ¥</code>ï¼Œå®ç°è¯»å†™æ“ä½œåˆ†ç¦»å’Œæ•°æ®åº“æœåŠ¡å™¨è¿æ¥çš„ç®¡ç†ã€‚å¯¹äºä¸šåŠ¡æœåŠ¡å™¨æ¥è¯´ï¼Œè®¿é—®ä¸­é—´ä»¶å’Œè®¿é—®æ•°æ®åº“æ²¡æœ‰åŒºåˆ«ï¼Œåœ¨ä¸šåŠ¡æœåŠ¡å™¨çœ‹æ¥ï¼Œä¸­é—´ä»¶å°±æ˜¯ä¸€ä¸ªæ•°æ®åº“æœåŠ¡å™¨ã€‚</p><p>**åŸºæœ¬æ¶æ„æ˜¯ï¼š**ä»¥è¯»å†™åˆ†ç¦»ä¸ºä¾‹</p><p><img src="/assets/2a2dba7f07581fd055d9cd5a3aa8388e-cfb57e85.jpg" alt="img"></p><h4 id="_4-3ã€å¸¸ç”¨è§£å†³æ–¹æ¡ˆ" tabindex="-1"><a class="header-anchor" href="#_4-3ã€å¸¸ç”¨è§£å†³æ–¹æ¡ˆ" aria-hidden="true">#</a> 4.3ã€å¸¸ç”¨è§£å†³æ–¹æ¡ˆ</h4><p>Apache ShardingSphereï¼ˆç¨‹åºçº§åˆ«å’Œä¸­é—´ä»¶çº§åˆ«ï¼‰</p><p>MyCatï¼ˆæ•°æ®åº“ä¸­é—´ä»¶ï¼‰</p><h2 id="ç¬¬02ç« -shardingsphere" tabindex="-1"><a class="header-anchor" href="#ç¬¬02ç« -shardingsphere" aria-hidden="true">#</a> ç¬¬02ç«  ShardingSphere</h2><h3 id="_1ã€ç®€ä»‹" tabindex="-1"><a class="header-anchor" href="#_1ã€ç®€ä»‹" aria-hidden="true">#</a> 1ã€ç®€ä»‹</h3><p>å®˜ç½‘ï¼šhttps://shardingsphere.apache.org/index_zh.html</p><p>æ–‡æ¡£ï¼šhttps://shardingsphere.apache.org/document/5.1.1/cn/overview/</p><p>Apache ShardingSphere ç”± JDBCã€Proxy å’Œ Sidecarï¼ˆè§„åˆ’ä¸­ï¼‰è¿™ 3 æ¬¾æ—¢èƒ½å¤Ÿç‹¬ç«‹éƒ¨ç½²ï¼Œåˆæ”¯æŒæ··åˆéƒ¨ç½²é…åˆä½¿ç”¨çš„äº§å“ç»„æˆã€‚</p><h3 id="_2ã€shardingsphere-jdbc" tabindex="-1"><a class="header-anchor" href="#_2ã€shardingsphere-jdbc" aria-hidden="true">#</a> 2ã€ShardingSphere-JDBC</h3><p><strong>ç¨‹åºä»£ç å°è£…</strong></p><p>å®šä½ä¸ºè½»é‡çº§ Java æ¡†æ¶ï¼Œ<code>åœ¨ Java çš„ JDBC å±‚æä¾›çš„é¢å¤–æœåŠ¡</code>ã€‚ å®ƒä½¿ç”¨å®¢æˆ·ç«¯ç›´è¿æ•°æ®åº“ï¼Œ<code>ä»¥ jar åŒ…å½¢å¼æä¾›æœåŠ¡</code>ï¼Œæ— éœ€é¢å¤–éƒ¨ç½²å’Œä¾èµ–ï¼Œå¯ç†è§£ä¸ºå¢å¼ºç‰ˆçš„ JDBC é©±åŠ¨ï¼Œå®Œå…¨å…¼å®¹ JDBC å’Œå„ç§ ORM æ¡†æ¶ã€‚</p><p><img src="/assets/image-20220804195402870-1406b13e.png" alt="image-20220804195402870"></p><h3 id="_3ã€shardingsphere-proxy" tabindex="-1"><a class="header-anchor" href="#_3ã€shardingsphere-proxy" aria-hidden="true">#</a> 3ã€ShardingSphere-Proxy</h3><p><strong>ä¸­é—´ä»¶å°è£…</strong></p><p>å®šä½ä¸ºé€æ˜åŒ–çš„<code>æ•°æ®åº“ä»£ç†ç«¯</code>ï¼Œæä¾›å°è£…äº†æ•°æ®åº“äºŒè¿›åˆ¶åè®®çš„æœåŠ¡ç«¯ç‰ˆæœ¬ï¼Œç”¨äºå®Œæˆå¯¹å¼‚æ„è¯­è¨€çš„æ”¯æŒã€‚ ç›®å‰æä¾› MySQL å’Œ PostgreSQLç‰ˆæœ¬ï¼Œå®ƒå¯ä»¥ä½¿ç”¨ä»»ä½•å…¼å®¹ MySQL/PostgreSQL åè®®çš„è®¿é—®å®¢æˆ·ç«¯ï¼ˆå¦‚ï¼šMySQL Command Client, MySQL Workbench, Navicat ç­‰ï¼‰æ“ä½œæ•°æ®ï¼Œå¯¹ DBA æ›´åŠ å‹å¥½ã€‚</p><p><img src="/assets/image-20220804195432673-4d74878d.png" alt="image-20220804195432673"></p><h2 id="ç¬¬03ç« -mysqlä¸»ä»åŒæ­¥" tabindex="-1"><a class="header-anchor" href="#ç¬¬03ç« -mysqlä¸»ä»åŒæ­¥" aria-hidden="true">#</a> ç¬¬03ç«  MySQLä¸»ä»åŒæ­¥</h2><h3 id="_1ã€mysqlä¸»ä»åŒæ­¥åŸç†" tabindex="-1"><a class="header-anchor" href="#_1ã€mysqlä¸»ä»åŒæ­¥åŸç†" aria-hidden="true">#</a> 1ã€MySQLä¸»ä»åŒæ­¥åŸç†</h3><p><img src="/assets/image-20220714133617856-24c0de1c.png" alt="img"></p><p><strong>åŸºæœ¬åŸç†ï¼š</strong></p><p>slaveä¼šä»masterè¯»å–binlogæ¥è¿›è¡Œæ•°æ®åŒæ­¥</p><p><strong>å…·ä½“æ­¥éª¤ï¼š</strong></p><ul><li><code>step1ï¼š</code>masterå°†æ•°æ®æ”¹å˜è®°å½•åˆ°<code>äºŒè¿›åˆ¶æ—¥å¿—ï¼ˆbinary logï¼‰</code>ä¸­ã€‚</li><li><code>step2ï¼š</code> å½“slaveä¸Šæ‰§è¡Œ <code>start slave</code> å‘½ä»¤ä¹‹åï¼Œslaveä¼šåˆ›å»ºä¸€ä¸ª <code>IO çº¿ç¨‹</code>ç”¨æ¥è¿æ¥masterï¼Œè¯·æ±‚masterä¸­çš„binlogã€‚</li><li><code>step3ï¼š</code>å½“slaveè¿æ¥masteræ—¶ï¼Œmasterä¼šåˆ›å»ºä¸€ä¸ª <code>log dump çº¿ç¨‹</code>ï¼Œç”¨äºå‘é€ binlog çš„å†…å®¹ã€‚åœ¨è¯»å– binlog çš„å†…å®¹çš„æ“ä½œä¸­ï¼Œä¼šå¯¹ä¸»èŠ‚ç‚¹ä¸Šçš„ binlog åŠ é”ï¼Œå½“è¯»å–å®Œæˆå¹¶å‘é€ç»™ä»æœåŠ¡å™¨åè§£é”ã€‚</li><li><code>step4ï¼š</code>IO çº¿ç¨‹æ¥æ”¶ä¸»èŠ‚ç‚¹ binlog dump è¿›ç¨‹å‘æ¥çš„æ›´æ–°ä¹‹åï¼Œä¿å­˜åˆ° <code>ä¸­ç»§æ—¥å¿—ï¼ˆrelay logï¼‰</code> ä¸­ã€‚</li><li><code>step5ï¼š</code>slaveçš„<code>SQLçº¿ç¨‹</code>ï¼Œè¯»å–relay logæ—¥å¿—ï¼Œå¹¶è§£ææˆå…·ä½“æ“ä½œï¼Œä»è€Œå®ç°ä¸»ä»æ“ä½œä¸€è‡´ï¼Œæœ€ç»ˆæ•°æ®ä¸€è‡´ã€‚</li></ul><h3 id="_2ã€ä¸€ä¸»å¤šä»é…ç½®" tabindex="-1"><a class="header-anchor" href="#_2ã€ä¸€ä¸»å¤šä»é…ç½®" aria-hidden="true">#</a> 2ã€ä¸€ä¸»å¤šä»é…ç½®</h3><p>æœåŠ¡å™¨è§„åˆ’ï¼šä½¿ç”¨<code>docker</code>æ–¹å¼åˆ›å»ºï¼Œ<code>ä¸»ä»æœåŠ¡å™¨IPä¸€è‡´ï¼Œç«¯å£å·ä¸ä¸€è‡´</code></p><p><img src="/assets/image-20220807183231101-1cd87cd0.png" alt="image-20220807183231101"></p><ul><li>ä¸»æœåŠ¡å™¨ï¼šå®¹å™¨å<code>atguigu-mysql-master</code>ï¼Œç«¯å£<code>3306</code></li><li>ä»æœåŠ¡å™¨ï¼šå®¹å™¨å<code>atguigu-mysql-slave1</code>ï¼Œç«¯å£<code>3307</code></li><li>ä»æœåŠ¡å™¨ï¼šå®¹å™¨å<code>atguigu-mysql-slave2</code>ï¼Œç«¯å£<code>3308</code></li></ul><p>**æ³¨æ„ï¼š**å¦‚æœæ­¤æ—¶é˜²ç«å¢™æ˜¯å¼€å¯çš„ï¼Œ<code>åˆ™å…ˆå…³é—­é˜²ç«å¢™ï¼Œå¹¶é‡å¯docker</code>ï¼Œå¦åˆ™åç»­å®‰è£…çš„MySQLæ— æ³•å¯åŠ¨</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment">#å…³é—­docker</span>
systemctl stop <span class="token function">docker</span>
<span class="token comment">#å…³é—­é˜²ç«å¢™</span>
systemctl stop firewalld
<span class="token comment">#å¯åŠ¨docker</span>
systemctl start <span class="token function">docker</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-1ã€å‡†å¤‡ä¸»æœåŠ¡å™¨" tabindex="-1"><a class="header-anchor" href="#_2-1ã€å‡†å¤‡ä¸»æœåŠ¡å™¨" aria-hidden="true">#</a> 2.1ã€å‡†å¤‡ä¸»æœåŠ¡å™¨</h4><ul><li><strong>step1ï¼šåœ¨dockerä¸­åˆ›å»ºå¹¶å¯åŠ¨MySQLä¸»æœåŠ¡å™¨ï¼š</strong><code>ç«¯å£3306</code></li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-p</span> <span class="token number">3306</span>:3306 <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /atguigu/mysql/master/conf:/etc/mysql/conf.d <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /atguigu/mysql/master/data:/var/lib/mysql <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span><span class="token number">123456</span> <span class="token punctuation">\</span>
<span class="token parameter variable">--name</span> atguigu-mysql-master <span class="token punctuation">\</span>
mysql:8.0.29
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>step2ï¼šåˆ›å»ºMySQLä¸»æœåŠ¡å™¨é…ç½®æ–‡ä»¶ï¼š</strong></li></ul><p>é»˜è®¤æƒ…å†µä¸‹MySQLçš„binlogæ—¥å¿—æ˜¯è‡ªåŠ¨å¼€å¯çš„ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹é…ç½®å®šä¹‰ä¸€äº›å¯é€‰é…ç½®</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">vim</span> /atguigu/mysql/master/conf/my.cnf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>é…ç½®å¦‚ä¸‹å†…å®¹</p><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code>[mysqld]
<span class="token comment"># æœåŠ¡å™¨å”¯ä¸€idï¼Œé»˜è®¤å€¼1</span>
<span class="token key attr-name">server-id</span><span class="token punctuation">=</span><span class="token value attr-value">1</span>
<span class="token comment"># è®¾ç½®æ—¥å¿—æ ¼å¼ï¼Œé»˜è®¤å€¼ROW</span>
<span class="token key attr-name">binlog_format</span><span class="token punctuation">=</span><span class="token value attr-value">STATEMENT</span>
<span class="token comment"># äºŒè¿›åˆ¶æ—¥å¿—åï¼Œé»˜è®¤binlog</span>
<span class="token comment"># log-bin=binlog</span>
<span class="token comment"># è®¾ç½®éœ€è¦å¤åˆ¶çš„æ•°æ®åº“ï¼Œé»˜è®¤å¤åˆ¶å…¨éƒ¨æ•°æ®åº“</span>
<span class="token comment"># binlog-do-db=mytestdb</span>
<span class="token comment"># è®¾ç½®ä¸éœ€è¦å¤åˆ¶çš„æ•°æ®åº“</span>
<span class="token comment"># binlog-ignore-db=mysql</span>
<span class="token comment"># binlog-ignore-db=infomation_schema</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é‡å¯MySQLå®¹å™¨</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> restart atguigu-mysql-master
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><code>binlogæ ¼å¼è¯´æ˜ï¼š</code></p><ul><li>binlog_format=STATEMENTï¼šæ—¥å¿—è®°å½•çš„æ˜¯ä¸»æœºæ•°æ®åº“çš„<code>å†™æŒ‡ä»¤</code>ï¼Œæ€§èƒ½é«˜ï¼Œä½†æ˜¯now()ä¹‹ç±»çš„å‡½æ•°ä»¥åŠè·å–ç³»ç»Ÿå‚æ•°çš„æ“ä½œä¼šå‡ºç°ä¸»ä»æ•°æ®ä¸åŒæ­¥çš„é—®é¢˜ã€‚</li><li>binlog_format=ROWï¼ˆé»˜è®¤ï¼‰ï¼šæ—¥å¿—è®°å½•çš„æ˜¯ä¸»æœºæ•°æ®åº“çš„<code>å†™åçš„æ•°æ®</code>ï¼Œæ‰¹é‡æ“ä½œæ—¶æ€§èƒ½è¾ƒå·®ï¼Œè§£å†³now()æˆ–è€… user()æˆ–è€… @@hostname ç­‰æ“ä½œåœ¨ä¸»ä»æœºå™¨ä¸Šä¸ä¸€è‡´çš„é—®é¢˜ã€‚</li><li>binlog_format=MIXEDï¼šæ˜¯ä»¥ä¸Šä¸¤ç§levelçš„æ··åˆä½¿ç”¨ï¼Œæœ‰å‡½æ•°ç”¨ROWï¼Œæ²¡å‡½æ•°ç”¨STATEMENTï¼Œä½†æ˜¯æ— æ³•è¯†åˆ«ç³»ç»Ÿå˜é‡</li></ul><p><code>binlog-ignore-dbå’Œbinlog-do-dbçš„ä¼˜å…ˆçº§é—®é¢˜ï¼š</code></p><p><img src="/assets/0.08703112216569037-f31f2cf7.png" alt="img"></p><ul><li><strong>step3ï¼šä½¿ç”¨å‘½ä»¤è¡Œç™»å½•MySQLä¸»æœåŠ¡å™¨ï¼š</strong></li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment">#è¿›å…¥å®¹å™¨ï¼šenv LANG=C.UTF-8 é¿å…å®¹å™¨ä¸­æ˜¾ç¤ºä¸­æ–‡ä¹±ç </span>
<span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> atguigu-mysql-master <span class="token function">env</span> <span class="token assign-left variable"><span class="token environment constant">LANG</span></span><span class="token operator">=</span>C.UTF-8 /bin/bash
<span class="token comment">#è¿›å…¥å®¹å™¨å†…çš„mysqlå‘½ä»¤è¡Œ</span>
mysql <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-p</span>
<span class="token comment">#ä¿®æ”¹é»˜è®¤å¯†ç æ ¡éªŒæ–¹å¼</span>
ALTER <span class="token environment constant">USER</span> <span class="token string">&#39;root&#39;</span>@<span class="token string">&#39;%&#39;</span> IDENTIFIED WITH mysql_native_password BY <span class="token string">&#39;123456&#39;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>step4ï¼šä¸»æœºä¸­åˆ›å»ºslaveç”¨æˆ·ï¼š</strong></li></ul><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">-- åˆ›å»ºslaveç”¨æˆ·</span>
<span class="token keyword">CREATE</span> <span class="token keyword">USER</span> <span class="token string">&#39;atguigu_slave&#39;</span><span class="token variable">@&#39;%&#39;</span><span class="token punctuation">;</span>
<span class="token comment">-- è®¾ç½®å¯†ç </span>
<span class="token keyword">ALTER</span> <span class="token keyword">USER</span> <span class="token string">&#39;atguigu_slave&#39;</span><span class="token variable">@&#39;%&#39;</span> IDENTIFIED <span class="token keyword">WITH</span> mysql_native_password <span class="token keyword">BY</span> <span class="token string">&#39;123456&#39;</span><span class="token punctuation">;</span>
<span class="token comment">-- æˆäºˆå¤åˆ¶æƒé™</span>
<span class="token keyword">GRANT</span> <span class="token keyword">REPLICATION</span> SLAVE <span class="token keyword">ON</span> <span class="token operator">*</span><span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">TO</span> <span class="token string">&#39;atguigu_slave&#39;</span><span class="token variable">@&#39;%&#39;</span><span class="token punctuation">;</span>
<span class="token comment">-- åˆ·æ–°æƒé™</span>
FLUSH <span class="token keyword">PRIVILEGES</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>step5ï¼šä¸»æœºä¸­æŸ¥è¯¢masterçŠ¶æ€ï¼š</strong></li></ul><p>æ‰§è¡Œå®Œæ­¤æ­¥éª¤å<code>ä¸è¦å†æ“ä½œä¸»æœåŠ¡å™¨MYSQL</code>ï¼Œé˜²æ­¢ä¸»æœåŠ¡å™¨çŠ¶æ€å€¼å˜åŒ–</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SHOW</span> MASTER <span class="token keyword">STATUS</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>è®°ä¸‹<code>File</code>å’Œ<code>Position</code>çš„å€¼ã€‚æ‰§è¡Œå®Œæ­¤æ­¥éª¤åä¸è¦å†æ“ä½œä¸»æœåŠ¡å™¨MYSQLï¼Œé˜²æ­¢ä¸»æœåŠ¡å™¨çŠ¶æ€å€¼å˜åŒ–ã€‚</p><p><img src="/assets/image-20220804191852164-34c1740a.png" alt="image-20220804191852164"></p><h4 id="_2-2ã€å‡†å¤‡ä»æœåŠ¡å™¨" tabindex="-1"><a class="header-anchor" href="#_2-2ã€å‡†å¤‡ä»æœåŠ¡å™¨" aria-hidden="true">#</a> 2.2ã€å‡†å¤‡ä»æœåŠ¡å™¨</h4><p>å¯ä»¥é…ç½®å¤šå°ä»æœºslave1ã€slave2...ï¼Œè¿™é‡Œä»¥é…ç½®slave1ä¸ºä¾‹</p><ul><li><strong>step1ï¼šåœ¨dockerä¸­åˆ›å»ºå¹¶å¯åŠ¨MySQLä»æœåŠ¡å™¨ï¼š</strong><code>ç«¯å£3307</code></li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-p</span> <span class="token number">3307</span>:3306 <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /atguigu/mysql/slave1/conf:/etc/mysql/conf.d <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /atguigu/mysql/slave1/data:/var/lib/mysql <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span><span class="token number">123456</span> <span class="token punctuation">\</span>
<span class="token parameter variable">--name</span> atguigu-mysql-slave1 <span class="token punctuation">\</span>
mysql:8.0.29
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>step2ï¼šåˆ›å»ºMySQLä»æœåŠ¡å™¨é…ç½®æ–‡ä»¶ï¼š</strong></li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">vim</span> /atguigu/mysql/slave1/conf/my.cnf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>é…ç½®å¦‚ä¸‹å†…å®¹ï¼š</p><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code>[mysqld]
<span class="token comment"># æœåŠ¡å™¨å”¯ä¸€idï¼Œæ¯å°æœåŠ¡å™¨çš„idå¿…é¡»ä¸åŒï¼Œå¦‚æœé…ç½®å…¶ä»–ä»æœºï¼Œæ³¨æ„ä¿®æ”¹id</span>
<span class="token key attr-name">server-id</span><span class="token punctuation">=</span><span class="token value attr-value">2</span>
<span class="token comment"># ä¸­ç»§æ—¥å¿—åï¼Œé»˜è®¤xxxxxxxxxxxx-relay-bin</span>
<span class="token comment">#relay-log=relay-bin</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é‡å¯MySQLå®¹å™¨</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> restart atguigu-mysql-slave1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li><strong>step3ï¼šä½¿ç”¨å‘½ä»¤è¡Œç™»å½•MySQLä»æœåŠ¡å™¨ï¼š</strong></li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment">#è¿›å…¥å®¹å™¨ï¼š</span>
<span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> atguigu-mysql-slave1 <span class="token function">env</span> <span class="token assign-left variable"><span class="token environment constant">LANG</span></span><span class="token operator">=</span>C.UTF-8 /bin/bash
<span class="token comment">#è¿›å…¥å®¹å™¨å†…çš„mysqlå‘½ä»¤è¡Œ</span>
mysql <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-p</span>
<span class="token comment">#ä¿®æ”¹é»˜è®¤å¯†ç æ ¡éªŒæ–¹å¼</span>
ALTER <span class="token environment constant">USER</span> <span class="token string">&#39;root&#39;</span>@<span class="token string">&#39;%&#39;</span> IDENTIFIED WITH mysql_native_password BY <span class="token string">&#39;123456&#39;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>step4ï¼šåœ¨ä»æœºä¸Šé…ç½®ä¸»ä»å…³ç³»ï¼š</strong></li></ul><p>åœ¨<strong>ä»æœº</strong>ä¸Šæ‰§è¡Œä»¥ä¸‹SQLæ“ä½œ</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>CHANGE MASTER <span class="token keyword">TO</span> MASTER_HOST<span class="token operator">=</span><span class="token string">&#39;192.168.100.201&#39;</span><span class="token punctuation">,</span> 
MASTER_USER<span class="token operator">=</span><span class="token string">&#39;atguigu_slave&#39;</span><span class="token punctuation">,</span>MASTER_PASSWORD<span class="token operator">=</span><span class="token string">&#39;123456&#39;</span><span class="token punctuation">,</span> MASTER_PORT<span class="token operator">=</span><span class="token number">3306</span><span class="token punctuation">,</span>
MASTER_LOG_FILE<span class="token operator">=</span><span class="token string">&#39;binlog.000003&#39;</span><span class="token punctuation">,</span>MASTER_LOG_POS<span class="token operator">=</span><span class="token number">1357</span><span class="token punctuation">;</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-3ã€å¯åŠ¨ä¸»ä»åŒæ­¥" tabindex="-1"><a class="header-anchor" href="#_2-3ã€å¯åŠ¨ä¸»ä»åŒæ­¥" aria-hidden="true">#</a> 2.3ã€å¯åŠ¨ä¸»ä»åŒæ­¥</h4><p>å¯åŠ¨ä»æœºçš„å¤åˆ¶åŠŸèƒ½ï¼Œæ‰§è¡ŒSQLï¼š</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">START</span> SLAVE<span class="token punctuation">;</span>
<span class="token comment">-- æŸ¥çœ‹çŠ¶æ€ï¼ˆä¸éœ€è¦åˆ†å·ï¼‰</span>
<span class="token keyword">SHOW</span> SLAVE <span class="token keyword">STATUS</span>\G
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>**ä¸¤ä¸ªå…³é”®è¿›ç¨‹ï¼š**ä¸‹é¢ä¸¤ä¸ªå‚æ•°éƒ½æ˜¯Yesï¼Œåˆ™è¯´æ˜ä¸»ä»é…ç½®æˆåŠŸï¼</p><p><img src="/assets/image-20220715000533951-1e74439a.png" alt="img"></p><h4 id="_2-4ã€å®ç°ä¸»ä»åŒæ­¥" tabindex="-1"><a class="header-anchor" href="#_2-4ã€å®ç°ä¸»ä»åŒæ­¥" aria-hidden="true">#</a> 2.4ã€å®ç°ä¸»ä»åŒæ­¥</h4><p>åœ¨ä¸»æœºä¸­æ‰§è¡Œä»¥ä¸‹SQLï¼Œåœ¨ä»æœºä¸­æŸ¥çœ‹æ•°æ®åº“ã€è¡¨å’Œæ•°æ®æ˜¯å¦å·²ç»è¢«åŒæ­¥</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> db_user<span class="token punctuation">;</span>
<span class="token keyword">USE</span> db_user<span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> t_user <span class="token punctuation">(</span>
 id <span class="token keyword">BIGINT</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
 uname <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
 <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> t_user<span class="token punctuation">(</span>uname<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">&#39;zhang3&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> t_user<span class="token punctuation">(</span>uname<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span>@<span class="token variable">@hostname</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-5ã€åœæ­¢å’Œé‡ç½®" tabindex="-1"><a class="header-anchor" href="#_2-5ã€åœæ­¢å’Œé‡ç½®" aria-hidden="true">#</a> 2.5ã€åœæ­¢å’Œé‡ç½®</h4><p>éœ€è¦çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹SQLè¯­å¥</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">-- åœ¨ä»æœºä¸Šæ‰§è¡Œã€‚åŠŸèƒ½è¯´æ˜ï¼šåœæ­¢I/O çº¿ç¨‹å’ŒSQLçº¿ç¨‹çš„æ“ä½œã€‚</span>
stop slave<span class="token punctuation">;</span> 

<span class="token comment">-- åœ¨ä»æœºä¸Šæ‰§è¡Œã€‚åŠŸèƒ½è¯´æ˜ï¼šç”¨äºåˆ é™¤SLAVEæ•°æ®åº“çš„relaylogæ—¥å¿—æ–‡ä»¶ï¼Œå¹¶é‡æ–°å¯ç”¨æ–°çš„relaylogæ–‡ä»¶ã€‚</span>
reset slave<span class="token punctuation">;</span>

<span class="token comment">-- åœ¨ä¸»æœºä¸Šæ‰§è¡Œã€‚åŠŸèƒ½è¯´æ˜ï¼šåˆ é™¤æ‰€æœ‰çš„binglogæ—¥å¿—æ–‡ä»¶ï¼Œå¹¶å°†æ—¥å¿—ç´¢å¼•æ–‡ä»¶æ¸…ç©ºï¼Œé‡æ–°å¼€å§‹æ‰€æœ‰æ–°çš„æ—¥å¿—æ–‡ä»¶ã€‚</span>
<span class="token comment">-- ç”¨äºç¬¬ä¸€æ¬¡è¿›è¡Œæ­å»ºä¸»ä»åº“æ—¶ï¼Œè¿›è¡Œä¸»åº“binlogåˆå§‹åŒ–å·¥ä½œï¼›</span>
reset master<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-6ã€å¸¸è§é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#_2-6ã€å¸¸è§é—®é¢˜" aria-hidden="true">#</a> <strong>2.6ã€å¸¸è§é—®é¢˜</strong></h4><h4 id="é—®é¢˜1" tabindex="-1"><a class="header-anchor" href="#é—®é¢˜1" aria-hidden="true">#</a> é—®é¢˜1</h4><p>å¯åŠ¨ä¸»ä»åŒæ­¥åï¼Œå¸¸è§é”™è¯¯æ˜¯<code>Slave_IO_Runningï¼š No æˆ–è€… Connecting</code> çš„æƒ…å†µï¼Œæ­¤æ—¶æŸ¥çœ‹ä¸‹æ–¹çš„ <code>Last_IO_ERROR</code>é”™è¯¯æ—¥å¿—ï¼Œæ ¹æ®æ—¥å¿—ä¸­æ˜¾ç¤ºçš„é”™è¯¯ä¿¡æ¯åœ¨ç½‘ä¸Šæœç´¢è§£å†³æ–¹æ¡ˆå³å¯</p><p><img src="/assets/image-20220714235426120-9d9bef0d.png" alt="img"></p><p><strong>å…¸å‹çš„é”™è¯¯ä¾‹å¦‚ï¼š</strong><code>Last_IO_Error: Got fatal error 1236 from master when reading data from binary log: &#39;Client requested master to start replication from position &gt; file size&#39;</code></p><p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">-- åœ¨ä»æœºåœæ­¢slave</span>
SLAVE STOP<span class="token punctuation">;</span>

<span class="token comment">-- åœ¨ä¸»æœºæŸ¥çœ‹materçŠ¶æ€</span>
<span class="token keyword">SHOW</span> MASTER <span class="token keyword">STATUS</span><span class="token punctuation">;</span>
<span class="token comment">-- åœ¨ä¸»æœºåˆ·æ–°æ—¥å¿—</span>
FLUSH LOGS<span class="token punctuation">;</span>
<span class="token comment">-- å†æ¬¡åœ¨ä¸»æœºæŸ¥çœ‹materçŠ¶æ€ï¼ˆä¼šå‘ç°Fileå’ŒPositionå‘ç”Ÿäº†å˜åŒ–ï¼‰</span>
<span class="token keyword">SHOW</span> MASTER <span class="token keyword">STATUS</span><span class="token punctuation">;</span>
<span class="token comment">-- ä¿®æ”¹ä»æœºè¿æ¥ä¸»æœºçš„SQLï¼Œå¹¶é‡æ–°è¿æ¥å³å¯</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="é—®é¢˜2" tabindex="-1"><a class="header-anchor" href="#é—®é¢˜2" aria-hidden="true">#</a> é—®é¢˜2</h4><p>å¯åŠ¨dockerå®¹å™¨åæç¤º <code>WARNING: IPv4 forwarding is disabled. Networking will not work.</code></p><p><img src="/assets/image-20220715004850504-babaa767.png" alt="img"></p><p>æ­¤é”™è¯¯ï¼Œè™½ç„¶ä¸å½±å“ä¸»ä»åŒæ­¥çš„æ­å»ºï¼Œä½†æ˜¯å¦‚æœæƒ³ä»è¿œç¨‹å®¢æˆ·ç«¯é€šè¿‡ä»¥ä¸‹æ–¹å¼è¿æ¥dockerä¸­çš„MySQLåˆ™æ²¡æ³•è¿æ¥</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>administrator<span class="token operator">&gt;</span>mysql <span class="token parameter variable">-h</span> <span class="token number">192.168</span>.100.201 <span class="token parameter variable">-P</span> <span class="token number">3306</span> <span class="token parameter variable">-u</span> root <span class="token parameter variable">-p</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment">#ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼š</span>
<span class="token function">vim</span> /usr/lib/sysctl.d/00-system.conf
<span class="token comment">#è¿½åŠ </span>
<span class="token assign-left variable">net.ipv4.ip_forward</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token comment">#æ¥ç€é‡å¯ç½‘ç»œ</span>
systemctl restart network
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ç¬¬04ç« -shardingsphere-jdbcè¯»å†™åˆ†ç¦»" tabindex="-1"><a class="header-anchor" href="#ç¬¬04ç« -shardingsphere-jdbcè¯»å†™åˆ†ç¦»" aria-hidden="true">#</a> ç¬¬04ç«  ShardingSphere-JDBCè¯»å†™åˆ†ç¦»</h2><h3 id="_1ã€åˆ›å»ºspringbootç¨‹åº" tabindex="-1"><a class="header-anchor" href="#_1ã€åˆ›å»ºspringbootç¨‹åº" aria-hidden="true">#</a> 1ã€åˆ›å»ºSpringBootç¨‹åº</h3><h4 id="_1-1ã€åˆ›å»ºé¡¹ç›®" tabindex="-1"><a class="header-anchor" href="#_1-1ã€åˆ›å»ºé¡¹ç›®" aria-hidden="true">#</a> 1.1ã€åˆ›å»ºé¡¹ç›®</h4><p>é¡¹ç›®ç±»å‹ï¼šSpring Initializr</p><p>SpringBootè„šæ‰‹æ¶ï¼šhttp://start.aliyun.com</p><p>é¡¹ç›®åï¼šsharding-jdbc-demo</p><p>SpringBootç‰ˆæœ¬ï¼š2.3.7.RELEASE</p><h4 id="_1-2ã€æ·»åŠ ä¾èµ–" tabindex="-1"><a class="header-anchor" href="#_1-2ã€æ·»åŠ ä¾èµ–" aria-hidden="true">#</a> 1.2ã€æ·»åŠ ä¾èµ–</h4><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.shardingsphere<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>shardingsphere-jdbc-core-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>5.1.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>runtime<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.baomidou<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mybatis-plus-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.3.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusions</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusion</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.junit.vintage<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>junit-vintage-engine<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusion</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusions</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_1-3ã€åˆ›å»ºå®ä½“ç±»" tabindex="-1"><a class="header-anchor" href="#_1-3ã€åˆ›å»ºå®ä½“ç±»" aria-hidden="true">#</a> 1.3ã€åˆ›å»ºå®ä½“ç±»</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>shardingjdbcdemo<span class="token punctuation">.</span>entity</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@TableName</span><span class="token punctuation">(</span><span class="token string">&quot;t_user&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@TableId</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">IdType</span><span class="token punctuation">.</span><span class="token constant">AUTO</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> uname<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_1-4ã€åˆ›å»ºmapper" tabindex="-1"><a class="header-anchor" href="#_1-4ã€åˆ›å»ºmapper" aria-hidden="true">#</a> 1.4ã€åˆ›å»ºMapper</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>shardingjdbcdemo<span class="token punctuation">.</span>mapper</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Mapper</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserMapper</span> <span class="token keyword">extends</span> <span class="token class-name">BaseMapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_1-5ã€é…ç½®è¯»å†™åˆ†ç¦»" tabindex="-1"><a class="header-anchor" href="#_1-5ã€é…ç½®è¯»å†™åˆ†ç¦»" aria-hidden="true">#</a> 1.5ã€é…ç½®è¯»å†™åˆ†ç¦»</h4><p>application.propertiesï¼š</p><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token comment"># åº”ç”¨åç§°</span>
<span class="token key attr-name">spring.application.name</span><span class="token punctuation">=</span><span class="token value attr-value">sharging-jdbc-demo</span>
<span class="token comment"># å¼€å‘ç¯å¢ƒè®¾ç½®</span>
<span class="token key attr-name">spring.profiles.active</span><span class="token punctuation">=</span><span class="token value attr-value">dev</span>
<span class="token comment"># å†…å­˜æ¨¡å¼</span>
<span class="token key attr-name">spring.shardingsphere.mode.type</span><span class="token punctuation">=</span><span class="token value attr-value">Memory</span>

<span class="token comment"># é…ç½®çœŸå®æ•°æ®æº</span>
<span class="token key attr-name">spring.shardingsphere.datasource.names</span><span class="token punctuation">=</span><span class="token value attr-value">master,slave1,slave2</span>

<span class="token comment"># é…ç½®ç¬¬ 1 ä¸ªæ•°æ®æº</span>
<span class="token key attr-name">spring.shardingsphere.datasource.master.type</span><span class="token punctuation">=</span><span class="token value attr-value">com.zaxxer.hikari.HikariDataSource</span>
<span class="token key attr-name">spring.shardingsphere.datasource.master.driver-class-name</span><span class="token punctuation">=</span><span class="token value attr-value">com.mysql.jdbc.Driver</span>
<span class="token key attr-name">spring.shardingsphere.datasource.master.jdbc-url</span><span class="token punctuation">=</span><span class="token value attr-value">jdbc:mysql://192.168.100.201:3306/db_user</span>
<span class="token key attr-name">spring.shardingsphere.datasource.master.username</span><span class="token punctuation">=</span><span class="token value attr-value">root</span>
<span class="token key attr-name">spring.shardingsphere.datasource.master.password</span><span class="token punctuation">=</span><span class="token value attr-value">123456</span>

<span class="token comment"># é…ç½®ç¬¬ 2 ä¸ªæ•°æ®æº</span>
<span class="token key attr-name">spring.shardingsphere.datasource.slave1.type</span><span class="token punctuation">=</span><span class="token value attr-value">com.zaxxer.hikari.HikariDataSource</span>
<span class="token key attr-name">spring.shardingsphere.datasource.slave1.driver-class-name</span><span class="token punctuation">=</span><span class="token value attr-value">com.mysql.jdbc.Driver</span>
<span class="token key attr-name">spring.shardingsphere.datasource.slave1.jdbc-url</span><span class="token punctuation">=</span><span class="token value attr-value">jdbc:mysql://192.168.100.201:3307/db_user</span>
<span class="token key attr-name">spring.shardingsphere.datasource.slave1.username</span><span class="token punctuation">=</span><span class="token value attr-value">root</span>
<span class="token key attr-name">spring.shardingsphere.datasource.slave1.password</span><span class="token punctuation">=</span><span class="token value attr-value">123456</span>

<span class="token comment"># é…ç½®ç¬¬ 3 ä¸ªæ•°æ®æº</span>
<span class="token key attr-name">spring.shardingsphere.datasource.slave2.type</span><span class="token punctuation">=</span><span class="token value attr-value">com.zaxxer.hikari.HikariDataSource</span>
<span class="token key attr-name">spring.shardingsphere.datasource.slave2.driver-class-name</span><span class="token punctuation">=</span><span class="token value attr-value">com.mysql.jdbc.Driver</span>
<span class="token key attr-name">spring.shardingsphere.datasource.slave2.jdbc-url</span><span class="token punctuation">=</span><span class="token value attr-value">jdbc:mysql://192.168.100.201:3308/db_user</span>
<span class="token key attr-name">spring.shardingsphere.datasource.slave2.username</span><span class="token punctuation">=</span><span class="token value attr-value">root</span>
<span class="token key attr-name">spring.shardingsphere.datasource.slave2.password</span><span class="token punctuation">=</span><span class="token value attr-value">123456</span>

<span class="token comment"># è¯»å†™åˆ†ç¦»ç±»å‹ï¼Œå¦‚: Staticï¼ŒDynamic</span>
<span class="token key attr-name">spring.shardingsphere.rules.readwrite-splitting.data-sources.myds.type</span><span class="token punctuation">=</span><span class="token value attr-value">Static</span>
<span class="token comment"># å†™æ•°æ®æºåç§°</span>
<span class="token key attr-name">spring.shardingsphere.rules.readwrite-splitting.data-sources.myds.props.write-data-source-name</span><span class="token punctuation">=</span><span class="token value attr-value">master</span>
<span class="token comment"># è¯»æ•°æ®æºåç§°ï¼Œå¤šä¸ªä»æ•°æ®æºç”¨é€—å·åˆ†éš”</span>
<span class="token key attr-name">spring.shardingsphere.rules.readwrite-splitting.data-sources.myds.props.read-data-source-names</span><span class="token punctuation">=</span><span class="token value attr-value">slave1,slave2</span>

<span class="token comment"># è´Ÿè½½å‡è¡¡ç®—æ³•åç§°</span>
<span class="token key attr-name">spring.shardingsphere.rules.readwrite-splitting.data-sources.myds.load-balancer-name</span><span class="token punctuation">=</span><span class="token value attr-value">alg_round</span>

<span class="token comment"># è´Ÿè½½å‡è¡¡ç®—æ³•é…ç½®</span>
<span class="token comment"># è´Ÿè½½å‡è¡¡ç®—æ³•ç±»å‹</span>
<span class="token key attr-name">spring.shardingsphere.rules.readwrite-splitting.load-balancers.alg_round.type</span><span class="token punctuation">=</span><span class="token value attr-value">ROUND_ROBIN</span>
<span class="token key attr-name">spring.shardingsphere.rules.readwrite-splitting.load-balancers.alg_random.type</span><span class="token punctuation">=</span><span class="token value attr-value">RANDOM</span>
<span class="token key attr-name">spring.shardingsphere.rules.readwrite-splitting.load-balancers.alg_weight.type</span><span class="token punctuation">=</span><span class="token value attr-value">WEIGHT</span>
<span class="token key attr-name">spring.shardingsphere.rules.readwrite-splitting.load-balancers.alg_weight.props.slave1</span><span class="token punctuation">=</span><span class="token value attr-value">1</span>
<span class="token key attr-name">spring.shardingsphere.rules.readwrite-splitting.load-balancers.alg_weight.props.slave2</span><span class="token punctuation">=</span><span class="token value attr-value">2</span>

<span class="token comment"># æ‰“å°SQl</span>
<span class="token key attr-name">spring.shardingsphere.props.sql-show</span><span class="token punctuation">=</span><span class="token value attr-value">true</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2ã€æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_2ã€æµ‹è¯•" aria-hidden="true">#</a> 2ã€æµ‹è¯•</h3><h4 id="_2-1ã€è¯»å†™åˆ†ç¦»æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_2-1ã€è¯»å†™åˆ†ç¦»æµ‹è¯•" aria-hidden="true">#</a> 2.1ã€è¯»å†™åˆ†ç¦»æµ‹è¯•</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>shardingjdbcdemo</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">class</span> <span class="token class-name">ReadwriteTest</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">UserMapper</span> userMapper<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * å†™å…¥æ•°æ®çš„æµ‹è¯•
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testInsert</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setUname</span><span class="token punctuation">(</span><span class="token string">&quot;å¼ ä¸‰ä¸°&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        userMapper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-2ã€äº‹åŠ¡æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_2-2ã€äº‹åŠ¡æµ‹è¯•" aria-hidden="true">#</a> 2.2ã€äº‹åŠ¡æµ‹è¯•</h4><p>ä¸ºäº†ä¿è¯ä¸»ä»åº“é—´çš„äº‹åŠ¡ä¸€è‡´æ€§ï¼Œé¿å…è·¨æœåŠ¡çš„åˆ†å¸ƒå¼äº‹åŠ¡ï¼ŒShardingSphere-JDBCçš„<code>ä¸»ä»æ¨¡å‹ä¸­ï¼Œäº‹åŠ¡ä¸­çš„æ•°æ®è¯»å†™å‡ç”¨ä¸»åº“</code>ã€‚</p><ul><li>ä¸æ·»åŠ @Transactionalï¼šinsertå¯¹ä¸»åº“æ“ä½œï¼Œselectå¯¹ä»åº“æ“ä½œ</li><li>æ·»åŠ @Transactionalï¼šåˆ™insertå’Œselectå‡å¯¹ä¸»åº“æ“ä½œ</li><li>**æ³¨æ„ï¼š**åœ¨JUnitç¯å¢ƒä¸‹çš„@Transactionalæ³¨è§£ï¼Œé»˜è®¤æƒ…å†µä¸‹å°±ä¼šå¯¹äº‹åŠ¡è¿›è¡Œå›æ»šï¼ˆå³ä½¿åœ¨æ²¡åŠ æ³¨è§£@Rollbackï¼Œä¹Ÿä¼šå¯¹äº‹åŠ¡å›æ»šï¼‰</li></ul><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * äº‹åŠ¡æµ‹è¯•
 */</span>
<span class="token annotation punctuation">@Transactional</span><span class="token comment">//å¼€å¯äº‹åŠ¡</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testTrans</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

    <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    user<span class="token punctuation">.</span><span class="token function">setUname</span><span class="token punctuation">(</span><span class="token string">&quot;é“é”¤&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    userMapper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> users <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">selectList</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-3ã€è´Ÿè½½å‡è¡¡æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_2-3ã€è´Ÿè½½å‡è¡¡æµ‹è¯•" aria-hidden="true">#</a> 2.3ã€è´Ÿè½½å‡è¡¡æµ‹è¯•</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * è¯»æ•°æ®æµ‹è¯•
 */</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSelectAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> users <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">selectList</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> users <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">selectList</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ‰§è¡Œç¬¬äºŒæ¬¡æµ‹è¯•è´Ÿè½½å‡è¡¡</span>
    users<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¹Ÿå¯ä»¥åœ¨webè¯·æ±‚ä¸­æµ‹è¯•è´Ÿè½½å‡è¡¡</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>shardingjdbcdemo<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/userController&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">UserMapper</span> userMapper<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * æµ‹è¯•è´Ÿè½½å‡è¡¡ç­–ç•¥
     */</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;selectAll&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">selectAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> users <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">selectList</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        users<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ç¬¬05ç« -shardingsphere-jdbcå‚ç›´åˆ†ç‰‡" tabindex="-1"><a class="header-anchor" href="#ç¬¬05ç« -shardingsphere-jdbcå‚ç›´åˆ†ç‰‡" aria-hidden="true">#</a> ç¬¬05ç«  ShardingSphere-JDBCå‚ç›´åˆ†ç‰‡</h2><h3 id="_1ã€å‡†å¤‡æœåŠ¡å™¨" tabindex="-1"><a class="header-anchor" href="#_1ã€å‡†å¤‡æœåŠ¡å™¨" aria-hidden="true">#</a> 1ã€å‡†å¤‡æœåŠ¡å™¨</h3><p>æœåŠ¡å™¨è§„åˆ’ï¼šä½¿ç”¨<code>docker</code>æ–¹å¼åˆ›å»ºå¦‚ä¸‹å®¹å™¨</p><p><img src="/assets/image-20220807232456342-826a59e6.png" alt="image-20220807232456342"></p><ul><li><p>æœåŠ¡å™¨ï¼šå®¹å™¨å<code>server-user</code>ï¼Œç«¯å£<code>3301</code></p></li><li><p>æœåŠ¡å™¨ï¼šå®¹å™¨å<code>server-order</code>ï¼Œç«¯å£<code>3302</code></p></li></ul><h4 id="_1-1ã€åˆ›å»ºserver-userå®¹å™¨" tabindex="-1"><a class="header-anchor" href="#_1-1ã€åˆ›å»ºserver-userå®¹å™¨" aria-hidden="true">#</a> 1.1ã€åˆ›å»ºserver-userå®¹å™¨</h4><ul><li><strong>step1ï¼šåˆ›å»ºå®¹å™¨ï¼š</strong></li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-p</span> <span class="token number">3301</span>:3306 <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /atguigu/server/user/conf:/etc/mysql/conf.d <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /atguigu/server/user/data:/var/lib/mysql <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span><span class="token number">123456</span> <span class="token punctuation">\</span>
<span class="token parameter variable">--name</span> server-user <span class="token punctuation">\</span>
mysql:8.0.29
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>step2ï¼šç™»å½•MySQLæœåŠ¡å™¨ï¼š</strong></li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment">#è¿›å…¥å®¹å™¨ï¼š</span>
<span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> server-user <span class="token function">env</span> <span class="token assign-left variable"><span class="token environment constant">LANG</span></span><span class="token operator">=</span>C.UTF-8 /bin/bash
<span class="token comment">#è¿›å…¥å®¹å™¨å†…çš„mysqlå‘½ä»¤è¡Œ</span>
mysql <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-p</span>
<span class="token comment">#ä¿®æ”¹é»˜è®¤å¯†ç æ’ä»¶</span>
ALTER <span class="token environment constant">USER</span> <span class="token string">&#39;root&#39;</span>@<span class="token string">&#39;%&#39;</span> IDENTIFIED WITH mysql_native_password BY <span class="token string">&#39;123456&#39;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>step3ï¼šåˆ›å»ºæ•°æ®åº“ï¼š</strong></li></ul><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> db_user<span class="token punctuation">;</span>
<span class="token keyword">USE</span> db_user<span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> t_user <span class="token punctuation">(</span>
 id <span class="token keyword">BIGINT</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
 uname <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
 <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_1-2ã€åˆ›å»ºserver-orderå®¹å™¨" tabindex="-1"><a class="header-anchor" href="#_1-2ã€åˆ›å»ºserver-orderå®¹å™¨" aria-hidden="true">#</a> 1.2ã€åˆ›å»ºserver-orderå®¹å™¨</h4><ul><li><strong>step1ï¼šåˆ›å»ºå®¹å™¨ï¼š</strong></li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-p</span> <span class="token number">3302</span>:3306 <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /atguigu/server/order/conf:/etc/mysql/conf.d <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /atguigu/server/order/data:/var/lib/mysql <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span><span class="token number">123456</span> <span class="token punctuation">\</span>
<span class="token parameter variable">--name</span> server-order <span class="token punctuation">\</span>
mysql:8.0.29
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>step2ï¼šç™»å½•MySQLæœåŠ¡å™¨ï¼š</strong></li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment">#è¿›å…¥å®¹å™¨ï¼š</span>
<span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> server-order <span class="token function">env</span> <span class="token assign-left variable"><span class="token environment constant">LANG</span></span><span class="token operator">=</span>C.UTF-8 /bin/bash
<span class="token comment">#è¿›å…¥å®¹å™¨å†…çš„mysqlå‘½ä»¤è¡Œ</span>
mysql <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-p</span>
<span class="token comment">#ä¿®æ”¹é»˜è®¤å¯†ç æ’ä»¶</span>
ALTER <span class="token environment constant">USER</span> <span class="token string">&#39;root&#39;</span>@<span class="token string">&#39;%&#39;</span> IDENTIFIED WITH mysql_native_password BY <span class="token string">&#39;123456&#39;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>step3ï¼šåˆ›å»ºæ•°æ®åº“ï¼š</strong></li></ul><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> db_order<span class="token punctuation">;</span>
<span class="token keyword">USE</span> db_order<span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> t_order <span class="token punctuation">(</span>
  id <span class="token keyword">BIGINT</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
  order_no <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  user_id <span class="token keyword">BIGINT</span><span class="token punctuation">,</span>
  amount <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> 
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2ã€ç¨‹åºå®ç°" tabindex="-1"><a class="header-anchor" href="#_2ã€ç¨‹åºå®ç°" aria-hidden="true">#</a> 2ã€ç¨‹åºå®ç°</h3><h4 id="_2-1ã€åˆ›å»ºå®ä½“ç±»" tabindex="-1"><a class="header-anchor" href="#_2-1ã€åˆ›å»ºå®ä½“ç±»" aria-hidden="true">#</a> 2.1ã€åˆ›å»ºå®ä½“ç±»</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>shardingjdbcdemo<span class="token punctuation">.</span>entity</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@TableName</span><span class="token punctuation">(</span><span class="token string">&quot;t_order&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Order</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@TableId</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">IdType</span><span class="token punctuation">.</span><span class="token constant">AUTO</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> orderNo<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> userId<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">BigDecimal</span> amount<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-2ã€åˆ›å»ºmapper" tabindex="-1"><a class="header-anchor" href="#_2-2ã€åˆ›å»ºmapper" aria-hidden="true">#</a> 2.2ã€åˆ›å»ºMapper</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>shardingjdbcdemo<span class="token punctuation">.</span>mapper</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Mapper</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">OrderMapper</span> <span class="token keyword">extends</span> <span class="token class-name">BaseMapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Order</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-3ã€é…ç½®å‚ç›´åˆ†ç‰‡" tabindex="-1"><a class="header-anchor" href="#_2-3ã€é…ç½®å‚ç›´åˆ†ç‰‡" aria-hidden="true">#</a> 2.3ã€é…ç½®å‚ç›´åˆ†ç‰‡</h4><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token comment"># åº”ç”¨åç§°</span>
<span class="token key attr-name">spring.application.name</span><span class="token punctuation">=</span><span class="token value attr-value">sharding-jdbc-demo</span>
<span class="token comment"># ç¯å¢ƒè®¾ç½®</span>
<span class="token key attr-name">spring.profiles.active</span><span class="token punctuation">=</span><span class="token value attr-value">dev</span>

<span class="token comment"># é…ç½®çœŸå®æ•°æ®æº</span>
<span class="token key attr-name">spring.shardingsphere.datasource.names</span><span class="token punctuation">=</span><span class="token value attr-value">server-user,server-order</span>

<span class="token comment"># é…ç½®ç¬¬ 1 ä¸ªæ•°æ®æº</span>
<span class="token key attr-name">spring.shardingsphere.datasource.server-user.type</span><span class="token punctuation">=</span><span class="token value attr-value">com.zaxxer.hikari.HikariDataSource</span>
<span class="token key attr-name">spring.shardingsphere.datasource.server-user.driver-class-name</span><span class="token punctuation">=</span><span class="token value attr-value">com.mysql.jdbc.Driver</span>
<span class="token key attr-name">spring.shardingsphere.datasource.server-user.jdbc-url</span><span class="token punctuation">=</span><span class="token value attr-value">jdbc:mysql://192.168.100.201:3301/db_user</span>
<span class="token key attr-name">spring.shardingsphere.datasource.server-user.username</span><span class="token punctuation">=</span><span class="token value attr-value">root</span>
<span class="token key attr-name">spring.shardingsphere.datasource.server-user.password</span><span class="token punctuation">=</span><span class="token value attr-value">123456</span>

<span class="token comment"># é…ç½®ç¬¬ 2 ä¸ªæ•°æ®æº</span>
<span class="token key attr-name">spring.shardingsphere.datasource.server-order.type</span><span class="token punctuation">=</span><span class="token value attr-value">com.zaxxer.hikari.HikariDataSource</span>
<span class="token key attr-name">spring.shardingsphere.datasource.server-order.driver-class-name</span><span class="token punctuation">=</span><span class="token value attr-value">com.mysql.jdbc.Driver</span>
<span class="token key attr-name">spring.shardingsphere.datasource.server-order.jdbc-url</span><span class="token punctuation">=</span><span class="token value attr-value">jdbc:mysql://192.168.100.201:3302/db_order</span>
<span class="token key attr-name">spring.shardingsphere.datasource.server-order.username</span><span class="token punctuation">=</span><span class="token value attr-value">root</span>
<span class="token key attr-name">spring.shardingsphere.datasource.server-order.password</span><span class="token punctuation">=</span><span class="token value attr-value">123456</span>

<span class="token comment"># æ ‡å‡†åˆ†ç‰‡è¡¨é…ç½®ï¼ˆæ•°æ®èŠ‚ç‚¹ï¼‰</span>
<span class="token comment"># spring.shardingsphere.rules.sharding.tables.&lt;table-name&gt;.actual-data-nodes=å€¼</span>
<span class="token comment"># å€¼ç”±æ•°æ®æºå + è¡¨åç»„æˆï¼Œä»¥å°æ•°ç‚¹åˆ†éš”ã€‚</span>
<span class="token comment"># &lt;table-name&gt;ï¼šé€»è¾‘è¡¨å</span>
<span class="token key attr-name">spring.shardingsphere.rules.sharding.tables.t_user.actual-data-nodes</span><span class="token punctuation">=</span><span class="token value attr-value">server-user.t_user</span>
<span class="token key attr-name">spring.shardingsphere.rules.sharding.tables.t_order.actual-data-nodes</span><span class="token punctuation">=</span><span class="token value attr-value">server-order.t_order</span>


<span class="token comment"># æ‰“å°SQL</span>
<span class="token key attr-name">spring.shardingsphere.props.sql-show</span><span class="token punctuation">=</span><span class="token value attr-value">true</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3ã€æµ‹è¯•å‚ç›´åˆ†ç‰‡" tabindex="-1"><a class="header-anchor" href="#_3ã€æµ‹è¯•å‚ç›´åˆ†ç‰‡" aria-hidden="true">#</a> 3ã€æµ‹è¯•å‚ç›´åˆ†ç‰‡</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>shardingjdbcdemo</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ShardingTest</span> <span class="token punctuation">{</span>


    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">UserMapper</span> userMapper<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">OrderMapper</span> orderMapper<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * å‚ç›´åˆ†ç‰‡ï¼šæ’å…¥æ•°æ®æµ‹è¯•
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testInsertOrderAndUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setUname</span><span class="token punctuation">(</span><span class="token string">&quot;å¼ºå“¥&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        userMapper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Order</span> order <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Order</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        order<span class="token punctuation">.</span><span class="token function">setOrderNo</span><span class="token punctuation">(</span><span class="token string">&quot;ATGUIGU001&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        order<span class="token punctuation">.</span><span class="token function">setUserId</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        order<span class="token punctuation">.</span><span class="token function">setAmount</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        orderMapper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * å‚ç›´åˆ†ç‰‡ï¼šæŸ¥è¯¢æ•°æ®æµ‹è¯•
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSelectFromOrderAndUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">selectById</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Order</span> order <span class="token operator">=</span> orderMapper<span class="token punctuation">.</span><span class="token function">selectById</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="å¸¸è§é”™è¯¯" tabindex="-1"><a class="header-anchor" href="#å¸¸è§é”™è¯¯" aria-hidden="true">#</a> å¸¸è§é”™è¯¯</h4><p><img src="/assets/image-20220810163534068-ce00f181.png" alt="image-20220810163534068"></p><p>ShardingSphere-JDBCè¿œç¨‹è¿æ¥çš„æ–¹å¼é»˜è®¤çš„å¯†ç åŠ å¯†è§„åˆ™æ˜¯ï¼šmysql_native_password</p><p>å› æ­¤éœ€è¦åœ¨æœåŠ¡å™¨ç«¯ä¿®æ”¹æœåŠ¡å™¨çš„å¯†ç åŠ å¯†è§„åˆ™ï¼Œå¦‚ä¸‹ï¼š</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">ALTER</span> <span class="token keyword">USER</span> <span class="token string">&#39;root&#39;</span><span class="token variable">@&#39;%&#39;</span> IDENTIFIED <span class="token keyword">WITH</span> mysql_native_password <span class="token keyword">BY</span> <span class="token string">&#39;123456&#39;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="ç¬¬06ç« -shardingsphere-jdbcæ°´å¹³åˆ†ç‰‡" tabindex="-1"><a class="header-anchor" href="#ç¬¬06ç« -shardingsphere-jdbcæ°´å¹³åˆ†ç‰‡" aria-hidden="true">#</a> ç¬¬06ç«  ShardingSphere-JDBCæ°´å¹³åˆ†ç‰‡</h2><h3 id="_1ã€å‡†å¤‡æœåŠ¡å™¨-1" tabindex="-1"><a class="header-anchor" href="#_1ã€å‡†å¤‡æœåŠ¡å™¨-1" aria-hidden="true">#</a> 1ã€å‡†å¤‡æœåŠ¡å™¨</h3><p>æœåŠ¡å™¨è§„åˆ’ï¼šä½¿ç”¨<code>docker</code>æ–¹å¼åˆ›å»ºå¦‚ä¸‹å®¹å™¨</p><p><img src="/assets/image-20220808033239206-2395791f.png" alt="image-20220808033239206"></p><ul><li><p>æœåŠ¡å™¨ï¼šå®¹å™¨å<code>server-order0</code>ï¼Œç«¯å£<code>3310</code></p></li><li><p>æœåŠ¡å™¨ï¼šå®¹å™¨å<code>server-order1</code>ï¼Œç«¯å£<code>3311</code></p></li></ul><h4 id="_1-1ã€åˆ›å»ºserver-order0å®¹å™¨" tabindex="-1"><a class="header-anchor" href="#_1-1ã€åˆ›å»ºserver-order0å®¹å™¨" aria-hidden="true">#</a> 1.1ã€åˆ›å»ºserver-order0å®¹å™¨</h4><ul><li><strong>step1ï¼šåˆ›å»ºå®¹å™¨ï¼š</strong></li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-p</span> <span class="token number">3310</span>:3306 <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /atguigu/server/order0/conf:/etc/mysql/conf.d <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /atguigu/server/order0/data:/var/lib/mysql <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span><span class="token number">123456</span> <span class="token punctuation">\</span>
<span class="token parameter variable">--name</span> server-order0 <span class="token punctuation">\</span>
mysql:8.0.29
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>step2ï¼šç™»å½•MySQLæœåŠ¡å™¨ï¼š</strong></li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment">#è¿›å…¥å®¹å™¨ï¼š</span>
<span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> server-order0 <span class="token function">env</span> <span class="token assign-left variable"><span class="token environment constant">LANG</span></span><span class="token operator">=</span>C.UTF-8 /bin/bash
<span class="token comment">#è¿›å…¥å®¹å™¨å†…çš„mysqlå‘½ä»¤è¡Œ</span>
mysql <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-p</span>
<span class="token comment">#ä¿®æ”¹é»˜è®¤å¯†ç æ’ä»¶</span>
ALTER <span class="token environment constant">USER</span> <span class="token string">&#39;root&#39;</span>@<span class="token string">&#39;%&#39;</span> IDENTIFIED WITH mysql_native_password BY <span class="token string">&#39;123456&#39;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>step3ï¼šåˆ›å»ºæ•°æ®åº“ï¼š</strong></li></ul><p><code>æ³¨æ„ï¼š</code>æ°´å¹³åˆ†ç‰‡çš„idéœ€è¦åœ¨ä¸šåŠ¡å±‚å®ç°ï¼Œ<code>ä¸èƒ½ä¾èµ–æ•°æ®åº“çš„ä¸»é”®è‡ªå¢</code></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> db_order<span class="token punctuation">;</span>
<span class="token keyword">USE</span> db_order<span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> t_order0 <span class="token punctuation">(</span>
  id <span class="token keyword">BIGINT</span><span class="token punctuation">,</span>
  order_no <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  user_id <span class="token keyword">BIGINT</span><span class="token punctuation">,</span>
  amount <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> 
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> t_order1 <span class="token punctuation">(</span>
  id <span class="token keyword">BIGINT</span><span class="token punctuation">,</span>
  order_no <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  user_id <span class="token keyword">BIGINT</span><span class="token punctuation">,</span>
  amount <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> 
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-2ã€åˆ›å»ºserver-order1å®¹å™¨" tabindex="-1"><a class="header-anchor" href="#_1-2ã€åˆ›å»ºserver-order1å®¹å™¨" aria-hidden="true">#</a> 1.2ã€åˆ›å»ºserver-order1å®¹å™¨</h3><ul><li><strong>step1ï¼šåˆ›å»ºå®¹å™¨ï¼š</strong></li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-p</span> <span class="token number">3311</span>:3306 <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /atguigu/server/order1/conf:/etc/mysql/conf.d <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /atguigu/server/order1/data:/var/lib/mysql <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span><span class="token number">123456</span> <span class="token punctuation">\</span>
<span class="token parameter variable">--name</span> server-order1 <span class="token punctuation">\</span>
mysql:8.0.29
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>step2ï¼šç™»å½•MySQLæœåŠ¡å™¨ï¼š</strong></li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment">#è¿›å…¥å®¹å™¨ï¼š</span>
<span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> server-order1 <span class="token function">env</span> <span class="token assign-left variable"><span class="token environment constant">LANG</span></span><span class="token operator">=</span>C.UTF-8 /bin/bash
<span class="token comment">#è¿›å…¥å®¹å™¨å†…çš„mysqlå‘½ä»¤è¡Œ</span>
mysql <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-p</span>
<span class="token comment">#ä¿®æ”¹é»˜è®¤å¯†ç æ’ä»¶</span>
ALTER <span class="token environment constant">USER</span> <span class="token string">&#39;root&#39;</span>@<span class="token string">&#39;%&#39;</span> IDENTIFIED WITH mysql_native_password BY <span class="token string">&#39;123456&#39;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>**step3ï¼šåˆ›å»ºæ•°æ®åº“ï¼š**å’Œserver-order0ç›¸åŒ</li></ul><p><code>æ³¨æ„ï¼š</code>æ°´å¹³åˆ†ç‰‡çš„idéœ€è¦åœ¨ä¸šåŠ¡å±‚å®ç°ï¼Œä¸èƒ½ä¾èµ–æ•°æ®åº“çš„ä¸»é”®è‡ªå¢</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> db_order<span class="token punctuation">;</span>
<span class="token keyword">USE</span> db_order<span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> t_order0 <span class="token punctuation">(</span>
  id <span class="token keyword">BIGINT</span><span class="token punctuation">,</span>
  order_no <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  user_id <span class="token keyword">BIGINT</span><span class="token punctuation">,</span>
  amount <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> 
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> t_order1 <span class="token punctuation">(</span>
  id <span class="token keyword">BIGINT</span><span class="token punctuation">,</span>
  order_no <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  user_id <span class="token keyword">BIGINT</span><span class="token punctuation">,</span>
  amount <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> 
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2ã€åŸºæœ¬æ°´å¹³åˆ†ç‰‡" tabindex="-1"><a class="header-anchor" href="#_2ã€åŸºæœ¬æ°´å¹³åˆ†ç‰‡" aria-hidden="true">#</a> 2ã€åŸºæœ¬æ°´å¹³åˆ†ç‰‡</h3><h4 id="_2-1ã€åŸºæœ¬é…ç½®" tabindex="-1"><a class="header-anchor" href="#_2-1ã€åŸºæœ¬é…ç½®" aria-hidden="true">#</a> 2.1ã€åŸºæœ¬é…ç½®</h4><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token comment">#========================åŸºæœ¬é…ç½®</span>
<span class="token comment"># åº”ç”¨åç§°</span>
<span class="token key attr-name">spring.application.name</span><span class="token punctuation">=</span><span class="token value attr-value">sharging-jdbc-demo</span>
<span class="token comment"># å¼€å‘ç¯å¢ƒè®¾ç½®</span>
<span class="token key attr-name">spring.profiles.active</span><span class="token punctuation">=</span><span class="token value attr-value">dev</span>
<span class="token comment"># å†…å­˜æ¨¡å¼</span>
<span class="token key attr-name">spring.shardingsphere.mode.type</span><span class="token punctuation">=</span><span class="token value attr-value">Memory</span>
<span class="token comment"># æ‰“å°SQl</span>
<span class="token key attr-name">spring.shardingsphere.props.sql-show</span><span class="token punctuation">=</span><span class="token value attr-value">true</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-2ã€æ•°æ®æºé…ç½®" tabindex="-1"><a class="header-anchor" href="#_2-2ã€æ•°æ®æºé…ç½®" aria-hidden="true">#</a> 2.2ã€æ•°æ®æºé…ç½®</h4><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token comment">#========================æ•°æ®æºé…ç½®</span>
<span class="token comment"># é…ç½®çœŸå®æ•°æ®æº</span>
<span class="token key attr-name">spring.shardingsphere.datasource.names</span><span class="token punctuation">=</span><span class="token value attr-value">server-user,server-order0,server-order1</span>

<span class="token comment"># é…ç½®ç¬¬ 1 ä¸ªæ•°æ®æº</span>
<span class="token key attr-name">spring.shardingsphere.datasource.server-user.type</span><span class="token punctuation">=</span><span class="token value attr-value">com.zaxxer.hikari.HikariDataSource</span>
<span class="token key attr-name">spring.shardingsphere.datasource.server-user.driver-class-name</span><span class="token punctuation">=</span><span class="token value attr-value">com.mysql.jdbc.Driver</span>
<span class="token key attr-name">spring.shardingsphere.datasource.server-user.jdbc-url</span><span class="token punctuation">=</span><span class="token value attr-value">jdbc:mysql://192.168.100.201:3301/db_user</span>
<span class="token key attr-name">spring.shardingsphere.datasource.server-user.username</span><span class="token punctuation">=</span><span class="token value attr-value">root</span>
<span class="token key attr-name">spring.shardingsphere.datasource.server-user.password</span><span class="token punctuation">=</span><span class="token value attr-value">123456</span>

<span class="token comment"># é…ç½®ç¬¬ 2 ä¸ªæ•°æ®æº</span>
<span class="token key attr-name">spring.shardingsphere.datasource.server-order.type</span><span class="token punctuation">=</span><span class="token value attr-value">com.zaxxer.hikari.HikariDataSource</span>
<span class="token key attr-name">spring.shardingsphere.datasource.server-order.driver-class-name</span><span class="token punctuation">=</span><span class="token value attr-value">com.mysql.jdbc.Driver</span>
<span class="token key attr-name">spring.shardingsphere.datasource.server-order.jdbc-url</span><span class="token punctuation">=</span><span class="token value attr-value">jdbc:mysql://192.168.100.201:3310/db_order</span>
<span class="token key attr-name">spring.shardingsphere.datasource.server-order.username</span><span class="token punctuation">=</span><span class="token value attr-value">root</span>
<span class="token key attr-name">spring.shardingsphere.datasource.server-order.password</span><span class="token punctuation">=</span><span class="token value attr-value">123456</span>

<span class="token comment"># é…ç½®ç¬¬ 3 ä¸ªæ•°æ®æº</span>
<span class="token key attr-name">spring.shardingsphere.datasource.server-order.type</span><span class="token punctuation">=</span><span class="token value attr-value">com.zaxxer.hikari.HikariDataSource</span>
<span class="token key attr-name">spring.shardingsphere.datasource.server-order.driver-class-name</span><span class="token punctuation">=</span><span class="token value attr-value">com.mysql.jdbc.Driver</span>
<span class="token key attr-name">spring.shardingsphere.datasource.server-order.jdbc-url</span><span class="token punctuation">=</span><span class="token value attr-value">jdbc:mysql://192.168.100.201:3311/db_order</span>
<span class="token key attr-name">spring.shardingsphere.datasource.server-order.username</span><span class="token punctuation">=</span><span class="token value attr-value">root</span>
<span class="token key attr-name">spring.shardingsphere.datasource.server-order.password</span><span class="token punctuation">=</span><span class="token value attr-value">123456</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-3ã€æ ‡æ¤åˆ†ç‰‡è¡¨é…ç½®" tabindex="-1"><a class="header-anchor" href="#_2-3ã€æ ‡æ¤åˆ†ç‰‡è¡¨é…ç½®" aria-hidden="true">#</a> 2.3ã€æ ‡æ¤åˆ†ç‰‡è¡¨é…ç½®</h4><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token comment">#========================æ ‡å‡†åˆ†ç‰‡è¡¨é…ç½®ï¼ˆæ•°æ®èŠ‚ç‚¹é…ç½®ï¼‰</span>
<span class="token comment"># spring.shardingsphere.rules.sharding.tables.&lt;table-name&gt;.actual-data-nodes=å€¼</span>
<span class="token comment"># å€¼ç”±æ•°æ®æºå + è¡¨åç»„æˆï¼Œä»¥å°æ•°ç‚¹åˆ†éš”ã€‚å¤šä¸ªè¡¨ä»¥é€—å·åˆ†éš”ï¼Œæ”¯æŒ inline è¡¨è¾¾å¼ã€‚</span>
<span class="token comment"># &lt;table-name&gt;ï¼šé€»è¾‘è¡¨å</span>
<span class="token key attr-name">spring.shardingsphere.rules.sharding.tables.t_user.actual-data-nodes</span><span class="token punctuation">=</span><span class="token value attr-value">server-user.t_user</span>
<span class="token key attr-name">spring.shardingsphere.rules.sharding.tables.t_order.actual-data-nodes</span><span class="token punctuation">=</span><span class="token value attr-value">server-order0.t_order0,server-order0.t_order1,server-order1.t_order0,server-order1.t_order1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¿®æ”¹Orderå®ä½“ç±»çš„ä¸»é”®ç­–ç•¥ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//@TableId(type = IdType.AUTO)//ä¾èµ–æ•°æ®åº“çš„ä¸»é”®è‡ªå¢ç­–ç•¥</span>
<span class="token annotation punctuation">@TableId</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">IdType</span><span class="token punctuation">.</span><span class="token constant">ASSIGN_ID</span><span class="token punctuation">)</span><span class="token comment">//åˆ†å¸ƒå¼id</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>æµ‹è¯•ï¼šä¿ç•™ä¸Šé¢é…ç½®ä¸­çš„ä¸€ä¸ªåˆ†ç‰‡è¡¨èŠ‚ç‚¹åˆ†åˆ«è¿›è¡Œæµ‹è¯•ï¼Œæ£€æŸ¥æ¯ä¸ªåˆ†ç‰‡èŠ‚ç‚¹æ˜¯å¦å¯ç”¨</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
     * æ°´å¹³åˆ†ç‰‡ï¼šæ’å…¥æ•°æ®æµ‹è¯•
     */</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testInsertOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

    <span class="token class-name">Order</span> order <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Order</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    order<span class="token punctuation">.</span><span class="token function">setOrderNo</span><span class="token punctuation">(</span><span class="token string">&quot;ATGUIGU001&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    order<span class="token punctuation">.</span><span class="token function">setUserId</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    order<span class="token punctuation">.</span><span class="token function">setAmount</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    orderMapper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-4ã€è¡Œè¡¨è¾¾å¼" tabindex="-1"><a class="header-anchor" href="#_2-4ã€è¡Œè¡¨è¾¾å¼" aria-hidden="true">#</a> 2.4ã€è¡Œè¡¨è¾¾å¼</h3><p>ä¼˜åŒ–ä¸Šä¸€æ­¥çš„åˆ†ç‰‡è¡¨é…ç½®</p><p>https://shardingsphere.apache.org/document/5.1.1/cn/features/sharding/concept/inline-expression/</p><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token comment">#========================æ ‡å‡†åˆ†ç‰‡è¡¨é…ç½®ï¼ˆæ•°æ®èŠ‚ç‚¹é…ç½®ï¼‰</span>
<span class="token comment"># spring.shardingsphere.rules.sharding.tables.&lt;table-name&gt;.actual-data-nodes=å€¼</span>
<span class="token comment"># å€¼ç”±æ•°æ®æºå + è¡¨åç»„æˆï¼Œä»¥å°æ•°ç‚¹åˆ†éš”ã€‚å¤šä¸ªè¡¨ä»¥é€—å·åˆ†éš”ï¼Œæ”¯æŒ inline è¡¨è¾¾å¼ã€‚</span>
<span class="token comment"># &lt;table-name&gt;ï¼šé€»è¾‘è¡¨å</span>
<span class="token key attr-name">spring.shardingsphere.rules.sharding.tables.t_user.actual-data-nodes</span><span class="token punctuation">=</span><span class="token value attr-value">server-user.t_user</span>
<span class="token key attr-name">spring.shardingsphere.rules.sharding.tables.t_order.actual-data-nodes</span><span class="token punctuation">=</span><span class="token value attr-value">server-order$-&gt;{0..1}.t_order$-&gt;{0..1}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-5ã€åˆ†ç‰‡ç®—æ³•é…ç½®" tabindex="-1"><a class="header-anchor" href="#_2-5ã€åˆ†ç‰‡ç®—æ³•é…ç½®" aria-hidden="true">#</a> 2.5ã€åˆ†ç‰‡ç®—æ³•é…ç½®</h3><p><strong>æ°´å¹³åˆ†åº“ï¼š</strong></p><p>åˆ†ç‰‡è§„åˆ™ï¼šorderè¡¨ä¸­<code>user_id</code>ä¸ºå¶æ•°æ—¶ï¼Œæ•°æ®æ’å…¥<code>server-order0æœåŠ¡å™¨</code>ï¼Œ<code>user_id</code>ä¸ºå¥‡æ•°æ—¶ï¼Œæ•°æ®æ’å…¥<code>server-order1æœåŠ¡å™¨</code>ã€‚è¿™æ ·åˆ†ç‰‡çš„å¥½å¤„æ˜¯ï¼ŒåŒä¸€ä¸ªç”¨æˆ·çš„è®¢å•æ•°æ®ï¼Œä¸€å®šä¼šè¢«æ’å…¥åˆ°åŒä¸€å°æœåŠ¡å™¨ä¸Šï¼ŒæŸ¥è¯¢ä¸€ä¸ªç”¨æˆ·çš„è®¢å•æ—¶æ•ˆç‡è¾ƒé«˜ã€‚</p><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token comment">#------------------------åˆ†åº“ç­–ç•¥</span>
<span class="token comment"># åˆ†ç‰‡åˆ—åç§°</span>
<span class="token key attr-name">spring.shardingsphere.rules.sharding.tables.t_order.database-strategy.standard.sharding-column</span><span class="token punctuation">=</span><span class="token value attr-value">user_id</span>
<span class="token comment"># åˆ†ç‰‡ç®—æ³•åç§°</span>
<span class="token key attr-name">spring.shardingsphere.rules.sharding.tables.t_order.database-strategy.standard.sharding-algorithm-name</span><span class="token punctuation">=</span><span class="token value attr-value">alg_inline_userid</span>

<span class="token comment">#------------------------åˆ†ç‰‡ç®—æ³•é…ç½®</span>
<span class="token comment"># è¡Œè¡¨è¾¾å¼åˆ†ç‰‡ç®—æ³•</span>
<span class="token comment"># åˆ†ç‰‡ç®—æ³•ç±»å‹</span>
<span class="token key attr-name">spring.shardingsphere.rules.sharding.sharding-algorithms.alg_inline_userid.type</span><span class="token punctuation">=</span><span class="token value attr-value">INLINE</span>
<span class="token comment"># åˆ†ç‰‡ç®—æ³•å±æ€§é…ç½®</span>
<span class="token key attr-name">spring.shardingsphere.rules.sharding.sharding-algorithms.alg_inline_userid.props.algorithm-expression</span><span class="token punctuation">=</span><span class="token value attr-value">server-order$-&gt;{user_id % 2}</span>

<span class="token comment"># å–æ¨¡åˆ†ç‰‡ç®—æ³•</span>
<span class="token comment"># åˆ†ç‰‡ç®—æ³•ç±»å‹</span>
<span class="token key attr-name">spring.shardingsphere.rules.sharding.sharding-algorithms.alg_mod.type</span><span class="token punctuation">=</span><span class="token value attr-value">MOD</span>
<span class="token comment"># åˆ†ç‰‡ç®—æ³•å±æ€§é…ç½®</span>
<span class="token key attr-name">spring.shardingsphere.rules.sharding.sharding-algorithms.alg_mod.props.sharding-count</span><span class="token punctuation">=</span><span class="token value attr-value">2</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸ºäº†æ–¹ä¾¿æµ‹è¯•ï¼Œå…ˆè®¾ç½®åªåœ¨ <code>t_order0</code>è¡¨ä¸Šè¿›è¡Œæµ‹è¯•</p><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token key attr-name">xxx.actual-data-nodes</span><span class="token punctuation">=</span><span class="token value attr-value">server-order$-&gt;{0..1}.t_order0</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>æµ‹è¯•ï¼šå¯ä»¥åˆ†åˆ«æµ‹è¯•è¡Œè¡¨è¾¾å¼åˆ†ç‰‡ç®—æ³•å’Œå–æ¨¡åˆ†ç‰‡ç®—æ³•</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
     * æ°´å¹³åˆ†ç‰‡ï¼šåˆ†åº“æ’å…¥æ•°æ®æµ‹è¯•
     */</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testInsertOrderDatabaseStrategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">long</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Order</span> order <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Order</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        order<span class="token punctuation">.</span><span class="token function">setOrderNo</span><span class="token punctuation">(</span><span class="token string">&quot;ATGUIGU001&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        order<span class="token punctuation">.</span><span class="token function">setUserId</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        order<span class="token punctuation">.</span><span class="token function">setAmount</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        orderMapper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æ°´å¹³åˆ†è¡¨ï¼š</strong></p><p>åˆ†ç‰‡è§„åˆ™ï¼šorderè¡¨ä¸­<code>order_noçš„å“ˆå¸Œå€¼ä¸ºå¶æ•°æ—¶</code>ï¼Œæ•°æ®æ’å…¥å¯¹åº”æœåŠ¡å™¨çš„<code>t_order0è¡¨</code>ï¼Œ<code>order_noçš„å“ˆå¸Œå€¼ä¸ºå¥‡æ•°æ—¶</code>ï¼Œæ•°æ®æ’å…¥å¯¹åº”æœåŠ¡å™¨çš„<code>t_order1è¡¨</code>ã€‚å› ä¸ºorder_noæ˜¯å­—ç¬¦ä¸²å½¢å¼ï¼Œå› æ­¤ä¸èƒ½ç›´æ¥å–æ¨¡ã€‚</p><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token comment">#------------------------åˆ†è¡¨ç­–ç•¥</span>
<span class="token comment"># åˆ†ç‰‡åˆ—åç§°</span>
<span class="token key attr-name">spring.shardingsphere.rules.sharding.tables.t_order.table-strategy.standard.sharding-column</span><span class="token punctuation">=</span><span class="token value attr-value">order_no</span>
<span class="token comment"># åˆ†ç‰‡ç®—æ³•åç§°</span>
<span class="token key attr-name">spring.shardingsphere.rules.sharding.tables.t_order.table-strategy.standard.sharding-algorithm-name</span><span class="token punctuation">=</span><span class="token value attr-value">alg_hash_mod</span>


<span class="token comment">#------------------------åˆ†ç‰‡ç®—æ³•é…ç½®</span>
<span class="token comment"># å“ˆå¸Œå–æ¨¡åˆ†ç‰‡ç®—æ³•</span>
<span class="token comment"># åˆ†ç‰‡ç®—æ³•ç±»å‹</span>
<span class="token key attr-name">spring.shardingsphere.rules.sharding.sharding-algorithms.alg_hash_mod.type</span><span class="token punctuation">=</span><span class="token value attr-value">HASH_MOD</span>
<span class="token comment"># åˆ†ç‰‡ç®—æ³•å±æ€§é…ç½®</span>
<span class="token key attr-name">spring.shardingsphere.rules.sharding.sharding-algorithms.alg_hash_mod.props.sharding-count</span><span class="token punctuation">=</span><span class="token value attr-value">2</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æµ‹è¯•å‰ä¸è¦å¿˜è®°å°†å¦‚ä¸‹èŠ‚ç‚¹æ”¹å›åŸæ¥çš„çŠ¶æ€</p><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token key attr-name">xxx.actual-data-nodes</span><span class="token punctuation">=</span><span class="token value attr-value">server-order$-&gt;{0..1}.t_order$-&gt;{0..1}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>æµ‹è¯•ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
     * æ°´å¹³åˆ†ç‰‡ï¼šåˆ†è¡¨æ’å…¥æ•°æ®æµ‹è¯•
     */</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testInsertOrderTableStrategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">long</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token class-name">Order</span> order <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Order</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        order<span class="token punctuation">.</span><span class="token function">setOrderNo</span><span class="token punctuation">(</span><span class="token string">&quot;ATGUIGU&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        order<span class="token punctuation">.</span><span class="token function">setUserId</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        order<span class="token punctuation">.</span><span class="token function">setAmount</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        orderMapper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">long</span> i <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">9</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token class-name">Order</span> order <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Order</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        order<span class="token punctuation">.</span><span class="token function">setOrderNo</span><span class="token punctuation">(</span><span class="token string">&quot;ATGUIGU&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        order<span class="token punctuation">.</span><span class="token function">setUserId</span><span class="token punctuation">(</span><span class="token number">2L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        order<span class="token punctuation">.</span><span class="token function">setAmount</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        orderMapper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token doc-comment comment">/**
     * æµ‹è¯•å“ˆå¸Œå–æ¨¡
     */</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

    <span class="token comment">//æ³¨æ„hashå–æ¨¡çš„ç»“æœæ˜¯æ•´ä¸ªå­—ç¬¦ä¸²hashåå†å–æ¨¡ï¼Œå’Œæ•°å€¼åç¼€æ˜¯å¥‡æ•°è¿˜æ˜¯å¶æ•°æ— å…³</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ATGUIGU001&quot;</span><span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ATGUIGU0011&quot;</span><span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æŸ¥è¯¢æµ‹è¯•ï¼š</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
     * æ°´å¹³åˆ†ç‰‡ï¼šæŸ¥è¯¢æ‰€æœ‰è®°å½•
     * æŸ¥è¯¢äº†ä¸¤ä¸ªæ•°æ®æºï¼Œæ¯ä¸ªæ•°æ®æºä¸­ä½¿ç”¨UNION ALLè¿æ¥ä¸¤ä¸ªè¡¨
     */</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testShardingSelectAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Order</span><span class="token punctuation">&gt;</span></span> orders <span class="token operator">=</span> orderMapper<span class="token punctuation">.</span><span class="token function">selectList</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    orders<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token doc-comment comment">/**
     * æ°´å¹³åˆ†ç‰‡ï¼šæ ¹æ®user_idæŸ¥è¯¢è®°å½•
     * æŸ¥è¯¢äº†ä¸€ä¸ªæ•°æ®æºï¼Œæ¯ä¸ªæ•°æ®æºä¸­ä½¿ç”¨UNION ALLè¿æ¥ä¸¤ä¸ªè¡¨
     */</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testShardingSelectByUserId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

    <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Order</span><span class="token punctuation">&gt;</span></span> orderQueryWrapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    orderQueryWrapper<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;user_id&quot;</span><span class="token punctuation">,</span> <span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Order</span><span class="token punctuation">&gt;</span></span> orders <span class="token operator">=</span> orderMapper<span class="token punctuation">.</span><span class="token function">selectList</span><span class="token punctuation">(</span>orderQueryWrapper<span class="token punctuation">)</span><span class="token punctuation">;</span>
    orders<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-6ã€åˆ†å¸ƒå¼åºåˆ—ç®—æ³•" tabindex="-1"><a class="header-anchor" href="#_2-6ã€åˆ†å¸ƒå¼åºåˆ—ç®—æ³•" aria-hidden="true">#</a> 2.6ã€åˆ†å¸ƒå¼åºåˆ—ç®—æ³•</h3><p><strong>é›ªèŠ±ç®—æ³•ï¼š</strong></p><p>https://shardingsphere.apache.org/document/5.1.1/cn/features/sharding/concept/key-generator/</p><p>æ°´å¹³åˆ†ç‰‡éœ€è¦å…³æ³¨å…¨å±€åºåˆ—ï¼Œå› ä¸ºä¸èƒ½ç®€å•çš„ä½¿ç”¨åŸºäºæ•°æ®åº“çš„ä¸»é”®è‡ªå¢ã€‚</p><p>è¿™é‡Œæœ‰ä¸¤ç§æ–¹æ¡ˆï¼šä¸€ç§æ˜¯åŸºäºMyBatisPlusçš„idç­–ç•¥ï¼›ä¸€ç§æ˜¯ShardingSphere-JDBCçš„å…¨å±€åºåˆ—é…ç½®ã€‚</p><p><code>åŸºäºMyBatisPlusçš„idç­–ç•¥ï¼š</code>å°†Orderç±»çš„idè®¾ç½®æˆå¦‚ä¸‹å½¢å¼</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@TableId</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">IdType</span><span class="token punctuation">.</span><span class="token constant">ASSIGN_ID</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><code>åŸºäºShardingSphere-JDBCçš„å…¨å±€åºåˆ—é…ç½®</code>ï¼šå’Œå‰é¢çš„MyBatisPlusçš„ç­–ç•¥äºŒé€‰ä¸€</p><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token comment">#------------------------åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥é…ç½®</span>
<span class="token comment"># åˆ†å¸ƒå¼åºåˆ—åˆ—åç§°</span>
<span class="token key attr-name">spring.shardingsphere.rules.sharding.tables.t_order.key-generate-strategy.column</span><span class="token punctuation">=</span><span class="token value attr-value">id</span>
<span class="token comment"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span>
<span class="token key attr-name">spring.shardingsphere.rules.sharding.tables.t_order.key-generate-strategy.key-generator-name</span><span class="token punctuation">=</span><span class="token value attr-value">alg_snowflake</span>

<span class="token comment"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•é…ç½®</span>
<span class="token comment"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•ç±»å‹</span>
<span class="token key attr-name">spring.shardingsphere.rules.sharding.key-generators.alg_snowflake.type</span><span class="token punctuation">=</span><span class="token value attr-value">SNOWFLAKE</span>
<span class="token comment"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•å±æ€§é…ç½®</span>
<span class="token comment">#spring.shardingsphere.rules.sharding.key-generators.alg_snowflake.props.xxx=</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ­¤æ—¶ï¼Œéœ€è¦å°†å®ä½“ç±»ä¸­çš„idç­–ç•¥ä¿®æ”¹æˆä»¥ä¸‹å½¢å¼ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//å½“é…ç½®äº†shardingsphere-jdbcçš„åˆ†å¸ƒå¼åºåˆ—æ—¶ï¼Œè‡ªåŠ¨ä½¿ç”¨shardingsphere-jdbcçš„åˆ†å¸ƒå¼åºåˆ—</span>
<span class="token comment">//å½“æ²¡æœ‰é…ç½®shardingsphere-jdbcçš„åˆ†å¸ƒå¼åºåˆ—æ—¶ï¼Œè‡ªåŠ¨ä¾èµ–æ•°æ®åº“çš„ä¸»é”®è‡ªå¢ç­–ç•¥</span>
<span class="token annotation punctuation">@TableId</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">IdType</span><span class="token punctuation">.</span><span class="token constant">AUTO</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3ã€å¤šè¡¨å…³è”" tabindex="-1"><a class="header-anchor" href="#_3ã€å¤šè¡¨å…³è”" aria-hidden="true">#</a> 3ã€å¤šè¡¨å…³è”</h3><h4 id="_3-1ã€åˆ›å»ºå…³è”è¡¨" tabindex="-1"><a class="header-anchor" href="#_3-1ã€åˆ›å»ºå…³è”è¡¨" aria-hidden="true">#</a> 3.1ã€åˆ›å»ºå…³è”è¡¨</h4><p>åœ¨<code>server-order0ã€server-order1</code>æœåŠ¡å™¨ä¸­åˆ†åˆ«åˆ›å»ºä¸¤å¼ è®¢å•è¯¦æƒ…è¡¨<code>t_order_item0ã€t_order_item1</code></p><p>æˆ‘ä»¬å¸Œæœ›<code>åŒä¸€ä¸ªç”¨æˆ·çš„è®¢å•è¡¨å’Œè®¢å•è¯¦æƒ…è¡¨ä¸­çš„æ•°æ®éƒ½åœ¨åŒä¸€ä¸ªæ•°æ®æºä¸­ï¼Œé¿å…è·¨åº“å…³è”</code>ï¼Œå› æ­¤è¿™ä¸¤å¼ è¡¨æˆ‘ä»¬ä½¿ç”¨ç›¸åŒçš„åˆ†ç‰‡ç­–ç•¥ã€‚</p><p>é‚£ä¹ˆåœ¨<code>t_order_item</code>ä¸­æˆ‘ä»¬ä¹Ÿéœ€è¦åˆ›å»º<code>order_no</code>å’Œ<code>user_id</code>è¿™ä¸¤ä¸ªåˆ†ç‰‡é”®</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> t_order_item0<span class="token punctuation">(</span>
    id <span class="token keyword">BIGINT</span><span class="token punctuation">,</span>
    order_no <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    user_id <span class="token keyword">BIGINT</span><span class="token punctuation">,</span>
    price <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>count<span class="token punctuation">`</span></span> <span class="token keyword">INT</span><span class="token punctuation">,</span>
    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> t_order_item1<span class="token punctuation">(</span>
    id <span class="token keyword">BIGINT</span><span class="token punctuation">,</span>
    order_no <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    user_id <span class="token keyword">BIGINT</span><span class="token punctuation">,</span>
    price <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>count<span class="token punctuation">`</span></span> <span class="token keyword">INT</span><span class="token punctuation">,</span>
    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-2ã€åˆ›å»ºå®ä½“ç±»" tabindex="-1"><a class="header-anchor" href="#_3-2ã€åˆ›å»ºå®ä½“ç±»" aria-hidden="true">#</a> 3.2ã€åˆ›å»ºå®ä½“ç±»</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>shardingjdbcdemo<span class="token punctuation">.</span>entity</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@TableName</span><span class="token punctuation">(</span><span class="token string">&quot;t_order_item&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderItem</span> <span class="token punctuation">{</span>
    <span class="token comment">//å½“é…ç½®äº†shardingsphere-jdbcçš„åˆ†å¸ƒå¼åºåˆ—æ—¶ï¼Œè‡ªåŠ¨ä½¿ç”¨shardingsphere-jdbcçš„åˆ†å¸ƒå¼åºåˆ—</span>
    <span class="token annotation punctuation">@TableId</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">IdType</span><span class="token punctuation">.</span><span class="token constant">AUTO</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> orderNo<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> userId<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">BigDecimal</span> price<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> count<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-3ã€åˆ›å»ºmapper" tabindex="-1"><a class="header-anchor" href="#_3-3ã€åˆ›å»ºmapper" aria-hidden="true">#</a> 3.3ã€åˆ›å»ºMapper</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>shargingjdbcdemo<span class="token punctuation">.</span>mapper</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Mapper</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">OrderItemMapper</span> <span class="token keyword">extends</span> <span class="token class-name">BaseMapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">OrderItem</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-4ã€é…ç½®å…³è”è¡¨" tabindex="-1"><a class="header-anchor" href="#_3-4ã€é…ç½®å…³è”è¡¨" aria-hidden="true">#</a> 3.4ã€é…ç½®å…³è”è¡¨</h4><p>t_order_itemçš„åˆ†ç‰‡è¡¨ã€åˆ†ç‰‡ç­–ç•¥ã€åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥å’Œt_orderä¸€è‡´</p><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token comment">#------------------------æ ‡å‡†åˆ†ç‰‡è¡¨é…ç½®ï¼ˆæ•°æ®èŠ‚ç‚¹é…ç½®ï¼‰</span>
<span class="token key attr-name">spring.shardingsphere.rules.sharding.tables.t_order_item.actual-data-nodes</span><span class="token punctuation">=</span><span class="token value attr-value">server-order$-&gt;{0..1}.t_order_item$-&gt;{0..1}</span>

<span class="token comment">#------------------------åˆ†åº“ç­–ç•¥</span>
<span class="token comment"># åˆ†ç‰‡åˆ—åç§°</span>
<span class="token key attr-name">spring.shardingsphere.rules.sharding.tables.t_order_item.database-strategy.standard.sharding-column</span><span class="token punctuation">=</span><span class="token value attr-value">user_id</span>
<span class="token comment"># åˆ†ç‰‡ç®—æ³•åç§°</span>
<span class="token key attr-name">spring.shardingsphere.rules.sharding.tables.t_order_item.database-strategy.standard.sharding-algorithm-name</span><span class="token punctuation">=</span><span class="token value attr-value">alg_mod</span>

<span class="token comment">#------------------------åˆ†è¡¨ç­–ç•¥</span>
<span class="token comment"># åˆ†ç‰‡åˆ—åç§°</span>
<span class="token key attr-name">spring.shardingsphere.rules.sharding.tables.t_order_item.table-strategy.standard.sharding-column</span><span class="token punctuation">=</span><span class="token value attr-value">order_no</span>
<span class="token comment"># åˆ†ç‰‡ç®—æ³•åç§°</span>
<span class="token key attr-name">spring.shardingsphere.rules.sharding.tables.t_order_item.table-strategy.standard.sharding-algorithm-name</span><span class="token punctuation">=</span><span class="token value attr-value">alg_hash_mod</span>

<span class="token comment">#------------------------åˆ†å¸ƒå¼åºåˆ—ç­–ç•¥é…ç½®</span>
<span class="token comment"># åˆ†å¸ƒå¼åºåˆ—åˆ—åç§°</span>
<span class="token key attr-name">spring.shardingsphere.rules.sharding.tables.t_order_item.key-generate-strategy.column</span><span class="token punctuation">=</span><span class="token value attr-value">id</span>
<span class="token comment"># åˆ†å¸ƒå¼åºåˆ—ç®—æ³•åç§°</span>
<span class="token key attr-name">spring.shardingsphere.rules.sharding.tables.t_order_item.key-generate-strategy.key-generator-name</span><span class="token punctuation">=</span><span class="token value attr-value">alg_snowflake</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-5ã€æµ‹è¯•æ’å…¥æ•°æ®" tabindex="-1"><a class="header-anchor" href="#_3-5ã€æµ‹è¯•æ’å…¥æ•°æ®" aria-hidden="true">#</a> 3.5ã€æµ‹è¯•æ’å…¥æ•°æ®</h4><p>åŒä¸€ä¸ªç”¨æˆ·çš„è®¢å•è¡¨å’Œè®¢å•è¯¦æƒ…è¡¨ä¸­çš„æ•°æ®éƒ½åœ¨åŒä¸€ä¸ªæ•°æ®æºä¸­ï¼Œé¿å…è·¨åº“å…³è”</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
     * æµ‹è¯•å…³è”è¡¨æ’å…¥
     */</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testInsertOrderAndOrderItem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">long</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token class-name">Order</span> order <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Order</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        order<span class="token punctuation">.</span><span class="token function">setOrderNo</span><span class="token punctuation">(</span><span class="token string">&quot;ATGUIGU&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        order<span class="token punctuation">.</span><span class="token function">setUserId</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        orderMapper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">long</span> j <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">OrderItem</span> orderItem <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderItem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            orderItem<span class="token punctuation">.</span><span class="token function">setOrderNo</span><span class="token punctuation">(</span><span class="token string">&quot;ATGUIGU&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            orderItem<span class="token punctuation">.</span><span class="token function">setUserId</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            orderItem<span class="token punctuation">.</span><span class="token function">setPrice</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            orderItem<span class="token punctuation">.</span><span class="token function">setCount</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            orderItemMapper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>orderItem<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">long</span> i <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">7</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token class-name">Order</span> order <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Order</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        order<span class="token punctuation">.</span><span class="token function">setOrderNo</span><span class="token punctuation">(</span><span class="token string">&quot;ATGUIGU&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        order<span class="token punctuation">.</span><span class="token function">setUserId</span><span class="token punctuation">(</span><span class="token number">2L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        orderMapper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">long</span> j <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">OrderItem</span> orderItem <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderItem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            orderItem<span class="token punctuation">.</span><span class="token function">setOrderNo</span><span class="token punctuation">(</span><span class="token string">&quot;ATGUIGU&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            orderItem<span class="token punctuation">.</span><span class="token function">setUserId</span><span class="token punctuation">(</span><span class="token number">2L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            orderItem<span class="token punctuation">.</span><span class="token function">setPrice</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            orderItem<span class="token punctuation">.</span><span class="token function">setCount</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            orderItemMapper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>orderItem<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4ã€ç»‘å®šè¡¨" tabindex="-1"><a class="header-anchor" href="#_4ã€ç»‘å®šè¡¨" aria-hidden="true">#</a> 4ã€ç»‘å®šè¡¨</h3><p>**éœ€æ±‚ï¼š**æŸ¥è¯¢æ¯ä¸ªè®¢å•çš„è®¢å•å·å’Œæ€»è®¢å•é‡‘é¢</p><h4 id="_4-1ã€åˆ›å»ºvoå¯¹è±¡" tabindex="-1"><a class="header-anchor" href="#_4-1ã€åˆ›å»ºvoå¯¹è±¡" aria-hidden="true">#</a> 4.1ã€åˆ›å»ºVOå¯¹è±¡</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>shardingjdbcdemo<span class="token punctuation">.</span>entity</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderVo</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> orderNo<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">BigDecimal</span> amount<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-2ã€æ·»åŠ mapperæ–¹æ³•" tabindex="-1"><a class="header-anchor" href="#_4-2ã€æ·»åŠ mapperæ–¹æ³•" aria-hidden="true">#</a> 4.2ã€æ·»åŠ Mapperæ–¹æ³•</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>shardingjdbcdemo<span class="token punctuation">.</span>mapper</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Mapper</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">OrderMapper</span> <span class="token keyword">extends</span> <span class="token class-name">BaseMapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Order</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;SELECT o.order_no, SUM(i.price * i.count) AS amount&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;FROM t_order o JOIN t_order_item i ON o.order_no = i.order_no&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;GROUP BY o.order_no&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">OrderVo</span><span class="token punctuation">&gt;</span></span> <span class="token function">getOrderAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-3ã€æµ‹è¯•å…³è”æŸ¥è¯¢" tabindex="-1"><a class="header-anchor" href="#_4-3ã€æµ‹è¯•å…³è”æŸ¥è¯¢" aria-hidden="true">#</a> 4.3ã€æµ‹è¯•å…³è”æŸ¥è¯¢</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * æµ‹è¯•å…³è”è¡¨æŸ¥è¯¢
 */</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testGetOrderAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">OrderVo</span><span class="token punctuation">&gt;</span></span> orderAmountList <span class="token operator">=</span> orderMapper<span class="token punctuation">.</span><span class="token function">getOrderAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    orderAmountList<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-4ã€é…ç½®ç»‘å®šè¡¨" tabindex="-1"><a class="header-anchor" href="#_4-4ã€é…ç½®ç»‘å®šè¡¨" aria-hidden="true">#</a> 4.4ã€é…ç½®ç»‘å®šè¡¨</h4><p>åœ¨åŸæ¥æ°´å¹³åˆ†ç‰‡é…ç½®çš„åŸºç¡€ä¸Šæ·»åŠ å¦‚ä¸‹é…ç½®ï¼š</p><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token comment">#------------------------ç»‘å®šè¡¨</span>
<span class="token key attr-name">spring.shardingsphere.rules.sharding.binding-tables[0]</span><span class="token punctuation">=</span><span class="token value attr-value">t_order,t_order_item</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>é…ç½®å®Œç»‘å®šè¡¨åå†æ¬¡è¿›è¡Œå…³è”æŸ¥è¯¢çš„æµ‹è¯•ï¼š</p><ul><li><p>**å¦‚æœä¸é…ç½®ç»‘å®šè¡¨ï¼šæµ‹è¯•çš„ç»“æœä¸º8ä¸ªSQLã€‚**å¤šè¡¨å…³è”æŸ¥è¯¢ä¼šå‡ºç°ç¬›å¡å°”ç§¯å…³è”ã€‚</p></li><li><p><strong>å¦‚æœé…ç½®ç»‘å®šè¡¨ï¼šæµ‹è¯•çš„ç»“æœä¸º4ä¸ªSQLã€‚</strong> å¤šè¡¨å…³è”æŸ¥è¯¢ä¸ä¼šå‡ºç°ç¬›å¡å°”ç§¯å…³è”ï¼Œå…³è”æŸ¥è¯¢æ•ˆç‡å°†å¤§å¤§æå‡ã€‚</p></li></ul><p><code>ç»‘å®šè¡¨ï¼š</code>æŒ‡åˆ†ç‰‡è§„åˆ™ä¸€è‡´çš„ä¸€ç»„åˆ†ç‰‡è¡¨ã€‚ ä½¿ç”¨ç»‘å®šè¡¨è¿›è¡Œå¤šè¡¨å…³è”æŸ¥è¯¢æ—¶ï¼Œå¿…é¡»ä½¿ç”¨åˆ†ç‰‡é”®è¿›è¡Œå…³è”ï¼Œå¦åˆ™ä¼šå‡ºç°ç¬›å¡å°”ç§¯å…³è”æˆ–è·¨åº“å…³è”ï¼Œä»è€Œå½±å“æŸ¥è¯¢æ•ˆç‡ã€‚</p><h3 id="_5ã€å¹¿æ’­è¡¨" tabindex="-1"><a class="header-anchor" href="#_5ã€å¹¿æ’­è¡¨" aria-hidden="true">#</a> 5ã€å¹¿æ’­è¡¨</h3><h4 id="_5-1ã€ä»€ä¹ˆæ˜¯å¹¿æ’­è¡¨" tabindex="-1"><a class="header-anchor" href="#_5-1ã€ä»€ä¹ˆæ˜¯å¹¿æ’­è¡¨" aria-hidden="true">#</a> 5.1ã€ä»€ä¹ˆæ˜¯å¹¿æ’­è¡¨</h4><p>æŒ‡æ‰€æœ‰çš„åˆ†ç‰‡æ•°æ®æºä¸­éƒ½å­˜åœ¨çš„è¡¨ï¼Œè¡¨ç»“æ„åŠå…¶æ•°æ®åœ¨æ¯ä¸ªæ•°æ®åº“ä¸­å‡å®Œå…¨ä¸€è‡´ã€‚ é€‚ç”¨äºæ•°æ®é‡ä¸å¤§ä¸”éœ€è¦ä¸æµ·é‡æ•°æ®çš„è¡¨è¿›è¡Œå…³è”æŸ¥è¯¢çš„åœºæ™¯ï¼Œä¾‹å¦‚ï¼šå­—å…¸è¡¨ã€‚</p><p>å¹¿æ’­å…·æœ‰ä»¥ä¸‹ç‰¹æ€§ï¼š</p><p>ï¼ˆ1ï¼‰æ’å…¥ã€æ›´æ–°æ“ä½œä¼šå®æ—¶åœ¨æ‰€æœ‰èŠ‚ç‚¹ä¸Šæ‰§è¡Œï¼Œä¿æŒå„ä¸ªåˆ†ç‰‡çš„æ•°æ®ä¸€è‡´æ€§</p><p>ï¼ˆ2ï¼‰æŸ¥è¯¢æ“ä½œï¼Œåªä»ä¸€ä¸ªèŠ‚ç‚¹è·å–</p><p>ï¼ˆ3ï¼‰å¯ä»¥è·Ÿä»»ä½•ä¸€ä¸ªè¡¨è¿›è¡Œ JOIN æ“ä½œ</p><h4 id="_5-2ã€åˆ›å»ºå¹¿æ’­è¡¨" tabindex="-1"><a class="header-anchor" href="#_5-2ã€åˆ›å»ºå¹¿æ’­è¡¨" aria-hidden="true">#</a> 5.2ã€åˆ›å»ºå¹¿æ’­è¡¨</h4><p>åœ¨server-order0ã€server-order1å’Œserver-useræœåŠ¡å™¨ä¸­åˆ†åˆ«åˆ›å»ºt_dictè¡¨</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> t_dict<span class="token punctuation">(</span>
    id <span class="token keyword">BIGINT</span><span class="token punctuation">,</span>
    dict_type <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-3ã€ç¨‹åºå®ç°" tabindex="-1"><a class="header-anchor" href="#_4-3ã€ç¨‹åºå®ç°" aria-hidden="true">#</a> 4.3ã€ç¨‹åºå®ç°</h4><h5 id="_4-3-1ã€åˆ›å»ºå®ä½“ç±»" tabindex="-1"><a class="header-anchor" href="#_4-3-1ã€åˆ›å»ºå®ä½“ç±»" aria-hidden="true">#</a> 4.3.1ã€åˆ›å»ºå®ä½“ç±»</h5><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>shardingjdbcdemo<span class="token punctuation">.</span>entity</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@TableName</span><span class="token punctuation">(</span><span class="token string">&quot;t_dict&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Dict</span> <span class="token punctuation">{</span>
    <span class="token comment">//å¯ä»¥ä½¿ç”¨MyBatisPlusçš„é›ªèŠ±ç®—æ³•</span>
    <span class="token annotation punctuation">@TableId</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">IdType</span><span class="token punctuation">.</span><span class="token constant">ASSIGN_ID</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> dictType<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_4-3-2ã€åˆ›å»ºmapper" tabindex="-1"><a class="header-anchor" href="#_4-3-2ã€åˆ›å»ºmapper" aria-hidden="true">#</a> 4.3.2ã€åˆ›å»ºMapper</h5><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>shardingjdbcdemo<span class="token punctuation">.</span>mapper</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Mapper</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">DictMapper</span> <span class="token keyword">extends</span> <span class="token class-name">BaseMapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Dict</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_4-3-3ã€é…ç½®å¹¿æ’­è¡¨" tabindex="-1"><a class="header-anchor" href="#_4-3-3ã€é…ç½®å¹¿æ’­è¡¨" aria-hidden="true">#</a> 4.3.3ã€é…ç½®å¹¿æ’­è¡¨</h5><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token comment">#æ•°æ®èŠ‚ç‚¹å¯ä¸é…ç½®ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå‘æ‰€æœ‰æ•°æ®æºå¹¿æ’­</span>
<span class="token key attr-name">spring.shardingsphere.rules.sharding.tables.t_dict.actual-data-nodes</span><span class="token punctuation">=</span><span class="token value attr-value">server-user.t_dict,server-order$-&gt;{0..1}.t_dict</span>

<span class="token comment"># å¹¿æ’­è¡¨</span>
<span class="token key attr-name">spring.shardingsphere.rules.sharding.broadcast-tables[0]</span><span class="token punctuation">=</span><span class="token value attr-value">t_dict</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-4ã€æµ‹è¯•å¹¿æ’­è¡¨" tabindex="-1"><a class="header-anchor" href="#_4-4ã€æµ‹è¯•å¹¿æ’­è¡¨" aria-hidden="true">#</a> 4.4ã€æµ‹è¯•å¹¿æ’­è¡¨</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Autowired</span>
<span class="token keyword">private</span> <span class="token class-name">DictMapper</span> dictMapper<span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
     * å¹¿æ’­è¡¨ï¼šæ¯ä¸ªæœåŠ¡å™¨ä¸­çš„t_dictåŒæ—¶æ·»åŠ äº†æ–°æ•°æ®
     */</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testBroadcast</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

    <span class="token class-name">Dict</span> dict <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dict</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    dict<span class="token punctuation">.</span><span class="token function">setDictType</span><span class="token punctuation">(</span><span class="token string">&quot;type1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    dictMapper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>dict<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token doc-comment comment">/**
     * æŸ¥è¯¢æ“ä½œï¼Œåªä»ä¸€ä¸ªèŠ‚ç‚¹è·å–æ•°æ®
     * éšæœºè´Ÿè½½å‡è¡¡è§„åˆ™
     */</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSelectBroadcast</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Dict</span><span class="token punctuation">&gt;</span></span> dicts <span class="token operator">=</span> dictMapper<span class="token punctuation">.</span><span class="token function">selectList</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    dicts<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ç¬¬07ç« -å¯åŠ¨shardingsphere-proxy" tabindex="-1"><a class="header-anchor" href="#ç¬¬07ç« -å¯åŠ¨shardingsphere-proxy" aria-hidden="true">#</a> ç¬¬07ç«  å¯åŠ¨ShardingSphere-Proxy</h2><h3 id="_1ã€è·å–" tabindex="-1"><a class="header-anchor" href="#_1ã€è·å–" aria-hidden="true">#</a> 1ã€è·å–</h3><p>ç›®å‰ ShardingSphere-Proxy æä¾›äº† 3 ç§è·å–æ–¹å¼ï¼š</p><ul><li><a href="https://shardingsphere.apache.org/document/5.1.1/cn/user-manual/shardingsphere-proxy/startup/bin/" target="_blank" rel="noopener noreferrer">äºŒè¿›åˆ¶å‘å¸ƒåŒ…<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://shardingsphere.apache.org/document/5.1.1/cn/user-manual/shardingsphere-proxy/startup/docker/" target="_blank" rel="noopener noreferrer">Docker<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://shardingsphere.apache.org/document/5.1.1/cn/user-manual/shardingsphere-proxy/startup/helm/" target="_blank" rel="noopener noreferrer">Helm<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul><h3 id="_2ã€ä½¿ç”¨äºŒè¿›åˆ¶å‘å¸ƒåŒ…å®‰è£…" tabindex="-1"><a class="header-anchor" href="#_2ã€ä½¿ç”¨äºŒè¿›åˆ¶å‘å¸ƒåŒ…å®‰è£…" aria-hidden="true">#</a> 2ã€ä½¿ç”¨äºŒè¿›åˆ¶å‘å¸ƒåŒ…å®‰è£…</h3><p>äºŒè¿›åˆ¶åŒ…æ—¢å¯ä»¥Linuxç³»ç»Ÿè¿è¡Œï¼Œåˆå¯ä»¥åœ¨windowsç³»ç»Ÿè¿è¡Œ</p><p><strong>step1ï¼šè§£å‹äºŒè¿›åˆ¶åŒ…</strong></p><p><code>apache-shardingsphere-5.1.1-shardingsphere-proxy-bin.tar.gz</code></p><p>windowsï¼šä½¿ç”¨è§£å‹è½¯ä»¶è§£å‹æ–‡ä»¶</p><p>Linuxï¼šå°†æ–‡ä»¶ä¸Šä¼ è‡³/optç›®å½•ï¼Œå¹¶è§£å‹</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">tar</span> <span class="token parameter variable">-zxvf</span> apache-shardingsphere-5.1.1-shardingsphere-proxy-bin.tar.gz
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>step2ï¼šMySQLé©±åŠ¨</strong></p><p><code>mysql-connector-java-8.0.22.jar</code></p><p>å°†MySQlé©±åŠ¨æ”¾è‡³è§£å‹ç›®å½•ä¸­çš„<code>ext-lib</code>ç›®å½•</p><p><strong>spte3ï¼šä¿®æ”¹é…ç½®conf/server.yaml</strong></p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">rules</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token tag">!AUTHORITY</span>
    <span class="token key atrule">users</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> root@%<span class="token punctuation">:</span>root
    <span class="token key atrule">provider</span><span class="token punctuation">:</span>
      <span class="token key atrule">type</span><span class="token punctuation">:</span> ALL_PRIVILEGES_PERMITTED

<span class="token key atrule">props</span><span class="token punctuation">:</span>
  <span class="token key atrule">sql-show</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>spte4ï¼šå¯åŠ¨ShardingSphere-Proxy</strong></p><p>Linux æ“ä½œç³»ç»Ÿè¯·è¿è¡Œ <code>bin/start.sh</code></p><p>Windows æ“ä½œç³»ç»Ÿè¯·è¿è¡Œ <code>bin/start.bat</code></p><p>æŒ‡å®šç«¯å£å·å’Œé…ç½®æ–‡ä»¶ç›®å½•ï¼š<code>bin/start.bat ${proxy_port} ${proxy_conf_directory}</code></p><p><strong>step5ï¼šè¿œç¨‹è¿æ¥ShardingSphere-Proxy</strong></p><p>è¿œç¨‹è®¿é—®</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mysql <span class="token parameter variable">-h192.168.100.1</span> <span class="token parameter variable">-P3307</span> <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-p</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>step6ï¼šè®¿é—®æµ‹è¯•</strong></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">show</span> <span class="token keyword">databases</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="/assets/image-20220819152009158-5402c0ce.png" alt="image-20220819152009158"></p><h3 id="_3ã€ä½¿ç”¨dockerå®‰è£…" tabindex="-1"><a class="header-anchor" href="#_3ã€ä½¿ç”¨dockerå®‰è£…" aria-hidden="true">#</a> 3ã€ä½¿ç”¨Dockerå®‰è£…</h3><p><strong>step1ï¼šå¯åŠ¨Dockerå®¹å™¨</strong></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /atguigu/server/proxy-a/conf:/opt/shardingsphere-proxy/conf <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /atguigu/server/proxy-a/ext-lib:/opt/shardingsphere-proxy/ext-lib <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">ES_JAVA_OPTS</span><span class="token operator">=</span><span class="token string">&quot;-Xmx256m -Xms256m -Xmn128m&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-p</span> <span class="token number">3321</span>:3307 <span class="token punctuation">\</span>
<span class="token parameter variable">--name</span> server-proxy-a <span class="token punctuation">\</span>
apache/shardingsphere-proxy:5.1.1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>step2ï¼šä¸Šä¼ MySQLé©±åŠ¨</strong></p><p>å°†MySQlé©±åŠ¨ä¸Šä¼ è‡³<code>/atguigu/server/proxy-a/ext-lib</code>ç›®å½•</p><p><strong>spte3ï¼šä¿®æ”¹é…ç½®server.yaml</strong></p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">rules</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token tag">!AUTHORITY</span>
    <span class="token key atrule">users</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> root@%<span class="token punctuation">:</span>root
    <span class="token key atrule">provider</span><span class="token punctuation">:</span>
      <span class="token key atrule">type</span><span class="token punctuation">:</span> ALL_PRIVILEGES_PERMITTED

<span class="token key atrule">props</span><span class="token punctuation">:</span>
  <span class="token key atrule">sql-show</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å°†é…ç½®æ–‡ä»¶ä¸Šä¼ è‡³<code>/atguigu/server/proxy-a/conf</code>ç›®å½•</p><p><strong>spte4ï¼šé‡å¯å®¹å™¨</strong></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> restart server-proxy-a
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>step5ï¼šè¿œç¨‹è¿æ¥ShardingSphere-Proxy</strong></p><p>ShardingSphere-Proxyå®¹å™¨ä¸­é»˜è®¤æƒ…å†µä¸‹æ²¡æœ‰mysqlå‘½ä»¤è¡Œå®¢æˆ·ç«¯çš„å®‰è£…ï¼Œå› æ­¤éœ€è¦è¿œç¨‹è®¿é—®</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mysql <span class="token parameter variable">-h192.168.100.201</span> <span class="token parameter variable">-P3321</span> <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-p</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>step6ï¼šè®¿é—®æµ‹è¯•</strong></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">show</span> <span class="token keyword">databases</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="/assets/image-20220819152009158-5402c0ce.png" alt="image-20220819152009158"></p><p><strong>å¸¸è§é—®é¢˜ï¼šdockerå®¹å™¨æ— æ³•è¿œç¨‹è¿æ¥</strong></p><p>å®¹å™¨å¯ä»¥æˆåŠŸçš„åˆ›å»ºå¹¶å¯åŠ¨ï¼Œä½†æ˜¯æ— æ³•è¿œç¨‹è¿æ¥ã€‚æ’é™¤é˜²ç«å¢™å’Œç½‘ç»œç­‰é—®é¢˜åï¼Œçœ‹çœ‹æ˜¯ä¸æ˜¯å› ä¸ºå®¹å™¨å†…å­˜ä¸è¶³å¯¼è‡´ã€‚</p><p><code>åŸå› ï¼š</code>å®¹å™¨å¯åˆ†é…å†…å­˜ä¸è¶³</p><p><code>æŸ¥çœ‹åŠæ³•ï¼š</code>è¿›å…¥å®¹å™¨åæŸ¥çœ‹ShardingSphere-Proxyçš„æ—¥å¿—ï¼Œå¦‚æœ‰æœ‰<code>cannot allocate memory</code>ï¼Œåˆ™è¯´æ˜å®¹å™¨å†…å­˜ä¸è¶³</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> server-proxy-a <span class="token function">env</span> <span class="token assign-left variable"><span class="token environment constant">LANG</span></span><span class="token operator">=</span>C.UTF-8 /bin/bash
<span class="token builtin class-name">cd</span> /opt/shardingsphere-proxy/logs
<span class="token function">tail</span> stdout.log 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="/assets/image-20220819151154763-2af49181.png" alt="image-20220819151154763"></p><p><code>è§£å†³æ–¹æ¡ˆï¼š</code>åˆ›å»ºå®¹å™¨çš„æ—¶å€™ä½¿ç”¨JVMå‚æ•°</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token parameter variable">-e</span> <span class="token assign-left variable">ES_JAVA_OPTS</span><span class="token operator">=</span><span class="token string">&quot;-Xmx256m -Xms256m -Xmn128m&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="ç¬¬08ç« -shardingsphere-proxyè¯»å†™åˆ†ç¦»" tabindex="-1"><a class="header-anchor" href="#ç¬¬08ç« -shardingsphere-proxyè¯»å†™åˆ†ç¦»" aria-hidden="true">#</a> ç¬¬08ç«  ShardingSphere-Proxyè¯»å†™åˆ†ç¦»</h2><h3 id="_1ã€ä¿®æ”¹é…ç½®æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#_1ã€ä¿®æ”¹é…ç½®æ–‡ä»¶" aria-hidden="true">#</a> 1ã€ä¿®æ”¹é…ç½®æ–‡ä»¶</h3><p><strong>ä¿®æ”¹é…ç½®config-readwrite-splitting.yaml</strong></p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">schemaName</span><span class="token punctuation">:</span> readwrite_splitting_db

<span class="token key atrule">dataSources</span><span class="token punctuation">:</span>
  <span class="token key atrule">write_ds</span><span class="token punctuation">:</span>
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//192.168.100.201<span class="token punctuation">:</span>3306/db_user<span class="token punctuation">?</span>serverTimezone=UTC<span class="token important">&amp;useSSL=false</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">123456</span>
    <span class="token key atrule">connectionTimeoutMilliseconds</span><span class="token punctuation">:</span> <span class="token number">30000</span>
    <span class="token key atrule">idleTimeoutMilliseconds</span><span class="token punctuation">:</span> <span class="token number">60000</span>
    <span class="token key atrule">maxLifetimeMilliseconds</span><span class="token punctuation">:</span> <span class="token number">1800000</span>
    <span class="token key atrule">maxPoolSize</span><span class="token punctuation">:</span> <span class="token number">50</span>
    <span class="token key atrule">minPoolSize</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">read_ds_0</span><span class="token punctuation">:</span>
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//192.168.100.201<span class="token punctuation">:</span>3307/db_user<span class="token punctuation">?</span>serverTimezone=UTC<span class="token important">&amp;useSSL=false</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">123456</span>
    <span class="token key atrule">connectionTimeoutMilliseconds</span><span class="token punctuation">:</span> <span class="token number">30000</span>
    <span class="token key atrule">idleTimeoutMilliseconds</span><span class="token punctuation">:</span> <span class="token number">60000</span>
    <span class="token key atrule">maxLifetimeMilliseconds</span><span class="token punctuation">:</span> <span class="token number">1800000</span>
    <span class="token key atrule">maxPoolSize</span><span class="token punctuation">:</span> <span class="token number">50</span>
    <span class="token key atrule">minPoolSize</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">read_ds_1</span><span class="token punctuation">:</span>
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//192.168.100.201<span class="token punctuation">:</span>3308/db_user<span class="token punctuation">?</span>serverTimezone=UTC<span class="token important">&amp;useSSL=false</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">123456</span>
    <span class="token key atrule">connectionTimeoutMilliseconds</span><span class="token punctuation">:</span> <span class="token number">30000</span>
    <span class="token key atrule">idleTimeoutMilliseconds</span><span class="token punctuation">:</span> <span class="token number">60000</span>
    <span class="token key atrule">maxLifetimeMilliseconds</span><span class="token punctuation">:</span> <span class="token number">1800000</span>
    <span class="token key atrule">maxPoolSize</span><span class="token punctuation">:</span> <span class="token number">50</span>
    <span class="token key atrule">minPoolSize</span><span class="token punctuation">:</span> <span class="token number">1</span>

<span class="token key atrule">rules</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token tag">!READWRITE_SPLITTING</span>
  <span class="token key atrule">dataSources</span><span class="token punctuation">:</span>
    <span class="token key atrule">readwrite_ds</span><span class="token punctuation">:</span>
      <span class="token key atrule">type</span><span class="token punctuation">:</span> Static
      <span class="token key atrule">props</span><span class="token punctuation">:</span>
        <span class="token key atrule">write-data-source-name</span><span class="token punctuation">:</span> write_ds
        <span class="token key atrule">read-data-source-names</span><span class="token punctuation">:</span> read_ds_0<span class="token punctuation">,</span>read_ds_1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å°†é…ç½®æ–‡ä»¶ä¸Šä¼ è‡³<code>/atguigu/server/proxy-a/conf</code>ç›®å½•</p><p><strong>é‡å¯å®¹å™¨</strong></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> restart server-proxy-a
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_2ã€å®æ—¶æŸ¥çœ‹æ—¥å¿—" tabindex="-1"><a class="header-anchor" href="#_2ã€å®æ—¶æŸ¥çœ‹æ—¥å¿—" aria-hidden="true">#</a> 2ã€å®æ—¶æŸ¥çœ‹æ—¥å¿—</h3><p>å¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼æŸ¥çœ‹æœåŠ¡å™¨ä¸­è¾“å‡ºçš„SQLè¯­å¥</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> server-proxy-a <span class="token function">env</span> <span class="token assign-left variable"><span class="token environment constant">LANG</span></span><span class="token operator">=</span>C.UTF-8 /bin/bash
<span class="token function">tail</span> <span class="token parameter variable">-f</span> /opt/shardingsphere-proxy/logs/stdout.log 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3ã€è¿œç¨‹è®¿é—®æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_3ã€è¿œç¨‹è®¿é—®æµ‹è¯•" aria-hidden="true">#</a> 3ã€è¿œç¨‹è®¿é—®æµ‹è¯•</h3><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">show</span> <span class="token keyword">databases</span><span class="token punctuation">;</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">use</span> readwrite_splitting_db<span class="token punctuation">;</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">show</span> <span class="token keyword">tables</span><span class="token punctuation">;</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t_user<span class="token punctuation">;</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t_user<span class="token punctuation">;</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">insert</span> <span class="token keyword">into</span> t_user<span class="token punctuation">(</span>uname<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">&#39;wang5&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4ã€åº”ç”¨ç¨‹åºè®¿é—®proxy" tabindex="-1"><a class="header-anchor" href="#_4ã€åº”ç”¨ç¨‹åºè®¿é—®proxy" aria-hidden="true">#</a> 4ã€åº”ç”¨ç¨‹åºè®¿é—®Proxy</h3><h4 id="_4-1ã€åˆ›å»ºé¡¹ç›®" tabindex="-1"><a class="header-anchor" href="#_4-1ã€åˆ›å»ºé¡¹ç›®" aria-hidden="true">#</a> 4.1ã€åˆ›å»ºé¡¹ç›®</h4><p>é¡¹ç›®ç±»å‹ï¼šSpring Initializr</p><p>SpringBootè„šæ‰‹æ¶ï¼šhttp://start.aliyun.com</p><p>é¡¹ç›®åï¼šsharding-proxy-demo</p><p>SpringBootç‰ˆæœ¬ï¼š2.3.7.RELEASE</p><h4 id="_4-2ã€æ·»åŠ ä¾èµ–" tabindex="-1"><a class="header-anchor" href="#_4-2ã€æ·»åŠ ä¾èµ–" aria-hidden="true">#</a> 4.2ã€æ·»åŠ ä¾èµ–</h4><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>runtime<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.baomidou<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mybatis-plus-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.3.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusions</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusion</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.junit.vintage<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>junit-vintage-engine<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusion</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusions</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-3ã€åˆ›å»ºå®ä½“ç±»" tabindex="-1"><a class="header-anchor" href="#_4-3ã€åˆ›å»ºå®ä½“ç±»" aria-hidden="true">#</a> 4.3ã€åˆ›å»ºå®ä½“ç±»</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>shardingproxydemo<span class="token punctuation">.</span>entity</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@TableName</span><span class="token punctuation">(</span><span class="token string">&quot;t_user&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@TableId</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">IdType</span><span class="token punctuation">.</span><span class="token constant">AUTO</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> uname<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-4ã€åˆ›å»ºmapper" tabindex="-1"><a class="header-anchor" href="#_4-4ã€åˆ›å»ºmapper" aria-hidden="true">#</a> 4.4ã€åˆ›å»ºMapper</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>shardingproxydemo<span class="token punctuation">.</span>mapper</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Mapper</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserMapper</span> <span class="token keyword">extends</span> <span class="token class-name">BaseMapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-5ã€é…ç½®æ•°æ®æº" tabindex="-1"><a class="header-anchor" href="#_4-5ã€é…ç½®æ•°æ®æº" aria-hidden="true">#</a> 4.5ã€é…ç½®æ•°æ®æº</h4><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token comment"># åº”ç”¨åç§°</span>
<span class="token key attr-name">spring.application.name</span><span class="token punctuation">=</span><span class="token value attr-value">sharding-proxy-demo</span>
<span class="token comment"># å¼€å‘ç¯å¢ƒè®¾ç½®</span>
<span class="token key attr-name">spring.profiles.active</span><span class="token punctuation">=</span><span class="token value attr-value">dev</span>

<span class="token comment">#mysqlæ•°æ®åº“è¿æ¥ï¼ˆproxyï¼‰</span>
<span class="token key attr-name">spring.datasource.driver-class-name</span><span class="token punctuation">=</span><span class="token value attr-value">com.mysql.jdbc.Driver</span>
<span class="token key attr-name">spring.datasource.url</span><span class="token punctuation">=</span><span class="token value attr-value">jdbc:mysql://192.168.100.201:3321/readwrite_splitting_db?serverTimezone=GMT%2B8&amp;useSSL=false</span>
<span class="token key attr-name">spring.datasource.username</span><span class="token punctuation">=</span><span class="token value attr-value">root</span>
<span class="token key attr-name">spring.datasource.password</span><span class="token punctuation">=</span><span class="token value attr-value">root</span>

<span class="token comment">#mybatisæ—¥å¿—</span>
<span class="token key attr-name">mybatis-plus.configuration.log-impl</span><span class="token punctuation">=</span><span class="token value attr-value">org.apache.ibatis.logging.stdout.StdOutImpl</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-6ã€æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_4-6ã€æµ‹è¯•" aria-hidden="true">#</a> 4.6ã€æµ‹è¯•</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>shardingproxydemo</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">class</span> <span class="token class-name">ShardingProxyDemoApplicationTests</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">UserMapper</span> userMapper<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * è¯»æ•°æ®æµ‹è¯•
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSelectAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> users <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">selectList</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        users<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ç¬¬09ç« -shardingsphere-proxyå‚ç›´åˆ†ç‰‡" tabindex="-1"><a class="header-anchor" href="#ç¬¬09ç« -shardingsphere-proxyå‚ç›´åˆ†ç‰‡" aria-hidden="true">#</a> ç¬¬09ç«  ShardingSphere-Proxyå‚ç›´åˆ†ç‰‡</h2><h3 id="_1ã€ä¿®æ”¹é…ç½®æ–‡ä»¶-1" tabindex="-1"><a class="header-anchor" href="#_1ã€ä¿®æ”¹é…ç½®æ–‡ä»¶-1" aria-hidden="true">#</a> 1ã€ä¿®æ”¹é…ç½®æ–‡ä»¶</h3><p><strong>ä¿®æ”¹é…ç½®config-sharding.yaml</strong></p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">schemaName</span><span class="token punctuation">:</span> sharding_db

<span class="token key atrule">dataSources</span><span class="token punctuation">:</span>
  <span class="token key atrule">ds_0</span><span class="token punctuation">:</span>
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//192.168.100.201<span class="token punctuation">:</span>3301/db_user<span class="token punctuation">?</span>serverTimezone=UTC<span class="token important">&amp;useSSL=false</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">123456</span>
    <span class="token key atrule">connectionTimeoutMilliseconds</span><span class="token punctuation">:</span> <span class="token number">30000</span>
    <span class="token key atrule">idleTimeoutMilliseconds</span><span class="token punctuation">:</span> <span class="token number">60000</span>
    <span class="token key atrule">maxLifetimeMilliseconds</span><span class="token punctuation">:</span> <span class="token number">1800000</span>
    <span class="token key atrule">maxPoolSize</span><span class="token punctuation">:</span> <span class="token number">50</span>
    <span class="token key atrule">minPoolSize</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">ds_1</span><span class="token punctuation">:</span>
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//192.168.100.201<span class="token punctuation">:</span>3302/db_order<span class="token punctuation">?</span>serverTimezone=UTC<span class="token important">&amp;useSSL=false</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">123456</span>
    <span class="token key atrule">connectionTimeoutMilliseconds</span><span class="token punctuation">:</span> <span class="token number">30000</span>
    <span class="token key atrule">idleTimeoutMilliseconds</span><span class="token punctuation">:</span> <span class="token number">60000</span>
    <span class="token key atrule">maxLifetimeMilliseconds</span><span class="token punctuation">:</span> <span class="token number">1800000</span>
    <span class="token key atrule">maxPoolSize</span><span class="token punctuation">:</span> <span class="token number">50</span>
    <span class="token key atrule">minPoolSize</span><span class="token punctuation">:</span> <span class="token number">1</span>

<span class="token key atrule">rules</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token tag">!SHARDING</span>
  <span class="token key atrule">tables</span><span class="token punctuation">:</span>
    <span class="token key atrule">t_user</span><span class="token punctuation">:</span>
      <span class="token key atrule">actualDataNodes</span><span class="token punctuation">:</span> ds_0.t_user
    <span class="token key atrule">t_order</span><span class="token punctuation">:</span>
      <span class="token key atrule">actualDataNodes</span><span class="token punctuation">:</span> ds_1.t_order
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2ã€å®æ—¶æŸ¥çœ‹æ—¥å¿—-1" tabindex="-1"><a class="header-anchor" href="#_2ã€å®æ—¶æŸ¥çœ‹æ—¥å¿—-1" aria-hidden="true">#</a> 2ã€å®æ—¶æŸ¥çœ‹æ—¥å¿—</h3><p>å¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼æŸ¥çœ‹æœåŠ¡å™¨ä¸­è¾“å‡ºçš„SQLè¯­å¥</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> server-proxy-a <span class="token function">env</span> <span class="token assign-left variable"><span class="token environment constant">LANG</span></span><span class="token operator">=</span>C.UTF-8 /bin/bash
<span class="token function">tail</span> <span class="token parameter variable">-f</span> /opt/shardingsphere-proxy/logs/stdout.log 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3ã€è¿œç¨‹è®¿é—®æµ‹è¯•-1" tabindex="-1"><a class="header-anchor" href="#_3ã€è¿œç¨‹è®¿é—®æµ‹è¯•-1" aria-hidden="true">#</a> 3ã€è¿œç¨‹è®¿é—®æµ‹è¯•</h3><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">show</span> <span class="token keyword">databases</span><span class="token punctuation">;</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">use</span> sharding_db<span class="token punctuation">;</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">show</span> <span class="token keyword">tables</span><span class="token punctuation">;</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t_order<span class="token punctuation">;</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t_user<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ç¬¬10ç« -shardingsphere-proxyæ°´å¹³åˆ†ç‰‡" tabindex="-1"><a class="header-anchor" href="#ç¬¬10ç« -shardingsphere-proxyæ°´å¹³åˆ†ç‰‡" aria-hidden="true">#</a> ç¬¬10ç«  ShardingSphere-Proxyæ°´å¹³åˆ†ç‰‡</h2><h3 id="_1ã€ä¿®æ”¹é…ç½®æ–‡ä»¶-2" tabindex="-1"><a class="header-anchor" href="#_1ã€ä¿®æ”¹é…ç½®æ–‡ä»¶-2" aria-hidden="true">#</a> 1ã€ä¿®æ”¹é…ç½®æ–‡ä»¶</h3><p><strong>ä¿®æ”¹é…ç½®config-sharding.yaml</strong></p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">schemaName</span><span class="token punctuation">:</span> sharding_db

<span class="token key atrule">dataSources</span><span class="token punctuation">:</span>
  <span class="token key atrule">ds_user</span><span class="token punctuation">:</span>
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//192.168.100.201<span class="token punctuation">:</span>3301/db_user<span class="token punctuation">?</span>serverTimezone=UTC<span class="token important">&amp;useSSL=false</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">123456</span>
    <span class="token key atrule">connectionTimeoutMilliseconds</span><span class="token punctuation">:</span> <span class="token number">30000</span>
    <span class="token key atrule">idleTimeoutMilliseconds</span><span class="token punctuation">:</span> <span class="token number">60000</span>
    <span class="token key atrule">maxLifetimeMilliseconds</span><span class="token punctuation">:</span> <span class="token number">1800000</span>
    <span class="token key atrule">maxPoolSize</span><span class="token punctuation">:</span> <span class="token number">50</span>
    <span class="token key atrule">minPoolSize</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">ds_order0</span><span class="token punctuation">:</span>
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//192.168.100.201<span class="token punctuation">:</span>3310/db_order<span class="token punctuation">?</span>serverTimezone=UTC<span class="token important">&amp;useSSL=false</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">123456</span>
    <span class="token key atrule">connectionTimeoutMilliseconds</span><span class="token punctuation">:</span> <span class="token number">30000</span>
    <span class="token key atrule">idleTimeoutMilliseconds</span><span class="token punctuation">:</span> <span class="token number">60000</span>
    <span class="token key atrule">maxLifetimeMilliseconds</span><span class="token punctuation">:</span> <span class="token number">1800000</span>
    <span class="token key atrule">maxPoolSize</span><span class="token punctuation">:</span> <span class="token number">50</span>
    <span class="token key atrule">minPoolSize</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">ds_order1</span><span class="token punctuation">:</span>
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//192.168.100.201<span class="token punctuation">:</span>3311/db_order<span class="token punctuation">?</span>serverTimezone=UTC<span class="token important">&amp;useSSL=false</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">123456</span>
    <span class="token key atrule">connectionTimeoutMilliseconds</span><span class="token punctuation">:</span> <span class="token number">30000</span>
    <span class="token key atrule">idleTimeoutMilliseconds</span><span class="token punctuation">:</span> <span class="token number">60000</span>
    <span class="token key atrule">maxLifetimeMilliseconds</span><span class="token punctuation">:</span> <span class="token number">1800000</span>
    <span class="token key atrule">maxPoolSize</span><span class="token punctuation">:</span> <span class="token number">50</span>
    <span class="token key atrule">minPoolSize</span><span class="token punctuation">:</span> <span class="token number">1</span>

<span class="token key atrule">rules</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token tag">!SHARDING</span>
  <span class="token key atrule">tables</span><span class="token punctuation">:</span>
    <span class="token key atrule">t_user</span><span class="token punctuation">:</span>
      <span class="token key atrule">actualDataNodes</span><span class="token punctuation">:</span> ds_user.t_user

    <span class="token key atrule">t_order</span><span class="token punctuation">:</span>
      <span class="token key atrule">actualDataNodes</span><span class="token punctuation">:</span> ds_order$<span class="token punctuation">{</span>0..1<span class="token punctuation">}</span>.t_order$<span class="token punctuation">{</span>0..1<span class="token punctuation">}</span>
      <span class="token key atrule">databaseStrategy</span><span class="token punctuation">:</span>
        <span class="token key atrule">standard</span><span class="token punctuation">:</span>
          <span class="token key atrule">shardingColumn</span><span class="token punctuation">:</span> user_id
          <span class="token key atrule">shardingAlgorithmName</span><span class="token punctuation">:</span> alg_mod
      <span class="token key atrule">tableStrategy</span><span class="token punctuation">:</span>
        <span class="token key atrule">standard</span><span class="token punctuation">:</span>
          <span class="token key atrule">shardingColumn</span><span class="token punctuation">:</span> order_no
          <span class="token key atrule">shardingAlgorithmName</span><span class="token punctuation">:</span> alg_hash_mod
      <span class="token key atrule">keyGenerateStrategy</span><span class="token punctuation">:</span>
        <span class="token key atrule">column</span><span class="token punctuation">:</span> id
        <span class="token key atrule">keyGeneratorName</span><span class="token punctuation">:</span> snowflake
    <span class="token key atrule">t_order_item</span><span class="token punctuation">:</span>
      <span class="token key atrule">actualDataNodes</span><span class="token punctuation">:</span> ds_order$<span class="token punctuation">{</span>0..1<span class="token punctuation">}</span>.t_order_item$<span class="token punctuation">{</span>0..1<span class="token punctuation">}</span>
      <span class="token key atrule">databaseStrategy</span><span class="token punctuation">:</span>
        <span class="token key atrule">standard</span><span class="token punctuation">:</span>
          <span class="token key atrule">shardingColumn</span><span class="token punctuation">:</span> user_id
          <span class="token key atrule">shardingAlgorithmName</span><span class="token punctuation">:</span> alg_mod
      <span class="token key atrule">tableStrategy</span><span class="token punctuation">:</span>
        <span class="token key atrule">standard</span><span class="token punctuation">:</span>
          <span class="token key atrule">shardingColumn</span><span class="token punctuation">:</span> order_no
          <span class="token key atrule">shardingAlgorithmName</span><span class="token punctuation">:</span> alg_hash_mod
      <span class="token key atrule">keyGenerateStrategy</span><span class="token punctuation">:</span>
        <span class="token key atrule">column</span><span class="token punctuation">:</span> id
        <span class="token key atrule">keyGeneratorName</span><span class="token punctuation">:</span> snowflake

  <span class="token key atrule">bindingTables</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> t_order<span class="token punctuation">,</span>t_order_item


  <span class="token key atrule">broadcastTables</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> t_dict

  <span class="token key atrule">shardingAlgorithms</span><span class="token punctuation">:</span>
    <span class="token key atrule">alg_inline_userid</span><span class="token punctuation">:</span>
      <span class="token key atrule">type</span><span class="token punctuation">:</span> INLINE
      <span class="token key atrule">props</span><span class="token punctuation">:</span>
        <span class="token key atrule">algorithm-expression</span><span class="token punctuation">:</span> server<span class="token punctuation">-</span>order$<span class="token punctuation">-</span><span class="token punctuation">&gt;</span><span class="token punctuation">{</span>user_id % 2<span class="token punctuation">}</span>
    <span class="token key atrule">alg_mod</span><span class="token punctuation">:</span>
      <span class="token key atrule">type</span><span class="token punctuation">:</span> MOD
      <span class="token key atrule">props</span><span class="token punctuation">:</span>
        <span class="token key atrule">sharding-count</span><span class="token punctuation">:</span> <span class="token number">2</span>
    <span class="token key atrule">alg_hash_mod</span><span class="token punctuation">:</span>
      <span class="token key atrule">type</span><span class="token punctuation">:</span> HASH_MOD
      <span class="token key atrule">props</span><span class="token punctuation">:</span>
        <span class="token key atrule">sharding-count</span><span class="token punctuation">:</span> <span class="token number">2</span>
  
  <span class="token key atrule">keyGenerators</span><span class="token punctuation">:</span>
    <span class="token key atrule">snowflake</span><span class="token punctuation">:</span>
      <span class="token key atrule">type</span><span class="token punctuation">:</span> SNOWFLAKE

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2ã€å®æ—¶æŸ¥çœ‹æ—¥å¿—-2" tabindex="-1"><a class="header-anchor" href="#_2ã€å®æ—¶æŸ¥çœ‹æ—¥å¿—-2" aria-hidden="true">#</a> 2ã€å®æ—¶æŸ¥çœ‹æ—¥å¿—</h3><p>å¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼æŸ¥çœ‹æœåŠ¡å™¨ä¸­è¾“å‡ºçš„SQLè¯­å¥</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> server-proxy-a <span class="token function">env</span> <span class="token assign-left variable"><span class="token environment constant">LANG</span></span><span class="token operator">=</span>C.UTF-8 /bin/bash
<span class="token function">tail</span> <span class="token parameter variable">-f</span> /opt/shardingsphere-proxy/logs/stdout.log 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3ã€è¿œç¨‹è®¿é—®æµ‹è¯•-2" tabindex="-1"><a class="header-anchor" href="#_3ã€è¿œç¨‹è®¿é—®æµ‹è¯•-2" aria-hidden="true">#</a> 3ã€è¿œç¨‹è®¿é—®æµ‹è¯•</h3><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">show</span> <span class="token keyword">databases</span><span class="token punctuation">;</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">use</span> sharding_db<span class="token punctuation">;</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">show</span> <span class="token keyword">tables</span><span class="token punctuation">;</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t_order<span class="token punctuation">;</span> <span class="token comment">--æµ‹è¯•æ°´å¹³åˆ†ç‰‡</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t_dict<span class="token punctuation">;</span> <span class="token comment">--æµ‹è¯•å¹¿æ’­è¡¨</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><!----><footer class="page-meta"><!----><div class="meta-item update-time"><span class="label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><!----></div><div class="meta-item contributors"><span class="label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="contributor" title="email: 895252461@qq.com">xuliang</span><!--]--><!--]--></div></footer><nav class="page-nav"><a href="/middleware/shiro/shiro-overview.html" class="nav-link prev" aria-label="Shiro æ€»ç»“"><div class="hint"><span class="arrow left"></span>ä¸Šä¸€é¡µ</div><div class="link"><!---->Shiro æ€»ç»“</div></a><!----></nav><!----><!----><!--]--></main><!--]--><!----><!--]--></div><!--]--><!----><!--]--></div>
    <script type="module" src="/assets/app-fb3896f3.js" defer></script>
  </body>
</html>
