<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.67" />
    <meta name="theme" content="VuePress Theme Hope" />
    <title>Kafka Overview | -_- !</title><meta name="description" content="good night !">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d1e1f;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/assets/style-f4247c06.css" as="style"><link rel="stylesheet" href="/assets/style-f4247c06.css">
    <link rel="modulepreload" href="/assets/app-9aa256ea.js"><link rel="modulepreload" href="/assets/kafka-old.html-18104567.js"><link rel="modulepreload" href="/assets/kafka-old.html-e508f49c.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper-c27b6911.js"><link rel="prefetch" href="/assets/index.html-130ecd90.js" as="script"><link rel="prefetch" href="/assets/database-overview.html-03717758.js" as="script"><link rel="prefetch" href="/assets/new-concept-2.html-4471fd4d.js" as="script"><link rel="prefetch" href="/assets/java-overview.html-49f1be9c.js" as="script"><link rel="prefetch" href="/assets/middleware-overview.html-be4fdd51.js" as="script"><link rel="prefetch" href="/assets/quality-overview.html-a8e9bda4.js" as="script"><link rel="prefetch" href="/assets/spring-cloud-overview.html-eb7abca7.js" as="script"><link rel="prefetch" href="/assets/gitbook.html-f2319ef4.js" as="script"><link rel="prefetch" href="/assets/tools-overview.html-cf0e5bf6.js" as="script"><link rel="prefetch" href="/assets/mongo.html-2ab52e79.js" as="script"><link rel="prefetch" href="/assets/mysql-advance.html-b13e5f8a.js" as="script"><link rel="prefetch" href="/assets/mysql-apply.html-a6b2d1c2.js" as="script"><link rel="prefetch" href="/assets/mysql-base.html-3cf280af.js" as="script"><link rel="prefetch" href="/assets/mysql-devops.html-f2c73032.js" as="script"><link rel="prefetch" href="/assets/redis-action.html-a3045ac9.js" as="script"><link rel="prefetch" href="/assets/redis-base.html-65a1be1c.js" as="script"><link rel="prefetch" href="/assets/redis-cluster.html-dd5a3b3e.js" as="script"><link rel="prefetch" href="/assets/redis-overview.html-4a3dba49.js" as="script"><link rel="prefetch" href="/assets/java-annotation.html-ef20db56.js" as="script"><link rel="prefetch" href="/assets/java-base.html-ed910b21.js" as="script"><link rel="prefetch" href="/assets/java-enum.html-afe8aeb1.js" as="script"><link rel="prefetch" href="/assets/java-reflect.html-0178e6e8.js" as="script"><link rel="prefetch" href="/assets/java-regex.html-ea5302f5.js" as="script"><link rel="prefetch" href="/assets/java-sql.html-f3768bbb.js" as="script"><link rel="prefetch" href="/assets/java-time.html-2c855f9e.js" as="script"><link rel="prefetch" href="/assets/java-version-feature.html-0514c3a5.js" as="script"><link rel="prefetch" href="/assets/java-collection-list.html-fbfca1ef.js" as="script"><link rel="prefetch" href="/assets/java-collection-map.html-15307947.js" as="script"><link rel="prefetch" href="/assets/heima-concurrent-base.html-764658bc.js" as="script"><link rel="prefetch" href="/assets/java-concurrent-base.html-527f93a9.js" as="script"><link rel="prefetch" href="/assets/Java-concurrent-container.html-9e302a0b.js" as="script"><link rel="prefetch" href="/assets/java-concurrent-interview.html-bbc0a621.js" as="script"><link rel="prefetch" href="/assets/java-concurrent-lock.html-41f5cb73.js" as="script"><link rel="prefetch" href="/assets/java-concurrent-pool.html-05c10061.js" as="script"><link rel="prefetch" href="/assets/java-concurrent-tools.html-01a740a1.js" as="script"><link rel="prefetch" href="/assets/java-bio.html-ee55c8f8.js" as="script"><link rel="prefetch" href="/assets/java-io.html-7f9ff9da.js" as="script"><link rel="prefetch" href="/assets/java-nio.html-46b166f9.js" as="script"><link rel="prefetch" href="/assets/java-memory-model.html-7958112b.js" as="script"><link rel="prefetch" href="/assets/jvm-class-file-structure.html-c097e686.js" as="script"><link rel="prefetch" href="/assets/jvm-class-loader.html-d0382e33.js" as="script"><link rel="prefetch" href="/assets/jvm-garbage-collection.html-ad2dc850.js" as="script"><link rel="prefetch" href="/assets/jvm-memory-structure.html-e31bda30.js" as="script"><link rel="prefetch" href="/assets/JVMæ¦‚è§ˆ.html-eda595c7.js" as="script"><link rel="prefetch" href="/assets/JVMè°ƒä¼˜.html-d0f59301.js" as="script"><link rel="prefetch" href="/assets/java-servlet.html-654d0068.js" as="script"><link rel="prefetch" href="/assets/java-lambda.html-c21b5e3b.js" as="script"><link rel="prefetch" href="/assets/java-stream.html-797890ef.js" as="script"><link rel="prefetch" href="/assets/HikariCP-base.html-ec5c9222.js" as="script"><link rel="prefetch" href="/assets/HikariCP-source.html-71542b59.js" as="script"><link rel="prefetch" href="/assets/jackson-overview.html-15f61ae4.js" as="script"><link rel="prefetch" href="/assets/kafka-broker.html-f3939976.js" as="script"><link rel="prefetch" href="/assets/kafka-consumer.html-f5b2d049.js" as="script"><link rel="prefetch" href="/assets/kafka-overview.html-0029d53e.js" as="script"><link rel="prefetch" href="/assets/kafka-producer.html-94380090.js" as="script"><link rel="prefetch" href="/assets/spring-kafka.html-bc75ec45.js" as="script"><link rel="prefetch" href="/assets/log-framework.html-1135605f.js" as="script"><link rel="prefetch" href="/assets/1.Hello World.html-44c17b24.js" as="script"><link rel="prefetch" href="/assets/2.Global Config.html-c6cf8642.js" as="script"><link rel="prefetch" href="/assets/mybatis-plus.html-47dc6415.js" as="script"><link rel="prefetch" href="/assets/index.html-91838e99.js" as="script"><link rel="prefetch" href="/assets/nginx.html-482342f3.js" as="script"><link rel="prefetch" href="/assets/sharding-sphere.html-5419590f.js" as="script"><link rel="prefetch" href="/assets/data-structure-dynamic.html-4f7b0965.js" as="script"><link rel="prefetch" href="/assets/data-structure-list.html-a268df29.js" as="script"><link rel="prefetch" href="/assets/data-structure-overview.html-85d0b05a.js" as="script"><link rel="prefetch" href="/assets/data-structure-tree.html-6f24b217.js" as="script"><link rel="prefetch" href="/assets/shiro-overview.html-e42cf658.js" as="script"><link rel="prefetch" href="/assets/tomcat.html-eb4a9dda.js" as="script"><link rel="prefetch" href="/assets/xxl-job.html-134d207a.js" as="script"><link rel="prefetch" href="/assets/design-adapter.html-3e892dc7.js" as="script"><link rel="prefetch" href="/assets/design-bridge.html-91b363b8.js" as="script"><link rel="prefetch" href="/assets/design-builder.html-6fd2408c.js" as="script"><link rel="prefetch" href="/assets/design-chain.html-73c4f586.js" as="script"><link rel="prefetch" href="/assets/design-command.html-d6dfccee.js" as="script"><link rel="prefetch" href="/assets/design-composite.html-057a7bcf.js" as="script"><link rel="prefetch" href="/assets/design-decorator.html-1955d9ac.js" as="script"><link rel="prefetch" href="/assets/design-facade.html-c34c2259.js" as="script"><link rel="prefetch" href="/assets/design-factory.html-89999af1.js" as="script"><link rel="prefetch" href="/assets/design-flyweight.html-f4f2afe1.js" as="script"><link rel="prefetch" href="/assets/design-interpreter.html-982ac126.js" as="script"><link rel="prefetch" href="/assets/design-iterator.html-59b9d18b.js" as="script"><link rel="prefetch" href="/assets/design-mediator.html-a73e3179.js" as="script"><link rel="prefetch" href="/assets/design-memento.html-495efbd1.js" as="script"><link rel="prefetch" href="/assets/design-observer.html-fbadf9f5.js" as="script"><link rel="prefetch" href="/assets/design-overview.html-fb49535c.js" as="script"><link rel="prefetch" href="/assets/design-prototype.html-5e661e49.js" as="script"><link rel="prefetch" href="/assets/design-proxy.html-c743cc9c.js" as="script"><link rel="prefetch" href="/assets/design-singleton.html-a594ad7a.js" as="script"><link rel="prefetch" href="/assets/design-state.html-b91f3529.js" as="script"><link rel="prefetch" href="/assets/design-strategy.html-586d3ac2.js" as="script"><link rel="prefetch" href="/assets/design-template.html-12aa47cf.js" as="script"><link rel="prefetch" href="/assets/design-visitor.html-51d45c95.js" as="script"><link rel="prefetch" href="/assets/docker.html-2f412609.js" as="script"><link rel="prefetch" href="/assets/linux-command.html-db80ac58.js" as="script"><link rel="prefetch" href="/assets/linux-core.html-3f065eb0.js" as="script"><link rel="prefetch" href="/assets/linux-overview.html-7f61946a.js" as="script"><link rel="prefetch" href="/assets/temp.html-733f02e6.js" as="script"><link rel="prefetch" href="/assets/æ»‘åŠ¨çª—å£.html-2903c1b6.js" as="script"><link rel="prefetch" href="/assets/encoding.html-3b631fc3.js" as="script"><link rel="prefetch" href="/assets/encryption-algorithm.html-bf387256.js" as="script"><link rel="prefetch" href="/assets/network.html-279991aa.js" as="script"><link rel="prefetch" href="/assets/spring-batch.html-7466d243.js" as="script"><link rel="prefetch" href="/assets/BeanPostProcessor-base.html-a46b20f9.js" as="script"><link rel="prefetch" href="/assets/BeanPostProcessor-ConfigurationClassPostProcessor.html-d4e7a5e5.js" as="script"><link rel="prefetch" href="/assets/spring-framework-overview.html-49552513.js" as="script"><link rel="prefetch" href="/assets/spring-source-overview.html-3ac2c8f4.js" as="script"><link rel="prefetch" href="/assets/spring-boot-condition.html-f38f1a16.js" as="script"><link rel="prefetch" href="/assets/spring-cloud-commons.html-b2df0b2e.js" as="script"><link rel="prefetch" href="/assets/spring-cloud-gateway.html-79d8ca10.js" as="script"><link rel="prefetch" href="/assets/spring-cloud-loadbalancer.html-182fff59.js" as="script"><link rel="prefetch" href="/assets/cloud-openfeign-action.html-6173210d.js" as="script"><link rel="prefetch" href="/assets/spring-cloud-openfeign.html-9dd99fbf.js" as="script"><link rel="prefetch" href="/assets/nacos-client-discovery.html-43257632.js" as="script"><link rel="prefetch" href="/assets/nacos-naming-source-service-register.html-f2d19ed3.js" as="script"><link rel="prefetch" href="/assets/nacos-overview.html-d85018d2.js" as="script"><link rel="prefetch" href="/assets/spring-cloud-ribbon.html-d8a62676.js" as="script"><link rel="prefetch" href="/assets/spring-cloud-alibaba-seate.html-f62e5a6b.js" as="script"><link rel="prefetch" href="/assets/git.html-476f511a.js" as="script"><link rel="prefetch" href="/assets/sentinel-source.html-e706b7a6.js" as="script"><link rel="prefetch" href="/assets/spring-cloud-sentinel.html-031a7566.js" as="script"><link rel="prefetch" href="/assets/gitlab.html-af9cead7.js" as="script"><link rel="prefetch" href="/assets/junit4.html-7674a247.js" as="script"><link rel="prefetch" href="/assets/junit5.html-5d65839e.js" as="script"><link rel="prefetch" href="/assets/maven.html-be6f6316.js" as="script"><link rel="prefetch" href="/assets/reactor.html-b7f3a608.js" as="script"><link rel="prefetch" href="/assets/1.tcp-id-model.html-763c065d.js" as="script"><link rel="prefetch" href="/assets/2.what_happen_url.html-ed893ab5.js" as="script"><link rel="prefetch" href="/assets/3.how_os_deal_network_package.html-003c9378.js" as="script"><link rel="prefetch" href="/assets/1.http_interview.html-81e5ff34.js" as="script"><link rel="prefetch" href="/assets/2.http_optimize.html-c31dc84d.js" as="script"><link rel="prefetch" href="/assets/3_https_rsa.html-d8314292.js" as="script"><link rel="prefetch" href="/assets/4_https_ecdhe.html-5333ed6a.js" as="script"><link rel="prefetch" href="/assets/5_https_optimize.html-1b5cb67c.js" as="script"><link rel="prefetch" href="/assets/6_http2.html-f5c4545f.js" as="script"><link rel="prefetch" href="/assets/7_http3.html-22194a12.js" as="script"><link rel="prefetch" href="/assets/1_tcp_interview.html-80022c5b.js" as="script"><link rel="prefetch" href="/assets/2_tcp_feature.html-a38fb885.js" as="script"><link rel="prefetch" href="/assets/3_tcp_tcpdump.html-7fa54232.js" as="script"><link rel="prefetch" href="/assets/1_ip_base.html-0a16f0d2.js" as="script"><link rel="prefetch" href="/assets/2_ping.html-31b5dbb5.js" as="script"><link rel="prefetch" href="/assets/3_ping_lo.html-4c54a1d5.js" as="script"><link rel="prefetch" href="/assets/1.how-cpu-run.html-230d707d.js" as="script"><link rel="prefetch" href="/assets/2.storage.html-189910cd.js" as="script"><link rel="prefetch" href="/assets/3.how-make-cpu-run-faster.html-4051d2c2.js" as="script"><link rel="prefetch" href="/assets/4.cpu-mesi.html-07cf201e.js" as="script"><link rel="prefetch" href="/assets/5.how-cup-deal-task.html-0e3ee3df.js" as="script"><link rel="prefetch" href="/assets/6.soft-interrupt.html-1bea4976.js" as="script"><link rel="prefetch" href="/assets/7.float.html-92f8ff81.js" as="script"><link rel="prefetch" href="/assets/linux-vs-windows.html-d0be38b1.js" as="script"><link rel="prefetch" href="/assets/1.vmem.html-b282b546.js" as="script"><link rel="prefetch" href="/assets/2.malloc.html-350861f0.js" as="script"><link rel="prefetch" href="/assets/3.mem-reclaim.html-ee770ad0.js" as="script"><link rel="prefetch" href="/assets/4.alloc-mem.html-541cad7b.js" as="script"><link rel="prefetch" href="/assets/5.cache-lru.html-6e272aa2.js" as="script"><link rel="prefetch" href="/assets/6.linux-mem.html-7d761356.js" as="script"><link rel="prefetch" href="/assets/7.linux-mem-2.html-25dc77c0.js" as="script"><link rel="prefetch" href="/assets/spring-collection-annotation.html-7395ab82.js" as="script"><link rel="prefetch" href="/assets/application-context.html-8ef65b1e.js" as="script"><link rel="prefetch" href="/assets/bean-factory-post-processor.html-a2e97494.js" as="script"><link rel="prefetch" href="/assets/bean-factory.html-982a8ae7.js" as="script"><link rel="prefetch" href="/assets/bean-post-processor.html-a79c4714.js" as="script"><link rel="prefetch" href="/assets/i18n-and-event.html-bad25ca9.js" as="script"><link rel="prefetch" href="/assets/package-scan.html-3652f543.js" as="script"><link rel="prefetch" href="/assets/spring-bean-create.html-a1f3b825.js" as="script"><link rel="prefetch" href="/assets/starting-finished.html-20e89aec.js" as="script"><link rel="prefetch" href="/assets/starting-overview.html-9a415d8c.js" as="script"><link rel="prefetch" href="/assets/starting-prepare.html-f22dce60.js" as="script"><link rel="prefetch" href="/assets/starting-summary.html-f0b9950a.js" as="script"><link rel="prefetch" href="/assets/spring-source-web-init.html-7095a9cc.js" as="script"><link rel="prefetch" href="/assets/spring-source-web-listener.html-8020b96c.js" as="script"><link rel="prefetch" href="/assets/404.html-f04ced3e.js" as="script"><link rel="prefetch" href="/assets/index.html-79ea5b2c.js" as="script"><link rel="prefetch" href="/assets/index.html-c2745466.js" as="script"><link rel="prefetch" href="/assets/index.html-e7a2b372.js" as="script"><link rel="prefetch" href="/assets/index.html-c7a0896e.js" as="script"><link rel="prefetch" href="/assets/index.html-44e4fbd1.js" as="script"><link rel="prefetch" href="/assets/index.html-deb73f95.js" as="script"><link rel="prefetch" href="/assets/index.html-9923d923.js" as="script"><link rel="prefetch" href="/assets/index.html-f8852d02.js" as="script"><link rel="prefetch" href="/assets/index.html-ebc6e775.js" as="script"><link rel="prefetch" href="/assets/index.html-5391a96f.js" as="script"><link rel="prefetch" href="/assets/index.html-7f9a590b.js" as="script"><link rel="prefetch" href="/assets/index.html-bdfce464.js" as="script"><link rel="prefetch" href="/assets/index.html-7bc2e619.js" as="script"><link rel="prefetch" href="/assets/index.html-19a53cb3.js" as="script"><link rel="prefetch" href="/assets/index.html-2dbf58c9.js" as="script"><link rel="prefetch" href="/assets/index.html-5135c839.js" as="script"><link rel="prefetch" href="/assets/index.html-493839dd.js" as="script"><link rel="prefetch" href="/assets/index.html-ceb8d736.js" as="script"><link rel="prefetch" href="/assets/index.html-e7623640.js" as="script"><link rel="prefetch" href="/assets/index.html-09445423.js" as="script"><link rel="prefetch" href="/assets/index.html-4228b788.js" as="script"><link rel="prefetch" href="/assets/index.html-ae4432a1.js" as="script"><link rel="prefetch" href="/assets/index.html-db047aee.js" as="script"><link rel="prefetch" href="/assets/index.html-6afc1b6b.js" as="script"><link rel="prefetch" href="/assets/index.html-36ab6168.js" as="script"><link rel="prefetch" href="/assets/index.html-844edecf.js" as="script"><link rel="prefetch" href="/assets/index.html-0bee4d7c.js" as="script"><link rel="prefetch" href="/assets/index.html-e48a03aa.js" as="script"><link rel="prefetch" href="/assets/index.html-1bcb9a21.js" as="script"><link rel="prefetch" href="/assets/index.html-6bad5551.js" as="script"><link rel="prefetch" href="/assets/index.html-b674839b.js" as="script"><link rel="prefetch" href="/assets/index.html-a2aeccdb.js" as="script"><link rel="prefetch" href="/assets/index.html-d2431a2d.js" as="script"><link rel="prefetch" href="/assets/index.html-8196e289.js" as="script"><link rel="prefetch" href="/assets/index.html-915f74ea.js" as="script"><link rel="prefetch" href="/assets/index.html-83711a9e.js" as="script"><link rel="prefetch" href="/assets/index.html-9df5b5ad.js" as="script"><link rel="prefetch" href="/assets/index.html-57c02b1b.js" as="script"><link rel="prefetch" href="/assets/index.html-10287dda.js" as="script"><link rel="prefetch" href="/assets/index.html-63a7add0.js" as="script"><link rel="prefetch" href="/assets/index.html-c84f755d.js" as="script"><link rel="prefetch" href="/assets/index.html-2e53f4cf.js" as="script"><link rel="prefetch" href="/assets/index.html-df942fbe.js" as="script"><link rel="prefetch" href="/assets/index.html-aa4a854c.js" as="script"><link rel="prefetch" href="/assets/index.html-420a9f57.js" as="script"><link rel="prefetch" href="/assets/index.html-27efb3f0.js" as="script"><link rel="prefetch" href="/assets/index.html-ca596762.js" as="script"><link rel="prefetch" href="/assets/index.html-9ba7568f.js" as="script"><link rel="prefetch" href="/assets/index.html-385adf3b.js" as="script"><link rel="prefetch" href="/assets/index.html-95b73732.js" as="script"><link rel="prefetch" href="/assets/index.html-74bd633c.js" as="script"><link rel="prefetch" href="/assets/index.html-b480d660.js" as="script"><link rel="prefetch" href="/assets/index.html-9b56ea57.js" as="script"><link rel="prefetch" href="/assets/index.html-2cc6561e.js" as="script"><link rel="prefetch" href="/assets/index.html-5e502638.js" as="script"><link rel="prefetch" href="/assets/index.html-2cbc0496.js" as="script"><link rel="prefetch" href="/assets/index.html-60de7f02.js" as="script"><link rel="prefetch" href="/assets/index.html-c6491f7f.js" as="script"><link rel="prefetch" href="/assets/index.html-cd02df7a.js" as="script"><link rel="prefetch" href="/assets/index.html-7cb87159.js" as="script"><link rel="prefetch" href="/assets/index.html-3454e09f.js" as="script"><link rel="prefetch" href="/assets/index.html-91025ccb.js" as="script"><link rel="prefetch" href="/assets/index.html-5477af0e.js" as="script"><link rel="prefetch" href="/assets/index.html-0a65ea49.js" as="script"><link rel="prefetch" href="/assets/index.html-88930a72.js" as="script"><link rel="prefetch" href="/assets/index.html-19de02d9.js" as="script"><link rel="prefetch" href="/assets/index.html-2e547c56.js" as="script"><link rel="prefetch" href="/assets/index.html-71fc6e23.js" as="script"><link rel="prefetch" href="/assets/index.html-b8bdf50b.js" as="script"><link rel="prefetch" href="/assets/index.html-982f8e31.js" as="script"><link rel="prefetch" href="/assets/index.html-4fe1b55c.js" as="script"><link rel="prefetch" href="/assets/index.html-a680cb33.js" as="script"><link rel="prefetch" href="/assets/index.html-148fdd8d.js" as="script"><link rel="prefetch" href="/assets/index.html-e50ac7ec.js" as="script"><link rel="prefetch" href="/assets/index.html-e31220f1.js" as="script"><link rel="prefetch" href="/assets/index.html-66f2582a.js" as="script"><link rel="prefetch" href="/assets/database-overview.html-81bf24af.js" as="script"><link rel="prefetch" href="/assets/new-concept-2.html-ff88e3ae.js" as="script"><link rel="prefetch" href="/assets/java-overview.html-d0b73528.js" as="script"><link rel="prefetch" href="/assets/middleware-overview.html-70e35558.js" as="script"><link rel="prefetch" href="/assets/quality-overview.html-c9aab1ec.js" as="script"><link rel="prefetch" href="/assets/spring-cloud-overview.html-74916449.js" as="script"><link rel="prefetch" href="/assets/gitbook.html-acdf5e93.js" as="script"><link rel="prefetch" href="/assets/tools-overview.html-f1afa529.js" as="script"><link rel="prefetch" href="/assets/mongo.html-a86d5a53.js" as="script"><link rel="prefetch" href="/assets/mysql-advance.html-a3921c1d.js" as="script"><link rel="prefetch" href="/assets/mysql-apply.html-3175b849.js" as="script"><link rel="prefetch" href="/assets/mysql-base.html-95c718f9.js" as="script"><link rel="prefetch" href="/assets/mysql-devops.html-21d35d02.js" as="script"><link rel="prefetch" href="/assets/redis-action.html-418d5ab2.js" as="script"><link rel="prefetch" href="/assets/redis-base.html-da98e929.js" as="script"><link rel="prefetch" href="/assets/redis-cluster.html-9dcb005a.js" as="script"><link rel="prefetch" href="/assets/redis-overview.html-b28d9cb7.js" as="script"><link rel="prefetch" href="/assets/java-annotation.html-30013231.js" as="script"><link rel="prefetch" href="/assets/java-base.html-45dd8871.js" as="script"><link rel="prefetch" href="/assets/java-enum.html-87cc3275.js" as="script"><link rel="prefetch" href="/assets/java-reflect.html-87ed91ce.js" as="script"><link rel="prefetch" href="/assets/java-regex.html-49dfa7ed.js" as="script"><link rel="prefetch" href="/assets/java-sql.html-cac00060.js" as="script"><link rel="prefetch" href="/assets/java-time.html-fdfe2ea1.js" as="script"><link rel="prefetch" href="/assets/java-version-feature.html-a868ac52.js" as="script"><link rel="prefetch" href="/assets/java-collection-list.html-b2030247.js" as="script"><link rel="prefetch" href="/assets/java-collection-map.html-c516a252.js" as="script"><link rel="prefetch" href="/assets/heima-concurrent-base.html-0d37e29a.js" as="script"><link rel="prefetch" href="/assets/java-concurrent-base.html-8030155e.js" as="script"><link rel="prefetch" href="/assets/Java-concurrent-container.html-811f4aab.js" as="script"><link rel="prefetch" href="/assets/java-concurrent-interview.html-c13ea47a.js" as="script"><link rel="prefetch" href="/assets/java-concurrent-lock.html-8ce687e8.js" as="script"><link rel="prefetch" href="/assets/java-concurrent-pool.html-c9f0f175.js" as="script"><link rel="prefetch" href="/assets/java-concurrent-tools.html-cce9bcca.js" as="script"><link rel="prefetch" href="/assets/java-bio.html-c75f1345.js" as="script"><link rel="prefetch" href="/assets/java-io.html-0e2cf5e0.js" as="script"><link rel="prefetch" href="/assets/java-nio.html-934e8907.js" as="script"><link rel="prefetch" href="/assets/java-memory-model.html-263a2e85.js" as="script"><link rel="prefetch" href="/assets/jvm-class-file-structure.html-34c3bce9.js" as="script"><link rel="prefetch" href="/assets/jvm-class-loader.html-9185fd00.js" as="script"><link rel="prefetch" href="/assets/jvm-garbage-collection.html-7859578e.js" as="script"><link rel="prefetch" href="/assets/jvm-memory-structure.html-fe44534c.js" as="script"><link rel="prefetch" href="/assets/JVMæ¦‚è§ˆ.html-4c5d2e30.js" as="script"><link rel="prefetch" href="/assets/JVMè°ƒä¼˜.html-72c2eb98.js" as="script"><link rel="prefetch" href="/assets/java-servlet.html-94bdbc40.js" as="script"><link rel="prefetch" href="/assets/java-lambda.html-7174e34d.js" as="script"><link rel="prefetch" href="/assets/java-stream.html-0016d70b.js" as="script"><link rel="prefetch" href="/assets/HikariCP-base.html-61148ceb.js" as="script"><link rel="prefetch" href="/assets/HikariCP-source.html-4b401a26.js" as="script"><link rel="prefetch" href="/assets/jackson-overview.html-cd6a6a9d.js" as="script"><link rel="prefetch" href="/assets/kafka-broker.html-824fc781.js" as="script"><link rel="prefetch" href="/assets/kafka-consumer.html-acb94ec6.js" as="script"><link rel="prefetch" href="/assets/kafka-overview.html-e594f96f.js" as="script"><link rel="prefetch" href="/assets/kafka-producer.html-fc3214cf.js" as="script"><link rel="prefetch" href="/assets/spring-kafka.html-c37f0556.js" as="script"><link rel="prefetch" href="/assets/log-framework.html-3e5b2aea.js" as="script"><link rel="prefetch" href="/assets/1.Hello World.html-05f026e2.js" as="script"><link rel="prefetch" href="/assets/2.Global Config.html-f70c177c.js" as="script"><link rel="prefetch" href="/assets/mybatis-plus.html-411a764f.js" as="script"><link rel="prefetch" href="/assets/index.html-8eece89e.js" as="script"><link rel="prefetch" href="/assets/nginx.html-da20fd8e.js" as="script"><link rel="prefetch" href="/assets/sharding-sphere.html-78203d55.js" as="script"><link rel="prefetch" href="/assets/data-structure-dynamic.html-19bb7a14.js" as="script"><link rel="prefetch" href="/assets/data-structure-list.html-6dc538c5.js" as="script"><link rel="prefetch" href="/assets/data-structure-overview.html-4782ed36.js" as="script"><link rel="prefetch" href="/assets/data-structure-tree.html-8b761e52.js" as="script"><link rel="prefetch" href="/assets/shiro-overview.html-0b349d07.js" as="script"><link rel="prefetch" href="/assets/tomcat.html-1dadbec4.js" as="script"><link rel="prefetch" href="/assets/xxl-job.html-47bd0cc3.js" as="script"><link rel="prefetch" href="/assets/design-adapter.html-4db66971.js" as="script"><link rel="prefetch" href="/assets/design-bridge.html-c70e3526.js" as="script"><link rel="prefetch" href="/assets/design-builder.html-95262ea6.js" as="script"><link rel="prefetch" href="/assets/design-chain.html-8bff25bf.js" as="script"><link rel="prefetch" href="/assets/design-command.html-d7d2ffd7.js" as="script"><link rel="prefetch" href="/assets/design-composite.html-137b1bb3.js" as="script"><link rel="prefetch" href="/assets/design-decorator.html-56744b7a.js" as="script"><link rel="prefetch" href="/assets/design-facade.html-9f6d20c6.js" as="script"><link rel="prefetch" href="/assets/design-factory.html-f98890be.js" as="script"><link rel="prefetch" href="/assets/design-flyweight.html-19b297be.js" as="script"><link rel="prefetch" href="/assets/design-interpreter.html-1e85617c.js" as="script"><link rel="prefetch" href="/assets/design-iterator.html-6da75cee.js" as="script"><link rel="prefetch" href="/assets/design-mediator.html-c3901bcc.js" as="script"><link rel="prefetch" href="/assets/design-memento.html-33f18b31.js" as="script"><link rel="prefetch" href="/assets/design-observer.html-061ef3cc.js" as="script"><link rel="prefetch" href="/assets/design-overview.html-31bda9ae.js" as="script"><link rel="prefetch" href="/assets/design-prototype.html-e9f7590f.js" as="script"><link rel="prefetch" href="/assets/design-proxy.html-979ddc5a.js" as="script"><link rel="prefetch" href="/assets/design-singleton.html-7c329043.js" as="script"><link rel="prefetch" href="/assets/design-state.html-be475fa6.js" as="script"><link rel="prefetch" href="/assets/design-strategy.html-54993b2b.js" as="script"><link rel="prefetch" href="/assets/design-template.html-2890a82a.js" as="script"><link rel="prefetch" href="/assets/design-visitor.html-86d27f60.js" as="script"><link rel="prefetch" href="/assets/docker.html-348fe9d4.js" as="script"><link rel="prefetch" href="/assets/linux-command.html-afa2fdc0.js" as="script"><link rel="prefetch" href="/assets/linux-core.html-34afd11f.js" as="script"><link rel="prefetch" href="/assets/linux-overview.html-76e7efda.js" as="script"><link rel="prefetch" href="/assets/temp.html-555d9383.js" as="script"><link rel="prefetch" href="/assets/æ»‘åŠ¨çª—å£.html-4a0742d9.js" as="script"><link rel="prefetch" href="/assets/encoding.html-cbfd0d77.js" as="script"><link rel="prefetch" href="/assets/encryption-algorithm.html-8e07492a.js" as="script"><link rel="prefetch" href="/assets/network.html-44c0d77f.js" as="script"><link rel="prefetch" href="/assets/spring-batch.html-3ef72f7b.js" as="script"><link rel="prefetch" href="/assets/BeanPostProcessor-base.html-98b0202d.js" as="script"><link rel="prefetch" href="/assets/BeanPostProcessor-ConfigurationClassPostProcessor.html-229400aa.js" as="script"><link rel="prefetch" href="/assets/spring-framework-overview.html-0bd1b3bd.js" as="script"><link rel="prefetch" href="/assets/spring-source-overview.html-bc3f8003.js" as="script"><link rel="prefetch" href="/assets/spring-boot-condition.html-6ff26285.js" as="script"><link rel="prefetch" href="/assets/spring-cloud-commons.html-f0cbc043.js" as="script"><link rel="prefetch" href="/assets/spring-cloud-gateway.html-aee90359.js" as="script"><link rel="prefetch" href="/assets/spring-cloud-loadbalancer.html-a9814120.js" as="script"><link rel="prefetch" href="/assets/cloud-openfeign-action.html-54387674.js" as="script"><link rel="prefetch" href="/assets/spring-cloud-openfeign.html-8f692d94.js" as="script"><link rel="prefetch" href="/assets/nacos-client-discovery.html-4e22e868.js" as="script"><link rel="prefetch" href="/assets/nacos-naming-source-service-register.html-46598061.js" as="script"><link rel="prefetch" href="/assets/nacos-overview.html-71fd26b0.js" as="script"><link rel="prefetch" href="/assets/spring-cloud-ribbon.html-e86d0416.js" as="script"><link rel="prefetch" href="/assets/spring-cloud-alibaba-seate.html-f60b19e5.js" as="script"><link rel="prefetch" href="/assets/git.html-956c9cf1.js" as="script"><link rel="prefetch" href="/assets/sentinel-source.html-ff88b99f.js" as="script"><link rel="prefetch" href="/assets/spring-cloud-sentinel.html-8db3b8ca.js" as="script"><link rel="prefetch" href="/assets/gitlab.html-6b192049.js" as="script"><link rel="prefetch" href="/assets/junit4.html-c792240f.js" as="script"><link rel="prefetch" href="/assets/junit5.html-3727c3db.js" as="script"><link rel="prefetch" href="/assets/maven.html-e13c8f26.js" as="script"><link rel="prefetch" href="/assets/reactor.html-f0f4cd13.js" as="script"><link rel="prefetch" href="/assets/1.tcp-id-model.html-fbdc585c.js" as="script"><link rel="prefetch" href="/assets/2.what_happen_url.html-11ff9eab.js" as="script"><link rel="prefetch" href="/assets/3.how_os_deal_network_package.html-b92c6457.js" as="script"><link rel="prefetch" href="/assets/1.http_interview.html-f9516b19.js" as="script"><link rel="prefetch" href="/assets/2.http_optimize.html-c74a6f87.js" as="script"><link rel="prefetch" href="/assets/3_https_rsa.html-034f973b.js" as="script"><link rel="prefetch" href="/assets/4_https_ecdhe.html-b0a9c59f.js" as="script"><link rel="prefetch" href="/assets/5_https_optimize.html-fe06e481.js" as="script"><link rel="prefetch" href="/assets/6_http2.html-d305c873.js" as="script"><link rel="prefetch" href="/assets/7_http3.html-97b70a2a.js" as="script"><link rel="prefetch" href="/assets/1_tcp_interview.html-60729441.js" as="script"><link rel="prefetch" href="/assets/2_tcp_feature.html-25b828cf.js" as="script"><link rel="prefetch" href="/assets/3_tcp_tcpdump.html-5491f690.js" as="script"><link rel="prefetch" href="/assets/1_ip_base.html-d712d902.js" as="script"><link rel="prefetch" href="/assets/2_ping.html-eec452ed.js" as="script"><link rel="prefetch" href="/assets/3_ping_lo.html-8dcb5a9a.js" as="script"><link rel="prefetch" href="/assets/1.how-cpu-run.html-d99149b0.js" as="script"><link rel="prefetch" href="/assets/2.storage.html-774e3e4d.js" as="script"><link rel="prefetch" href="/assets/3.how-make-cpu-run-faster.html-8e014b54.js" as="script"><link rel="prefetch" href="/assets/4.cpu-mesi.html-7e5c37ae.js" as="script"><link rel="prefetch" href="/assets/5.how-cup-deal-task.html-b2f2d081.js" as="script"><link rel="prefetch" href="/assets/6.soft-interrupt.html-889975b4.js" as="script"><link rel="prefetch" href="/assets/7.float.html-bffa75ff.js" as="script"><link rel="prefetch" href="/assets/linux-vs-windows.html-915715df.js" as="script"><link rel="prefetch" href="/assets/1.vmem.html-4064416a.js" as="script"><link rel="prefetch" href="/assets/2.malloc.html-32197d01.js" as="script"><link rel="prefetch" href="/assets/3.mem-reclaim.html-6209f085.js" as="script"><link rel="prefetch" href="/assets/4.alloc-mem.html-911ee7b0.js" as="script"><link rel="prefetch" href="/assets/5.cache-lru.html-b747920f.js" as="script"><link rel="prefetch" href="/assets/6.linux-mem.html-80432afb.js" as="script"><link rel="prefetch" href="/assets/7.linux-mem-2.html-f3db7807.js" as="script"><link rel="prefetch" href="/assets/spring-collection-annotation.html-29798feb.js" as="script"><link rel="prefetch" href="/assets/application-context.html-9bee65ed.js" as="script"><link rel="prefetch" href="/assets/bean-factory-post-processor.html-f10ec0a6.js" as="script"><link rel="prefetch" href="/assets/bean-factory.html-842232a8.js" as="script"><link rel="prefetch" href="/assets/bean-post-processor.html-1368dfdc.js" as="script"><link rel="prefetch" href="/assets/i18n-and-event.html-8fdbd04c.js" as="script"><link rel="prefetch" href="/assets/package-scan.html-b58ae430.js" as="script"><link rel="prefetch" href="/assets/spring-bean-create.html-92e356c0.js" as="script"><link rel="prefetch" href="/assets/starting-finished.html-5e1a1000.js" as="script"><link rel="prefetch" href="/assets/starting-overview.html-c747f251.js" as="script"><link rel="prefetch" href="/assets/starting-prepare.html-de7f2f97.js" as="script"><link rel="prefetch" href="/assets/starting-summary.html-56702e3e.js" as="script"><link rel="prefetch" href="/assets/spring-source-web-init.html-7dc40dc5.js" as="script"><link rel="prefetch" href="/assets/spring-source-web-listener.html-3ab151a2.js" as="script"><link rel="prefetch" href="/assets/404.html-4482f428.js" as="script"><link rel="prefetch" href="/assets/index.html-087cd9cf.js" as="script"><link rel="prefetch" href="/assets/index.html-9e123f15.js" as="script"><link rel="prefetch" href="/assets/index.html-c8c0595b.js" as="script"><link rel="prefetch" href="/assets/index.html-3dec91e0.js" as="script"><link rel="prefetch" href="/assets/index.html-dac4fb5e.js" as="script"><link rel="prefetch" href="/assets/index.html-57ca67ca.js" as="script"><link rel="prefetch" href="/assets/index.html-47aa26a2.js" as="script"><link rel="prefetch" href="/assets/index.html-6228255c.js" as="script"><link rel="prefetch" href="/assets/index.html-e5821b2c.js" as="script"><link rel="prefetch" href="/assets/index.html-5b406c8c.js" as="script"><link rel="prefetch" href="/assets/index.html-69303c44.js" as="script"><link rel="prefetch" href="/assets/index.html-57908ff6.js" as="script"><link rel="prefetch" href="/assets/index.html-5bfef271.js" as="script"><link rel="prefetch" href="/assets/index.html-e812711e.js" as="script"><link rel="prefetch" href="/assets/index.html-0cd59e6c.js" as="script"><link rel="prefetch" href="/assets/index.html-af3557c8.js" as="script"><link rel="prefetch" href="/assets/index.html-400416c1.js" as="script"><link rel="prefetch" href="/assets/index.html-aeb21a5e.js" as="script"><link rel="prefetch" href="/assets/index.html-e603f649.js" as="script"><link rel="prefetch" href="/assets/index.html-8099f8b7.js" as="script"><link rel="prefetch" href="/assets/index.html-e657d222.js" as="script"><link rel="prefetch" href="/assets/index.html-b72e665b.js" as="script"><link rel="prefetch" href="/assets/index.html-8850e34b.js" as="script"><link rel="prefetch" href="/assets/index.html-1c0c2a2a.js" as="script"><link rel="prefetch" href="/assets/index.html-3a56156a.js" as="script"><link rel="prefetch" href="/assets/index.html-62180c4b.js" as="script"><link rel="prefetch" href="/assets/index.html-4dce3ab3.js" as="script"><link rel="prefetch" href="/assets/index.html-72c49b04.js" as="script"><link rel="prefetch" href="/assets/index.html-4c98ed7e.js" as="script"><link rel="prefetch" href="/assets/index.html-cfb35331.js" as="script"><link rel="prefetch" href="/assets/index.html-85c25e01.js" as="script"><link rel="prefetch" href="/assets/index.html-e9165360.js" as="script"><link rel="prefetch" href="/assets/index.html-c5c6ccd9.js" as="script"><link rel="prefetch" href="/assets/index.html-b1a95e7f.js" as="script"><link rel="prefetch" href="/assets/index.html-0aed9f44.js" as="script"><link rel="prefetch" href="/assets/index.html-6309b593.js" as="script"><link rel="prefetch" href="/assets/index.html-53f4ae61.js" as="script"><link rel="prefetch" href="/assets/index.html-be453128.js" as="script"><link rel="prefetch" href="/assets/index.html-b6d2e0cf.js" as="script"><link rel="prefetch" href="/assets/index.html-d96fb28a.js" as="script"><link rel="prefetch" href="/assets/index.html-0dd8fad8.js" as="script"><link rel="prefetch" href="/assets/index.html-a1eaa0a7.js" as="script"><link rel="prefetch" href="/assets/index.html-e51738f2.js" as="script"><link rel="prefetch" href="/assets/index.html-8c102982.js" as="script"><link rel="prefetch" href="/assets/index.html-1f9cdd35.js" as="script"><link rel="prefetch" href="/assets/index.html-63fbd907.js" as="script"><link rel="prefetch" href="/assets/index.html-3190c6a3.js" as="script"><link rel="prefetch" href="/assets/index.html-1aa7fee5.js" as="script"><link rel="prefetch" href="/assets/index.html-483697fa.js" as="script"><link rel="prefetch" href="/assets/index.html-ab65ac33.js" as="script"><link rel="prefetch" href="/assets/index.html-2d7a9565.js" as="script"><link rel="prefetch" href="/assets/index.html-b838c603.js" as="script"><link rel="prefetch" href="/assets/index.html-de3b7914.js" as="script"><link rel="prefetch" href="/assets/index.html-74fbbd3a.js" as="script"><link rel="prefetch" href="/assets/index.html-a7de50d0.js" as="script"><link rel="prefetch" href="/assets/index.html-b3af77c3.js" as="script"><link rel="prefetch" href="/assets/index.html-681a7978.js" as="script"><link rel="prefetch" href="/assets/index.html-4984d8c7.js" as="script"><link rel="prefetch" href="/assets/index.html-26accc77.js" as="script"><link rel="prefetch" href="/assets/index.html-183a4964.js" as="script"><link rel="prefetch" href="/assets/index.html-dfe1bab4.js" as="script"><link rel="prefetch" href="/assets/index.html-5cad09e8.js" as="script"><link rel="prefetch" href="/assets/index.html-74aefd26.js" as="script"><link rel="prefetch" href="/assets/index.html-65cf5278.js" as="script"><link rel="prefetch" href="/assets/index.html-e08b1bac.js" as="script"><link rel="prefetch" href="/assets/index.html-1a618372.js" as="script"><link rel="prefetch" href="/assets/index.html-63cba565.js" as="script"><link rel="prefetch" href="/assets/index.html-1d599a81.js" as="script"><link rel="prefetch" href="/assets/index.html-279180e7.js" as="script"><link rel="prefetch" href="/assets/index.html-69dbe9f0.js" as="script"><link rel="prefetch" href="/assets/index.html-e701b05c.js" as="script"><link rel="prefetch" href="/assets/index.html-cf8785e3.js" as="script"><link rel="prefetch" href="/assets/index.html-9eea119d.js" as="script"><link rel="prefetch" href="/assets/index.html-bd64f0b5.js" as="script"><link rel="prefetch" href="/assets/index.html-aecf24f6.js" as="script"><link rel="prefetch" href="/assets/mermaid.core-a1726b7b.js" as="script"><link rel="prefetch" href="/assets/pageview-4c1e2df7.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><!--[--><div class="theme-container has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><!--[--><a class="vp-link vp-brand vp-brand" href="/"><!----><!----><span class="vp-site-name">-_- !</span></a><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-center"><!--[--><!----><!--]--><!--[--><nav class="vp-nav-links"><div class="nav-item hide-in-mobile"><a aria-label="Java ç¬”è®°" class="vp-link nav-link nav-link" href="/java/java-overview.html"><!---->Java ç¬”è®°<!----></a></div><div class="nav-item hide-in-mobile"><a aria-label="SpringFramwork" class="vp-link nav-link nav-link" href="/spring/spring-framework/spring-framework-overview.html"><!---->SpringFramwork<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="Spring Cloud"><span class="title"><!---->Spring Cloud</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a aria-label="Spring Cloud Overview" class="vp-link nav-link nav-link" href="/spring-cloud/spring-cloud-overview.html"><!---->Spring Cloud Overview<!----></a></li><li class="dropdown-item"><a aria-label="Spring Cloud Nacos" class="vp-link nav-link nav-link" href="/spring-cloud/spring-cloud-alibaba-nacos.html"><!---->Spring Cloud Nacos<!----></a></li><li class="dropdown-item"><a aria-label="Spring Cloud Sentinel" class="vp-link nav-link nav-link" href="/spring-cloud/spring-cloud-alibaba-sentinel.html"><!---->Spring Cloud Sentinel<!----></a></li><li class="dropdown-item"><a aria-label="Spring Cloud Seate" class="vp-link nav-link nav-link" href="/spring-cloud/spring-cloud-alibaba-seate.html"><!---->Spring Cloud Seate<!----></a></li><li class="dropdown-item"><a aria-label="Spring Cloud Ribbon" class="vp-link nav-link nav-link" href="/spring-cloud/spring-cloud-ribbon/spring-cloud-ribbon.html"><!---->Spring Cloud Ribbon<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><a aria-label="æ•°æ®åº“" class="vp-link nav-link nav-link" href="/database/database-overview.html"><!---->æ•°æ®åº“<!----></a></div><div class="nav-item hide-in-mobile"><a aria-label="è‡ªæˆ‘ä¿®å…»" class="vp-link nav-link nav-link" href="/quality/quality-overview.html"><!---->è‡ªæˆ‘ä¿®å…»<!----></a></div><div class="nav-item hide-in-mobile"><a aria-label="ä¸­é—´ä»¶" class="vp-link nav-link nav-link" href="/middleware/middleware-overview.html"><!---->ä¸­é—´ä»¶<!----></a></div><div class="nav-item hide-in-mobile"><a aria-label="å·¥å…·åŒ…" class="vp-link nav-link nav-link" href="/tools/tools-overview.html"><!---->å·¥å…·åŒ…<!----></a></div></nav><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-end"><!--[--><!----><!--]--><!--[--><!----><!----><div class="nav-item hide-in-mobile"><button type="button" id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!----><!--]--><!--[--><!----><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!--[--><!----><!--]--><ul class="vp-sidebar-links"><li><!--[--><a aria-label="å¸¸ç”¨å·¥å…·æ€»ç»“" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/middleware/middleware-overview.html"><!---->å¸¸ç”¨å·¥å…·æ€»ç»“<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">Mybatis æ€»ç»“</span><span class="vp-arrow end"></span></button><!----></section></li><li><!--[--><a aria-label="Shiro æ€»ç»“" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/middleware/shiro/shiro-overview.html"><!---->Shiro æ€»ç»“<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="Sharding-Sphere æ€»ç»“" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/middleware/sharding-sphere/sharding-sphere.html"><!---->Sharding-Sphere æ€»ç»“<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">Tomcat ä¸“é¢˜</span><span class="vp-arrow end"></span></button><!----></section></li><li><!--[--><a aria-label="Nginx å®æˆ˜" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/middleware/nginx/nginx.html"><!---->Nginx å®æˆ˜<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">Kafka ä¸“é¢˜</span><span class="vp-arrow end"></span></button><!----></section></li><li><!--[--><a aria-label="æ—¥å¿—çš„ä½¿ç”¨" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/middleware/log/log-framework.html"><!---->æ—¥å¿—çš„ä½¿ç”¨<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="Jackson è¯¦è§£" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/middleware/jackson/jackson-overview.html"><!---->Jackson è¯¦è§£<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">HikariCP è¯¦è§£</span><span class="vp-arrow end"></span></button><!----></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->Kafka Overview</h1><div class="page-info"><!----><!----><span class="page-date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2023-02-01T07:21:39.000Z"></span><!----><span class="page-reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 40 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT40M"></span><!----><!----></div><hr></div><div class="toc-place-holder"><aside id="toc"><!--[--><!----><!--]--><div class="toc-header">æ­¤é¡µå†…å®¹<button type="button" class="print-button" title="æ‰“å°"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button></div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/#kafka-å…¥é—¨ä»‹ç»">Kafka å…¥é—¨ä»‹ç»</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/#kafkaçš„æ¶ˆæ¯æ¨¡å‹">Kafkaçš„æ¶ˆæ¯æ¨¡å‹</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/#kafkaå‰¯æœ¬åŒæ­¥æœºåˆ¶">Kafkaå‰¯æœ¬åŒæ­¥æœºåˆ¶</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/#kafkaæ–‡ä»¶å­˜å‚¨æœºåˆ¶">Kafkaæ–‡ä»¶å­˜å‚¨æœºåˆ¶</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/#kafkaæ•°æ®å¯é æ€§å’Œä¸€è‡´æ€§ä¿è¯">kafkaæ•°æ®å¯é æ€§å’Œä¸€è‡´æ€§ä¿è¯</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/#kafka-leaderé€‰ä¸¾">kafka leaderé€‰ä¸¾</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/#æ¶ˆæ¯ä¼ é€’è¯­ä¹‰">æ¶ˆæ¯ä¼ é€’è¯­ä¹‰</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/#kafkaé›†ç¾¤partitions-replicasé»˜è®¤åˆ†é…è§£æ">Kafkaé›†ç¾¤partitions/replicasé»˜è®¤åˆ†é…è§£æ</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/#kafkaçš„ç®€å•å®‰è£…">Kafkaçš„ç®€å•å®‰è£…</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/#kafkaé…ç½®æ–‡ä»¶æ€»ç»“">Kafkaé…ç½®æ–‡ä»¶æ€»ç»“</a></li><!----><!--]--></ul><div class="toc-marker" style="top:-1.7rem;"></div></div><!--[--><!----><!--]--></aside></div><!----><div class="theme-hope-content"><h1 id="kafka-overview" tabindex="-1"><a class="header-anchor" href="#kafka-overview" aria-hidden="true">#</a> Kafka Overview</h1><h3 id="kafka-å…¥é—¨ä»‹ç»" tabindex="-1"><a class="header-anchor" href="#kafka-å…¥é—¨ä»‹ç»" aria-hidden="true">#</a> Kafka å…¥é—¨ä»‹ç»</h3><p>ä¸€ä¸ªæµå¤„ç†å¹³å°ï¼Œåº”è¯¥å…·å¤‡ä¸‰ä¸ªå…³é”®èƒ½åŠ›ï¼š</p><ul><li>å‘å¸ƒå’Œè®¢é˜…æ¶ˆæ¯ï¼ˆæµï¼‰ï¼Œ åœ¨è¿™æ–¹é¢ï¼Œä»–ç±»ä¼¼ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—</li><li>ä»¥å®¹é”™ï¼ˆæ•…éšœè½¬ç§»ï¼‰çš„æ–¹å¼å¤„ç†å­˜å‚¨æ¶ˆæ¯ï¼ˆæµï¼‰</li><li>åœ¨æ¶ˆæ¯å‘ç”Ÿæ˜¯å¤„ç†ä»–ä»¬</li></ul><p>kafkaä½œä¸ºä¸€ä¸ªæµå¤„ç†å¹³å°ï¼Œä¸»è¦åº”ç”¨äºä¸¤å¤§ç±»åœºæ™¯ï¼š</p><ul><li>æ„å»ºå®æ—¶çš„æ•°æ®æµç®¡é“ï¼Œå¯é çš„è·å–ç³»ç»Ÿå’Œåº”ç”¨ç¨‹åºä¹‹é—´çš„æ•°æ®</li><li>æ„å»ºå®æ—¶æµçš„åº”ç”¨ç¨‹åºï¼Œå¯¹æ•°æ®æµè¿›è¡Œè½¬æ¢æˆ–ååº”</li></ul><h4 id="å‡ ä¸ªæ¦‚å¿µ" tabindex="-1"><a class="header-anchor" href="#å‡ ä¸ªæ¦‚å¿µ" aria-hidden="true">#</a> å‡ ä¸ªæ¦‚å¿µ</h4><ol><li>kafkaä½œä¸ºä¸€ä¸ªé›†ç¾¤è¿è¡Œåœ¨ä¸€ä¸ªæˆ–å¤šä¸ªæœåŠ¡å™¨ä¸Š</li><li>kafkaé›†ç¾¤å­˜å‚¨çš„æ¶ˆæ¯æ—¶ä»¥topicä¸ºç±»åˆ«è®°å½•</li><li>æ¯ä¸ªæ¶ˆæ¯æ—¶æœ‰ä¸€ä¸ªkeyï¼Œä¸€ä¸ªvalueå’Œæ—¶é—´æˆ³æ„æˆã€‚</li></ol><h4 id="kafkaçš„å››ä¸ªæ ¸å¿ƒapi" tabindex="-1"><a class="header-anchor" href="#kafkaçš„å››ä¸ªæ ¸å¿ƒapi" aria-hidden="true">#</a> kafkaçš„å››ä¸ªæ ¸å¿ƒAPI</h4><ul><li><p>åº”ç”¨ç¨‹åºä½¿ç”¨Producer APIå‘å¸ƒä¸€ä¸ªæ¶ˆæ¯åˆ°1ä¸ªæˆ–å¯¹ä¸ªtopicä¸­</p></li><li><p>åº”ç”¨ç¨‹åºä½¿ç”¨Consumer APIæ¥è®¢é˜…ä¸€ä¸ªæˆ–å¤šä¸ªtopicï¼Œå¹¶å¤„ç†äº§ç”Ÿçš„æ¶ˆæ¯</p></li><li><p>åº”ç”¨ç¨‹åºä½¿ç”¨ Streams API å……å½“ä¸€ä¸ªæµå¤„ç†å™¨ï¼Œä»1ä¸ªæˆ–å¤šä¸ªtopicæ¶ˆè´¹è¾“å…¥æµï¼Œå¹¶ç”Ÿäº§ä¸€ä¸ªè¾“å‡ºæµåˆ°1ä¸ªæˆ–å¤šä¸ªè¾“å‡ºtopicï¼Œæœ‰æ•ˆåœ°å°†è¾“å…¥æµè½¬æ¢åˆ°è¾“å‡ºæµã€‚</p></li><li><p>Connector APIå¯æ„å»ºæˆ–è¿è¡Œå¯é‡ç”¨çš„ç”Ÿäº§è€…æˆ–æ¶ˆè´¹è€…ï¼Œå°†topicè¿æ¥åˆ°ç°æœ‰çš„åº”ç”¨ç¨‹åºæˆ–æ•°æ®ç³»ç»Ÿã€‚ä¾‹å¦‚ï¼Œè¿æ¥åˆ°å…³ç³»æ•°æ®åº“çš„è¿æ¥å™¨å¯ä»¥æ•è·è¡¨çš„æ¯ä¸ªå˜æ›´ã€‚</p><img src="/assets/KmCudlf7DXiAVXBMAAFScKNS-Og538-e4353c3d.png" style="zoom:50%;float:left;"></li></ul><p>Clientå’ŒServerä¹‹é—´çš„é€šè®¯ï¼Œæ˜¯é€šè¿‡ä¸€æ¡ç®€å•ã€é«˜æ€§èƒ½å¹¶ä¸”å’Œå¼€å‘è¯­è¨€æ— å…³çš„<a href="/fwd?link=https://kafka.apache.org/protocol.html" class="">TCPåè®®</a>ã€‚å¹¶ä¸”è¯¥åè®®ä¿æŒä¸è€ç‰ˆæœ¬çš„å…¼å®¹ã€‚Kafkaæä¾›äº†Java Clientï¼ˆå®¢æˆ·ç«¯ï¼‰ã€‚é™¤äº†Javaå®¢æˆ·ç«¯å¤–ï¼Œè¿˜æœ‰éå¸¸å¤šçš„<a href="/fwd?link=https://cwiki.apache.org/confluence/display/KAFKA/Clients">å…¶å®ƒç¼–ç¨‹è¯­è¨€çš„å®¢æˆ·ç«¯</a>ã€‚</p><h4 id="kafkaçš„åŸºæœ¬æœ¯è¯­" tabindex="-1"><a class="header-anchor" href="#kafkaçš„åŸºæœ¬æœ¯è¯­" aria-hidden="true">#</a> kafkaçš„åŸºæœ¬æœ¯è¯­</h4><h5 id="topic" tabindex="-1"><a class="header-anchor" href="#topic" aria-hidden="true">#</a> Topic</h5><p>Kafkaå°†æ¶ˆæ¯åˆ†é—¨åˆ«ç±»ï¼Œæ¯ä¸€ç±»çš„æ¶ˆæ¯ç§°ä¹‹ä¸ºä¸€ä¸ªä¸»é¢˜ï¼ˆTopicï¼‰ã€‚</p><h5 id="producer" tabindex="-1"><a class="header-anchor" href="#producer" aria-hidden="true">#</a> Producer</h5><p>å‘å¸ƒæ¶ˆæ¯çš„å¯¹è±¡ç§°ä¹‹ä¸ºä¸»é¢˜ç”Ÿäº§è€…ï¼ˆKafka topic producerï¼‰</p><h5 id="consumer" tabindex="-1"><a class="header-anchor" href="#consumer" aria-hidden="true">#</a> Consumer</h5><p>è®¢é˜…æ¶ˆæ¯å¹¶å¤„ç†å‘å¸ƒçš„æ¶ˆæ¯çš„å¯¹è±¡ç§°ä¹‹ä¸ºä¸»é¢˜æ¶ˆè´¹è€…ï¼ˆconsumersï¼‰</p><h5 id="broker" tabindex="-1"><a class="header-anchor" href="#broker" aria-hidden="true">#</a> Broker</h5><p>å·²å‘å¸ƒçš„æ¶ˆæ¯ä¿å­˜åœ¨ä¸€ç»„æœåŠ¡å™¨ä¸­ï¼Œç§°ä¹‹ä¸ºKafkaé›†ç¾¤ã€‚é›†ç¾¤ä¸­çš„æ¯ä¸€ä¸ªæœåŠ¡å™¨éƒ½æ˜¯ä¸€ä¸ªä»£ç†ï¼ˆBrokerï¼‰ã€‚ æ¶ˆè´¹è€…å¯ä»¥è®¢é˜…ä¸€ä¸ªæˆ–å¤šä¸ªä¸»é¢˜ï¼ˆtopicï¼‰ï¼Œå¹¶ä»Brokeræ‹‰æ•°æ®ï¼Œä»è€Œæ¶ˆè´¹è¿™äº›å·²å‘å¸ƒçš„æ¶ˆæ¯ã€‚</p><h4 id="æ—¥å¿—å’Œä¸»é¢˜" tabindex="-1"><a class="header-anchor" href="#æ—¥å¿—å’Œä¸»é¢˜" aria-hidden="true">#</a> æ—¥å¿—å’Œä¸»é¢˜</h4><p>è®©æˆ‘ä»¬æ›´æ·±å…¥çš„äº†è§£Kafkaä¸­çš„Topicã€‚</p><p>Topicæ˜¯å‘å¸ƒçš„æ¶ˆæ¯çš„ç±»åˆ«åï¼Œä¸€ä¸ªtopicå¯ä»¥æœ‰é›¶ä¸ªï¼Œä¸€ä¸ªæˆ–å¤šä¸ªæ¶ˆè´¹è€…è®¢é˜…è¯¥ä¸»é¢˜çš„æ¶ˆæ¯ã€‚</p><p>å¯¹äºæ¯ä¸ªtopicï¼ŒKafkaé›†ç¾¤éƒ½ä¼šç»´æŠ¤ä¸€ä¸ªåˆ†åŒºlogï¼Œå°±åƒä¸‹å›¾ä¸­æ‰€ç¤ºï¼š</p><img src="/assets/KmCudlf7DsaAVF0WAABMe0J0lv4158-7f200681.png" alt="kafka topicå‰–æ" style="zoom:120%;float:left;"><p>æ¯ä¸€ä¸ªåˆ†åŒºéƒ½æ˜¯ä¸€ä¸ªé¡ºåºçš„ã€ä¸å¯å˜çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œ å¹¶ä¸”å¯ä»¥æŒç»­çš„æ·»åŠ ã€‚åˆ†åŒºä¸­çš„æ¶ˆæ¯éƒ½è¢«åˆ†äº†ä¸€ä¸ªåºåˆ—å·ï¼Œç§°ä¹‹ä¸ºåç§»é‡(offset)ï¼Œåœ¨æ¯ä¸ªåˆ†åŒºä¸­æ­¤åç§»é‡éƒ½æ˜¯å”¯ä¸€çš„ã€‚</p><p>Kafkaé›†ç¾¤ä¿æŒæ‰€æœ‰çš„æ¶ˆæ¯ï¼Œç›´åˆ°å®ƒä»¬è¿‡æœŸï¼ˆæ— è®ºæ¶ˆæ¯æ˜¯å¦è¢«æ¶ˆè´¹ï¼‰ã€‚å®é™…ä¸Šæ¶ˆè´¹è€…æ‰€æŒæœ‰çš„ä»…æœ‰çš„å…ƒæ•°æ®å°±æ˜¯è¿™ä¸ªoffsetï¼ˆåç§»é‡ï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´offsetç”±æ¶ˆè´¹è€…æ¥æ§åˆ¶ï¼šæ­£å¸¸æƒ…å†µå½“æ¶ˆè´¹è€…æ¶ˆè´¹æ¶ˆæ¯çš„æ—¶å€™ï¼Œåç§»é‡ä¹Ÿçº¿æ€§çš„çš„å¢åŠ ã€‚ä½†æ˜¯å®é™…åç§»é‡ç”±æ¶ˆè´¹è€…æ§åˆ¶ï¼Œæ¶ˆè´¹è€…å¯ä»¥å°†åç§»é‡é‡ç½®ä¸ºæ›´æ—©çš„ä½ç½®ï¼Œé‡æ–°è¯»å–æ¶ˆæ¯ã€‚å¯ä»¥çœ‹åˆ°è¿™ç§è®¾è®¡å¯¹æ¶ˆè´¹è€…æ¥è¯´æ“ä½œè‡ªå¦‚ï¼Œä¸€ä¸ªæ¶ˆè´¹è€…çš„æ“ä½œä¸ä¼šå½±å“å…¶å®ƒæ¶ˆè´¹è€…å¯¹æ­¤logçš„å¤„ç†ã€‚</p><img src="/assets/KmCudlf7D2iALXG_AAIhinsLf_Q676-9c47057a.png" style="zoom:30%;float:left;"><p>å†è¯´è¯´åˆ†åŒºã€‚Kafkaä¸­é‡‡ç”¨åˆ†åŒºçš„è®¾è®¡æœ‰å‡ ä¸ªç›®çš„ã€‚ä¸€æ˜¯å¯ä»¥å¤„ç†æ›´å¤šçš„æ¶ˆæ¯ï¼Œä¸å—å•å°æœåŠ¡å™¨çš„é™åˆ¶ã€‚Topicæ‹¥æœ‰å¤šä¸ªåˆ†åŒºæ„å‘³ç€å®ƒå¯ä»¥ä¸å—é™çš„å¤„ç†æ›´å¤šçš„æ•°æ®ã€‚ç¬¬äºŒï¼Œåˆ†åŒºå¯ä»¥ä½œä¸ºå¹¶è¡Œå¤„ç†çš„å•å…ƒï¼Œç¨åä¼šè°ˆåˆ°è¿™ä¸€ç‚¹ã€‚</p><h4 id="åˆ†å¸ƒå¼-distribution" tabindex="-1"><a class="header-anchor" href="#åˆ†å¸ƒå¼-distribution" aria-hidden="true">#</a> åˆ†å¸ƒå¼(Distribution)</h4><p>Logçš„åˆ†åŒºè¢«åˆ†å¸ƒåˆ°é›†ç¾¤ä¸­çš„å¤šä¸ªæœåŠ¡å™¨ä¸Šã€‚æ¯ä¸ªæœåŠ¡å™¨å¤„ç†å®ƒåˆ†åˆ°çš„åˆ†åŒºã€‚ æ ¹æ®é…ç½®æ¯ä¸ªåˆ†åŒºè¿˜å¯ä»¥å¤åˆ¶åˆ°å…¶å®ƒæœåŠ¡å™¨ä½œä¸ºå¤‡ä»½å®¹é”™ã€‚ æ¯ä¸ªåˆ†åŒºæœ‰ä¸€ä¸ªleaderï¼Œé›¶æˆ–å¤šä¸ªfollowerã€‚Leaderå¤„ç†æ­¤åˆ†åŒºçš„æ‰€æœ‰çš„è¯»å†™è¯·æ±‚ï¼Œè€Œfollowerè¢«åŠ¨çš„å¤åˆ¶æ•°æ®ã€‚å¦‚æœleaderå®•æœºï¼Œå…¶å®ƒçš„ä¸€ä¸ªfollowerä¼šè¢«æ¨ä¸¾ä¸ºæ–°çš„leaderã€‚ ä¸€å°æœåŠ¡å™¨å¯èƒ½åŒæ—¶æ˜¯ä¸€ä¸ªåˆ†åŒºçš„leaderï¼Œå¦ä¸€ä¸ªåˆ†åŒºçš„followerã€‚ è¿™æ ·å¯ä»¥å¹³è¡¡è´Ÿè½½ï¼Œé¿å…æ‰€æœ‰çš„è¯·æ±‚éƒ½åªè®©ä¸€å°æˆ–è€…æŸå‡ å°æœåŠ¡å™¨å¤„ç†ã€‚</p><h4 id="geo-replication-å¼‚åœ°æ•°æ®åŒæ­¥æŠ€æœ¯" tabindex="-1"><a class="header-anchor" href="#geo-replication-å¼‚åœ°æ•°æ®åŒæ­¥æŠ€æœ¯" aria-hidden="true">#</a> Geo-Replication(å¼‚åœ°æ•°æ®åŒæ­¥æŠ€æœ¯)</h4><p>Kafka MirrorMakerä¸ºç¾¤é›†æä¾›<code>geo-replication</code>æ”¯æŒã€‚å€ŸåŠ©<code>MirrorMaker</code>ï¼Œæ¶ˆæ¯å¯ä»¥è·¨å¤šä¸ªæ•°æ®ä¸­å¿ƒæˆ–äº‘åŒºåŸŸè¿›è¡Œå¤åˆ¶ã€‚ æ‚¨å¯ä»¥åœ¨active/passiveåœºæ™¯ä¸­ç”¨äºå¤‡ä»½å’Œæ¢å¤; æˆ–è€…åœ¨active/passiveæ–¹æ¡ˆä¸­å°†æ•°æ®ç½®äºæ›´æ¥è¿‘ç”¨æˆ·çš„ä½ç½®ï¼Œæˆ–æ•°æ®æœ¬åœ°åŒ–ã€‚</p><h4 id="ç”Ÿäº§è€…-producers" tabindex="-1"><a class="header-anchor" href="#ç”Ÿäº§è€…-producers" aria-hidden="true">#</a> ç”Ÿäº§è€…(Producers)</h4><p>ç”Ÿäº§è€…å¾€æŸä¸ªTopicä¸Šå‘å¸ƒæ¶ˆæ¯ã€‚ç”Ÿäº§è€…ä¹Ÿè´Ÿè´£é€‰æ‹©å‘å¸ƒåˆ°Topicä¸Šçš„å“ªä¸€ä¸ªåˆ†åŒºã€‚æœ€ç®€å•çš„æ–¹å¼ä»åˆ†åŒºåˆ—è¡¨ä¸­è½®æµé€‰æ‹©ã€‚ä¹Ÿå¯ä»¥æ ¹æ®æŸç§ç®—æ³•ä¾ç…§æƒé‡é€‰æ‹©åˆ†åŒºã€‚å¼€å‘è€…è´Ÿè´£å¦‚ä½•é€‰æ‹©åˆ†åŒºçš„ç®—æ³•ã€‚</p><h4 id="æ¶ˆè´¹è€…-consumers" tabindex="-1"><a class="header-anchor" href="#æ¶ˆè´¹è€…-consumers" aria-hidden="true">#</a> æ¶ˆè´¹è€…(Consumers)</h4><p>é€šå¸¸æ¥è®²ï¼Œæ¶ˆæ¯æ¨¡å‹å¯ä»¥åˆ†ä¸ºä¸¤ç§ï¼Œ é˜Ÿåˆ—å’Œå‘å¸ƒ-è®¢é˜…å¼ã€‚ é˜Ÿåˆ—çš„å¤„ç†æ–¹å¼æ˜¯ ä¸€ç»„æ¶ˆè´¹è€…ä»æœåŠ¡å™¨è¯»å–æ¶ˆæ¯ï¼Œä¸€æ¡æ¶ˆæ¯åªæœ‰å…¶ä¸­çš„ä¸€ä¸ªæ¶ˆè´¹è€…æ¥å¤„ç†ã€‚åœ¨å‘å¸ƒ-è®¢é˜…æ¨¡å‹ä¸­ï¼Œæ¶ˆæ¯è¢«å¹¿æ’­ç»™æ‰€æœ‰çš„æ¶ˆè´¹è€…ï¼Œæ¥æ”¶åˆ°æ¶ˆæ¯çš„æ¶ˆè´¹è€…éƒ½å¯ä»¥å¤„ç†æ­¤æ¶ˆæ¯ã€‚Kafkaä¸ºè¿™ä¸¤ç§æ¨¡å‹æä¾›äº†å•ä¸€çš„æ¶ˆè´¹è€…æŠ½è±¡æ¨¡å‹ï¼š æ¶ˆè´¹è€…ç»„ ï¼ˆconsumer groupï¼‰ã€‚ æ¶ˆè´¹è€…ç”¨ä¸€ä¸ªæ¶ˆè´¹è€…ç»„åæ ‡è®°è‡ªå·±ã€‚ ä¸€ä¸ªå‘å¸ƒåœ¨Topicä¸Šæ¶ˆæ¯è¢«åˆ†å‘ç»™æ­¤æ¶ˆè´¹è€…ç»„ä¸­çš„ä¸€ä¸ªæ¶ˆè´¹è€…ã€‚ å‡å¦‚æ‰€æœ‰çš„æ¶ˆè´¹è€…éƒ½åœ¨ä¸€ä¸ªç»„ä¸­ï¼Œé‚£ä¹ˆè¿™å°±å˜æˆäº†queueæ¨¡å‹ã€‚ å‡å¦‚æ‰€æœ‰çš„æ¶ˆè´¹è€…éƒ½åœ¨ä¸åŒçš„ç»„ä¸­ï¼Œé‚£ä¹ˆå°±å®Œå…¨å˜æˆäº†å‘å¸ƒ-è®¢é˜…æ¨¡å‹ã€‚ æ›´é€šç”¨çš„ï¼Œ æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€äº›æ¶ˆè´¹è€…ç»„ä½œä¸ºé€»è¾‘ä¸Šçš„è®¢é˜…è€…ã€‚æ¯ä¸ªç»„åŒ…å«æ•°ç›®ä¸ç­‰çš„æ¶ˆè´¹è€…ï¼Œ ä¸€ä¸ªç»„å†…å¤šä¸ªæ¶ˆè´¹è€…å¯ä»¥ç”¨æ¥æ‰©å±•æ€§èƒ½å’Œå®¹é”™ã€‚æ­£å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/assets/KmCudlf7D-OAEjy8AABoxGLnMI4173-c8797fc8.png" alt="kafkaæ¶ˆè´¹è€…"></p><p>2ä¸ªkafkaé›†ç¾¤æ‰˜ç®¡4ä¸ªåˆ†åŒºï¼ˆP0-P3ï¼‰ï¼Œ2ä¸ªæ¶ˆè´¹è€…ç»„ï¼Œæ¶ˆè´¹ç»„Aæœ‰2ä¸ªæ¶ˆè´¹è€…å®ä¾‹ï¼Œæ¶ˆè´¹ç»„Bæœ‰4ä¸ªã€‚</p><p>æ­£åƒä¼ ç»Ÿçš„æ¶ˆæ¯ç³»ç»Ÿä¸€æ ·ï¼ŒKafkaä¿è¯æ¶ˆæ¯çš„é¡ºåºä¸å˜ã€‚ å†è¯¦ç»†æ‰¯å‡ å¥ã€‚ä¼ ç»Ÿçš„é˜Ÿåˆ—æ¨¡å‹ä¿æŒæ¶ˆæ¯ï¼Œå¹¶ä¸”ä¿è¯å®ƒä»¬çš„å…ˆåé¡ºåºä¸å˜ã€‚ä½†æ˜¯ï¼Œ å°½ç®¡æœåŠ¡å™¨ä¿è¯äº†æ¶ˆæ¯çš„é¡ºåºï¼Œæ¶ˆæ¯è¿˜æ˜¯å¼‚æ­¥çš„å‘é€ç»™å„ä¸ªæ¶ˆè´¹è€…ï¼Œæ¶ˆè´¹è€…æ”¶åˆ°æ¶ˆæ¯çš„å…ˆåé¡ºåºä¸èƒ½ä¿è¯äº†ã€‚è¿™ä¹Ÿæ„å‘³ç€å¹¶è¡Œæ¶ˆè´¹å°†ä¸èƒ½ä¿è¯æ¶ˆæ¯çš„å…ˆåé¡ºåºã€‚ç”¨è¿‡ä¼ ç»Ÿçš„æ¶ˆæ¯ç³»ç»Ÿçš„åŒå­¦è‚¯å®šæ¸…æ¥šï¼Œæ¶ˆæ¯çš„é¡ºåºå¤„ç†å¾ˆè®©äººå¤´ç—›ã€‚å¦‚æœåªè®©ä¸€ä¸ªæ¶ˆè´¹è€…å¤„ç†æ¶ˆæ¯ï¼Œåˆè¿èƒŒäº†å¹¶è¡Œå¤„ç†çš„åˆè¡·ã€‚ åœ¨è¿™ä¸€ç‚¹ä¸ŠKafkaåšçš„æ›´å¥½ï¼Œå°½ç®¡å¹¶æ²¡æœ‰å®Œå…¨è§£å†³ä¸Šè¿°é—®é¢˜ã€‚ Kafkaé‡‡ç”¨äº†ä¸€ç§åˆ†è€Œæ²»ä¹‹çš„ç­–ç•¥ï¼šåˆ†åŒºã€‚ å› ä¸ºTopicåˆ†åŒºä¸­æ¶ˆæ¯åªèƒ½ç”±æ¶ˆè´¹è€…ç»„ä¸­çš„å”¯ä¸€ä¸€ä¸ªæ¶ˆè´¹è€…å¤„ç†ï¼Œæ‰€ä»¥æ¶ˆæ¯è‚¯å®šæ˜¯æŒ‰ç…§å…ˆåé¡ºåºè¿›è¡Œå¤„ç†çš„ã€‚ä½†æ˜¯å®ƒä¹Ÿä»…ä»…æ˜¯ä¿è¯Topicçš„ä¸€ä¸ªåˆ†åŒºé¡ºåºå¤„ç†ï¼Œä¸èƒ½ä¿è¯è·¨åˆ†åŒºçš„æ¶ˆæ¯å…ˆåå¤„ç†é¡ºåºã€‚ æ‰€ä»¥ï¼Œå¦‚æœä½ æƒ³è¦é¡ºåºçš„å¤„ç†Topicçš„æ‰€æœ‰æ¶ˆæ¯ï¼Œé‚£å°±åªæä¾›ä¸€ä¸ªåˆ†åŒºã€‚</p><h4 id="kafkaçš„ä¿è¯-guarantees" tabindex="-1"><a class="header-anchor" href="#kafkaçš„ä¿è¯-guarantees" aria-hidden="true">#</a> Kafkaçš„ä¿è¯(Guarantees)</h4><ul><li>ç”Ÿäº§è€…å‘é€åˆ°ä¸€ä¸ªç‰¹å®šçš„Topicçš„åˆ†åŒºä¸Šï¼Œæ¶ˆæ¯å°†ä¼šæŒ‰ç…§å®ƒä»¬å‘é€çš„é¡ºåºä¾æ¬¡åŠ å…¥ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä¸€ä¸ªæ¶ˆæ¯M1å’ŒM2ä½¿ç”¨ç›¸åŒçš„producerå‘é€ï¼ŒM1å…ˆå‘é€ï¼Œé‚£ä¹ˆM1å°†æ¯”M2çš„offsetä½ï¼Œå¹¶ä¸”ä¼˜å…ˆçš„å‡ºç°åœ¨æ—¥å¿—ä¸­ã€‚</li><li>æ¶ˆè´¹è€…æ”¶åˆ°çš„æ¶ˆæ¯ä¹Ÿæ˜¯æ­¤é¡ºåºã€‚</li><li>å¦‚æœä¸€ä¸ªTopicé…ç½®äº†å¤åˆ¶å› å­ï¼ˆreplication factorï¼‰ä¸ºNï¼Œ é‚£ä¹ˆå¯ä»¥å…è®¸N-1æœåŠ¡å™¨å®•æœºè€Œä¸ä¸¢å¤±ä»»ä½•å·²ç»æäº¤ï¼ˆcommittedï¼‰çš„æ¶ˆæ¯ã€‚</li></ul><h4 id="kafkaä½œä¸ºä¸€ä¸ªæ¶ˆæ¯ç³»ç»Ÿ" tabindex="-1"><a class="header-anchor" href="#kafkaä½œä¸ºä¸€ä¸ªæ¶ˆæ¯ç³»ç»Ÿ" aria-hidden="true">#</a> kafkaä½œä¸ºä¸€ä¸ªæ¶ˆæ¯ç³»ç»Ÿ</h4><h5 id="kafkaçš„æµä¸ä¼ ç»Ÿä¼ä¸šæ¶ˆæ¯ç³»ç»Ÿç›¸æ¯”çš„æ¦‚å¿µå¦‚ä½•" tabindex="-1"><a class="header-anchor" href="#kafkaçš„æµä¸ä¼ ç»Ÿä¼ä¸šæ¶ˆæ¯ç³»ç»Ÿç›¸æ¯”çš„æ¦‚å¿µå¦‚ä½•" aria-hidden="true">#</a> Kafkaçš„æµä¸ä¼ ç»Ÿä¼ä¸šæ¶ˆæ¯ç³»ç»Ÿç›¸æ¯”çš„æ¦‚å¿µå¦‚ä½•ï¼Ÿ</h5><p>ä¼ ç»Ÿçš„æ¶ˆæ¯æœ‰ä¸¤ç§æ¨¡å¼ï¼š<code>é˜Ÿåˆ—</code>å’Œ<code>å‘å¸ƒè®¢é˜…</code>ã€‚ åœ¨é˜Ÿåˆ—æ¨¡å¼ä¸­ï¼Œæ¶ˆè´¹è€…æ± ä»æœåŠ¡å™¨è¯»å–æ¶ˆæ¯ï¼ˆæ¯ä¸ªæ¶ˆæ¯åªè¢«å…¶ä¸­ä¸€ä¸ªè¯»å–ï¼‰; å‘å¸ƒè®¢é˜…æ¨¡å¼ï¼šæ¶ˆæ¯å¹¿æ’­ç»™æ‰€æœ‰çš„æ¶ˆè´¹è€…ã€‚è¿™ä¸¤ç§æ¨¡å¼éƒ½æœ‰ä¼˜ç¼ºç‚¹ï¼Œé˜Ÿåˆ—çš„ä¼˜ç‚¹æ˜¯å…è®¸å¤šä¸ªæ¶ˆè´¹è€…ç“œåˆ†å¤„ç†æ•°æ®ï¼Œè¿™æ ·å¯ä»¥æ‰©å±•å¤„ç†ã€‚ä½†æ˜¯ï¼Œé˜Ÿåˆ—ä¸åƒå¤šä¸ªè®¢é˜…è€…ï¼Œä¸€æ—¦æ¶ˆæ¯è€…è¿›ç¨‹è¯»å–åæ•…éšœäº†ï¼Œé‚£ä¹ˆæ¶ˆæ¯å°±ä¸¢äº†ã€‚è€Œ<code>å‘å¸ƒå’Œè®¢é˜…</code>å…è®¸ä½ å¹¿æ’­æ•°æ®åˆ°å¤šä¸ªæ¶ˆè´¹è€…ï¼Œç”±äºæ¯ä¸ªè®¢é˜…è€…éƒ½è®¢é˜…äº†æ¶ˆæ¯ï¼Œæ‰€ä»¥æ²¡åŠæ³•ç¼©æ”¾å¤„ç†ã€‚</p><p>kafkaä¸­æ¶ˆè´¹è€…ç»„æœ‰ä¸¤ä¸ªæ¦‚å¿µï¼š<code>é˜Ÿåˆ—</code>ï¼šæ¶ˆè´¹è€…ç»„ï¼ˆconsumer groupï¼‰å…è®¸åŒåçš„æ¶ˆè´¹è€…ç»„æˆå‘˜ç“œåˆ†å¤„ç†ã€‚<code>å‘å¸ƒè®¢é˜…</code>ï¼šå…è®¸ä½ å¹¿æ’­æ¶ˆæ¯ç»™å¤šä¸ªæ¶ˆè´¹è€…ç»„ï¼ˆä¸åŒåï¼‰ã€‚</p><p>kafkaçš„æ¯ä¸ªtopicéƒ½å…·æœ‰è¿™ä¸¤ç§æ¨¡å¼ã€‚</p><h5 id="kafkaæœ‰æ¯”ä¼ ç»Ÿçš„æ¶ˆæ¯ç³»ç»Ÿæ›´å¼ºçš„é¡ºåºä¿è¯ã€‚" tabindex="-1"><a class="header-anchor" href="#kafkaæœ‰æ¯”ä¼ ç»Ÿçš„æ¶ˆæ¯ç³»ç»Ÿæ›´å¼ºçš„é¡ºåºä¿è¯ã€‚" aria-hidden="true">#</a> kafkaæœ‰æ¯”ä¼ ç»Ÿçš„æ¶ˆæ¯ç³»ç»Ÿæ›´å¼ºçš„é¡ºåºä¿è¯ã€‚</h5><p>ä¼ ç»Ÿçš„æ¶ˆæ¯ç³»ç»ŸæŒ‰é¡ºåºä¿å­˜æ•°æ®ï¼Œå¦‚æœå¤šä¸ªæ¶ˆè´¹è€…ä»é˜Ÿåˆ—æ¶ˆè´¹ï¼Œåˆ™æœåŠ¡å™¨æŒ‰å­˜å‚¨çš„é¡ºåºå‘é€æ¶ˆæ¯ï¼Œä½†æ˜¯ï¼Œå°½ç®¡æœåŠ¡å™¨æŒ‰é¡ºåºå‘é€ï¼Œæ¶ˆæ¯å¼‚æ­¥ä¼ é€’åˆ°æ¶ˆè´¹è€…ï¼Œå› æ­¤æ¶ˆæ¯å¯èƒ½ä¹±åºåˆ°è¾¾æ¶ˆè´¹è€…ã€‚è¿™æ„å‘³ç€æ¶ˆæ¯å­˜åœ¨å¹¶è¡Œæ¶ˆè´¹çš„æƒ…å†µï¼Œé¡ºåºå°±æ— æ³•ä¿è¯ã€‚æ¶ˆæ¯ç³»ç»Ÿå¸¸å¸¸é€šè¿‡ä»…è®¾1ä¸ªæ¶ˆè´¹è€…æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½†æ˜¯è¿™æ„å‘³ç€æ²¡ç”¨åˆ°å¹¶è¡Œå¤„ç†ã€‚</p><p>kafkaåšçš„æ›´å¥½ã€‚é€šè¿‡å¹¶è¡Œtopicçš„parition â€”â€” kafkaæä¾›äº†é¡ºåºä¿è¯å’Œè´Ÿè½½å‡è¡¡ã€‚æ¯ä¸ªpartitionä»…ç”±åŒä¸€ä¸ªæ¶ˆè´¹è€…ç»„ä¸­çš„ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹åˆ°ã€‚å¹¶ç¡®ä¿æ¶ˆè´¹è€…æ˜¯è¯¥partitionçš„å”¯ä¸€æ¶ˆè´¹è€…ï¼Œå¹¶æŒ‰é¡ºåºæ¶ˆè´¹æ•°æ®ã€‚æ¯ä¸ªtopicæœ‰å¤šä¸ªåˆ†åŒºï¼Œåˆ™éœ€è¦å¯¹å¤šä¸ªæ¶ˆè´¹è€…åšè´Ÿè½½å‡è¡¡ï¼Œä½†è¯·æ³¨æ„ï¼Œ<code>ç›¸åŒçš„æ¶ˆè´¹è€…ç»„ä¸­ä¸èƒ½æœ‰æ¯”åˆ†åŒºæ›´å¤šçš„æ¶ˆè´¹è€…ï¼Œå¦åˆ™å¤šå‡ºçš„æ¶ˆè´¹è€…ä¸€ç›´å¤„äºç©ºç­‰å¾…ï¼Œä¸ä¼šæ”¶åˆ°æ¶ˆæ¯</code>ã€‚</p><h4 id="kafkaä½œä¸ºä¸€ä¸ªå­˜å‚¨ç³»ç»Ÿ" tabindex="-1"><a class="header-anchor" href="#kafkaä½œä¸ºä¸€ä¸ªå­˜å‚¨ç³»ç»Ÿ" aria-hidden="true">#</a> kafkaä½œä¸ºä¸€ä¸ªå­˜å‚¨ç³»ç»Ÿ</h4><p>æ‰€æœ‰å‘å¸ƒæ¶ˆæ¯åˆ°<code>æ¶ˆæ¯é˜Ÿåˆ—</code>å’Œæ¶ˆè´¹åˆ†ç¦»çš„ç³»ç»Ÿï¼Œå®é™…ä¸Šéƒ½å……å½“äº†ä¸€ä¸ªå­˜å‚¨ç³»ç»Ÿï¼ˆå‘å¸ƒçš„æ¶ˆæ¯å…ˆå­˜å‚¨èµ·æ¥ï¼‰ã€‚Kafkaæ¯”åˆ«çš„ç³»ç»Ÿçš„ä¼˜åŠ¿æ˜¯å®ƒæ˜¯ä¸€ä¸ªéå¸¸é«˜æ€§èƒ½çš„<code>å­˜å‚¨ç³»ç»Ÿ</code>ã€‚</p><p>å†™å…¥åˆ°kafkaçš„æ•°æ®å°†å†™åˆ°ç£ç›˜å¹¶å¤åˆ¶åˆ°é›†ç¾¤ä¸­ä¿è¯å®¹é”™æ€§ã€‚å¹¶å…è®¸ç”Ÿäº§è€…ç­‰å¾…æ¶ˆæ¯åº”ç­”ï¼Œç›´åˆ°æ¶ˆæ¯å®Œå…¨å†™å…¥ã€‚</p><p>kafkaçš„ç£ç›˜ç»“æ„ - æ— è®ºä½ æœåŠ¡å™¨ä¸Šæœ‰50KBæˆ–50TBï¼Œæ‰§è¡Œæ˜¯ç›¸åŒçš„ã€‚</p><p>clientæ¥æ§åˆ¶è¯»å–æ•°æ®çš„ä½ç½®ã€‚ä½ è¿˜å¯ä»¥è®¤ä¸ºkafkaæ˜¯ä¸€ç§ä¸“ç”¨äºé«˜æ€§èƒ½ï¼Œä½å»¶è¿Ÿï¼Œæäº¤æ—¥å¿—å­˜å‚¨ï¼Œå¤åˆ¶ï¼Œå’Œä¼ æ’­ç‰¹æ®Šç”¨é€”çš„<code>åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ</code>ã€‚</p><h4 id="kafkaçš„æµå¤„ç†" tabindex="-1"><a class="header-anchor" href="#kafkaçš„æµå¤„ç†" aria-hidden="true">#</a> kafkaçš„æµå¤„ç†</h4><p>ä»…ä»…è¯»ï¼Œå†™å’Œå­˜å‚¨æ˜¯ä¸å¤Ÿçš„ï¼Œkafkaçš„ç›®æ ‡æ˜¯å®æ—¶çš„æµå¤„ç†ã€‚</p><p>åœ¨kafkaä¸­ï¼Œæµå¤„ç†æŒç»­è·å–<code>è¾“å…¥topic</code>çš„æ•°æ®ï¼Œè¿›è¡Œå¤„ç†åŠ å·¥ï¼Œç„¶åå†™å…¥<code>è¾“å‡ºtopic</code>ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªé›¶å”®APPï¼Œæ¥æ”¶é”€å”®å’Œå‡ºè´§çš„<code>è¾“å…¥æµ</code>ï¼Œç»Ÿè®¡æ•°é‡æˆ–è°ƒæ•´ä»·æ ¼åè¾“å‡ºã€‚</p><p>å¯ä»¥ç›´æ¥ä½¿ç”¨producerå’Œconsumer APIè¿›è¡Œç®€å•çš„å¤„ç†ã€‚å¯¹äºå¤æ‚çš„è½¬æ¢ï¼ŒKafkaæä¾›äº†æ›´å¼ºå¤§çš„Streams APIã€‚å¯æ„å»º<code>èšåˆè®¡ç®—</code>æˆ–<code>è¿æ¥æµåˆ°ä¸€èµ·</code>çš„å¤æ‚åº”ç”¨ç¨‹åºã€‚</p><p>åŠ©äºè§£å†³æ­¤ç±»åº”ç”¨é¢ä¸´çš„ç¡¬æ€§é—®é¢˜ï¼šå¤„ç†æ— åºçš„æ•°æ®ï¼Œä»£ç æ›´æ”¹çš„å†å¤„ç†ï¼Œæ‰§è¡ŒçŠ¶æ€è®¡ç®—ç­‰ã€‚</p><p>Streams APIåœ¨Kafkaä¸­çš„æ ¸å¿ƒï¼šä½¿ç”¨producerå’Œconsumer APIä½œä¸ºè¾“å…¥ï¼Œåˆ©ç”¨KafkaåšçŠ¶æ€å­˜å‚¨ï¼Œä½¿ç”¨ç›¸åŒçš„ç»„æœºåˆ¶åœ¨streamå¤„ç†å™¨å®ä¾‹ä¹‹é—´è¿›è¡Œå®¹é”™ä¿éšœã€‚</p><h4 id="æ‹¼åœ¨ä¸€èµ·" tabindex="-1"><a class="header-anchor" href="#æ‹¼åœ¨ä¸€èµ·" aria-hidden="true">#</a> æ‹¼åœ¨ä¸€èµ·</h4><p>æ¶ˆæ¯ä¼ é€’ï¼Œå­˜å‚¨å’Œæµå¤„ç†çš„ç»„åˆçœ‹ä¼¼åå¸¸ï¼Œä½†å¯¹äºKafkaä½œä¸ºæµå¼å¤„ç†å¹³å°çš„ä½œç”¨è‡³å…³é‡è¦ã€‚</p><p>åƒHDFSè¿™æ ·çš„åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿå…è®¸å­˜å‚¨é™æ€æ–‡ä»¶æ¥è¿›è¡Œæ‰¹å¤„ç†ã€‚è¿™æ ·ç³»ç»Ÿå¯ä»¥æœ‰æ•ˆåœ°å­˜å‚¨å’Œå¤„ç†æ¥è‡ªè¿‡å»çš„å†å²æ•°æ®ã€‚</p><p>ä¼ ç»Ÿä¼ä¸šçš„æ¶ˆæ¯ç³»ç»Ÿå…è®¸åœ¨ä½ è®¢é˜…ä¹‹åå¤„ç†æœªæ¥çš„æ¶ˆæ¯ï¼šåœ¨æœªæ¥æ•°æ®åˆ°è¾¾æ—¶å¤„ç†å®ƒã€‚</p><p>Kafkaç»“åˆäº†è¿™ä¸¤ç§èƒ½åŠ›ï¼Œè¿™ç§ç»„åˆå¯¹äºkafkaä½œä¸ºæµå¤„ç†åº”ç”¨å’Œæµæ•°æ®ç®¡é“å¹³å°æ˜¯è‡³å…³é‡è¦çš„ã€‚</p><p>æ‰¹å¤„ç†ä»¥åŠæ¶ˆæ¯é©±åŠ¨åº”ç”¨ç¨‹åºçš„æµå¤„ç†çš„æ¦‚å¿µï¼šé€šè¿‡ç»„åˆå­˜å‚¨å’Œä½å»¶è¿Ÿè®¢é˜…ï¼Œæµå¤„ç†åº”ç”¨å¯ä»¥ç”¨ç›¸åŒçš„æ–¹å¼å¯¹å¾…è¿‡å»å’Œæœªæ¥çš„æ•°æ®ã€‚å®ƒæ˜¯ä¸€ä¸ªå•ä¸€çš„åº”ç”¨ç¨‹åºï¼Œå®ƒå¯ä»¥å¤„ç†å†å²çš„å­˜å‚¨æ•°æ®ï¼Œå½“å®ƒå¤„ç†åˆ°æœ€åä¸€ä¸ªæ¶ˆæ¯æ—¶ï¼Œå®ƒè¿›å…¥ç­‰å¾…æœªæ¥çš„æ•°æ®åˆ°è¾¾ï¼Œè€Œä¸æ˜¯ç»“æŸã€‚</p><p>åŒæ ·ï¼Œå¯¹äºæµæ•°æ®ç®¡é“ï¼ˆpipelineï¼‰ï¼Œè®¢é˜…å®æ—¶äº‹ä»¶çš„ç»„åˆä½¿å¾—å¯ä»¥å°†Kafkaç”¨äºéå¸¸ä½å»¶è¿Ÿçš„ç®¡é“ï¼›ä½†æ˜¯ï¼Œå¯é åœ°å­˜å‚¨æ•°æ®çš„èƒ½åŠ›ä½¿å¾—å®ƒå¯ä»¥å°†å…¶ç”¨äºå¿…é¡»ä¿è¯ä¼ é€’çš„å…³é”®æ•°æ®ï¼Œæˆ–ä¸ä»…å®šæœŸåŠ è½½æ•°æ®æˆ–é•¿æ—¶é—´ç»´æŠ¤çš„ç¦»çº¿ç³»ç»Ÿé›†æˆåœ¨ä¸€èµ·ã€‚æµå¤„ç†å¯ä»¥åœ¨æ•°æ®åˆ°è¾¾æ—¶è½¬æ¢å®ƒã€‚</p><h3 id="kafkaçš„æ¶ˆæ¯æ¨¡å‹" tabindex="-1"><a class="header-anchor" href="#kafkaçš„æ¶ˆæ¯æ¨¡å‹" aria-hidden="true">#</a> Kafkaçš„æ¶ˆæ¯æ¨¡å‹</h3><h4 id="jmsåè®®-activemq" tabindex="-1"><a class="header-anchor" href="#jmsåè®®-activemq" aria-hidden="true">#</a> JMSåè®®(ActiveMQ)</h4><p>Javaæ¶ˆæ¯æœåŠ¡ï¼ˆJava Message Serviceï¼ŒJMSï¼‰åº”ç”¨ç¨‹åºæ¥å£æ˜¯ä¸€ä¸ªJavaå¹³å°ä¸­å…³äºé¢å‘æ¶ˆæ¯ä¸­é—´ä»¶çš„APIï¼Œç”¨äºåœ¨ä¸¤ä¸ªåº”ç”¨ç¨‹åºä¹‹é—´ï¼Œæˆ–åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å‘é€æ¶ˆæ¯ï¼Œè¿›è¡Œå¼‚æ­¥é€šä¿¡ã€‚</p><p>ç‚¹å¯¹ç‚¹ä¸å‘å¸ƒè®¢é˜…æœ€åˆæ˜¯ç”±JMSå®šä¹‰çš„ã€‚è¿™ä¸¤ç§æ¨¡å¼ä¸»è¦åŒºåˆ«æˆ–è§£å†³çš„é—®é¢˜å°±æ˜¯å‘é€åˆ°é˜Ÿåˆ—çš„æ¶ˆæ¯èƒ½å¦é‡å¤æ¶ˆè´¹(å¤šè®¢é˜…)ã€‚</p><p>JMSè§„èŒƒç›®å‰æ”¯æŒä¸¤ç§æ¶ˆæ¯æ¨¡å‹ï¼šç‚¹å¯¹ç‚¹ï¼ˆpoint to pointï¼Œ queueï¼‰å’Œå‘å¸ƒ/è®¢é˜…ï¼ˆpublish/subscribeï¼Œtopicï¼‰ã€‚</p><h5 id="ç‚¹å¯¹ç‚¹" tabindex="-1"><a class="header-anchor" href="#ç‚¹å¯¹ç‚¹" aria-hidden="true">#</a> ç‚¹å¯¹ç‚¹</h5><p>æ¶ˆæ¯ç”Ÿäº§è€…ç”Ÿäº§æ¶ˆæ¯å‘é€åˆ°queueä¸­ï¼Œç„¶åæ¶ˆæ¯æ¶ˆè´¹è€…ä»queueä¸­å–å‡ºå¹¶ä¸”æ¶ˆè´¹æ¶ˆæ¯ã€‚è¿™é‡Œè¦æ³¨æ„ï¼š</p><ol><li>æ¶ˆæ¯è¢«æ¶ˆè´¹ä»¥åï¼Œqueueä¸­ä¸å†æœ‰å­˜å‚¨ï¼Œæ‰€ä»¥æ¶ˆæ¯æ¶ˆè´¹è€…ä¸å¯èƒ½æ¶ˆè´¹åˆ°å·²ç»è¢«æ¶ˆè´¹çš„æ¶ˆæ¯ã€‚</li><li>Queueæ”¯æŒå­˜åœ¨å¤šä¸ªæ¶ˆè´¹è€…ï¼Œä½†æ˜¯å¯¹ä¸€ä¸ªæ¶ˆæ¯è€Œè¨€ï¼Œåªä¼šæœ‰ä¸€ä¸ªæ¶ˆè´¹è€…å¯ä»¥æ¶ˆè´¹ã€‚</li></ol><img src="/assets/719892-20180627210305037-352317925-deee653a.jpg" alt="img" style="zoom:67%;float:left;"><p>ç”Ÿäº§è€…å‘é€ä¸€æ¡æ¶ˆæ¯åˆ°queueï¼Œåªæœ‰ä¸€ä¸ªæ¶ˆè´¹è€…èƒ½æ”¶åˆ°ã€‚</p><h5 id="å‘å¸ƒè®¢é˜…" tabindex="-1"><a class="header-anchor" href="#å‘å¸ƒè®¢é˜…" aria-hidden="true">#</a> å‘å¸ƒè®¢é˜…</h5><p>æ¶ˆæ¯ç”Ÿäº§è€…ï¼ˆå‘å¸ƒï¼‰å°†æ¶ˆæ¯å‘å¸ƒåˆ°topicä¸­ï¼ŒåŒæ—¶æœ‰å¤šä¸ªæ¶ˆæ¯æ¶ˆè´¹è€…ï¼ˆè®¢é˜…ï¼‰æ¶ˆè´¹è¯¥æ¶ˆæ¯ã€‚å’Œç‚¹å¯¹ç‚¹æ–¹å¼ä¸åŒï¼Œå‘å¸ƒåˆ°topicçš„æ¶ˆæ¯ä¼šè¢«æ‰€æœ‰è®¢é˜…è€…æ¶ˆè´¹ã€‚ <img src="/assets/719892-20180627210321925-911797389-191590ea.jpg" alt="img" style="zoom:67%;"></p><p>å‘å¸ƒè€…å‘é€åˆ°topicçš„æ¶ˆæ¯ï¼Œè®¢é˜…äº†topicçš„æ‰€æœ‰è®¢é˜…è€…éƒ½ä¼šæ”¶åˆ°æ¶ˆæ¯ã€‚</p><h4 id="aqmpåè®®-rabbitmq" tabindex="-1"><a class="header-anchor" href="#aqmpåè®®-rabbitmq" aria-hidden="true">#</a> AQMPåè®®(RabbitMQ)</h4><p>RabbitMQå®ç°äº†AQMPåè®®ï¼ŒAQMPåè®®å®šä¹‰äº†æ¶ˆæ¯è·¯ç”±è§„åˆ™å’Œæ–¹å¼ã€‚ç”Ÿäº§ç«¯é€šè¿‡è·¯ç”±è§„åˆ™å‘é€æ¶ˆæ¯åˆ°ä¸åŒqueueï¼Œæ¶ˆè´¹ç«¯æ ¹æ®queueåç§°æ¶ˆè´¹æ¶ˆæ¯ã€‚æ­¤å¤–RabbitMQæ˜¯å‘æ¶ˆè´¹ç«¯æ¨é€æ¶ˆæ¯ï¼Œè®¢é˜…å…³ç³»å’Œæ¶ˆè´¹çŠ¶æ€ä¿å­˜åœ¨æœåŠ¡ç«¯ã€‚</p><h5 id="ç‚¹å¯¹ç‚¹-1" tabindex="-1"><a class="header-anchor" href="#ç‚¹å¯¹ç‚¹-1" aria-hidden="true">#</a> ç‚¹å¯¹ç‚¹</h5><img src="/assets/719892-20180627210407642-452811297-fae79a87.jpg" alt="img" style="zoom:67%;float:left;"><p>ç”Ÿäº§ç«¯å‘é€ä¸€æ¡æ¶ˆæ¯é€šè¿‡è·¯ç”±æŠ•é€’åˆ°Queueï¼Œåªæœ‰ä¸€ä¸ªæ¶ˆè´¹è€…èƒ½æ¶ˆè´¹åˆ°ã€‚</p><h5 id="å‘å¸ƒ-è®¢é˜…" tabindex="-1"><a class="header-anchor" href="#å‘å¸ƒ-è®¢é˜…" aria-hidden="true">#</a> å‘å¸ƒ/è®¢é˜…</h5><img src="/assets/719892-20180627210437706-1948451321-754008d1.jpg" alt="img" style="zoom:67%;float:left;"><p>å½“RabbitMQéœ€è¦æ”¯æŒå¤šè®¢é˜…æ—¶ï¼Œå‘å¸ƒè€…å‘é€çš„æ¶ˆæ¯é€šè¿‡è·¯ç”±åŒæ—¶å†™åˆ°å¤šä¸ªQueueï¼Œä¸åŒè®¢é˜…ç»„æ¶ˆè´¹æ­¤æ¶ˆæ¯ã€‚</p><p>RabbitMQæ—¢æ”¯æŒå†…å­˜é˜Ÿåˆ—ä¹Ÿæ”¯æŒæŒä¹…åŒ–é˜Ÿåˆ—ï¼Œæ¶ˆè´¹ç«¯ä¸ºæ¨æ¨¡å‹ï¼Œæ¶ˆè´¹çŠ¶æ€å’Œè®¢é˜…å…³ç³»ç”±æœåŠ¡ç«¯è´Ÿè´£ç»´æŠ¤ï¼Œæ¶ˆæ¯æ¶ˆè´¹å®Œåç«‹å³åˆ é™¤ï¼Œä¸ä¿ç•™å†å²æ¶ˆæ¯ã€‚æ‰€ä»¥æ”¯æŒå¤šè®¢é˜…æ—¶ï¼Œæ¶ˆæ¯ä¼šå¤šä¸ªæ‹·è´ã€‚</p><h4 id="kafkaå®ç°" tabindex="-1"><a class="header-anchor" href="#kafkaå®ç°" aria-hidden="true">#</a> kafkaå®ç°</h4><p>kafkaæ²¡æœ‰å®ç°JMSåè®®ï¼Œä½†å…¶æ¶ˆè´¹ç»„å¯ä»¥åƒç‚¹å¯¹ç‚¹æ¨¡å‹ä¸€æ ·è®©æ¶ˆæ¯è¢«ä¸€ç»„è¿›ç¨‹å¤„ç†ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥åƒå‘å¸ƒ/è®¢é˜…æ¨¡å¼ä¸€æ ·ï¼Œè®©ä½ å‘é€å¹¿æ’­æ¶ˆæ¯åˆ°å¤šä¸ªæ¶ˆè´¹ç»„ã€‚</p><h5 id="ç‚¹å¯¹ç‚¹-2" tabindex="-1"><a class="header-anchor" href="#ç‚¹å¯¹ç‚¹-2" aria-hidden="true">#</a> ç‚¹å¯¹ç‚¹</h5><p>å½“å¤šä¸ªæ¶ˆè´¹è€…åŒå±ä¸€ä¸ªæ¶ˆè´¹ç»„æ—¶ï¼Œå¯¹åº”æ¶ˆæ¯ä¼šè¢«åŒæ¶ˆè´¹ç»„çš„å½“ä¸ªæ¶ˆè´¹ç»„æ¶ˆè´¹ä½¿ç”¨ï¼Œç±»ä¼¼ç‚¹å¯¹ç‚¹çš„æ¶ˆæ¯æ¨¡å‹ã€‚ <img src="/assets/719892-20180627210505445-1484128075-520dc1fd.png" alt="img" style="zoom:67%;"></p><p>å³æ¶ˆæ¯Message1åªä¼šè¢«æ¶ˆè´¹ç»„GroupAä¸­çš„Consumer_1ã€Consumer_2ã€Consumer_3æ¶ˆè´¹</p><h5 id="å‘å¸ƒ-è®¢é˜…-1" tabindex="-1"><a class="header-anchor" href="#å‘å¸ƒ-è®¢é˜…-1" aria-hidden="true">#</a> å‘å¸ƒ/è®¢é˜…</h5><p>å½“æ¯ä¸ªæ¶ˆè´¹è€…éƒ½å±äºä¸åŒçš„æ¶ˆè´¹ç»„æ—¶ï¼Œå¯¹åº”çš„æ¶ˆæ¯ä¼šè¢«æ¯ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ä½¿ç”¨ï¼Œç±»ä¼¼è®¢é˜…/å‘å¸ƒçš„æ¶ˆæ¯æ¨¡å‹ã€‚ <img src="/assets/719892-20180627210534275-525977621-0e1fd05b.jpg" alt="img" style="zoom:67%;"></p><h3 id="kafkaå‰¯æœ¬åŒæ­¥æœºåˆ¶" tabindex="-1"><a class="header-anchor" href="#kafkaå‰¯æœ¬åŒæ­¥æœºåˆ¶" aria-hidden="true">#</a> Kafkaå‰¯æœ¬åŒæ­¥æœºåˆ¶</h3><p>Kafkaä¸­ä¸»é¢˜çš„æ¯ä¸ªPartitionæœ‰ä¸€ä¸ªé¢„å†™å¼æ—¥å¿—æ–‡ä»¶ï¼Œæ¯ä¸ªPartitionéƒ½ç”±ä¸€ç³»åˆ—æœ‰åºçš„ã€ä¸å¯å˜çš„æ¶ˆæ¯ç»„æˆï¼Œè¿™äº›æ¶ˆæ¯è¢«è¿ç»­çš„è¿½åŠ åˆ°Partitionä¸­ï¼ŒPartitionä¸­çš„æ¯ä¸ªæ¶ˆæ¯éƒ½æœ‰ä¸€ä¸ªè¿ç»­çš„åºåˆ—å·å«åšoffsetï¼Œ ç¡®å®šå®ƒåœ¨åˆ†åŒºæ—¥å¿—ä¸­å”¯ä¸€çš„ä½ç½®ã€‚</p><p>ä¸¤ä¸ªåè¯ ï¼š HWï¼ˆHigh Watermarkï¼‰ é«˜æ°´ä½ ï¼Œ LEOï¼ˆlog end offsetï¼‰æ—¥å¿—æœ«ç«¯ä½ç§»</p><p><img src="/assets/719892-20180627210921488-1305318844-37a1c271.png" alt="img"></p><p>Kafkaæ¯ä¸ªtopicçš„partitionæœ‰Nä¸ªå‰¯æœ¬ï¼Œå…¶ä¸­Næ˜¯topicçš„å¤åˆ¶å› å­ã€‚Kafkaé€šè¿‡å¤šå‰¯æœ¬æœºåˆ¶å®ç°æ•…éšœè‡ªåŠ¨è½¬ç§»ï¼Œå½“Kafkaé›†ç¾¤ä¸­ä¸€ä¸ªBrokerå¤±æ•ˆæƒ…å†µä¸‹ä»ç„¶ä¿è¯æœåŠ¡å¯ç”¨ã€‚åœ¨Kafkaä¸­å‘ç”Ÿå¤åˆ¶æ—¶ç¡®ä¿partitionçš„é¢„å†™å¼æ—¥å¿—æœ‰åºåœ°å†™åˆ°å…¶ä»–èŠ‚ç‚¹ä¸Šã€‚Nä¸ªreplicasä¸­ã€‚å…¶ä¸­ä¸€ä¸ªreplicaä¸ºleaderï¼Œå…¶ä»–éƒ½ä¸ºfollowerï¼Œleaderå¤„ç†partitionçš„æ‰€æœ‰è¯»å†™è¯·æ±‚ï¼Œä¸æ­¤åŒæ—¶ï¼Œfollowerä¼šè¢«åŠ¨å®šæœŸåœ°å»å¤åˆ¶leaderä¸Šçš„æ•°æ®ã€‚</p><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒKafkaé›†ç¾¤ä¸­æœ‰4ä¸ªbroker, æŸtopicæœ‰3ä¸ªpartition,ä¸”å¤åˆ¶å› å­å³å‰¯æœ¬ä¸ªæ•°ä¹Ÿä¸º3ï¼š <img src="/assets/719892-20180627211054202-1578518664-5da50234.jpg" alt="img" style="zoom:67%;"></p><p>Kafkaæä¾›äº†æ•°æ®å¤åˆ¶ç®—æ³•ä¿è¯ï¼Œå¦‚æœleaderå‘ç”Ÿæ•…éšœæˆ–æŒ‚æ‰ï¼Œä¸€ä¸ªæ–°leaderè¢«é€‰ä¸¾å¹¶è¢«æ¥å—å®¢æˆ·ç«¯çš„æ¶ˆæ¯æˆåŠŸå†™å…¥ã€‚Kafkaç¡®ä¿ä»åŒæ­¥å‰¯æœ¬åˆ—è¡¨ä¸­é€‰ä¸¾ä¸€ä¸ªå‰¯æœ¬ä¸ºleaderï¼Œæˆ–è€…è¯´followerè¿½èµ¶leaderæ•°æ®ã€‚leaderè´Ÿè´£ç»´æŠ¤å’Œè·Ÿè¸ªISR(In-Sync Replicasçš„ç¼©å†™ï¼Œè¡¨ç¤ºå‰¯æœ¬åŒæ­¥é˜Ÿåˆ—ï¼Œå…·ä½“å¯å‚è€ƒä¸‹èŠ‚)ä¸­æ‰€æœ‰followeræ»åçš„çŠ¶æ€ã€‚å½“producerå‘é€ä¸€æ¡æ¶ˆæ¯åˆ°brokeråï¼Œleaderå†™å…¥æ¶ˆæ¯å¹¶å¤åˆ¶åˆ°æ‰€æœ‰followerã€‚æ¶ˆæ¯æäº¤ä¹‹åæ‰è¢«æˆåŠŸå¤åˆ¶åˆ°æ‰€æœ‰çš„åŒæ­¥å‰¯æœ¬ã€‚æ¶ˆæ¯å¤åˆ¶å»¶è¿Ÿå—æœ€æ…¢çš„followeré™åˆ¶ï¼Œé‡è¦çš„æ˜¯å¿«é€Ÿæ£€æµ‹æ…¢å‰¯æœ¬ï¼Œå¦‚æœfollowerâ€œè½åâ€å¤ªå¤šæˆ–è€…å¤±æ•ˆï¼Œleaderå°†ä¼šæŠŠå®ƒä»ISRä¸­åˆ é™¤ã€‚</p><h4 id="å‰¯æœ¬åŒæ­¥é˜Ÿåˆ—-isr" tabindex="-1"><a class="header-anchor" href="#å‰¯æœ¬åŒæ­¥é˜Ÿåˆ—-isr" aria-hidden="true">#</a> å‰¯æœ¬åŒæ­¥é˜Ÿåˆ—(ISR)</h4><p>æ‰€è°“åŒæ­¥ï¼Œå¿…é¡»æ»¡è¶³å¦‚ä¸‹ä¸¤ä¸ªæ¡ä»¶ï¼š</p><ul><li>å‰¯æœ¬èŠ‚ç‚¹å¿…é¡»èƒ½ä¸zookeeperä¿æŒä¼šè¯ï¼ˆå¿ƒè·³æœºåˆ¶ï¼‰</li><li>å‰¯æœ¬èƒ½å¤åˆ¶leaderä¸Šçš„æ‰€æœ‰å†™æ“ä½œï¼Œå¹¶ä¸”ä¸èƒ½è½åå¤ªå¤šã€‚(å¡ä½æˆ–æ»åçš„å‰¯æœ¬æ§åˆ¶æ˜¯ç”± replica.lag.time.max.ms é…ç½®)</li></ul><p>é»˜è®¤æƒ…å†µä¸‹Kafkaå¯¹åº”çš„topicçš„replicaæ•°é‡ä¸º1ï¼Œå³æ¯ä¸ªpartitionéƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„leaderï¼Œä¸ºäº†ç¡®ä¿æ¶ˆæ¯çš„å¯é æ€§ï¼Œé€šå¸¸åº”ç”¨ä¸­å°†å…¶å€¼(ç”±brokerçš„å‚æ•°offsets.topic.replication.factoræŒ‡å®š)å¤§å°è®¾ç½®ä¸ºå¤§äº1ï¼Œæ¯”å¦‚3ã€‚ æ‰€æœ‰çš„å‰¯æœ¬ï¼ˆreplicasï¼‰ç»Ÿç§°ä¸ºAssigned Replicasï¼Œå³ARã€‚ISRæ˜¯ARä¸­çš„ä¸€ä¸ªå­é›†ï¼Œç”±leaderç»´æŠ¤ISRåˆ—è¡¨ï¼Œfollowerä»leaderåŒæ­¥æ•°æ®æœ‰ä¸€äº›å»¶è¿Ÿã€‚ä»»æ„ä¸€ä¸ªè¶…è¿‡é˜ˆå€¼éƒ½ä¼šæŠŠfollowerå‰”é™¤å‡ºISR, å­˜å…¥OSRï¼ˆOutof-Sync Replicasï¼‰åˆ—è¡¨ï¼Œæ–°åŠ å…¥çš„followerä¹Ÿä¼šå…ˆå­˜æ”¾åœ¨OSRä¸­ã€‚AR=ISR+OSRã€‚</p><p>ä¸Šä¸€èŠ‚ä¸­çš„HWä¿—ç§°é«˜æ°´ä½ï¼Œæ˜¯HighWatermarkçš„ç¼©å†™ï¼Œå–ä¸€ä¸ªpartitionå¯¹åº”çš„ISRä¸­æœ€å°çš„LEOä½œä¸ºHWï¼Œconsumeræœ€å¤šåªèƒ½æ¶ˆè´¹åˆ°HWæ‰€åœ¨çš„ä½ç½®ã€‚å¦å¤–æ¯ä¸ªreplicaéƒ½æœ‰HW,leaderå’Œfollowerå„è‡ªè´Ÿè´£æ›´æ–°è‡ªå·±çš„HWçš„çŠ¶æ€ã€‚å¯¹äºleaderæ–°å†™å…¥çš„æ¶ˆæ¯ï¼Œconsumerä¸èƒ½ç«‹åˆ»æ¶ˆè´¹ï¼Œleaderä¼šç­‰å¾…è¯¥æ¶ˆæ¯è¢«æ‰€æœ‰ISRä¸­çš„replicasåŒæ­¥åæ›´æ–°HWï¼Œæ­¤æ—¶æ¶ˆæ¯æ‰èƒ½è¢«consumeræ¶ˆè´¹ã€‚è¿™æ ·å°±ä¿è¯äº†å¦‚æœleaderæ‰€åœ¨çš„brokerå¤±æ•ˆï¼Œè¯¥æ¶ˆæ¯ä»ç„¶å¯ä»¥ä»æ–°é€‰ä¸¾çš„leaderä¸­è·å–ã€‚å¯¹äºæ¥è‡ªå†…éƒ¨broKerçš„è¯»å–è¯·æ±‚ï¼Œæ²¡æœ‰HWçš„é™åˆ¶ã€‚ ä¸‹å›¾è¯¦ç»†çš„è¯´æ˜äº†å½“producerç”Ÿäº§æ¶ˆæ¯è‡³brokeråï¼ŒISRä»¥åŠHWå’ŒLEOçš„æµè½¬è¿‡ç¨‹ï¼š <img src="/assets/719892-20180917173153201-1237551768-6a9adb76.png" alt="img" style="zoom:80%;"></p><p>ç”±æ­¤å¯è§ï¼ŒKafkaçš„å¤åˆ¶æœºåˆ¶æ—¢ä¸æ˜¯å®Œå…¨çš„åŒæ­¥å¤åˆ¶ï¼Œä¹Ÿä¸æ˜¯å•çº¯çš„å¼‚æ­¥å¤åˆ¶ã€‚äº‹å®ä¸Šï¼ŒåŒæ­¥å¤åˆ¶è¦æ±‚æ‰€æœ‰èƒ½å·¥ä½œçš„followeréƒ½å¤åˆ¶å®Œï¼Œè¿™æ¡æ¶ˆæ¯æ‰ä¼šè¢«commitï¼Œè¿™ç§å¤åˆ¶æ–¹å¼æå¤§çš„å½±å“äº†ååç‡ã€‚è€Œå¼‚æ­¥å¤åˆ¶æ–¹å¼ä¸‹ï¼Œfollowerå¼‚æ­¥çš„ä»leaderå¤åˆ¶æ•°æ®ï¼Œæ•°æ®åªè¦è¢«leaderå†™å…¥logå°±è¢«è®¤ä¸ºå·²ç»commitï¼Œè¿™ç§æƒ…å†µä¸‹å¦‚æœfolloweréƒ½è¿˜æ²¡æœ‰å¤åˆ¶å®Œï¼Œè½åäºleaderæ—¶ï¼Œçªç„¶leaderå®•æœºï¼Œåˆ™ä¼šä¸¢å¤±æ•°æ®ã€‚è€ŒKafkaçš„è¿™ç§ä½¿ç”¨ISRçš„æ–¹å¼åˆ™å¾ˆå¥½çš„å‡è¡¡äº†ç¡®ä¿æ•°æ®ä¸ä¸¢å¤±ä»¥åŠååç‡ã€‚</p><p>Kafkaçš„ISRçš„ç®¡ç†æœ€ç»ˆéƒ½ä¼šåé¦ˆåˆ°ZookeeperèŠ‚ç‚¹ä¸Šã€‚å…·ä½“ä½ç½®ä¸ºï¼š/brokers/topics/[topic]/partitions/[partition]/stateã€‚ç›®å‰æœ‰ä¸¤ä¸ªåœ°æ–¹ä¼šå¯¹è¿™ä¸ªZookeeperçš„èŠ‚ç‚¹è¿›è¡Œç»´æŠ¤ï¼š</p><ul><li>Controlleræ¥ç»´æŠ¤ï¼šKafkaé›†ç¾¤ä¸­çš„å…¶ä¸­ä¸€ä¸ªBrokerä¼šè¢«é€‰ä¸¾ä¸ºControllerï¼Œä¸»è¦è´Ÿè´£Partitionç®¡ç†å’Œå‰¯æœ¬çŠ¶æ€ç®¡ç†ï¼Œä¹Ÿä¼šæ‰§è¡Œç±»ä¼¼äºé‡åˆ†é…partitionä¹‹ç±»çš„ç®¡ç†ä»»åŠ¡ã€‚åœ¨ç¬¦åˆæŸäº›ç‰¹å®šæ¡ä»¶ä¸‹ï¼ŒControllerä¸‹çš„LeaderSelectorä¼šé€‰ä¸¾æ–°çš„leaderï¼ŒISRå’Œæ–°çš„leader_epochåŠcontroller_epochå†™å…¥Zookeeperçš„ç›¸å…³èŠ‚ç‚¹ä¸­ã€‚åŒæ—¶å‘èµ·LeaderAndIsrRequesté€šçŸ¥æ‰€æœ‰çš„replicasã€‚</li><li>leaderæ¥ç»´æŠ¤ï¼šleaderæœ‰å•ç‹¬çš„çº¿ç¨‹å®šæœŸæ£€æµ‹ISRä¸­followeræ˜¯å¦è„±ç¦»ISR, å¦‚æœå‘ç°ISRå˜åŒ–ï¼Œåˆ™ä¼šå°†æ–°çš„ISRçš„ä¿¡æ¯è¿”å›åˆ°Zookeeperçš„ç›¸å…³èŠ‚ç‚¹ä¸­ã€‚</li></ul><h4 id="å‰¯æœ¬ä¸åŒæ­¥çš„å¼‚å¸¸æƒ…å†µ" tabindex="-1"><a class="header-anchor" href="#å‰¯æœ¬ä¸åŒæ­¥çš„å¼‚å¸¸æƒ…å†µ" aria-hidden="true">#</a> å‰¯æœ¬ä¸åŒæ­¥çš„å¼‚å¸¸æƒ…å†µ</h4><ul><li>æ…¢å‰¯æœ¬ï¼šåœ¨ä¸€å®šå‘¨æœŸæ—¶é—´å†…followerä¸èƒ½è¿½èµ¶ä¸Šleaderã€‚æœ€å¸¸è§çš„åŸå› ä¹‹ä¸€æ˜¯I / Oç“¶é¢ˆå¯¼è‡´followerè¿½åŠ å¤åˆ¶æ¶ˆæ¯é€Ÿåº¦æ…¢äºä»leaderæ‹‰å–é€Ÿåº¦ã€‚</li><li>å¡ä½å‰¯æœ¬ï¼šåœ¨ä¸€å®šå‘¨æœŸæ—¶é—´å†…followeråœæ­¢ä»leaderæ‹‰å–è¯·æ±‚ã€‚follower replicaå¡ä½äº†æ˜¯ç”±äºGCæš‚åœæˆ–followerå¤±æ•ˆæˆ–æ­»äº¡ã€‚</li><li>æ–°å¯åŠ¨å‰¯æœ¬ï¼šå½“ç”¨æˆ·ç»™ä¸»é¢˜å¢åŠ å‰¯æœ¬å› å­æ—¶ï¼Œæ–°çš„followerä¸åœ¨åŒæ­¥å‰¯æœ¬åˆ—è¡¨ä¸­ï¼Œç›´åˆ°ä»–ä»¬å®Œå…¨èµ¶ä¸Šäº†leaderæ—¥å¿—ã€‚</li></ul><h3 id="kafkaæ–‡ä»¶å­˜å‚¨æœºåˆ¶" tabindex="-1"><a class="header-anchor" href="#kafkaæ–‡ä»¶å­˜å‚¨æœºåˆ¶" aria-hidden="true">#</a> Kafkaæ–‡ä»¶å­˜å‚¨æœºåˆ¶</h3><img src="/assets/kafka-aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzMyNTk5NDc5-e93099c6.png" alt="kafkaå­˜å‚¨æœºåˆ¶" style="zoom:80%;float:left;"><h4 id="topicä¸­partitionå­˜å‚¨åˆ†å¸ƒ" tabindex="-1"><a class="header-anchor" href="#topicä¸­partitionå­˜å‚¨åˆ†å¸ƒ" aria-hidden="true">#</a> topicä¸­partitionå­˜å‚¨åˆ†å¸ƒ</h4><p>å‡è®¾å®éªŒç¯å¢ƒä¸­Kafkaé›†ç¾¤åªæœ‰ä¸€ä¸ªbrokerï¼Œxxx/message-folderä¸ºæ•°æ®æ–‡ä»¶å­˜å‚¨æ ¹ç›®å½•ï¼Œåœ¨Kafka brokerä¸­server.propertiesæ–‡ä»¶é…ç½®(å‚æ•°log.dirs=xxx/message-folder)ï¼Œä¾‹å¦‚åˆ›å»ºtopicåç§°åˆ†åˆ«ä¸ºtest, partitionsæ•°é‡éƒ½ä¸ºpartitions=4ï¼Œå‰¯æœ¬ä¸º1 å­˜å‚¨è·¯å¾„å’Œç›®å½•è§„åˆ™ä¸ºï¼šxxx/logs</p><div class="language-x86asm line-numbers-mode" data-ext="x86asm"><pre class="language-x86asm"><code>test-0
test-1
test-2
test-3
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨Kafkaæ–‡ä»¶å­˜å‚¨ä¸­ï¼ŒåŒä¸€ä¸ªtopicä¸‹æœ‰å¤šä¸ªä¸åŒçš„partitionï¼Œæ¯ä¸ªpartitonä¸ºä¸€ä¸ªç›®å½•ï¼Œpartitionçš„åç§°è§„åˆ™ä¸ºï¼štopicåç§°+æœ‰åºåºå·ï¼Œç¬¬ä¸€ä¸ªåºå·ä»0å¼€å§‹è®¡ï¼Œæœ€å¤§çš„åºå·ä¸ºpartitionæ•°é‡å‡1ï¼Œpartitionæ˜¯å®é™…ç‰©ç†ä¸Šçš„æ¦‚å¿µï¼Œè€Œtopicæ˜¯é€»è¾‘ä¸Šçš„æ¦‚å¿µã€‚</p><h4 id="partitionä¸­æ–‡ä»¶å­˜å‚¨æ–¹å¼" tabindex="-1"><a class="header-anchor" href="#partitionä¸­æ–‡ä»¶å­˜å‚¨æ–¹å¼" aria-hidden="true">#</a> partitionä¸­æ–‡ä»¶å­˜å‚¨æ–¹å¼</h4><p>ä¸‹é¢ç¤ºæ„å›¾å½¢è±¡è¯´æ˜äº†partitionä¸­æ–‡ä»¶å­˜å‚¨æ–¹å¼: <img src="/assets/719892-20180627211352153-242677942-e5c4c3a1.png" alt="img"></p><ul><li>æ¯ä¸ªpartion(ç›®å½•)ç›¸å½“äºä¸€ä¸ªå·¨å‹æ–‡ä»¶è¢«å¹³å‡åˆ†é…åˆ°å¤šä¸ªå¤§å°ç›¸ç­‰segment(æ®µ)æ•°æ®æ–‡ä»¶ä¸­ã€‚ä½†æ¯ä¸ªæ®µsegment fileæ¶ˆæ¯æ•°é‡ä¸ä¸€å®šç›¸ç­‰ï¼Œè¿™ç§ç‰¹æ€§æ–¹ä¾¿old segment fileå¿«é€Ÿè¢«åˆ é™¤ã€‚</li><li>æ¯ä¸ªpartitonåªéœ€è¦æ”¯æŒé¡ºåºè¯»å†™å°±è¡Œäº†ï¼Œsegmentæ–‡ä»¶ç”Ÿå‘½å‘¨æœŸç”±æœåŠ¡ç«¯é…ç½®å‚æ•°å†³å®šã€‚</li></ul><p>è¿™æ ·åšçš„å¥½å¤„å°±æ˜¯èƒ½å¿«é€Ÿåˆ é™¤æ— ç”¨æ–‡ä»¶ï¼Œæœ‰æ•ˆæé«˜ç£ç›˜åˆ©ç”¨ç‡ã€‚</p><h4 id="partitionä¸­segmentæ–‡ä»¶å­˜å‚¨ç»“æ„" tabindex="-1"><a class="header-anchor" href="#partitionä¸­segmentæ–‡ä»¶å­˜å‚¨ç»“æ„" aria-hidden="true">#</a> partitionä¸­segmentæ–‡ä»¶å­˜å‚¨ç»“æ„</h4><p>segmentæ–‡ä»¶ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼Œåˆ†åˆ«ä¸ºâ€œ.indexâ€æ–‡ä»¶å’Œâ€œ.logâ€æ–‡ä»¶ï¼Œåˆ†åˆ«è¡¨ç¤ºä¸ºsegmentç´¢å¼•æ–‡ä»¶å’Œæ•°æ®æ–‡ä»¶ã€‚è¿™ä¸¤ä¸ªæ–‡ä»¶çš„å‘½ä»¤è§„åˆ™ä¸ºï¼špartitionå…¨å±€çš„ç¬¬ä¸€ä¸ªsegmentä»0å¼€å§‹ï¼Œåç»­æ¯ä¸ªsegmentæ–‡ä»¶åä¸ºä¸Šä¸€ä¸ªsegmentæ–‡ä»¶æœ€åä¸€æ¡æ¶ˆæ¯çš„offsetå€¼ï¼Œæ•°å€¼å¤§å°ä¸º64ä½ï¼Œ20ä½æ•°å­—å­—ç¬¦é•¿åº¦ï¼Œæ²¡æœ‰æ•°å­—ç”¨0å¡«å……ã€‚ ä¸‹é¢æ–‡ä»¶åˆ—è¡¨æ˜¯ç¬”è€…åœ¨Kafka brokerä¸Šåšçš„ä¸€ä¸ªå®éªŒï¼Œåˆ›å»ºä¸€ä¸ªtopicXXXåŒ…å«1 partitionï¼Œè®¾ç½®æ¯ä¸ªsegmentå¤§å°ä¸º500MB,å¹¶å¯åŠ¨producerå‘Kafka brokerå†™å…¥å¤§é‡æ•°æ®,å¦‚ä¸‹å›¾æ‰€ç¤ºsegmentæ–‡ä»¶åˆ—è¡¨å½¢è±¡è¯´æ˜äº†ä¸Šè¿°2ä¸ªè§„åˆ™ï¼š</p><img src="/assets/719892-20180627211448292-1850406771-f35016aa.png" alt="img" style="zoom:110%;float:left;"><p>ä»¥ä¸Šè¿°å›¾2ä¸€å¯¹segment fileæ–‡ä»¶ä¸ºä¾‹ï¼Œè¯´æ˜segmentä¸­index&lt;â€”-&gt;data fileå¯¹åº”å…³ç³»ç‰©ç†ç»“æ„å¦‚ä¸‹ï¼š <img src="/assets/719892-20180627211535074-1153379395-c4a610bc.png" alt="img"></p><p>ä¸Šè¿°å›¾3ç´¢å¼•æ–‡ä»¶å­˜å‚¨å¤§é‡å…ƒæ•°æ®ï¼Œæ•°æ®æ–‡ä»¶å­˜å‚¨å¤§é‡æ¶ˆæ¯ï¼Œç´¢å¼•æ–‡ä»¶ä¸­å…ƒæ•°æ®æŒ‡å‘å¯¹åº”æ•°æ®æ–‡ä»¶ä¸­messageçš„ç‰©ç†åç§»åœ°å€ã€‚ å…¶ä¸­ä»¥ç´¢å¼•æ–‡ä»¶ä¸­å…ƒæ•°æ®3,497ä¸ºä¾‹ï¼Œä¾æ¬¡åœ¨æ•°æ®æ–‡ä»¶ä¸­è¡¨ç¤ºç¬¬3ä¸ªmessage(åœ¨å…¨å±€partitonè¡¨ç¤ºç¬¬368772ä¸ªmessage)ã€ä»¥åŠè¯¥æ¶ˆæ¯çš„ç‰©ç†åç§»åœ°å€ä¸º497ã€‚</p><p>ä»ä¸Šå›¾äº†è§£åˆ°segment data fileç”±è®¸å¤šmessageç»„æˆï¼Œä¸‹é¢è¯¦ç»†è¯´æ˜messageç‰©ç†ç»“æ„å¦‚ä¸‹ï¼š <img src="/assets/719892-20180627211644283-2029234857-c750f524.png" alt="img"></p><p>ç›¸å…³å­—æ®µå«ä¹‰å¯¹åº”å¦‚ä¸‹ï¼š <img src="/assets/719892-20180627211552965-2036677379-76b60c63.png" alt="img" style="zoom:80%;"></p><h4 id="é€šè¿‡offsetæŸ¥æ‰¾message" tabindex="-1"><a class="header-anchor" href="#é€šè¿‡offsetæŸ¥æ‰¾message" aria-hidden="true">#</a> é€šè¿‡offsetæŸ¥æ‰¾message</h4><p>ä¾‹å¦‚è¯»å–offset=368776çš„messageï¼Œéœ€è¦é€šè¿‡ä¸‹é¢2ä¸ªæ­¥éª¤æŸ¥æ‰¾ã€‚</p><ul><li>ç¬¬ä¸€æ­¥æŸ¥æ‰¾segment file ä¸Šå›¾ä¸ºä¾‹ï¼Œå…¶ä¸­00000000000000000000.indexè¡¨ç¤ºæœ€å¼€å§‹çš„æ–‡ä»¶ï¼Œèµ·å§‹åç§»é‡(offset)ä¸º0.ç¬¬äºŒä¸ªæ–‡ä»¶00000000000000368769.indexçš„æ¶ˆæ¯é‡èµ·å§‹åç§»é‡ä¸º368770 = 368769 + 1.åŒæ ·ï¼Œç¬¬ä¸‰ä¸ªæ–‡ä»¶00000000000000737337.indexçš„èµ·å§‹åç§»é‡ä¸º737338=737337 + 1ï¼Œå…¶ä»–åç»­æ–‡ä»¶ä¾æ¬¡ç±»æ¨ï¼Œä»¥èµ·å§‹åç§»é‡å‘½åå¹¶æ’åºè¿™äº›æ–‡ä»¶ï¼Œåªè¦æ ¹æ®offsetäºŒåˆ†æŸ¥æ‰¾æ–‡ä»¶åˆ—è¡¨ï¼Œå°±å¯ä»¥å¿«é€Ÿå®šä½åˆ°å…·ä½“æ–‡ä»¶ã€‚ å½“offset=368776æ—¶å®šä½åˆ°00000000000000368769.index|log</li><li>ç¬¬äºŒæ­¥é€šè¿‡segment fileæŸ¥æ‰¾message é€šè¿‡ç¬¬ä¸€æ­¥å®šä½åˆ°segment fileï¼Œå½“offset=368776æ—¶ï¼Œä¾æ¬¡å®šä½åˆ°00000000000000368769.indexçš„å…ƒæ•°æ®ç‰©ç†ä½ç½®å’Œ00000000000000368769.logçš„ç‰©ç†åç§»åœ°å€ï¼Œç„¶åå†é€šè¿‡00000000000000368769.logé¡ºåºæŸ¥æ‰¾ç›´åˆ°offset=368776ä¸ºæ­¢ã€‚</li></ul><p>ä»ä¸Šå›¾å¯çŸ¥è¿™æ ·åšçš„ä¼˜ç‚¹ï¼Œsegment index fileé‡‡å–ç¨€ç–ç´¢å¼•å­˜å‚¨æ–¹å¼ï¼Œå®ƒå‡å°‘ç´¢å¼•æ–‡ä»¶å¤§å°ï¼Œé€šè¿‡mmapå¯ä»¥ç›´æ¥å†…å­˜æ“ä½œï¼Œç¨€ç–ç´¢å¼•ä¸ºæ•°æ®æ–‡ä»¶çš„æ¯ä¸ªå¯¹åº”messageè®¾ç½®ä¸€ä¸ªå…ƒæ•°æ®æŒ‡é’ˆ,å®ƒæ¯”ç¨ å¯†ç´¢å¼•èŠ‚çœäº†æ›´å¤šçš„å­˜å‚¨ç©ºé—´ï¼Œä½†æŸ¥æ‰¾èµ·æ¥éœ€è¦æ¶ˆè€—æ›´å¤šçš„æ—¶é—´ã€‚</p><p>Kafkaé«˜æ•ˆæ–‡ä»¶å­˜å‚¨è®¾è®¡ç‰¹ç‚¹</p><ul><li>KafkaæŠŠtopicä¸­ä¸€ä¸ªparitionå¤§æ–‡ä»¶åˆ†æˆå¤šä¸ªå°æ–‡ä»¶æ®µï¼Œé€šè¿‡å¤šä¸ªå°æ–‡ä»¶æ®µï¼Œå°±å®¹æ˜“å®šæœŸæ¸…é™¤æˆ–åˆ é™¤å·²ç»æ¶ˆè´¹å®Œæ–‡ä»¶ï¼Œå‡å°‘ç£ç›˜å ç”¨ã€‚</li><li>é€šè¿‡ç´¢å¼•ä¿¡æ¯å¯ä»¥å¿«é€Ÿå®šä½messageå’Œç¡®å®šresponseçš„æœ€å¤§å¤§å°ã€‚</li><li>é€šè¿‡indexå…ƒæ•°æ®å…¨éƒ¨æ˜ å°„åˆ°memoryï¼Œå¯ä»¥é¿å…segment fileçš„IOç£ç›˜æ“ä½œã€‚</li><li>é€šè¿‡ç´¢å¼•æ–‡ä»¶ç¨€ç–å­˜å‚¨ï¼Œå¯ä»¥å¤§å¹…é™ä½indexæ–‡ä»¶å…ƒæ•°æ®å ç”¨ç©ºé—´å¤§å°ã€‚</li></ul><h3 id="kafkaæ•°æ®å¯é æ€§å’Œä¸€è‡´æ€§ä¿è¯" tabindex="-1"><a class="header-anchor" href="#kafkaæ•°æ®å¯é æ€§å’Œä¸€è‡´æ€§ä¿è¯" aria-hidden="true">#</a> kafkaæ•°æ®å¯é æ€§å’Œä¸€è‡´æ€§ä¿è¯</h3><p>å½“producerå‘leaderå‘é€æ•°æ®æ—¶ï¼Œå¯ä»¥é€šè¿‡<code>request.required.acks</code>å‚æ•°æ¥è®¾ç½®æ•°æ®å¯é æ€§çš„çº§åˆ«ï¼š</p><ul><li>1ï¼ˆé»˜è®¤ï¼‰ï¼šè¿™æ„å‘³ç€produceråœ¨ISRä¸­çš„leaderå·²æˆåŠŸæ”¶åˆ°çš„æ•°æ®å¹¶å¾—åˆ°ç¡®è®¤åå‘é€ä¸‹ä¸€æ¡messageã€‚å¦‚æœleaderå®•æœºäº†ï¼Œåˆ™ä¼šä¸¢å¤±æ•°æ®ã€‚</li><li>0ï¼šè¿™æ„å‘³ç€produceræ— éœ€ç­‰å¾…æ¥è‡ªbrokerçš„ç¡®è®¤è€Œç»§ç»­å‘é€ä¸‹ä¸€æ‰¹æ¶ˆæ¯ã€‚è¿™ç§æƒ…å†µä¸‹æ•°æ®ä¼ è¾“æ•ˆç‡æœ€é«˜ï¼Œä½†æ˜¯æ•°æ®å¯é æ€§ç¡®æ˜¯æœ€ä½çš„ã€‚</li><li>-1ï¼šproduceréœ€è¦ç­‰å¾…ISRä¸­çš„æ‰€æœ‰followeréƒ½ç¡®è®¤æ¥æ”¶åˆ°æ•°æ®åæ‰ç®—ä¸€æ¬¡å‘é€å®Œæˆï¼Œå¯é æ€§æœ€é«˜ã€‚ä½†æ˜¯è¿™æ ·ä¹Ÿä¸èƒ½ä¿è¯æ•°æ®ä¸ä¸¢å¤±ï¼Œæ¯”å¦‚å½“ISRä¸­åªæœ‰leaderæ—¶ï¼ˆå‰é¢ISRé‚£ä¸€èŠ‚è®²åˆ°ï¼ŒISRä¸­çš„æˆå‘˜ç”±äºæŸäº›æƒ…å†µä¼šå¢åŠ ä¹Ÿä¼šå‡å°‘ï¼Œæœ€å°‘å°±åªå‰©ä¸€ä¸ªleaderï¼‰ï¼Œè¿™æ ·å°±å˜æˆäº†acks=1çš„æƒ…å†µã€‚</li></ul><p>å¦‚æœè¦æé«˜æ•°æ®çš„å¯é æ€§ï¼Œåœ¨è®¾ç½®<code>request.required.acks=-1</code>çš„åŒæ—¶ï¼Œä¹Ÿè¦<code>min.insync.replicas</code>è¿™ä¸ªå‚æ•°(å¯ä»¥åœ¨brokeræˆ–è€…topicå±‚é¢è¿›è¡Œè®¾ç½®)çš„é…åˆï¼Œè¿™æ ·æ‰èƒ½å‘æŒ¥æœ€å¤§çš„åŠŸæ•ˆã€‚<code>min.insync.replicas</code>è¿™ä¸ªå‚æ•°è®¾å®šISRä¸­çš„æœ€å°å‰¯æœ¬æ•°æ˜¯å¤šå°‘ï¼Œé»˜è®¤å€¼ä¸º1ï¼Œå½“ä¸”ä»…å½“<code>request.required.acks</code>å‚æ•°è®¾ç½®ä¸º-1æ—¶ï¼Œæ­¤å‚æ•°æ‰ç”Ÿæ•ˆã€‚å¦‚æœISRä¸­çš„å‰¯æœ¬æ•°å°‘äº<code>min.insync.replicas</code>é…ç½®çš„æ•°é‡æ—¶ï¼Œå®¢æˆ·ç«¯ä¼šè¿”å›å¼‚å¸¸ï¼š<code>org.apache.kafka.common.errors.NotEnoughReplicasExceptoin: Messages are rejected since there are fewer in-sync replicas than required</code>ã€‚</p><p>æ¥ä¸‹æ¥å¯¹acks=1å’Œ-1çš„ä¸¤ç§æƒ…å†µè¿›è¡Œè¯¦ç»†åˆ†æã€‚</p><p><strong>request.required.acks=1</strong></p><p>producerå‘é€æ•°æ®åˆ°leaderï¼Œleaderå†™æœ¬åœ°æ—¥å¿—æˆåŠŸï¼Œè¿”å›å®¢æˆ·ç«¯æˆåŠŸï¼›æ­¤æ—¶ISRä¸­çš„å‰¯æœ¬è¿˜æ²¡æœ‰æ¥å¾—åŠæ‹‰å–è¯¥æ¶ˆæ¯ï¼Œleaderå°±å®•æœºäº†ï¼Œé‚£ä¹ˆæ­¤æ¬¡å‘é€çš„æ¶ˆæ¯å°±ä¼šä¸¢å¤±ã€‚ <img src="/assets/719892-20180627212045509-329713915-e0c57c1b.png" alt="img"></p><p><strong>request.required.acks=-1</strong></p><p>åŒæ­¥ï¼ˆKafkaé»˜è®¤ä¸ºåŒæ­¥ï¼Œå³producer.type=syncï¼‰çš„å‘é€æ¨¡å¼ï¼Œreplication.factor&gt;=2ä¸”min.insync.replicas&gt;=2çš„æƒ…å†µä¸‹ï¼Œä¸ä¼šä¸¢å¤±æ•°æ®ã€‚</p><p>æœ‰ä¸¤ç§å…¸å‹æƒ…å†µï¼Œä¸€ç§æ˜¯followerå®Œå…¨åŒæ­¥ï¼Œä¸€ç§æ˜¯followeréƒ¨åˆ†åŒæ­¥ acks=-1çš„æƒ…å†µä¸‹ï¼ˆå¦‚æ— ç‰¹æ®Šè¯´æ˜ï¼Œä»¥ä¸‹ackséƒ½è¡¨ç¤ºä¸ºå‚æ•°request.required.acksï¼‰ï¼Œæ•°æ®å‘é€åˆ°leader, ISRçš„followerå…¨éƒ¨å®Œæˆæ•°æ®åŒæ­¥åï¼Œleaderæ­¤æ—¶æŒ‚æ‰ï¼Œé‚£ä¹ˆä¼šé€‰ä¸¾å‡ºæ–°çš„leaderï¼Œæ•°æ®ä¸ä¼šä¸¢å¤±ã€‚ <img src="/assets/719892-20180627212105752-1083289940-2f0eae22.png" alt="img"></p><p>acks=-1çš„æƒ…å†µä¸‹ï¼Œæ•°æ®å‘é€åˆ°leaderå ï¼Œéƒ¨åˆ†ISRçš„å‰¯æœ¬åŒæ­¥ï¼Œleaderæ­¤æ—¶æŒ‚æ‰ã€‚æ¯”å¦‚follower1hå’Œfollower2éƒ½æœ‰å¯èƒ½å˜æˆæ–°çš„leader, producerç«¯ä¼šå¾—åˆ°è¿”å›å¼‚å¸¸ï¼Œproducerç«¯ä¼šé‡æ–°å‘é€æ•°æ®ï¼Œæ•°æ®å¯èƒ½ä¼šé‡å¤ã€‚</p><p><img src="/assets/719892-20180627212123387-437515744-e673fef2.png" alt="img"></p><p>å½“ç„¶ä¸Šå›¾ä¸­å¦‚æœåœ¨leader crashçš„æ—¶å€™ï¼Œfollower2è¿˜æ²¡æœ‰åŒæ­¥åˆ°ä»»ä½•æ•°æ®ï¼Œè€Œä¸”follower2è¢«é€‰ä¸¾ä¸ºæ–°çš„leaderçš„è¯ï¼Œè¿™æ ·æ¶ˆæ¯å°±ä¸ä¼šé‡å¤ã€‚</p><p><strong>HWæ·±å…¥è®¨è®º</strong> è€ƒè™‘ä¸Šå›¾ï¼ˆå³acks=-1,éƒ¨åˆ†ISRå‰¯æœ¬åŒæ­¥ï¼‰ä¸­çš„å¦ä¸€ç§æƒ…å†µï¼Œå¦‚æœåœ¨LeaderæŒ‚æ‰çš„æ—¶å€™ï¼Œfollower1åŒæ­¥äº†æ¶ˆæ¯4,5ï¼Œfollower2åŒæ­¥äº†æ¶ˆæ¯4ï¼Œä¸æ­¤åŒæ—¶follower2è¢«é€‰ä¸¾ä¸ºleaderï¼Œé‚£ä¹ˆæ­¤æ—¶follower1ä¸­çš„å¤šå‡ºçš„æ¶ˆæ¯5è¯¥åšå¦‚ä½•å¤„ç†å‘¢ï¼Ÿ</p><p>è¿™é‡Œå°±éœ€è¦HWçš„ååŒé…åˆäº†ã€‚å¦‚å‰æ‰€è¿°ï¼Œä¸€ä¸ªpartitionä¸­çš„ISRåˆ—è¡¨ä¸­ï¼Œleaderçš„HWæ˜¯æ‰€æœ‰ISRåˆ—è¡¨é‡Œå‰¯æœ¬ä¸­æœ€å°çš„é‚£ä¸ªçš„LEOã€‚ç±»ä¼¼äºæœ¨æ¡¶åŸç†ï¼Œæ°´ä½å–å†³äºæœ€ä½é‚£å—çŸ­æ¿ã€‚ <img src="/assets/719892-20180627212208063-1729727294-161b41cd.png" alt="img"></p><p>å¦‚ä¸Šå›¾ï¼ŒæŸä¸ªtopicçš„æŸpartitionæœ‰ä¸‰ä¸ªå‰¯æœ¬ï¼Œåˆ†åˆ«ä¸ºAã€Bã€Cã€‚Aä½œä¸ºleaderè‚¯å®šæ˜¯LEOæœ€é«˜ï¼ŒBç´§éšå…¶åï¼ŒCæœºå™¨ç”±äºé…ç½®æ¯”è¾ƒä½ï¼Œç½‘ç»œæ¯”è¾ƒå·®ï¼Œæ•…è€ŒåŒæ­¥æœ€æ…¢ã€‚è¿™ä¸ªæ—¶å€™Aæœºå™¨å®•æœºï¼Œè¿™æ—¶å€™å¦‚æœBæˆä¸ºleaderï¼Œå‡å¦‚æ²¡æœ‰HWï¼Œåœ¨Aé‡æ–°æ¢å¤ä¹‹åä¼šåšåŒæ­¥(makeFollower)æ“ä½œï¼Œåœ¨å®•æœºæ—¶logæ–‡ä»¶ä¹‹åç›´æ¥åšè¿½åŠ æ“ä½œï¼Œè€Œå‡å¦‚Bçš„LEOå·²ç»è¾¾åˆ°äº†Açš„LEOï¼Œä¼šäº§ç”Ÿæ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µï¼Œæ‰€ä»¥ä½¿ç”¨HWæ¥é¿å…è¿™ç§æƒ…å†µã€‚</p><p>Aåœ¨åšåŒæ­¥æ“ä½œçš„æ—¶å€™ï¼Œå…ˆå°†logæ–‡ä»¶æˆªæ–­åˆ°ä¹‹å‰è‡ªå·±çš„HWçš„ä½ç½®ï¼Œå³3ï¼Œä¹‹åå†ä»Bä¸­æ‹‰å–æ¶ˆæ¯è¿›è¡ŒåŒæ­¥ã€‚</p><p>å¦‚æœå¤±è´¥çš„followeræ¢å¤è¿‡æ¥ï¼Œå®ƒé¦–å…ˆå°†è‡ªå·±çš„logæ–‡ä»¶æˆªæ–­åˆ°ä¸Šæ¬¡checkpointedæ—¶åˆ»çš„HWçš„ä½ç½®ï¼Œä¹‹åå†ä»leaderä¸­åŒæ­¥æ¶ˆæ¯ã€‚leaderæŒ‚æ‰ä¼šé‡æ–°é€‰ä¸¾ï¼Œæ–°çš„leaderä¼šå‘é€â€œæŒ‡ä»¤â€è®©å…¶ä½™çš„followeræˆªæ–­è‡³è‡ªèº«çš„HWçš„ä½ç½®ç„¶åå†æ‹‰å–æ–°çš„æ¶ˆæ¯ã€‚</p><p>å½“ISRä¸­çš„ä¸ªå‰¯æœ¬çš„LEOä¸ä¸€è‡´æ—¶ï¼Œå¦‚æœæ­¤æ—¶leaderæŒ‚æ‰ï¼Œé€‰ä¸¾æ–°çš„leaderæ—¶å¹¶ä¸æ˜¯æŒ‰ç…§LEOçš„é«˜ä½è¿›è¡Œé€‰ä¸¾ï¼Œè€Œæ˜¯æŒ‰ç…§ISRä¸­çš„é¡ºåºé€‰ä¸¾ã€‚</p><h3 id="kafka-leaderé€‰ä¸¾" tabindex="-1"><a class="header-anchor" href="#kafka-leaderé€‰ä¸¾" aria-hidden="true">#</a> kafka leaderé€‰ä¸¾</h3><p>ä¸€æ¡æ¶ˆæ¯åªæœ‰è¢«ISRä¸­çš„æ‰€æœ‰followeréƒ½ä»leaderå¤åˆ¶è¿‡å»æ‰ä¼šè¢«è®¤ä¸ºå·²æäº¤ã€‚è¿™æ ·å°±é¿å…äº†éƒ¨åˆ†æ•°æ®è¢«å†™è¿›äº†leaderï¼Œè¿˜æ²¡æ¥å¾—åŠè¢«ä»»ä½•followerå¤åˆ¶å°±å®•æœºäº†ï¼Œè€Œé€ æˆæ•°æ®ä¸¢å¤±ã€‚è€Œå¯¹äºproducerè€Œè¨€ï¼Œå®ƒå¯ä»¥é€‰æ‹©æ˜¯å¦ç­‰å¾…æ¶ˆæ¯commitï¼Œè¿™å¯ä»¥é€šè¿‡request.required.acksæ¥è®¾ç½®ã€‚è¿™ç§æœºåˆ¶ç¡®ä¿äº†åªè¦ISRä¸­æœ‰ä¸€ä¸ªæˆ–è€…ä»¥ä¸Šçš„followerï¼Œä¸€æ¡è¢«commitçš„æ¶ˆæ¯å°±ä¸ä¼šä¸¢å¤±ã€‚</p><p>æœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„é—®é¢˜æ˜¯å½“leaderå®•æœºäº†ï¼Œæ€æ ·åœ¨followerä¸­é€‰ä¸¾å‡ºæ–°çš„leaderï¼Œå› ä¸ºfollowerå¯èƒ½è½åå¾ˆå¤šæˆ–è€…ç›´æ¥crashäº†ï¼Œæ‰€ä»¥å¿…é¡»ç¡®ä¿é€‰æ‹©â€œæœ€æ–°â€çš„followerä½œä¸ºæ–°çš„leaderã€‚ä¸€ä¸ªåŸºæœ¬çš„åŸåˆ™å°±æ˜¯ï¼Œå¦‚æœleaderä¸åœ¨äº†ï¼Œæ–°çš„leaderå¿…é¡»æ‹¥æœ‰åŸæ¥çš„leader commitçš„æ‰€æœ‰æ¶ˆæ¯ã€‚è¿™å°±éœ€è¦åšä¸€ä¸ªæŠ˜ä¸­ï¼Œå¦‚æœleaderåœ¨è¡¨åä¸€ä¸ªæ¶ˆæ¯è¢«commitå‰ç­‰å¾…æ›´å¤šçš„followerç¡®è®¤ï¼Œé‚£ä¹ˆåœ¨å®ƒæŒ‚æ‰ä¹‹åå°±æœ‰æ›´å¤šçš„followerå¯ä»¥æˆä¸ºæ–°çš„leaderï¼Œä½†è¿™ä¹Ÿä¼šé€ æˆååç‡çš„ä¸‹é™ã€‚</p><p>æœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„é—®é¢˜æ˜¯å½“leaderå®•æœºäº†ï¼Œæ€æ ·åœ¨followerä¸­é€‰ä¸¾å‡ºæ–°çš„leaderï¼Œå› ä¸ºfollowerå¯èƒ½è½åå¾ˆå¤šæˆ–è€…ç›´æ¥crashäº†ï¼Œæ‰€ä»¥å¿…é¡»ç¡®ä¿é€‰æ‹©â€œæœ€æ–°â€çš„followerä½œä¸ºæ–°çš„leaderã€‚ä¸€ä¸ªåŸºæœ¬çš„åŸåˆ™å°±æ˜¯ï¼Œå¦‚æœleaderä¸åœ¨äº†ï¼Œæ–°çš„leaderå¿…é¡»æ‹¥æœ‰åŸæ¥çš„leader commitçš„æ‰€æœ‰æ¶ˆæ¯ã€‚è¿™å°±éœ€è¦åšä¸€ä¸ªæŠ˜ä¸­ï¼Œå¦‚æœleaderåœ¨è¡¨åä¸€ä¸ªæ¶ˆæ¯è¢«commitå‰ç­‰å¾…æ›´å¤šçš„followerç¡®è®¤ï¼Œé‚£ä¹ˆåœ¨å®ƒæŒ‚æ‰ä¹‹åå°±æœ‰æ›´å¤šçš„followerå¯ä»¥æˆä¸ºæ–°çš„leaderï¼Œä½†è¿™ä¹Ÿä¼šé€ æˆååç‡çš„ä¸‹é™ã€‚</p><p>ä¸€ç§éå¸¸å¸¸ç”¨çš„é€‰ä¸¾leaderçš„æ–¹å¼æ˜¯â€œå°‘æ•°æœä»å¤šæ•°â€ï¼ŒKafkaå¹¶ä¸æ˜¯é‡‡ç”¨è¿™ç§æ–¹å¼ã€‚è¿™ç§æ¨¡å¼ä¸‹ï¼Œå¦‚æœæˆ‘ä»¬æœ‰2f+1ä¸ªå‰¯æœ¬ï¼Œé‚£ä¹ˆåœ¨commitä¹‹å‰å¿…é¡»ä¿è¯æœ‰f+1ä¸ªreplicaå¤åˆ¶å®Œæ¶ˆæ¯ï¼ŒåŒæ—¶ä¸ºäº†ä¿è¯èƒ½æ­£ç¡®é€‰ä¸¾å‡ºæ–°çš„leaderï¼Œå¤±è´¥çš„å‰¯æœ¬æ•°ä¸èƒ½è¶…è¿‡fä¸ªã€‚è¿™ç§æ–¹å¼æœ‰ä¸ªå¾ˆå¤§çš„ä¼˜åŠ¿ï¼Œç³»ç»Ÿçš„å»¶è¿Ÿå–å†³äºæœ€å¿«çš„å‡ å°æœºå™¨ï¼Œä¹Ÿå°±æ˜¯è¯´æ¯”å¦‚å‰¯æœ¬æ•°ä¸º3ï¼Œé‚£ä¹ˆå»¶è¿Ÿå°±å–å†³äºæœ€å¿«çš„é‚£ä¸ªfollowerè€Œä¸æ˜¯æœ€æ…¢çš„é‚£ä¸ªã€‚â€œå°‘æ•°æœä»å¤šæ•°â€çš„æ–¹å¼ä¹Ÿæœ‰ä¸€äº›åŠ£åŠ¿ï¼Œä¸ºäº†ä¿è¯leaderé€‰ä¸¾çš„æ­£å¸¸è¿›è¡Œï¼Œå®ƒæ‰€èƒ½å®¹å¿çš„å¤±è´¥çš„followeræ•°æ¯”è¾ƒå°‘ï¼Œå¦‚æœè¦å®¹å¿1ä¸ªfolloweræŒ‚æ‰ï¼Œé‚£ä¹ˆè‡³å°‘è¦3ä¸ªä»¥ä¸Šçš„å‰¯æœ¬ï¼Œå¦‚æœè¦å®¹å¿2ä¸ªfolloweræŒ‚æ‰ï¼Œå¿…é¡»è¦æœ‰5ä¸ªä»¥ä¸Šçš„å‰¯æœ¬ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸‹ä¸ºäº†ä¿è¯è¾ƒé«˜çš„å®¹é”™ç‡ï¼Œå¿…é¡»è¦æœ‰å¤§é‡çš„å‰¯æœ¬ï¼Œè€Œå¤§é‡çš„å‰¯æœ¬åˆä¼šåœ¨å¤§æ•°æ®é‡ä¸‹å¯¼è‡´æ€§èƒ½çš„æ€¥å‰§ä¸‹é™ã€‚è¿™ç§ç®—æ³•æ›´å¤šç”¨åœ¨Zookeeperè¿™ç§å…±äº«é›†ç¾¤é…ç½®çš„ç³»ç»Ÿä¸­è€Œå¾ˆå°‘åœ¨éœ€è¦å¤§é‡æ•°æ®çš„ç³»ç»Ÿä¸­ä½¿ç”¨çš„åŸå› ã€‚HDFSçš„HAåŠŸèƒ½ä¹Ÿæ˜¯åŸºäºâ€œå°‘æ•°æœä»å¤šæ•°â€çš„æ–¹å¼ï¼Œä½†æ˜¯å…¶æ•°æ®å­˜å‚¨å¹¶ä¸æ˜¯é‡‡ç”¨è¿™æ ·çš„æ–¹å¼ã€‚</p><p>å®é™…ä¸Šï¼Œleaderé€‰ä¸¾çš„ç®—æ³•éå¸¸å¤šï¼Œæ¯”å¦‚Zookeeperçš„Zabã€Raftä»¥åŠViewstamped Replicationã€‚è€ŒKafkaæ‰€ä½¿ç”¨çš„leaderé€‰ä¸¾ç®—æ³•æ›´åƒæ˜¯å¾®è½¯çš„PacificAç®—æ³•ã€‚</p><p>Kafkaåœ¨Zookeeperä¸­ä¸ºæ¯ä¸€ä¸ªpartitionåŠ¨æ€çš„ç»´æŠ¤äº†ä¸€ä¸ªISRï¼Œè¿™ä¸ªISRé‡Œçš„æ‰€æœ‰replicaéƒ½è·Ÿä¸Šäº†leaderï¼Œåªæœ‰ISRé‡Œçš„æˆå‘˜æ‰èƒ½æœ‰è¢«é€‰ä¸ºleaderçš„å¯èƒ½ï¼ˆunclean.leader.election.enable=falseï¼‰ã€‚åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œå¯¹äºf+1ä¸ªå‰¯æœ¬ï¼Œä¸€ä¸ªKafka topicèƒ½åœ¨ä¿è¯ä¸ä¸¢å¤±å·²ç»commitæ¶ˆæ¯çš„å‰æä¸‹å®¹å¿fä¸ªå‰¯æœ¬çš„å¤±è´¥ï¼Œåœ¨å¤§å¤šæ•°ä½¿ç”¨åœºæ™¯ä¸‹ï¼Œè¿™ç§æ¨¡å¼æ˜¯ååˆ†æœ‰åˆ©çš„ã€‚äº‹å®ä¸Šï¼Œä¸ºäº†å®¹å¿fä¸ªå‰¯æœ¬çš„å¤±è´¥ï¼Œâ€œå°‘æ•°æœä»å¤šæ•°â€çš„æ–¹å¼å’ŒISRåœ¨commitå‰éœ€è¦ç­‰å¾…çš„å‰¯æœ¬çš„æ•°é‡æ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯ISRéœ€è¦çš„æ€»çš„å‰¯æœ¬çš„ä¸ªæ•°å‡ ä¹æ˜¯â€œå°‘æ•°æœä»å¤šæ•°â€çš„æ–¹å¼çš„ä¸€åŠã€‚</p><p>ä¸Šæ–‡æåˆ°ï¼Œåœ¨ISRä¸­è‡³å°‘æœ‰ä¸€ä¸ªfolloweræ—¶ï¼ŒKafkaå¯ä»¥ç¡®ä¿å·²ç»commitçš„æ•°æ®ä¸ä¸¢å¤±ï¼Œä½†å¦‚æœæŸä¸€ä¸ªpartitionçš„æ‰€æœ‰replicaéƒ½æŒ‚äº†ï¼Œå°±æ— æ³•ä¿è¯æ•°æ®ä¸ä¸¢å¤±äº†ã€‚è¿™ç§æƒ…å†µä¸‹æœ‰ä¸¤ç§å¯è¡Œçš„æ–¹æ¡ˆï¼š</p><ul><li>ç­‰å¾…ISRä¸­ä»»æ„ä¸€ä¸ªreplicaâ€œæ´»â€è¿‡æ¥ï¼Œå¹¶ä¸”é€‰å®ƒä½œä¸ºleader</li><li>é€‰æ‹©ç¬¬ä¸€ä¸ªâ€œæ´»â€è¿‡æ¥çš„replicaï¼ˆå¹¶ä¸ä¸€å®šæ˜¯åœ¨ISRä¸­ï¼‰ä½œä¸ºleader</li></ul><p>å¦‚æœä¸€å®šè¦ç­‰å¾…ISRä¸­çš„replicaâ€œæ´»â€è¿‡æ¥ï¼Œé‚£ä¸å¯ç”¨çš„æ—¶é—´å°±å¯èƒ½ä¼šç›¸å¯¹è¾ƒé•¿ã€‚è€Œä¸”å¦‚æœISRä¸­æ‰€æœ‰çš„replicaéƒ½æ— æ³•â€œæ´»â€è¿‡æ¥äº†ï¼Œæˆ–è€…æ•°æ®ä¸¢å¤±äº†ï¼Œè¿™ä¸ªpartitionå°†æ°¸è¿œä¸å¯ç”¨ã€‚é€‰æ‹©ç¬¬ä¸€ä¸ªâ€œæ´»â€è¿‡æ¥çš„replicaä½œä¸ºleader,è€Œè¿™ä¸ªreplicaä¸æ˜¯ISRä¸­çš„replica,é‚£å³ä½¿å®ƒå¹¶ä¸ä¿éšœå·²ç»åŒ…å«äº†æ‰€æœ‰å·²commitçš„æ¶ˆæ¯ï¼Œå®ƒä¹Ÿä¼šæˆä¸ºleaderè€Œä½œä¸ºconsumerçš„æ•°æ®æºã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒKafkaé‡‡ç”¨ç¬¬äºŒç§ç­–ç•¥ï¼Œå³<code>unclean.leader.election.enable=true</code>ï¼Œä¹Ÿå¯ä»¥å°†æ­¤å‚æ•°è®¾ç½®ä¸ºfalseæ¥å¯ç”¨ç¬¬ä¸€ç§ç­–ç•¥ã€‚</p><p>unclean.leader.election.enableè¿™ä¸ªå‚æ•°å¯¹äºleaderçš„é€‰ä¸¾ã€ç³»ç»Ÿçš„å¯ç”¨æ€§ä»¥åŠæ•°æ®çš„å¯é æ€§éƒ½æœ‰è‡³å…³é‡è¦çš„å½±å“ã€‚ä¸‹é¢æˆ‘ä»¬æ¥åˆ†æä¸‹å‡ ç§å…¸å‹çš„åœºæ™¯ã€‚</p><p><img src="/assets/719892-20180627212431940-1513014277-3a910f8f.png" alt="img"></p><p>å¦‚æœä¸Šå›¾æ‰€ç¤ºï¼Œå‡è®¾æŸä¸ªpartitionä¸­çš„å‰¯æœ¬æ•°ä¸º3ï¼Œreplica-0, replica-1, replica-2åˆ†åˆ«å­˜æ”¾åœ¨broker0, broker1å’Œbroker2ä¸­ã€‚AR=(0,1,2)ï¼ŒISR=(0,1)ã€‚</p><p>è®¾ç½®request.required.acks=-1, min.insync.replicas=2ï¼Œunclean.leader.election.enable=falseã€‚è¿™é‡Œè®²broker0ä¸­çš„å‰¯æœ¬ä¹Ÿç§°ä¹‹ä¸ºbroker0èµ·åˆbroker0ä¸ºleaderï¼Œbroker1ä¸ºfollowerã€‚</p><p><strong>1. å½“ISRä¸­çš„replica-0å‡ºç°crashçš„æƒ…å†µæ—¶ï¼Œbroker1é€‰ä¸¾ä¸ºæ–°çš„leader[ISR=(1)]</strong> å› ä¸ºå—min.insync.replicas=2å½±å“ï¼Œwriteä¸èƒ½æœåŠ¡ï¼Œä½†æ˜¯readèƒ½ç»§ç»­æ­£å¸¸æœåŠ¡ã€‚æ­¤ç§æƒ…å†µæ¢å¤æ–¹æ¡ˆï¼š</p><ul><li>å°è¯•æ¢å¤(é‡å¯)replica-0ï¼Œå¦‚æœèƒ½èµ·æ¥ï¼Œç³»ç»Ÿæ­£å¸¸ï¼›</li><li>å¦‚æœreplica-0ä¸èƒ½æ¢å¤ï¼Œéœ€è¦å°†min.insync.replicasè®¾ç½®ä¸º1ï¼Œæ¢å¤writeåŠŸèƒ½ã€‚</li></ul><p><strong>2. å½“ISRä¸­çš„replica-0å‡ºç°crashï¼Œç´§æ¥ç€replica-1ä¹Ÿå‡ºç°äº†crash, æ­¤æ—¶[ISR=(1),leader=-1]</strong></p><p>ä¸èƒ½å¯¹å¤–æä¾›æœåŠ¡ï¼Œæ­¤ç§æƒ…å†µæ¢å¤æ–¹æ¡ˆï¼š</p><ul><li>å°è¯•æ¢å¤replica-0å’Œreplica-1ï¼Œå¦‚æœéƒ½èƒ½èµ·æ¥ï¼Œåˆ™ç³»ç»Ÿæ¢å¤æ­£å¸¸ï¼›</li><li>å¦‚æœreplica-0èµ·æ¥ï¼Œè€Œreplica-1ä¸èƒ½èµ·æ¥ï¼Œè¿™æ—¶å€™ä»ç„¶ä¸èƒ½é€‰å‡ºleaderï¼Œå› ä¸ºå½“è®¾ç½®unclean.leader.election.enable=falseæ—¶ï¼Œleaderåªèƒ½ä»ISRä¸­é€‰ä¸¾ï¼Œå½“ISRä¸­æ‰€æœ‰å‰¯æœ¬éƒ½å¤±æ•ˆä¹‹åï¼Œéœ€è¦ISRä¸­æœ€åå¤±æ•ˆçš„é‚£ä¸ªå‰¯æœ¬èƒ½æ¢å¤ä¹‹åæ‰èƒ½é€‰ä¸¾leader, å³replica-0å…ˆå¤±æ•ˆï¼Œreplica-1åå¤±æ•ˆï¼Œéœ€è¦replica-1æ¢å¤åæ‰èƒ½é€‰ä¸¾leaderã€‚ä¿å®ˆçš„æ–¹æ¡ˆå»ºè®®æŠŠunclean.leader.election.enableè®¾ç½®ä¸ºtrue,ä½†æ˜¯è¿™æ ·ä¼šæœ‰ä¸¢å¤±æ•°æ®çš„æƒ…å†µå‘ç”Ÿï¼Œè¿™æ ·å¯ä»¥æ¢å¤readæœåŠ¡ã€‚åŒæ ·éœ€è¦å°†min.insync.replicasè®¾ç½®ä¸º1ï¼Œæ¢å¤writeåŠŸèƒ½ï¼›</li><li>replica-1æ¢å¤ï¼Œreplica-0ä¸èƒ½æ¢å¤ï¼Œè¿™ä¸ªæƒ…å†µä¸Šé¢é‡åˆ°è¿‡ï¼ŒreadæœåŠ¡å¯ç”¨ï¼Œéœ€è¦å°†min.insync.replicasè®¾ç½®ä¸º1ï¼Œæ¢å¤writeåŠŸèƒ½ï¼›</li><li>replica-0å’Œreplica-1éƒ½ä¸èƒ½æ¢å¤ï¼Œè¿™ç§æƒ…å†µå¯ä»¥å‚è€ƒæƒ…å½¢2.</li></ul><p><strong>3. å½“ISRä¸­çš„replica-0, replica-1åŒæ—¶å®•æœº,æ­¤æ—¶[ISR=(0,1)]</strong></p><p>ä¸èƒ½å¯¹å¤–æä¾›æœåŠ¡ï¼Œæ­¤ç§æƒ…å†µæ¢å¤æ–¹æ¡ˆï¼šå°è¯•æ¢å¤replica-0å’Œreplica-1ï¼Œå½“å…¶ä¸­ä»»æ„ä¸€ä¸ªå‰¯æœ¬æ¢å¤æ­£å¸¸æ—¶ï¼Œå¯¹å¤–å¯ä»¥æä¾›readæœåŠ¡ã€‚ç›´åˆ°2ä¸ªå‰¯æœ¬æ¢å¤æ­£å¸¸ï¼ŒwriteåŠŸèƒ½æ‰èƒ½æ¢å¤ï¼Œæˆ–è€…å°†å°†min.insync.replicasè®¾ç½®ä¸º1ã€‚</p><h3 id="æ¶ˆæ¯ä¼ é€’è¯­ä¹‰" tabindex="-1"><a class="header-anchor" href="#æ¶ˆæ¯ä¼ é€’è¯­ä¹‰" aria-hidden="true">#</a> æ¶ˆæ¯ä¼ é€’è¯­ä¹‰</h3><h4 id="æ¶ˆæ¯ä¼ é€’è¯­ä¹‰-1" tabindex="-1"><a class="header-anchor" href="#æ¶ˆæ¯ä¼ é€’è¯­ä¹‰-1" aria-hidden="true">#</a> æ¶ˆæ¯ä¼ é€’è¯­ä¹‰</h4><p>æœ¬èŠ‚è®¨è®ºKafkaå¦‚ä½•ç¡®ä¿æ¶ˆæ¯åœ¨producerå’Œconsumerä¹‹é—´ä¼ è¾“ã€‚æœ‰ä»¥ä¸‹ä¸‰ç§å¯èƒ½çš„ä¼ è¾“ä¿éšœï¼ˆdelivery guaranteeï¼‰:</p><ul><li>At most once: æ¶ˆæ¯å¯èƒ½ä¼šä¸¢ï¼Œä½†ç»ä¸ä¼šé‡å¤ä¼ è¾“</li><li>At least onceï¼šæ¶ˆæ¯ç»ä¸ä¼šä¸¢ï¼Œä½†å¯èƒ½ä¼šé‡å¤ä¼ è¾“</li><li>Exactly onceï¼šæ¯æ¡æ¶ˆæ¯è‚¯å®šä¼šè¢«ä¼ è¾“ä¸€æ¬¡ä¸”ä»…ä¼ è¾“ä¸€æ¬¡</li></ul><p>è¿™ä¸ªé—®é¢˜å¯ä»¥åˆ†è§£æˆä¸¤ä¸ªé—®é¢˜ï¼š</p><ul><li>å‘é€æ¶ˆæ¯çš„æŒä¹…æ€§ä¿è¯</li><li>æ¶ˆè´¹æ¶ˆæ¯çš„ä¿è¯</li></ul><h4 id="ä»ç”Ÿäº§è€…çš„è§’åº¦æ¥è€ƒè™‘" tabindex="-1"><a class="header-anchor" href="#ä»ç”Ÿäº§è€…çš„è§’åº¦æ¥è€ƒè™‘" aria-hidden="true">#</a> ä»ç”Ÿäº§è€…çš„è§’åº¦æ¥è€ƒè™‘</h4><p>kafkaæ‰¿è¯ºï¼Œå½“å‘å¸ƒä¸€æ¡æ¶ˆæ¯æ—¶ï¼Œä¸»è¦è¯¥æ¡è¢«å“åº”ä¸ºâ€œcommittedâ€ï¼Œå¹¶ä¸”å†™å…¥äº†æ­¤æ¡æ¶ˆæ¯çš„å‰¯æœ¬åˆ†åŒºçš„ä¸€ä¸ªbrokerå­˜æ´»ï¼Œnameè¿™ä¸ªæ¶ˆæ¯å°±ä¸ä¼šä¸¢å¤±ã€‚</p><p>åœ¨0.11.0.0ç‰ˆæœ¬ä¹‹å‰ï¼Œå¦‚æœä¸€ä¸ªç”Ÿäº§è€…æ²¡æœ‰æ”¶åˆ°æ¶ˆæ¯æäº¤çš„å“åº”ï¼Œé‚£ä¹ˆåªèƒ½é‡å‘ã€‚è¿™æä¾›äº†è‡³å°‘ä¸€æ¬¡ä¼ é€’è¯­ä¹‰ã€‚å› ä¸ºå¦‚æœåŸå§‹è¯·æ±‚å®é™…ä¸ŠæˆåŠŸäº†ï¼Œåˆ™åœ¨é‡æ–°å‘é€æ—¶ï¼Œä¼šå†æ¬¡å°†æ¶ˆæ¯å†™å…¥æ—¥å¿—ã€‚è‡ª0.11.0.0ç‰ˆæœ¬èµ·ï¼Œkafkaç”Ÿäº§è€…æ”¯æŒå¹‚ç­‰ä¼ é€’é€‰é¡¹ï¼Œä¿è¯é‡æ–°å‘é€ä¸ä¼šå¯¼è‡´æ—¥å¿—ä¸­é‡å¤ã€‚brokerä¸ºæ¯ä¸ªç”Ÿäº§è€…åˆ†é…ä¸€ä¸ªidï¼Œå¹¶é€šè¿‡ç”Ÿäº§è€…å‘é€çš„åºåˆ—å·ä¸ºæ¯ä¸ªæ¶ˆæ¯è¿›è¡Œå»é‡ã€‚ä»0.11.0.0å¼€å§‹ï¼Œç”Ÿäº§è€…æ”¯æŒä½¿ç”¨ç±»ä¼¼äº‹åŠ¡çš„è¯­ä¹‰å°†æ¶ˆæ¯å‘é€åˆ°å¤šä¸ªtopicåˆ†åŒºçš„èƒ½åŠ›ã€‚å³æ‰€æœ‰æ¶ˆæ¯éƒ½è¢«æˆåŠŸå†™å…¥ï¼Œæˆ–è€…éƒ½æ²¡æœ‰å†™å…¥ã€‚è¿™ä¸ªä¸»è¦ç”¨äºå¤šä¸ªkafka topicä¹‹é—´çš„ â€œæ­£å¥½ä¸€æ¬¡â€å¤„ç†ã€‚</p><h4 id="ä»æ¶ˆè´¹è€…çš„è§’åº¦æ¥è€ƒè™‘" tabindex="-1"><a class="header-anchor" href="#ä»æ¶ˆè´¹è€…çš„è§’åº¦æ¥è€ƒè™‘" aria-hidden="true">#</a> ä»æ¶ˆè´¹è€…çš„è§’åº¦æ¥è€ƒè™‘</h4><p>æ‰€æœ‰çš„å‰¯æœ¬éƒ½æœ‰ç›¸åŒçš„æ—¥å¿—ç›¸åŒçš„åç§»é‡ã€‚æ¶ˆè´¹è€…æ§åˆ¶offsetåœ¨æ—¥å¿—ä¸­çš„ä½ç½®ã€‚å¦‚æœæ¶ˆè´¹è€…æ°¸ä¸å®•æœºå®ƒå¯èƒ½åªæ˜¯åœ¨å†…å­˜ä¸­å­˜å‚¨è¿™ä¸ªä½ç½®ï¼Œä½†æ˜¯å¦‚æœæ¶ˆè´¹è€…æ•…éšœï¼Œæˆ‘ä»¬å¸Œæœ›è¿™ä¸ªtopicåˆ†åŒºè¢«å¦ä¸€ä¸ªè¿›ç¨‹æ¥ç®¡ï¼Œæ–°è¿›ç¨‹éœ€è¦é€‰æ‹©ä¸€ä¸ªåˆé€‚çš„ä½ç½®å¼€å§‹å¤„ç†ã€‚æˆ‘ä»¬å‡è®¾æ¶ˆè´¹è€…è¯»å–äº†ä¸€äº›æ¶ˆæ¯ï¼Œå‡ ç§é€‰é¡¹ç”¨äºå¤„ç†æ¶ˆæ¯å’Œæ›´æ–°å®ƒçš„ä½ç½®ã€‚</p><ol><li>è¯»å–æ¶ˆæ¯ï¼Œç„¶ååœ¨æ—¥å¿—ä¸­ä¿å­˜å®ƒçš„ä½ç½®ï¼Œæœ€åå¤„ç†æ¶ˆæ¯ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæœ‰å¯èƒ½æ¶ˆè´¹è€…ä¿å­˜äº†ä½ç½®ä¹‹åï¼Œä½†æ˜¯å¤„ç†æ¶ˆæ¯è¾“å‡ºä¹‹å‰å´©æºƒäº†ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ¥ç®¡å¤„ç†çš„è¿›ç¨‹ä¼šåœ¨å·²ä¿å­˜çš„ä½ç½®å¼€å§‹ï¼Œå³ä½¿è¯¥ä½ç½®ä¹‹å‰æœ‰å‡ ä¸ªæ¶ˆæ¯å°šæœªå¤„ç†ã€‚è¿™å¯¹åº”äºâ€œæœ€å¤šä¸€æ¬¡â€ ï¼Œåœ¨æ¶ˆè´¹è€…å¤„ç†å¤±è´¥æ¶ˆæ¯çš„æƒ…å†µä¸‹ï¼Œä¸è¿›è¡Œå¤„ç†ã€‚</li><li>è¯»å–æ¶ˆæ¯ï¼Œå¤„ç†æ¶ˆæ¯ï¼Œæœ€åä¿å­˜æ¶ˆæ¯çš„ä½ç½®ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯èƒ½æ¶ˆè´¹è¿›ç¨‹å¤„ç†æ¶ˆæ¯ä¹‹åï¼Œä½†ä¿å­˜å®ƒçš„ä½ç½®ä¹‹å‰å´©æºƒäº†ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå½“æ–°çš„è¿›ç¨‹æ¥ç®¡äº†å®ƒï¼Œè¿™å°†æ¥æ”¶å·²ç»è¢«å¤„ç†çš„å‰å‡ ä¸ªæ¶ˆæ¯ã€‚è¿™å°±ç¬¦åˆäº†â€œè‡³å°‘ä¸€æ¬¡â€çš„è¯­ä¹‰ã€‚åœ¨å¤šæ•°æƒ…å†µä¸‹æ¶ˆæ¯æœ‰ä¸€ä¸ªä¸»é”®ï¼Œä»¥ä¾¿æ›´æ–°å¹‚ç­‰ï¼ˆå…¶ä»»æ„å¤šæ¬¡æ‰§è¡Œæ‰€äº§ç”Ÿçš„å½±å“å‡ä¸ä¸€æ¬¡æ‰§è¡Œçš„å½±å“ç›¸åŒï¼‰ã€‚</li></ol><p>é‚£ä¹ˆä»€ä¹ˆæ˜¯â€œæ­£å¥½ä¸€æ¬¡â€è¯­ä¹‰ï¼ˆä¹Ÿå°±æ˜¯ä½ çœŸæ­£æƒ³è¦çš„ä¸œè¥¿ï¼‰? å½“ä»Kafkaä¸»é¢˜æ¶ˆè´¹å¹¶ç”Ÿäº§åˆ°å¦ä¸€ä¸ªtopicæ—¶ï¼ˆä¾‹å¦‚Kafka Streamï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ä¹‹å‰æåˆ°0.11.0.0ä¸­çš„ç”Ÿäº§è€…æ–°äº‹åŠ¡åŠŸèƒ½ã€‚æ¶ˆè´¹è€…çš„ä½ç½®ä½œä¸ºæ¶ˆæ¯å­˜å‚¨åˆ°topicä¸­ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ä¸æ¥æ”¶å¤„ç†åçš„æ•°æ®çš„è¾“å‡ºtopicä½¿ç”¨ç›¸åŒçš„äº‹åŠ¡å†™å…¥offsetåˆ°Kafkaã€‚å¦‚æœäº‹åŠ¡ä¸­æ–­ï¼Œåˆ™æ¶ˆè´¹è€…çš„ä½ç½®å°†æ¢å¤åˆ°è€çš„å€¼ï¼Œæ ¹æ®å…¶â€éš”ç¦»çº§åˆ«â€œï¼Œå…¶ä»–æ¶ˆè´¹è€…å°†ä¸ä¼šçœ‹åˆ°è¾“å‡ºtopicçš„ç”Ÿæˆæ•°æ®ï¼Œåœ¨é»˜è®¤çš„â€è¯»å–æœªæäº¤â€œéš”ç¦»çº§åˆ«ä¸­ï¼Œæ‰€æœ‰æ¶ˆæ¯å¯¹æ¶ˆè´¹è€…éƒ½æ˜¯å¯è§çš„ï¼Œå³ä½¿æ˜¯è¢«ä¸­æ–­çš„äº‹åŠ¡çš„æ¶ˆæ¯ã€‚ä½†æ˜¯åœ¨â€è¯»å–æäº¤â€œä¸­ï¼Œæ¶ˆè´¹è€…å°†åªä»å·²æäº¤çš„äº‹åŠ¡ä¸­è¿”å›æ¶ˆæ¯ã€‚</p><p>å½“å†™å…¥åˆ°å¤–éƒ¨ç³»ç»Ÿæ—¶ï¼Œéœ€è¦å°†æ¶ˆè´¹è€…çš„ä½ç½®ä¸å®é™…å­˜å‚¨ä¸ºè¾“å‡ºçš„ä½ç½®è¿›è¡Œåè°ƒã€‚å®ç°è¿™ä¸€ç›®æ ‡çš„å…¸å‹æ–¹æ³•æ˜¯åœ¨æ¶ˆè´¹è€…ä½ç½®çš„å­˜å‚¨å’Œæ¶ˆè´¹è€…è¾“å‡ºçš„å­˜å‚¨ä¹‹é—´å¼•å…¥ä¸¤é˜¶æ®µçš„â€æäº¤â€œã€‚ä½†æ˜¯ï¼Œè¿™å¯ä»¥æ›´ç®€å•ï¼Œé€šè¿‡è®©æ¶ˆè´¹è€…å°†å…¶offsetå­˜å‚¨åœ¨ä¸å…¶è¾“å‡ºç›¸åŒçš„ä½ç½®ã€‚è¿™æ ·æœ€å¥½ï¼Œå› ä¸ºå¤§å¤šæ•°çš„è¾“å‡ºç³»ç»Ÿä¸æ”¯æŒä¸¤é˜¶æ®µâ€æäº¤â€œã€‚ä½œä¸ºä¸€ä¸ªä¾‹å­ï¼Œè€ƒè™‘ä¸€ä¸ªKafka Connectè¿æ¥å™¨ï¼Œå®ƒå¡«å……HDFSä¸­çš„æ•°æ®ä»¥åŠå®ƒè¯»å–çš„æ•°æ®çš„offsetï¼Œä»¥ä¿è¯æ•°æ®å’Œoffsetéƒ½è¢«æ›´æ–°ï¼Œæˆ–è€…éƒ½ä¸æ›´æ–°ã€‚ å¯¹äºéœ€è¦è¿™äº›æ›´å¼ºå¤§è¯­ä¹‰çš„è®¸å¤šå…¶ä»–æ•°æ®ç³»ç»Ÿï¼Œæˆ‘ä»¬éµå¾ªç±»ä¼¼çš„æ¨¡å¼ï¼Œå¹¶ä¸”æ¶ˆæ¯ä¸å…·æœ‰å…è®¸é‡å¤æ•°æ®åˆ é™¤çš„ä¸»é”®ã€‚</p><p>kafkaé»˜è®¤æ˜¯ä¿è¯â€œè‡³å°‘ä¸€æ¬¡â€ä¼ é€’ï¼Œå¹¶å…è®¸ç”¨æˆ·é€šè¿‡ç¦æ­¢ç”Ÿäº§è€…é‡è¯•å’Œå¤„ç†ä¸€æ‰¹æ¶ˆæ¯å‰æäº¤å®ƒçš„åç§»é‡æ¥å®ç° â€œæœ€å¤šä¸€æ¬¡â€ä¼ é€’ã€‚è€Œâ€œæ­£å¥½ä¸€æ¬¡â€ä¼ é€’éœ€è¦ä¸ç›®æ ‡å­˜å‚¨ç³»ç»Ÿåˆä½œï¼Œä½†kafkaæä¾›äº†åç§»é‡ï¼Œæ‰€ä»¥å®ç°è¿™ä¸ªå¾ˆç®€å•ã€‚</p><h3 id="kafkaé›†ç¾¤partitions-replicasé»˜è®¤åˆ†é…è§£æ" tabindex="-1"><a class="header-anchor" href="#kafkaé›†ç¾¤partitions-replicasé»˜è®¤åˆ†é…è§£æ" aria-hidden="true">#</a> Kafkaé›†ç¾¤partitions/replicasé»˜è®¤åˆ†é…è§£æ</h3><p>TODO</p><p>https://www.cnblogs.com/aidodoo/p/8888710.html</p><h3 id="kafkaçš„ç®€å•å®‰è£…" tabindex="-1"><a class="header-anchor" href="#kafkaçš„ç®€å•å®‰è£…" aria-hidden="true">#</a> Kafkaçš„ç®€å•å®‰è£…</h3><h4 id="ä½¿ç”¨zkæ¨¡å¼çš„å®‰è£…" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨zkæ¨¡å¼çš„å®‰è£…" aria-hidden="true">#</a> ä½¿ç”¨ZKæ¨¡å¼çš„å®‰è£…</h4><h5 id="step-1-ä¸‹è½½ä»£ç " tabindex="-1"><a class="header-anchor" href="#step-1-ä¸‹è½½ä»£ç " aria-hidden="true">#</a> Step 1ï¼š ä¸‹è½½ä»£ç </h5><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>&gt; tar -xzf kafka_2.13-3.1.0.tgz
&gt; cd kafka_2.13-3.1.0
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="step-2-å¯åŠ¨æœåŠ¡" tabindex="-1"><a class="header-anchor" href="#step-2-å¯åŠ¨æœåŠ¡" aria-hidden="true">#</a> Step 2 ï¼š å¯åŠ¨æœåŠ¡</h5><p>è¿è¡Œkafkaéœ€è¦ä½¿ç”¨Zookeeperï¼Œæ‰€ä»¥ä½ éœ€è¦å…ˆå¯åŠ¨Zookeeperï¼Œå¦‚æœä½ æ²¡æœ‰Zookeeperï¼Œä½ å¯ä»¥ä½¿ç”¨kafkaè‡ªå¸¦æ‰“åŒ…å’Œé…ç½®å¥½çš„Zookeeperã€‚</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># æ³¨æ„ï¼šApache Kafka2.8ç‰ˆæœ¬ä¹‹åå¯ä»¥ä¸éœ€è¦ä½¿ç”¨ZooKeeperï¼Œå†…æµ‹ä¸­ï¼Œæ–‡ç« æœ«å°¾æœ‰ä½“éªŒçš„å®‰è£…æ–¹å¼ã€‚
&gt; bin/zookeeper-server-start.sh config/zookeeper.properties
...
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ‰“å¼€å¦ä¸€ä¸ªå‘½ä»¤ç»ˆç«¯å¯åŠ¨kafkaæœåŠ¡ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>&gt; bin/kafka-server-start.sh config/server.properties &amp;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å…¶ä»–æ­¥éª¤å‚è§raftæ–¹å¼</p><h4 id="ä½¿ç”¨raftæ¨¡å¼å®‰è£…" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨raftæ¨¡å¼å®‰è£…" aria-hidden="true">#</a> ä½¿ç”¨raftæ¨¡å¼å®‰è£…</h4><p>kafkaä»2.8ç‰ˆæœ¬å¼€å§‹æ”¯æŒRaftæ¨¡å¼ã€‚soï¼Œè¿™é‡Œéœ€è¦ä¸‹è½½2.8ä»¥åçš„ç‰ˆæœ¬ã€‚è¿™é‡Œé‡‡ç”¨å•æœºæ¨¡å¼å®‰è£…ï¼Œä¸»è¦æ˜¯ä¸ºäº†å­¦ä¹ ä½¿ç”¨</p><p>æ³¨æ„ï¼š windowsä¸‹å®‰è£…æœ‰å¾ˆå¤šå‘ï¼Œè¿™é‡Œæœ€å¥½ç›´æ¥ç”¨linuxå®‰è£…ã€‚</p><p>(æœ‰å‘ï¼Œé‡å¯çš„æ—¶å€™ä¼šæŠ¥é”™)</p><h5 id="step-1-ä¸‹è½½ä»£ç -1" tabindex="-1"><a class="header-anchor" href="#step-1-ä¸‹è½½ä»£ç -1" aria-hidden="true">#</a> Step 1ï¼š ä¸‹è½½ä»£ç </h5><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>tar -xzf kafka_2.13-3.0.0.tgz
cd kafka_2.13-3.0.0
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="step-2-ç”Ÿæˆé›†ç¾¤id-å¹¶æ ¼å¼åŒ–å­˜å‚¨ç›®å½•" tabindex="-1"><a class="header-anchor" href="#step-2-ç”Ÿæˆé›†ç¾¤id-å¹¶æ ¼å¼åŒ–å­˜å‚¨ç›®å½•" aria-hidden="true">#</a> Step 2ï¼š ç”Ÿæˆé›†ç¾¤idï¼Œå¹¶æ ¼å¼åŒ–å­˜å‚¨ç›®å½•</h5><p>ç”Ÿæˆé›†ç¾¤ID</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>bin/kafka-storage.sh random-uuid
Cba3BkapTFWyEKbpUkNJ_w <span class="token comment">#è·å–è¿”å›çš„é›†ç¾¤ID</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>æ ¼å¼åŒ–å­˜å‚¨ç›®å½•</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token operator">&gt;</span> bin/kafka-storage.sh <span class="token function">format</span> <span class="token parameter variable">-t</span> Cba3BkapTFWyEKbpUkNJ_w <span class="token parameter variable">-c</span> config/kraft/server.properties
Formatting /tmp/kraft-combined-logs <span class="token comment"># è¾“å‡º</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="step-3-å¯åŠ¨æœåŠ¡" tabindex="-1"><a class="header-anchor" href="#step-3-å¯åŠ¨æœåŠ¡" aria-hidden="true">#</a> Step 3ï¼š å¯åŠ¨æœåŠ¡</h5><p>æ³¨æ„ï¼š æœ¬åœ°éœ€è¦æå‰é…ç½®å¥½Java 9 +çš„ç¯å¢ƒ</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>bin/kafka-server-start.sh config/kraft/server.properties
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h5 id="step-4-åˆ›å»ºä¸€ä¸ªä¸»é¢˜-topic" tabindex="-1"><a class="header-anchor" href="#step-4-åˆ›å»ºä¸€ä¸ªä¸»é¢˜-topic" aria-hidden="true">#</a> Step 4 ï¼š åˆ›å»ºä¸€ä¸ªä¸»é¢˜(topic)</h5><p>åˆ›å»ºä¸€ä¸ªåä¸ºâ€œtestâ€çš„Topicï¼Œåªæœ‰ä¸€ä¸ªåˆ†åŒºå’Œä¸€ä¸ªå¤‡ä»½ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>bin/kafka-topics.sh --create --bootstrap-server localhost:9092 --replication-factor 1 --partitions 1 --topic test
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>åˆ›å»ºå¥½ä¹‹åï¼Œå¯ä»¥é€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼ŒæŸ¥çœ‹å·²åˆ›å»ºçš„topicä¿¡æ¯ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token operator">&gt;</span> bin/kafka-topics.sh <span class="token parameter variable">--describe</span> <span class="token parameter variable">--topic</span> <span class="token builtin class-name">test</span> --bootstrap-server localhost:9092
Topic:test  PartitionCount:1    ReplicationFactor:1 Configs:
Topic: <span class="token builtin class-name">test</span> Partition: <span class="token number">0</span>    Leader: <span class="token number">0</span>   Replicas: <span class="token number">0</span> Isr: <span class="token number">0</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆ–è€…ï¼Œé™¤äº†æ‰‹å·¥åˆ›å»ºtopicå¤–ï¼Œä½ ä¹Ÿå¯ä»¥é…ç½®ä½ çš„brokerï¼Œå½“å‘å¸ƒä¸€ä¸ªä¸å­˜åœ¨çš„topicæ—¶è‡ªåŠ¨åˆ›å»ºtopicï¼Œç‚¹å‡»è¿™é‡ŒæŸ¥çœ‹å¦‚ä½•é…ç½®<a href="https://www.orchome.com/10428" target="_blank" rel="noopener noreferrer">è‡ªåŠ¨åˆ›å»ºtopicæ—¶è®¾ç½®é»˜è®¤çš„åˆ†åŒºå’Œå‰¯æœ¬æ•°<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ã€‚</p><h5 id="step-5-å‘é€æ¶ˆæ¯" tabindex="-1"><a class="header-anchor" href="#step-5-å‘é€æ¶ˆæ¯" aria-hidden="true">#</a> Step 5 : å‘é€æ¶ˆæ¯</h5><p>Kafkaæä¾›äº†ä¸€ä¸ªå‘½ä»¤è¡Œçš„å·¥å…·ï¼Œå¯ä»¥ä»è¾“å…¥æ–‡ä»¶æˆ–è€…å‘½ä»¤è¡Œä¸­è¯»å–æ¶ˆæ¯å¹¶å‘é€ç»™Kafkaé›†ç¾¤ã€‚æ¯ä¸€è¡Œæ˜¯ä¸€æ¡æ¶ˆæ¯ã€‚</p><p>è¿è¡Œ <code>producerï¼ˆç”Ÿäº§è€…ï¼‰</code>,ç„¶ååœ¨æ§åˆ¶å°è¾“å…¥å‡ æ¡æ¶ˆæ¯åˆ°æœåŠ¡å™¨ã€‚</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token operator">&gt;</span> bin/kafka-console-producer.sh --broker-list localhost:9092 <span class="token parameter variable">--topic</span> <span class="token builtin class-name">test</span>
This is a message
This is another message
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="step-6-æ¶ˆè´¹æ¶ˆæ¯" tabindex="-1"><a class="header-anchor" href="#step-6-æ¶ˆè´¹æ¶ˆæ¯" aria-hidden="true">#</a> Step 6: æ¶ˆè´¹æ¶ˆæ¯</h5><p>Kafkaä¹Ÿæä¾›äº†ä¸€ä¸ªæ¶ˆè´¹æ¶ˆæ¯çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œå°†å­˜å‚¨çš„ä¿¡æ¯è¾“å‡ºå‡ºæ¥ï¼Œæ–°æ‰“å¼€ä¸€ä¸ªå‘½ä»¤æ§åˆ¶å°ï¼Œè¾“å…¥ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token operator">&gt;</span> bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 <span class="token parameter variable">--topic</span> <span class="token builtin class-name">test</span> --from-beginning <span class="token parameter variable">--consumer.config</span> config/consumer.properties
This is a message
This is another message
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="kafkaé…ç½®æ–‡ä»¶æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#kafkaé…ç½®æ–‡ä»¶æ€»ç»“" aria-hidden="true">#</a> Kafkaé…ç½®æ–‡ä»¶æ€»ç»“</h3><p>TODO</p></div><!----><footer class="page-meta"><!----><div class="meta-item git-info"><div class="update-time"><span class="label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><!----></div><div class="contributors"><span class="label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="contributor" title="email: 895252461@qq.com">è¯—äººéƒ½è—åœ¨æ°´åº•</span><!--]--><!--]--></div></div></footer><!----><!----><!----><!--]--></main><!--]--><!----></div><!--]--><!--]--><!----><!--]--></div>
    <script type="module" src="/assets/app-9aa256ea.js" defer></script>
  </body>
</html>
