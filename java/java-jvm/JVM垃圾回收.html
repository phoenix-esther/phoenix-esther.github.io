<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.59" />
    <meta name="theme" content="VuePress Theme Hope" />
    <title>åƒåœ¾å›æ”¶ | Java æˆç¥ä¹‹è·¯</title><meta name="description" content="è¿™æ˜¯æˆ‘çš„ç¬¬ä¸€ä¸ª VuePress ç«™ç‚¹">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d2025;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/assets/style-f1658162.css" as="style"><link rel="stylesheet" href="/assets/style-f1658162.css">
    <link rel="modulepreload" href="/assets/app-0de2ad7c.js"><link rel="modulepreload" href="/assets/framework-5dde3bca.js"><link rel="modulepreload" href="/assets/JVMåƒåœ¾å›æ”¶.html-304d9a2d.js"><link rel="modulepreload" href="/assets/JVMåƒåœ¾å›æ”¶.html-852577fd.js"><link rel="prefetch" href="/assets/index.html-95370337.js" as="script"><link rel="prefetch" href="/assets/database-overview.html-03717758.js" as="script"><link rel="prefetch" href="/assets/java-overview.html-44310673.js" as="script"><link rel="prefetch" href="/assets/middleware-overview.html-be4fdd51.js" as="script"><link rel="prefetch" href="/assets/quality-overview.html-a8e9bda4.js" as="script"><link rel="prefetch" href="/assets/spring-cloud-overview.html-87409649.js" as="script"><link rel="prefetch" href="/assets/gitbook.html-fb8a8229.js" as="script"><link rel="prefetch" href="/assets/tools-overview.html-67f69dba.js" as="script"><link rel="prefetch" href="/assets/mongo.html-50bc6f68.js" as="script"><link rel="prefetch" href="/assets/mysql-advance.html-e06a1ce2.js" as="script"><link rel="prefetch" href="/assets/mysql-apply.html-a6b2d1c2.js" as="script"><link rel="prefetch" href="/assets/mysql-base.html-d91fdb11.js" as="script"><link rel="prefetch" href="/assets/mysql-devops.html-0b9fc6f6.js" as="script"><link rel="prefetch" href="/assets/redis-base.html-fbc05584.js" as="script"><link rel="prefetch" href="/assets/redis-cluster.html-07744daf.js" as="script"><link rel="prefetch" href="/assets/redis-overview.html-1bcd1133.js" as="script"><link rel="prefetch" href="/assets/java-base.html-7071cb31.js" as="script"><link rel="prefetch" href="/assets/java-sql.html-c8be449f.js" as="script"><link rel="prefetch" href="/assets/java-time.html-2c855f9e.js" as="script"><link rel="prefetch" href="/assets/java-collection-list.html-2207ee3a.js" as="script"><link rel="prefetch" href="/assets/java-collection-map.html-d30b93e7.js" as="script"><link rel="prefetch" href="/assets/java-concurrent-base.html-8983a76d.js" as="script"><link rel="prefetch" href="/assets/Java-concurrent-container.html-3334407b.js" as="script"><link rel="prefetch" href="/assets/java-concurrent-interview.html-bbc0a621.js" as="script"><link rel="prefetch" href="/assets/java-concurrent-lock.html-ebf0a63c.js" as="script"><link rel="prefetch" href="/assets/java-concurrent-pool.html-7a290f95.js" as="script"><link rel="prefetch" href="/assets/java-concurrent-tools.html-01a740a1.js" as="script"><link rel="prefetch" href="/assets/java-bio.html-ceca2a90.js" as="script"><link rel="prefetch" href="/assets/java-io-base.html-40d5757f.js" as="script"><link rel="prefetch" href="/assets/java-nio.html-b002c449.js" as="script"><link rel="prefetch" href="/assets/Javaå†…å­˜æ¨¡å‹.html-13f8a203.js" as="script"><link rel="prefetch" href="/assets/JVMå†…å­˜ç»“æ„.html-fb577c69.js" as="script"><link rel="prefetch" href="/assets/JVMæ¦‚è§ˆ.html-eda595c7.js" as="script"><link rel="prefetch" href="/assets/JVMç±»åŠ è½½å™¨.html-ee6c0eb8.js" as="script"><link rel="prefetch" href="/assets/JVMç±»æ–‡ä»¶ç»“æ„.html-6aca785b.js" as="script"><link rel="prefetch" href="/assets/JVMè°ƒä¼˜.html-ad63cd2e.js" as="script"><link rel="prefetch" href="/assets/java-servlet.html-ef72b065.js" as="script"><link rel="prefetch" href="/assets/java-lambda.html-c21b5e3b.js" as="script"><link rel="prefetch" href="/assets/java-stream.html-797890ef.js" as="script"><link rel="prefetch" href="/assets/HikariCP-base.html-89b6d274.js" as="script"><link rel="prefetch" href="/assets/HikariCP-source.html-71542b59.js" as="script"><link rel="prefetch" href="/assets/jackson-overview.html-58553b4c.js" as="script"><link rel="prefetch" href="/assets/kafka-broker.html-8091a112.js" as="script"><link rel="prefetch" href="/assets/kafka-consumer.html-f5b2d049.js" as="script"><link rel="prefetch" href="/assets/kafka-old.html-1448d038.js" as="script"><link rel="prefetch" href="/assets/kafka-overview.html-8dd9a49b.js" as="script"><link rel="prefetch" href="/assets/kafka-producer.html-5dc9b65d.js" as="script"><link rel="prefetch" href="/assets/spring-kafka.html-bc75ec45.js" as="script"><link rel="prefetch" href="/assets/log-framework.html-76a57287.js" as="script"><link rel="prefetch" href="/assets/1.Hello World.html-b2ffe65b.js" as="script"><link rel="prefetch" href="/assets/2.Global Config.html-6a02822f.js" as="script"><link rel="prefetch" href="/assets/index.html-f37393b8.js" as="script"><link rel="prefetch" href="/assets/nginx.html-94f097bd.js" as="script"><link rel="prefetch" href="/assets/sharding-sphere.html-47e07fb1.js" as="script"><link rel="prefetch" href="/assets/shiro-overview.html-66b81094.js" as="script"><link rel="prefetch" href="/assets/data-structure-list.html-5ba0105d.js" as="script"><link rel="prefetch" href="/assets/data-structure-overview.html-85d0b05a.js" as="script"><link rel="prefetch" href="/assets/data-structure-tree.html-b7a2b7b5.js" as="script"><link rel="prefetch" href="/assets/tomcat.html-63e9b96e.js" as="script"><link rel="prefetch" href="/assets/design-adapter.html-ca7d4d0c.js" as="script"><link rel="prefetch" href="/assets/design-bridge.html-f70c2b16.js" as="script"><link rel="prefetch" href="/assets/design-builder.html-8d44b4e2.js" as="script"><link rel="prefetch" href="/assets/design-chain.html-73c4f586.js" as="script"><link rel="prefetch" href="/assets/design-command.html-d6dfccee.js" as="script"><link rel="prefetch" href="/assets/design-composite.html-756fd116.js" as="script"><link rel="prefetch" href="/assets/design-decorator.html-826f2e24.js" as="script"><link rel="prefetch" href="/assets/design-facade.html-c448fc15.js" as="script"><link rel="prefetch" href="/assets/design-factory.html-902a65a0.js" as="script"><link rel="prefetch" href="/assets/design-flyweight.html-4459624e.js" as="script"><link rel="prefetch" href="/assets/design-interpreter.html-c630c412.js" as="script"><link rel="prefetch" href="/assets/design-iterator.html-ab1b6e0a.js" as="script"><link rel="prefetch" href="/assets/design-mediator.html-0a45de36.js" as="script"><link rel="prefetch" href="/assets/design-memento.html-4208519d.js" as="script"><link rel="prefetch" href="/assets/design-observer.html-7d34acf8.js" as="script"><link rel="prefetch" href="/assets/design-overview.html-8ae1eaca.js" as="script"><link rel="prefetch" href="/assets/design-prototype.html-843f1ba1.js" as="script"><link rel="prefetch" href="/assets/design-proxy.html-b51e83f1.js" as="script"><link rel="prefetch" href="/assets/design-singleton.html-cb4b0e72.js" as="script"><link rel="prefetch" href="/assets/design-state.html-514399be.js" as="script"><link rel="prefetch" href="/assets/design-strategy.html-586d3ac2.js" as="script"><link rel="prefetch" href="/assets/design-template.html-12aa47cf.js" as="script"><link rel="prefetch" href="/assets/design-visitor.html-ed58259a.js" as="script"><link rel="prefetch" href="/assets/æ»‘åŠ¨çª—å£.html-d4efa51b.js" as="script"><link rel="prefetch" href="/assets/linux-overview.html-f8205a0e.js" as="script"><link rel="prefetch" href="/assets/encoding.html-bb7cac1e.js" as="script"><link rel="prefetch" href="/assets/encryption-algorithm.html-47d69cef.js" as="script"><link rel="prefetch" href="/assets/temp.html-60b41fd7.js" as="script"><link rel="prefetch" href="/assets/spring-source-overview.html-3ac2c8f4.js" as="script"><link rel="prefetch" href="/assets/BeanPostProcessor-base.html-9b47aa32.js" as="script"><link rel="prefetch" href="/assets/BeanPostProcessor-ConfigurationClassPostProcessor.html-d4e7a5e5.js" as="script"><link rel="prefetch" href="/assets/spring-boot-condition.html-f38f1a16.js" as="script"><link rel="prefetch" href="/assets/spring-cloud-commons-base.html-b68d3933.js" as="script"><link rel="prefetch" href="/assets/spring-cloud-loadbalancer.html-182fff59.js" as="script"><link rel="prefetch" href="/assets/spring-cloud-gateway.html-b56fde18.js" as="script"><link rel="prefetch" href="/assets/nacos-client-discovery.html-050d84e4.js" as="script"><link rel="prefetch" href="/assets/nacos-overview.html-755394c0.js" as="script"><link rel="prefetch" href="/assets/cloud-openfeign-action.html-6173210d.js" as="script"><link rel="prefetch" href="/assets/spring-cloud-openfeign.html-46fdc141.js" as="script"><link rel="prefetch" href="/assets/spring-cloud-ribbon.html-2f5d4e70.js" as="script"><link rel="prefetch" href="/assets/sentinel-source.html-db79abe0.js" as="script"><link rel="prefetch" href="/assets/spring-cloud-sentinel.html-031a7566.js" as="script"><link rel="prefetch" href="/assets/spring-cloud-alibaba-seate.html-90df4bc0.js" as="script"><link rel="prefetch" href="/assets/git.html-f3d86d29.js" as="script"><link rel="prefetch" href="/assets/gitlab.html-ee616321.js" as="script"><link rel="prefetch" href="/assets/junit4.html-7674a247.js" as="script"><link rel="prefetch" href="/assets/junit5.html-1088960a.js" as="script"><link rel="prefetch" href="/assets/maven.html-c5f718a8.js" as="script"><link rel="prefetch" href="/assets/reactor.html-b7f3a608.js" as="script"><link rel="prefetch" href="/assets/spring-source-web-init.html-76aa84f3.js" as="script"><link rel="prefetch" href="/assets/spring-source-web-listener.html-8020b96c.js" as="script"><link rel="prefetch" href="/assets/404.html-f04ced3e.js" as="script"><link rel="prefetch" href="/assets/index.html-33e4c2a2.js" as="script"><link rel="prefetch" href="/assets/index.html-8ad96e03.js" as="script"><link rel="prefetch" href="/assets/index.html-b23d2171.js" as="script"><link rel="prefetch" href="/assets/index.html-8a709d0c.js" as="script"><link rel="prefetch" href="/assets/index.html-9488715d.js" as="script"><link rel="prefetch" href="/assets/index.html-fb3dd3ef.js" as="script"><link rel="prefetch" href="/assets/index.html-42d88d20.js" as="script"><link rel="prefetch" href="/assets/index.html-87f3d90a.js" as="script"><link rel="prefetch" href="/assets/index.html-4e6c2eaf.js" as="script"><link rel="prefetch" href="/assets/index.html-df28bb11.js" as="script"><link rel="prefetch" href="/assets/index.html-78d325c5.js" as="script"><link rel="prefetch" href="/assets/index.html-0c05d7f0.js" as="script"><link rel="prefetch" href="/assets/database-overview.html-8e20b9c4.js" as="script"><link rel="prefetch" href="/assets/java-overview.html-110664f3.js" as="script"><link rel="prefetch" href="/assets/middleware-overview.html-23551371.js" as="script"><link rel="prefetch" href="/assets/quality-overview.html-c678a80a.js" as="script"><link rel="prefetch" href="/assets/spring-cloud-overview.html-4f455e53.js" as="script"><link rel="prefetch" href="/assets/gitbook.html-82c9e715.js" as="script"><link rel="prefetch" href="/assets/tools-overview.html-ef94410e.js" as="script"><link rel="prefetch" href="/assets/mongo.html-b49ed607.js" as="script"><link rel="prefetch" href="/assets/mysql-advance.html-04da5f50.js" as="script"><link rel="prefetch" href="/assets/mysql-apply.html-93145a97.js" as="script"><link rel="prefetch" href="/assets/mysql-base.html-d6966f7f.js" as="script"><link rel="prefetch" href="/assets/mysql-devops.html-6b9ccca1.js" as="script"><link rel="prefetch" href="/assets/redis-base.html-2d4d81f6.js" as="script"><link rel="prefetch" href="/assets/redis-cluster.html-dd1dc967.js" as="script"><link rel="prefetch" href="/assets/redis-overview.html-7f2546f3.js" as="script"><link rel="prefetch" href="/assets/java-base.html-2a2487a8.js" as="script"><link rel="prefetch" href="/assets/java-sql.html-3235fb3f.js" as="script"><link rel="prefetch" href="/assets/java-time.html-c6bd518b.js" as="script"><link rel="prefetch" href="/assets/java-collection-list.html-1f5f5479.js" as="script"><link rel="prefetch" href="/assets/java-collection-map.html-9eaf3f79.js" as="script"><link rel="prefetch" href="/assets/java-concurrent-base.html-ae299cb8.js" as="script"><link rel="prefetch" href="/assets/Java-concurrent-container.html-ebd6fec8.js" as="script"><link rel="prefetch" href="/assets/java-concurrent-interview.html-07fbfa4a.js" as="script"><link rel="prefetch" href="/assets/java-concurrent-lock.html-994ad73f.js" as="script"><link rel="prefetch" href="/assets/java-concurrent-pool.html-ed4a1de5.js" as="script"><link rel="prefetch" href="/assets/java-concurrent-tools.html-8880da92.js" as="script"><link rel="prefetch" href="/assets/java-bio.html-df6fc911.js" as="script"><link rel="prefetch" href="/assets/java-io-base.html-77f89736.js" as="script"><link rel="prefetch" href="/assets/java-nio.html-bcccb204.js" as="script"><link rel="prefetch" href="/assets/Javaå†…å­˜æ¨¡å‹.html-7383b9cd.js" as="script"><link rel="prefetch" href="/assets/JVMå†…å­˜ç»“æ„.html-8d99ddf3.js" as="script"><link rel="prefetch" href="/assets/JVMæ¦‚è§ˆ.html-8bd4b42f.js" as="script"><link rel="prefetch" href="/assets/JVMç±»åŠ è½½å™¨.html-77d4aeac.js" as="script"><link rel="prefetch" href="/assets/JVMç±»æ–‡ä»¶ç»“æ„.html-9a5ae840.js" as="script"><link rel="prefetch" href="/assets/JVMè°ƒä¼˜.html-abf07289.js" as="script"><link rel="prefetch" href="/assets/java-servlet.html-8537acfe.js" as="script"><link rel="prefetch" href="/assets/java-lambda.html-e158a557.js" as="script"><link rel="prefetch" href="/assets/java-stream.html-ad9eb0ed.js" as="script"><link rel="prefetch" href="/assets/HikariCP-base.html-f749e904.js" as="script"><link rel="prefetch" href="/assets/HikariCP-source.html-4651cd3f.js" as="script"><link rel="prefetch" href="/assets/jackson-overview.html-1ff735d9.js" as="script"><link rel="prefetch" href="/assets/kafka-broker.html-78790cd6.js" as="script"><link rel="prefetch" href="/assets/kafka-consumer.html-3872d15c.js" as="script"><link rel="prefetch" href="/assets/kafka-old.html-4a95df91.js" as="script"><link rel="prefetch" href="/assets/kafka-overview.html-03135409.js" as="script"><link rel="prefetch" href="/assets/kafka-producer.html-f9cc0e5f.js" as="script"><link rel="prefetch" href="/assets/spring-kafka.html-0eaac2b9.js" as="script"><link rel="prefetch" href="/assets/log-framework.html-13f8b728.js" as="script"><link rel="prefetch" href="/assets/1.Hello World.html-254e923d.js" as="script"><link rel="prefetch" href="/assets/2.Global Config.html-34377212.js" as="script"><link rel="prefetch" href="/assets/index.html-6f5477e7.js" as="script"><link rel="prefetch" href="/assets/nginx.html-64c0a015.js" as="script"><link rel="prefetch" href="/assets/sharding-sphere.html-bb3296bb.js" as="script"><link rel="prefetch" href="/assets/shiro-overview.html-f4bdb923.js" as="script"><link rel="prefetch" href="/assets/data-structure-list.html-0f23b38b.js" as="script"><link rel="prefetch" href="/assets/data-structure-overview.html-f1e03c1d.js" as="script"><link rel="prefetch" href="/assets/data-structure-tree.html-a44ba30f.js" as="script"><link rel="prefetch" href="/assets/tomcat.html-107f9ebe.js" as="script"><link rel="prefetch" href="/assets/design-adapter.html-77286312.js" as="script"><link rel="prefetch" href="/assets/design-bridge.html-00672c18.js" as="script"><link rel="prefetch" href="/assets/design-builder.html-27d852c8.js" as="script"><link rel="prefetch" href="/assets/design-chain.html-74047f74.js" as="script"><link rel="prefetch" href="/assets/design-command.html-943a7340.js" as="script"><link rel="prefetch" href="/assets/design-composite.html-463bbe40.js" as="script"><link rel="prefetch" href="/assets/design-decorator.html-34575490.js" as="script"><link rel="prefetch" href="/assets/design-facade.html-6a642241.js" as="script"><link rel="prefetch" href="/assets/design-factory.html-558c3336.js" as="script"><link rel="prefetch" href="/assets/design-flyweight.html-9a7105fb.js" as="script"><link rel="prefetch" href="/assets/design-interpreter.html-19cea0ae.js" as="script"><link rel="prefetch" href="/assets/design-iterator.html-55db2bf3.js" as="script"><link rel="prefetch" href="/assets/design-mediator.html-a639304c.js" as="script"><link rel="prefetch" href="/assets/design-memento.html-6453f1e1.js" as="script"><link rel="prefetch" href="/assets/design-observer.html-ed658ad7.js" as="script"><link rel="prefetch" href="/assets/design-overview.html-03776800.js" as="script"><link rel="prefetch" href="/assets/design-prototype.html-8fdfdb40.js" as="script"><link rel="prefetch" href="/assets/design-proxy.html-d9e3ef89.js" as="script"><link rel="prefetch" href="/assets/design-singleton.html-8c4de69b.js" as="script"><link rel="prefetch" href="/assets/design-state.html-aeddd299.js" as="script"><link rel="prefetch" href="/assets/design-strategy.html-79c37426.js" as="script"><link rel="prefetch" href="/assets/design-template.html-61d102d5.js" as="script"><link rel="prefetch" href="/assets/design-visitor.html-fefdc2c4.js" as="script"><link rel="prefetch" href="/assets/æ»‘åŠ¨çª—å£.html-a5cf52bf.js" as="script"><link rel="prefetch" href="/assets/linux-overview.html-4c5f0a4a.js" as="script"><link rel="prefetch" href="/assets/encoding.html-f5906218.js" as="script"><link rel="prefetch" href="/assets/encryption-algorithm.html-9a1f16a2.js" as="script"><link rel="prefetch" href="/assets/temp.html-bc9bd901.js" as="script"><link rel="prefetch" href="/assets/spring-source-overview.html-11cf77bb.js" as="script"><link rel="prefetch" href="/assets/BeanPostProcessor-base.html-f1d5d10e.js" as="script"><link rel="prefetch" href="/assets/BeanPostProcessor-ConfigurationClassPostProcessor.html-a96eba50.js" as="script"><link rel="prefetch" href="/assets/spring-boot-condition.html-925c1f11.js" as="script"><link rel="prefetch" href="/assets/spring-cloud-commons-base.html-08854838.js" as="script"><link rel="prefetch" href="/assets/spring-cloud-loadbalancer.html-6f95c5b7.js" as="script"><link rel="prefetch" href="/assets/spring-cloud-gateway.html-3b5bcf8b.js" as="script"><link rel="prefetch" href="/assets/nacos-client-discovery.html-79247510.js" as="script"><link rel="prefetch" href="/assets/nacos-overview.html-13cec71c.js" as="script"><link rel="prefetch" href="/assets/cloud-openfeign-action.html-0f222092.js" as="script"><link rel="prefetch" href="/assets/spring-cloud-openfeign.html-80b0fc34.js" as="script"><link rel="prefetch" href="/assets/spring-cloud-ribbon.html-e2d9af9b.js" as="script"><link rel="prefetch" href="/assets/sentinel-source.html-692a3324.js" as="script"><link rel="prefetch" href="/assets/spring-cloud-sentinel.html-bf9c4618.js" as="script"><link rel="prefetch" href="/assets/spring-cloud-alibaba-seate.html-37eed2ce.js" as="script"><link rel="prefetch" href="/assets/git.html-87ad5d64.js" as="script"><link rel="prefetch" href="/assets/gitlab.html-09e004bc.js" as="script"><link rel="prefetch" href="/assets/junit4.html-e113cced.js" as="script"><link rel="prefetch" href="/assets/junit5.html-49a7387c.js" as="script"><link rel="prefetch" href="/assets/maven.html-dfa1482f.js" as="script"><link rel="prefetch" href="/assets/reactor.html-caf126d4.js" as="script"><link rel="prefetch" href="/assets/spring-source-web-init.html-c9794d73.js" as="script"><link rel="prefetch" href="/assets/spring-source-web-listener.html-22512f68.js" as="script"><link rel="prefetch" href="/assets/404.html-f08c28a7.js" as="script"><link rel="prefetch" href="/assets/index.html-703427c5.js" as="script"><link rel="prefetch" href="/assets/index.html-d81ead65.js" as="script"><link rel="prefetch" href="/assets/index.html-89246e48.js" as="script"><link rel="prefetch" href="/assets/index.html-6a96e1d8.js" as="script"><link rel="prefetch" href="/assets/index.html-3f2fdf99.js" as="script"><link rel="prefetch" href="/assets/index.html-def5ae53.js" as="script"><link rel="prefetch" href="/assets/index.html-da4568d9.js" as="script"><link rel="prefetch" href="/assets/index.html-855b7bae.js" as="script"><link rel="prefetch" href="/assets/index.html-0d635afd.js" as="script"><link rel="prefetch" href="/assets/index.html-555be4ca.js" as="script"><link rel="prefetch" href="/assets/index.html-e93144aa.js" as="script"><link rel="prefetch" href="/assets/mermaid.esm.min-bc08675d.js" as="script"><link rel="prefetch" href="/assets/mermaid-mindmap.esm.min-d48ac69f.js" as="script"><link rel="prefetch" href="/assets/markdown.esm-d92a2fc9.js" as="script"><link rel="prefetch" href="/assets/reveal.esm-e5069ce0.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><div class="theme-container has-toc"><!--[--><!--[--><header class="navbar"><div class="navbar-left"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><a href="/" class="brand"><!----><!----><span class="site-name">Java æˆç¥ä¹‹è·¯</span></a><!--[--><!----><!--]--></div><div class="navbar-center"><!--[--><!----><!--]--><nav class="nav-links"><div class="nav-item hide-in-mobile"><a href="/java/java-overview.html" class="nav-link" aria-label="Java ç¬”è®°"><!---->Java ç¬”è®°<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="Spring ç¬”è®°"><span class="title"><!---->Spring ç¬”è®°</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>Spring IOC</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/spring/test02.html" class="nav-link" aria-label="Spring IOCè¯¦è§£"><!---->Spring IOCè¯¦è§£<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>Spring åç½®å¤„ç†å™¨è§£æ</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/spring/spring-bean-post-processor/BeanPostProcessor-base.html" class="nav-link" aria-label="Spring åç½®å¤„ç†å™¨æ€»è§ˆ"><!---->Spring åç½®å¤„ç†å™¨æ€»è§ˆ<!----></a></li></ul></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="Spring Cloud"><span class="title"><!---->Spring Cloud</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/spring-cloud/spring-cloud-overview.html" class="nav-link" aria-label="Spring Cloud Overview"><!---->Spring Cloud Overview<!----></a></li><li class="dropdown-item"><a href="/spring-cloud/spring-cloud-alibaba-nacos.md" class="nav-link" aria-label="Spring Cloud Nacos"><!---->Spring Cloud Nacos<!----></a></li><li class="dropdown-item"><a href="/spring-cloud/spring-cloud-alibaba-sentinel.md" class="nav-link" aria-label="Spring Cloud Sentinel"><!---->Spring Cloud Sentinel<!----></a></li><li class="dropdown-item"><a href="/spring-cloud/spring-cloud-alibaba-seate.md" class="nav-link" aria-label="Spring Cloud Seate"><!---->Spring Cloud Seate<!----></a></li><li class="dropdown-item"><a href="/spring-cloud/spring-cloud-ribbon/spring-cloud-ribbon.html" class="nav-link" aria-label="Spring Cloud Ribbon"><!---->Spring Cloud Ribbon<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><a href="/database/database-overview.html" class="nav-link" aria-label="æ•°æ®åº“"><!---->æ•°æ®åº“<!----></a></div><div class="nav-item hide-in-mobile"><a href="/quality/quality-overview.html" class="nav-link" aria-label="è‡ªæˆ‘ä¿®å…»"><!---->è‡ªæˆ‘ä¿®å…»<!----></a></div><div class="nav-item hide-in-mobile"><a href="/middleware/middleware-overview.html" class="nav-link" aria-label="ä¸­é—´ä»¶"><!---->ä¸­é—´ä»¶<!----></a></div><div class="nav-item hide-in-mobile"><a href="/tools/tools-overview.html" class="nav-link" aria-label="å·¥å…·åŒ…"><!---->å·¥å…·åŒ…<!----></a></div></nav><!--[--><!----><!--]--></div><div class="navbar-right"><!--[--><!----><!--]--><!----><!----><div class="nav-item hide-in-mobile"><button id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!----><!--[--><!----><!--]--><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><!--[--><a href="/java/java-overview.html" class="nav-link sidebar-link sidebar-page" aria-label="Java æ€»è§ˆ"><!---->Java æ€»è§ˆ<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">Java åŸºç¡€</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">Java 8 æ–°ç‰¹æ€§</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">Java é›†åˆ</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">Java IO æ¨¡å‹</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">Java å¹¶å‘ç¼–ç¨‹</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable active"><!----><span class="title">JVMæ¦‚è§ˆ</span><span class="arrow down"></span></button><ul class="sidebar-links"><li><!--[--><a href="/java/java-jvm/JVM%E6%A6%82%E8%A7%88.html" class="nav-link sidebar-link sidebar-page" aria-label="JVM æ¦‚è§ˆ"><!---->JVM æ¦‚è§ˆ<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/java-jvm/JVM%E5%86%85%E5%AD%98%E7%BB%93%E6%9E%84.html" class="nav-link sidebar-link sidebar-page" aria-label="JVM å†…å­˜ç»“æ„"><!---->JVM å†…å­˜ç»“æ„<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-current="page" href="/java/java-jvm/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" aria-label="åƒåœ¾å›æ”¶"><!---->åƒåœ¾å›æ”¶<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/java/java-jvm/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.html#ä»‹ç»" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="ä»‹ç»"><!---->ä»‹ç»<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/java/java-jvm/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.html#ä»€ä¹ˆæ˜¯jvm" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="ä»€ä¹ˆæ˜¯JVM"><!---->ä»€ä¹ˆæ˜¯JVM<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/java/java-jvm/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.html#å­¦ä¹ è·¯çº¿" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="å­¦ä¹ è·¯çº¿"><!---->å­¦ä¹ è·¯çº¿<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/java/java-jvm/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.html#jvmå†…å­˜ç»“æ„" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="JVMå†…å­˜ç»“æ„"><!---->JVMå†…å­˜ç»“æ„<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/java/java-jvm/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.html#ç¨‹åºè®¡æ•°å™¨" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="ç¨‹åºè®¡æ•°å™¨"><!---->ç¨‹åºè®¡æ•°å™¨<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/java/java-jvm/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.html#è™šæ‹Ÿæœºæ ˆ" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="è™šæ‹Ÿæœºæ ˆ"><!---->è™šæ‹Ÿæœºæ ˆ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/java/java-jvm/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.html#æœ¬åœ°æ–¹æ³•æ ˆ" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="æœ¬åœ°æ–¹æ³•æ ˆ"><!---->æœ¬åœ°æ–¹æ³•æ ˆ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/java/java-jvm/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.html#å †" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="å †"><!---->å †<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/java/java-jvm/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.html#æ–¹æ³•åŒº" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="æ–¹æ³•åŒº"><!---->æ–¹æ³•åŒº<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/java/java-jvm/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.html#stringtableè¯¦è§£-å°±æ˜¯ä¸²æ± " class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="StringTableè¯¦è§£(å°±æ˜¯ä¸²æ± )"><!---->StringTableè¯¦è§£(å°±æ˜¯ä¸²æ± )<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/java/java-jvm/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.html#ç›´æ¥å†…å­˜" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="ç›´æ¥å†…å­˜"><!---->ç›´æ¥å†…å­˜<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/java/java-jvm/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.html#åƒåœ¾å›æ”¶-1" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="åƒåœ¾å›æ”¶"><!---->åƒåœ¾å›æ”¶<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/java/java-jvm/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.html#å¦‚ä½•åˆ¤æ–­å¯¹è±¡å¯ä»¥è¢«å›æ”¶" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="å¦‚ä½•åˆ¤æ–­å¯¹è±¡å¯ä»¥è¢«å›æ”¶ï¼Ÿ"><!---->å¦‚ä½•åˆ¤æ–­å¯¹è±¡å¯ä»¥è¢«å›æ”¶ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/java/java-jvm/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.html#åƒåœ¾å›æ”¶ç®—æ³•" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="åƒåœ¾å›æ”¶ç®—æ³•"><!---->åƒåœ¾å›æ”¶ç®—æ³•<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/java/java-jvm/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.html#åˆ†ä»£åƒåœ¾å›æ”¶" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="åˆ†ä»£åƒåœ¾å›æ”¶"><!---->åˆ†ä»£åƒåœ¾å›æ”¶<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/java/java-jvm/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.html#åƒåœ¾å›æ”¶å™¨" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="åƒåœ¾å›æ”¶å™¨"><!---->åƒåœ¾å›æ”¶å™¨<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/java/java-jvm/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.html#åƒåœ¾å›æ”¶è°ƒä¼˜" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="åƒåœ¾å›æ”¶è°ƒä¼˜"><!---->åƒåœ¾å›æ”¶è°ƒä¼˜<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/java/java-jvm/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.html#ç±»æ–‡ä»¶ç»“æ„" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="ç±»æ–‡ä»¶ç»“æ„"><!---->ç±»æ–‡ä»¶ç»“æ„<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/java/java-jvm/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.html#ç±»åŠ è½½å™¨" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="ç±»åŠ è½½å™¨"><!---->ç±»åŠ è½½å™¨<!----></a><ul class="sidebar-sub-headers"></ul></li></ul><!--]--></li><li><!--[--><a href="/java/java-jvm/JVM%E7%B1%BB%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84.html" class="nav-link sidebar-link sidebar-page" aria-label="ç±»æ–‡ä»¶ç»“æ„"><!---->ç±»æ–‡ä»¶ç»“æ„<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/java-jvm/JVM%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8.html" class="nav-link sidebar-link sidebar-page" aria-label="è™šæ‹Ÿæœºç±»åŠ è½½æœºåˆ¶"><!---->è™šæ‹Ÿæœºç±»åŠ è½½æœºåˆ¶<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/java-jvm/Java%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B.html" class="nav-link sidebar-link sidebar-page" aria-label="Java å†…å­˜æ¨¡å‹"><!---->Java å†…å­˜æ¨¡å‹<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/java-jvm/JVM%E8%B0%83%E4%BC%98.html" class="nav-link sidebar-link sidebar-page" aria-label="JVMè°ƒä¼˜"><!---->JVMè°ƒä¼˜<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->åƒåœ¾å›æ”¶</h1><div class="page-info"><!----><!----><span class="date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2022-05-13T17:19:03.000Z"></span><!----><!----><span class="reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 66 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT66M"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><div class="toc-header">æ­¤é¡µå†…å®¹</div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/java/java-jvm/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.html#ä»‹ç»" class="router-link-active router-link-exact-active toc-link level2">ä»‹ç»</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/java/java-jvm/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.html#ä»€ä¹ˆæ˜¯jvm" class="router-link-active router-link-exact-active toc-link level3">ä»€ä¹ˆæ˜¯JVM</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/java/java-jvm/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.html#å­¦ä¹ è·¯çº¿" class="router-link-active router-link-exact-active toc-link level3">å­¦ä¹ è·¯çº¿</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/java/java-jvm/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.html#jvmå†…å­˜ç»“æ„" class="router-link-active router-link-exact-active toc-link level2">JVMå†…å­˜ç»“æ„</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/java/java-jvm/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.html#ç¨‹åºè®¡æ•°å™¨" class="router-link-active router-link-exact-active toc-link level3">ç¨‹åºè®¡æ•°å™¨</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/java/java-jvm/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.html#è™šæ‹Ÿæœºæ ˆ" class="router-link-active router-link-exact-active toc-link level3">è™šæ‹Ÿæœºæ ˆ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/java/java-jvm/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.html#æœ¬åœ°æ–¹æ³•æ ˆ" class="router-link-active router-link-exact-active toc-link level3">æœ¬åœ°æ–¹æ³•æ ˆ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/java/java-jvm/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.html#å †" class="router-link-active router-link-exact-active toc-link level3">å †</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/java/java-jvm/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.html#æ–¹æ³•åŒº" class="router-link-active router-link-exact-active toc-link level3">æ–¹æ³•åŒº</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/java/java-jvm/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.html#stringtableè¯¦è§£-å°±æ˜¯ä¸²æ± " class="router-link-active router-link-exact-active toc-link level3">StringTableè¯¦è§£(å°±æ˜¯ä¸²æ± )</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/java/java-jvm/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.html#ç›´æ¥å†…å­˜" class="router-link-active router-link-exact-active toc-link level3">ç›´æ¥å†…å­˜</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/java/java-jvm/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.html#åƒåœ¾å›æ”¶-1" class="router-link-active router-link-exact-active toc-link level2">åƒåœ¾å›æ”¶</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/java/java-jvm/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.html#å¦‚ä½•åˆ¤æ–­å¯¹è±¡å¯ä»¥è¢«å›æ”¶" class="router-link-active router-link-exact-active toc-link level3">å¦‚ä½•åˆ¤æ–­å¯¹è±¡å¯ä»¥è¢«å›æ”¶ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/java/java-jvm/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.html#åƒåœ¾å›æ”¶ç®—æ³•" class="router-link-active router-link-exact-active toc-link level3">åƒåœ¾å›æ”¶ç®—æ³•</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/java/java-jvm/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.html#åˆ†ä»£åƒåœ¾å›æ”¶" class="router-link-active router-link-exact-active toc-link level3">åˆ†ä»£åƒåœ¾å›æ”¶</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/java/java-jvm/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.html#åƒåœ¾å›æ”¶å™¨" class="router-link-active router-link-exact-active toc-link level3">åƒåœ¾å›æ”¶å™¨</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/java/java-jvm/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.html#åƒåœ¾å›æ”¶è°ƒä¼˜" class="router-link-active router-link-exact-active toc-link level3">åƒåœ¾å›æ”¶è°ƒä¼˜</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/java/java-jvm/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.html#ç±»æ–‡ä»¶ç»“æ„" class="router-link-active router-link-exact-active toc-link level2">ç±»æ–‡ä»¶ç»“æ„</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/java/java-jvm/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.html#ç±»åŠ è½½å™¨" class="router-link-active router-link-exact-active toc-link level2">ç±»åŠ è½½å™¨</a></li><!----><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><h1 id="åƒåœ¾å›æ”¶" tabindex="-1"><a class="header-anchor" href="#åƒåœ¾å›æ”¶" aria-hidden="true">#</a> åƒåœ¾å›æ”¶</h1><h1 id="jvmç¬”è®°" tabindex="-1"><a class="header-anchor" href="#jvmç¬”è®°" aria-hidden="true">#</a> JVMç¬”è®°</h1><h2 id="ä»‹ç»" tabindex="-1"><a class="header-anchor" href="#ä»‹ç»" aria-hidden="true">#</a> ä»‹ç»</h2><h3 id="ä»€ä¹ˆæ˜¯jvm" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯jvm" aria-hidden="true">#</a> ä»€ä¹ˆæ˜¯JVM</h3><p>Java Virtual Machine Javaç¨‹åºçš„è¿è¡Œç¯å¢ƒ</p><h3 id="å­¦ä¹ è·¯çº¿" tabindex="-1"><a class="header-anchor" href="#å­¦ä¹ è·¯çº¿" aria-hidden="true">#</a> å­¦ä¹ è·¯çº¿</h3><p>ç±»åŠ è½½å™¨ -&gt; JVMå†…å­˜ç»“æ„ -&gt; æ‰§è¡Œå¼•æ“</p><p><img src="/assets/image-20220510101926162-2e22f0c8.png" alt="image-20220510101926162"></p><h2 id="jvmå†…å­˜ç»“æ„" tabindex="-1"><a class="header-anchor" href="#jvmå†…å­˜ç»“æ„" aria-hidden="true">#</a> JVMå†…å­˜ç»“æ„</h2><p>åšå®¢ï¼š<a href="https://blog.csdn.net/xiaokanfuchen86/article/details/117625190" target="_blank" rel="noopener noreferrer">(41æ¡æ¶ˆæ¯) ä¸€æ–‡ææ‡‚JVMå†…å­˜ç»“æ„_xiaokanfuchen86çš„åšå®¢-CSDNåšå®¢_jvmå†…å­˜ç»“æ„<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>Java è™šæ‹Ÿæœºåœ¨æ‰§è¡Œ Java ç¨‹åºçš„è¿‡ç¨‹ä¸­ä¼šæŠŠå®ƒç®¡ç†çš„<a href="https://so.csdn.net/so/search?q=%E5%86%85%E5%AD%98&amp;spm=1001.2101.3001.7020" target="_blank" rel="noopener noreferrer">å†…å­˜<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªä¸åŒçš„æ•°æ®åŒºåŸŸã€‚æ¯ä¸ªåŒºåŸŸéƒ½æœ‰å„è‡ªçš„ä½œç”¨ã€‚</p><p>åˆ†æ JVM å†…å­˜ç»“æ„ï¼Œä¸»è¦å°±æ˜¯åˆ†æ JVM è¿è¡Œæ—¶æ•°æ®å­˜å‚¨åŒºåŸŸã€‚JVM çš„è¿è¡Œæ—¶æ•°æ®åŒºä¸»è¦åŒ…æ‹¬ï¼š<strong>å †ã€æ ˆã€æ–¹æ³•åŒºã€ç¨‹åºè®¡æ•°å™¨</strong>ç­‰ã€‚è€Œ JVM çš„ä¼˜åŒ–é—®é¢˜ä¸»è¦åœ¨çº¿ç¨‹å…±äº«çš„æ•°æ®åŒºä¸­ï¼š<strong>å †ã€æ–¹æ³•åŒº</strong>ã€‚</p><img src="/assets/jvm-memory-bed16a7a.png" alt="img" style="zoom:100%;"><h3 id="ç¨‹åºè®¡æ•°å™¨" tabindex="-1"><a class="header-anchor" href="#ç¨‹åºè®¡æ•°å™¨" aria-hidden="true">#</a> ç¨‹åºè®¡æ•°å™¨</h3><p>Program Counter Register ç¨‹åºè®¡æ•°å™¨ï¼ˆå¯„å­˜å™¨ï¼‰</p><ul><li><p>ä½œç”¨ï¼Œæ˜¯è®°ä½ä¸‹ä¸€æ¡jvmæŒ‡ä»¤çš„æ‰§è¡Œåœ°å€</p></li><li><p>ç‰¹ç‚¹</p><ul><li><p>æ˜¯çº¿ç¨‹ç§æœ‰çš„</p></li><li><p>ä¸ä¼šå­˜åœ¨å†…å­˜æº¢å‡º</p></li></ul></li></ul><p>ä¸‹é¢ç»™å‡ºä¸€ä¸ªä¾‹å­ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token number">0</span><span class="token operator">:</span> getstatic #<span class="token number">20</span>              <span class="token comment">// PrintStream out = System.out; </span>
<span class="token number">3</span><span class="token operator">:</span> astore_1                   <span class="token comment">// -- </span>
<span class="token number">4</span><span class="token operator">:</span> aload_1                    <span class="token comment">// out.println(1); </span>
<span class="token number">5</span><span class="token operator">:</span> iconst_1                   <span class="token comment">// -- </span>
<span class="token number">6</span><span class="token operator">:</span> invokevirtual #<span class="token number">26</span>          <span class="token comment">// -- </span>
<span class="token number">9</span><span class="token operator">:</span> aload_1                    <span class="token comment">// out.println(2); </span>
<span class="token number">10</span><span class="token operator">:</span> iconst_2                  <span class="token comment">// -- </span>
<span class="token number">11</span><span class="token operator">:</span> invokevirtual #<span class="token number">26</span>         <span class="token comment">// -- </span>
<span class="token number">14</span><span class="token operator">:</span> aload_1                   <span class="token comment">// out.println(3); </span>
<span class="token number">15</span><span class="token operator">:</span> iconst_3                  <span class="token comment">// -- </span>
<span class="token number">16</span><span class="token operator">:</span> invokevirtual #<span class="token number">26</span>         <span class="token comment">// -- </span>
<span class="token number">19</span><span class="token operator">:</span> aload_1                   <span class="token comment">// out.println(4); </span>
<span class="token number">20</span><span class="token operator">:</span> iconst_4                  <span class="token comment">// -- </span>
<span class="token number">21</span><span class="token operator">:</span> invokevirtual #<span class="token number">26</span>         <span class="token comment">// -- </span>
<span class="token number">24</span><span class="token operator">:</span> aload_1                   <span class="token comment">// out.println(5); </span>
<span class="token number">25</span><span class="token operator">:</span> iconst_5                  <span class="token comment">// -- </span>
<span class="token number">26</span><span class="token operator">:</span> invokevirtual #<span class="token number">26</span>         <span class="token comment">// -- </span>
<span class="token number">29</span><span class="token operator">:</span> <span class="token keyword">return</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»¥ä¸Šä»£ç çš„å³ä¾§æ˜¯Javaçš„æºä»£ç ï¼Œå·¦ä¾§æ˜¯äºŒè¿›åˆ¶å­—èŠ‚ç ï¼ŒJVMçš„æŒ‡ä»¤</p><p>JVMçš„æ‰§è¡Œæµç¨‹ï¼š</p><p>JVMæŒ‡ä»¤ -&gt; è§£é‡Šå™¨ -&gt; æœºå™¨ç  -&gt; CPU</p><p><strong>ç¨‹åºè®¡æ•°å™¨ï¼ˆProgram Counter Registerï¼‰<strong>æ˜¯ä¸€å—è¾ƒå°çš„å†…å­˜ç©ºé—´ï¼Œå¯ä»¥çœ‹ä½œæ˜¯</strong>å½“å‰çº¿ç¨‹</strong>æ‰€æ‰§è¡Œå­—èŠ‚ç çš„<strong>è¡Œå·æŒ‡ç¤ºå™¨</strong>ï¼ŒæŒ‡å‘ä¸‹ä¸€ä¸ªå°†è¦æ‰§è¡Œçš„æŒ‡ä»¤ä»£ç ï¼Œç”±æ‰§è¡Œå¼•æ“æ¥è¯»å–ä¸‹ä¸€æ¡æŒ‡ä»¤ã€‚æ›´ç¡®åˆ‡çš„è¯´ï¼Œ<strong>ä¸€ä¸ªçº¿ç¨‹çš„æ‰§è¡Œï¼Œæ˜¯é€šè¿‡å­—èŠ‚ç è§£é‡Šå™¨æ”¹å˜å½“å‰çº¿ç¨‹çš„è®¡æ•°å™¨çš„å€¼ï¼Œæ¥è·å–ä¸‹ä¸€æ¡éœ€è¦æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤ï¼Œä»è€Œç¡®ä¿çº¿ç¨‹çš„æ­£ç¡®æ‰§è¡Œ</strong>ã€‚</p><p>ä¸ºäº†ç¡®ä¿çº¿ç¨‹åˆ‡æ¢åï¼ˆä¸Šä¸‹æ–‡åˆ‡æ¢ï¼‰èƒ½æ¢å¤åˆ°æ­£ç¡®çš„æ‰§è¡Œä½ç½®ï¼Œ<strong>æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªç‹¬ç«‹çš„ç¨‹åºè®¡æ•°å™¨</strong>ï¼Œå„ä¸ªçº¿ç¨‹çš„è®¡æ•°å™¨äº’ä¸å½±å“ï¼Œç‹¬ç«‹å­˜å‚¨ã€‚ä¹Ÿå°±æ˜¯è¯´ç¨‹åºè®¡æ•°å™¨æ˜¯<strong>çº¿ç¨‹ç§æœ‰çš„å†…å­˜</strong>ã€‚</p><p>å¦‚æœçº¿ç¨‹æ‰§è¡Œ Java æ–¹æ³•ï¼Œè¿™ä¸ªè®¡æ•°å™¨è®°å½•çš„æ˜¯æ­£åœ¨æ‰§è¡Œçš„è™šæ‹Ÿæœºå­—èŠ‚ç æŒ‡ä»¤çš„åœ°å€ï¼›å¦‚æœæ‰§è¡Œçš„æ˜¯ Native æ–¹æ³•ï¼Œè®¡æ•°å™¨å€¼ä¸ºUndefinedã€‚</p><p><strong>ç¨‹åºè®¡æ•°å™¨ä¸ä¼šå‘ç”Ÿå†…å­˜æº¢å‡ºï¼ˆOutOfMemoryErrorå³OOMï¼‰é—®é¢˜ã€‚</strong></p><h3 id="è™šæ‹Ÿæœºæ ˆ" tabindex="-1"><a class="header-anchor" href="#è™šæ‹Ÿæœºæ ˆ" aria-hidden="true">#</a> è™šæ‹Ÿæœºæ ˆ</h3><h4 id="å®šä¹‰" tabindex="-1"><a class="header-anchor" href="#å®šä¹‰" aria-hidden="true">#</a> å®šä¹‰</h4><p>Java Virtual Machine Stacks ï¼ˆJava è™šæ‹Ÿæœºæ ˆï¼‰</p><ul><li><p>çº¿ç¨‹ç§æœ‰çš„</p></li><li><p>æ¯ä¸ªçº¿ç¨‹è¿è¡Œæ—¶æ‰€éœ€è¦çš„å†…å­˜ï¼Œç§°ä¸ºè™šæ‹Ÿæœºæ ˆ</p></li><li><p>æ¯ä¸ªæ ˆç”±å¤šä¸ªæ ˆå¸§ï¼ˆFrameï¼‰ç»„æˆï¼Œå¯¹åº”ç€æ¯æ¬¡æ–¹æ³•è°ƒç”¨æ—¶æ‰€å ç”¨çš„å†…å­˜</p></li><li><p>æ¯ä¸ªçº¿ç¨‹åªèƒ½æœ‰ä¸€ä¸ªæ´»åŠ¨æ ˆå¸§ï¼Œå¯¹åº”ç€å½“å‰æ­£åœ¨æ‰§è¡Œçš„é‚£ä¸ªæ–¹æ³•</p></li></ul><p><strong>æ ˆå¸§</strong>æ˜¯æ ˆçš„å…ƒç´ ã€‚<strong>æ¯ä¸ªæ–¹æ³•åœ¨æ‰§è¡Œæ—¶éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ ˆå¸§</strong>ã€‚æ ˆå¸§ä¸­å­˜å‚¨äº†<strong>å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€è¿æ¥å’Œæ–¹æ³•å‡ºå£</strong>ç­‰ä¿¡æ¯ã€‚æ¯ä¸ªæ–¹æ³•ä»è°ƒç”¨åˆ°è¿è¡Œç»“æŸçš„è¿‡ç¨‹ï¼Œå°±å¯¹åº”ç€ä¸€ä¸ªæ ˆå¸§åœ¨æ ˆä¸­å‹æ ˆåˆ°å‡ºæ ˆçš„è¿‡ç¨‹ã€‚</p><p><img src="/assets/20190409182042686-bf327923.png" alt="img"></p><p>JVMè™šæ‹Ÿæœºæ ˆçš„å¤§å°å¯ä»¥é€šè¿‡å‚æ•°æ¥æŒ‡å®š <strong>-Xss size</strong></p><p>é»˜è®¤çš„å•ä½æ˜¯å­—èŠ‚ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šå•ä½ï¼Œå¦‚KB(k,K)ã€MB(m,M)ã€GB(g,G)</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>-Xss1m
-Xss1024KB
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>æ ˆçš„å¤§å°å†³å®šäº†å‡½æ•°è°ƒç”¨çš„æœ€å¤§æ·±åº¦ï¼Œå¦‚æœå‡½æ•°è°ƒç”¨çš„æ·±åº¦å¤§äºè®¾ç½®çš„Xsså¤§å°ï¼Œé‚£ä¹ˆå°†ä¼šæŠ›â€œjava.lang.StackOverflowErrorâ€œ å¼‚å¸¸ã€‚</p><p>é»˜è®¤çš„æƒ…å†µä¸‹ï¼Œæ ˆçš„å¤§å°æ˜¯1024KBï¼ˆwindowsç³»ç»Ÿä¾‹å¤–ï¼Œå¤§å°ä¾èµ–äºè™šæ‹Ÿå†…å­˜ï¼‰</p><blockquote><p>é¢è¯•é¢˜ï¼š</p><ol><li><p>åƒåœ¾å›æ”¶æ˜¯å¦æ¶‰åŠæ ˆå†…å­˜ï¼Ÿ</p><p>ä¸éœ€è¦ï¼Œæ ˆå†…å­˜éšç€æ ˆé’ˆçš„å‡ºæ ˆè€Œè‡ªåŠ¨å›æ”¶æ‰ï¼Œæ‰€ä»¥ä¸éœ€è¦åƒåœ¾å›æ”¶å™¨æ¥ç®¡ç†ã€‚</p></li><li><p>å å†…å­˜åˆ†é…çš„è¶Šå¤§è¶Šå¥½ä¹ˆï¼Ÿ</p><p>å å†…å­˜è¿‡å¤§ä¼šå¯¼è‡´å•çº¿ç¨‹å ç”¨çš„å†…å­˜è¿‡å¤§ï¼Œæ€»çš„çº¿ç¨‹æ•°å˜å°‘ï¼Œä¸å»ºè®®è°ƒæ•´ï¼Œä½¿ç”¨é»˜è®¤å³å¯ã€‚</p></li><li><p>æ–¹æ³•çš„å±€éƒ¨å˜é‡æ˜¯å¦çº¿ç¨‹å®‰å…¨ï¼Ÿ</p><p>å±€éƒ¨å˜é‡æ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œä¸å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚</p></li><li><p>è™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆçš„åŒºåˆ«ï¼Ÿ</p><p>Java è™šæ‹Ÿæœºæ ˆä¸º JVM æ‰§è¡Œ Java æ–¹æ³•æœåŠ¡ï¼Œæœ¬åœ°æ–¹æ³•æ ˆåˆ™ä¸º JVM ä½¿ç”¨åˆ°çš„ Native æ–¹æ³•æœåŠ¡ã€‚</p></li></ol></blockquote><h4 id="æ¡ˆä¾‹1-cpuå ç”¨è¿‡å¤š" tabindex="-1"><a class="header-anchor" href="#æ¡ˆä¾‹1-cpuå ç”¨è¿‡å¤š" aria-hidden="true">#</a> æ¡ˆä¾‹1ï¼šCPUå ç”¨è¿‡å¤š</h4><p>å®šä½è¿‡ç¨‹ï¼š</p><ul><li><p>ç”¨topå®šä½å“ªä¸ªè¿›ç¨‹å¯¹cpuçš„å ç”¨è¿‡é«˜</p></li><li><p>ps H -eo pid,tid,%cpu | grep è¿›ç¨‹id ï¼ˆç”¨pså‘½ä»¤è¿›ä¸€æ­¥å®šä½æ˜¯å“ªä¸ªçº¿ç¨‹å¼•èµ·çš„cpuå ç”¨è¿‡é«˜ï¼‰</p></li><li><p>jstack è¿›ç¨‹idã€‚å¯ä»¥æ ¹æ®çº¿ç¨‹id æ‰¾åˆ°æœ‰é—®é¢˜çš„çº¿ç¨‹ï¼Œè¿›ä¸€æ­¥å®šä½åˆ°é—®é¢˜ä»£ç çš„æºç è¡Œå·</p><p>è¿™é‡Œæ³¨æ„ä¸€ä¸‹ï¼Œpsè¾“å‡ºçš„çº¿ç¨‹å·æ˜¯åè¿›åˆ¶çš„ï¼Œjstackè¾“å‡ºçš„çº¿ç¨‹ç¼–å·æ˜¯åå…­è¿›åˆ¶çš„ã€‚</p></li></ul><h4 id="æ¡ˆä¾‹2-ç¨‹åºè¿è¡Œå¾ˆé•¿æ—¶é—´æ²¡æœ‰ç»“æœ" tabindex="-1"><a class="header-anchor" href="#æ¡ˆä¾‹2-ç¨‹åºè¿è¡Œå¾ˆé•¿æ—¶é—´æ²¡æœ‰ç»“æœ" aria-hidden="true">#</a> æ¡ˆä¾‹2ï¼šç¨‹åºè¿è¡Œå¾ˆé•¿æ—¶é—´æ²¡æœ‰ç»“æœ</h4><h3 id="æœ¬åœ°æ–¹æ³•æ ˆ" tabindex="-1"><a class="header-anchor" href="#æœ¬åœ°æ–¹æ³•æ ˆ" aria-hidden="true">#</a> æœ¬åœ°æ–¹æ³•æ ˆ</h3><p>çº¿ç¨‹ç§æœ‰ã€‚ä¸ºè™šæ‹Ÿæœºä½¿ç”¨åˆ°çš„Native æ–¹æ³•æœåŠ¡ã€‚å¦‚Javaä½¿ç”¨cæˆ–è€…c++ç¼–å†™çš„æ¥å£æœåŠ¡æ—¶ï¼Œä»£ç åœ¨æ­¤åŒºè¿è¡Œã€‚</p><h3 id="å †" tabindex="-1"><a class="header-anchor" href="#å †" aria-hidden="true">#</a> å †</h3><p>å †çš„ä½œç”¨æ˜¯å­˜æ”¾å¯¹è±¡å®ä¾‹å’Œæ•°ç»„ã€‚é€šè¿‡newå…³é”®å­—åˆ›å»ºçš„å¯¹è±¡ï¼Œéƒ½ä¼šä½¿ç”¨å †å†…å­˜ã€‚</p><p>ç‰¹ç‚¹ï¼š</p><ul><li>å®ƒæ˜¯çº¿ç¨‹å…±äº«çš„ï¼Œå †ä¸­çš„å¯¹è±¡éƒ½éœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨é—®é¢˜</li><li>æœ‰åƒåœ¾å›æ”¶æœºåˆ¶</li></ul><p>å‚æ•°æ§åˆ¶ï¼š</p><ul><li>-Xmsè®¾ç½®å †çš„æœ€å°ç©ºé—´å¤§å°ã€‚-Xmxè®¾ç½®å †çš„æœ€å¤§ç©ºé—´å¤§å°ã€‚</li></ul><p>å¼‚å¸¸æƒ…å†µï¼š</p><ul><li>å¦‚æœåœ¨å †ä¸­æ²¡æœ‰å†…å­˜å®Œæˆå®ä¾‹åˆ†é…ï¼Œå¹¶ä¸”å †ä¹Ÿæ— æ³•å†æ‰©å±•æ—¶ï¼Œå°†ä¼šæŠ›å‡ºOutOfMemoryError å¼‚å¸¸</li></ul><h3 id="æ–¹æ³•åŒº" tabindex="-1"><a class="header-anchor" href="#æ–¹æ³•åŒº" aria-hidden="true">#</a> æ–¹æ³•åŒº</h3><p>æ–¹æ³•åŒºåŒ Java å †ä¸€æ ·æ˜¯è¢«æ‰€æœ‰çº¿ç¨‹å…±äº«çš„åŒºé—´ï¼Œç”¨äºå­˜å‚¨å·²è¢«è™šæ‹ŸæœºåŠ è½½çš„ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ã€‚åœ¨JVMå¯åŠ¨æ—¶è¢«åˆ›å»ºã€‚æ›´å…·ä½“çš„è¯´ï¼Œé™æ€å˜é‡+å¸¸é‡+ç±»ä¿¡æ¯ï¼ˆç‰ˆæœ¬ã€æ–¹æ³•ã€å­—æ®µç­‰ï¼‰+è¿è¡Œæ—¶å¸¸é‡æ± å­˜åœ¨æ–¹æ³•åŒºä¸­ã€‚å¸¸é‡æ± æ˜¯æ–¹æ³•åŒºçš„ä¸€éƒ¨åˆ†ã€‚</p><p>æ–¹æ³•åŒºåœ¨é€»è¾‘ä¸Šæ˜¯å †çš„ä¸€éƒ¨åˆ†ï¼Œä½†åœ¨å…·ä½“å®ç°ä¸Šä¸å¼ºåˆ¶æ–¹æ³•åŒºçš„ä½ç½®ï¼Œä¸åŒçš„è™šæ‹Ÿæœºå‚ å•†å¯ä»¥æœ‰ä¸åŒçš„å®ç°ï¼Œå¦‚ JDK1.8 ä¹‹å‰ä½¿ç”¨æ°¸ä¹…ä»£å®ç°ï¼Œ1.8 åä½¿ç”¨å…ƒç©ºé—´å®ç°</p><blockquote><p><strong>æ³¨</strong>ï¼šJDK1.8 ä½¿ç”¨å…ƒç©ºé—´ MetaSpace æ›¿ä»£æ–¹æ³•åŒºï¼Œå…ƒç©ºé—´å¹¶ä¸åœ¨ JVMä¸­ï¼Œè€Œæ˜¯ä½¿ç”¨æœ¬åœ°å†…å­˜ã€‚å…ƒç©ºé—´ä¸¤ä¸ªå‚æ•°ï¼š</p><ol><li>MetaSpaceSizeï¼šåˆå§‹åŒ–å…ƒç©ºé—´å¤§å°ï¼Œæ§åˆ¶å‘ç”ŸGCé˜ˆå€¼</li><li>MaxMetaspaceSize ï¼š é™åˆ¶å…ƒç©ºé—´å¤§å°ä¸Šé™ï¼Œé˜²æ­¢å¼‚å¸¸å ç”¨è¿‡å¤šç‰©ç†å†…å­˜</li></ol><img src="/assets/image-20220510230231970-167b5883.png" alt="image-20220510230231970" style="zoom:50%;"></blockquote><h4 id="å¸¸é‡æ± " tabindex="-1"><a class="header-anchor" href="#å¸¸é‡æ± " aria-hidden="true">#</a> å¸¸é‡æ± </h4><p>å¸¸é‡æ± ä¸­å­˜å‚¨ç¼–è¯‘å™¨ç”Ÿæˆçš„å„ç§<strong>å­—é¢é‡å’Œç¬¦å·å¼•ç”¨</strong>ã€‚å­—é¢é‡å°±æ˜¯Javaä¸­å¸¸é‡çš„æ„æ€ã€‚æ¯”å¦‚æ–‡æœ¬å­—ç¬¦ä¸²ï¼Œfinalä¿®é¥°çš„å¸¸é‡ç­‰ã€‚æ–¹æ³•å¼•ç”¨åˆ™åŒ…æ‹¬ç±»å’Œæ¥å£çš„å…¨é™å®šåï¼Œæ–¹æ³•åå’Œæè¿°ç¬¦ï¼Œå­—æ®µåå’Œæè¿°ç¬¦ç­‰ã€‚</p><p>æ³¨ï¼šJDK8ä»¥åï¼Œå¸¸é‡æ± ä¿å­˜åœ¨å †ä¸­ã€‚</p><img src="/assets/jvm-memory-method-constant-982e458a.png" alt="img" style="zoom:100%;"><p>ä¼˜ç‚¹ï¼š</p><ul><li>å¸¸é‡æ± é¿å…äº†é¢‘ç¹çš„åˆ›å»ºå’Œé”€æ¯å¯¹è±¡è€Œå½±å“ç³»ç»Ÿæ€§èƒ½ï¼Œå…¶å®ç°äº†å¯¹è±¡çš„å…±äº«ã€‚</li></ul><h5 id="classå¸¸é‡æ± " tabindex="-1"><a class="header-anchor" href="#classå¸¸é‡æ± " aria-hidden="true">#</a> Classå¸¸é‡æ± </h5><p><strong>å®šä¹‰ï¼š<strong>Classå¸¸é‡æ± å¯ä»¥ç†è§£ä¸ºæ˜¯Classæ–‡ä»¶ä¸­çš„</strong>èµ„æºä»“åº“</strong>ã€‚</p><p>**å†…å®¹ï¼š**Classæ–‡ä»¶ä¸­é™¤äº†åŒ…å«ç±»çš„ç‰ˆæœ¬ã€å­—æ®µã€æ–¹æ³•ã€æ¥å£ç­‰æè¿°ä¿¡æ¯å¤–ï¼Œ è¿˜æœ‰ä¸€é¡¹ä¿¡æ¯å°±æ˜¯å¸¸é‡æ± ï¼Œ<strong>ç”¨äºå­˜æ”¾ç¼–è¯‘æœŸç”Ÿæˆçš„å„ç§å­—é¢é‡å’Œç¬¦å·å¼•ç”¨</strong>ã€‚</p><p>é¦–å…ˆæœ‰å¦‚ä¸‹ç±»æ–‡ä»¶å®šä¹‰ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;hello world&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆ‘ä»¬é€šè¿‡javaæä¾›çš„å·¥å…·æ¥æŸ¥çœ‹ç¼–è¯‘åçš„Test.classæ–‡ä»¶çš„è¯¦ç»†ä¿¡æ¯</p><p>æŸ¥çœ‹å‘½ä»¤ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>javap -v Test.class       
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>è¯¦ç»†ä¿¡æ¯å¦‚ä¸‹ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>Classfile /D:/developer/gitee/spring-demo/java-demo/data-structure/src/test/java/Test.class
  Last modified 2022-5-11; size 413 bytes
  MD5 checksum ae5ed4a0ee5b45fd449f77ade8d7bd24
  Compiled from &quot;Test.java&quot;
public class Test
  minor version: 0
  major version: 52
  flags: ACC_PUBLIC, ACC_SUPER
Constant pool:  è¿™é‡Œå°±æ˜¯è¿™ä¸ªç±»éœ€è¦çš„å¸¸é‡ï¼Œè¿è¡Œåï¼Œä¼šä¿å­˜åˆ°å¸¸é‡æ± ä¸­ï¼Œ#åé¢çš„æ•°å­—ä¹Ÿä¼šå˜ä¸ºçœŸæ—¶çš„å†…å­˜åœ°å€ã€‚
   #1 = Methodref          #6.#15         // java/lang/Object.&quot;&lt;init&gt;&quot;:()V
   #2 = Fieldref           #16.#17        // java/lang/System.out:Ljava/io/PrintStream;
   #3 = String             #18            // hello world
   #4 = Methodref          #19.#20        // java/io/PrintStream.println:(Ljava/lang/String;)V
   #5 = Class              #21            // Test
   #6 = Class              #22            // java/lang/Object
   #7 = Utf8               &lt;init&gt;
   #8 = Utf8               ()V
   #9 = Utf8               Code
  #10 = Utf8               LineNumberTable
  #11 = Utf8               main
  #12 = Utf8               ([Ljava/lang/String;)V
  #13 = Utf8               SourceFile
  #14 = Utf8               Test.java
  #15 = NameAndType        #7:#8          // &quot;&lt;init&gt;&quot;:()V
  #16 = Class              #23            // java/lang/System
  #17 = NameAndType        #24:#25        // out:Ljava/io/PrintStream;
  #18 = Utf8               hello world
  #19 = Class              #26            // java/io/PrintStream
  #20 = NameAndType        #27:#28        // println:(Ljava/lang/String;)V
  #21 = Utf8               Test
  #22 = Utf8               java/lang/Object
  #23 = Utf8               java/lang/System
  #24 = Utf8               out
  #25 = Utf8               Ljava/io/PrintStream;
  #26 = Utf8               java/io/PrintStream
  #27 = Utf8               println
  #28 = Utf8               (Ljava/lang/String;)V
{
  public Test();
    descriptor: ()V
    flags: ACC_PUBLIC
    Code:
      stack=1, locals=1, args_size=1
         0: aload_0
         1: invokespecial #1                  // Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V
         4: return
      LineNumberTable:
        line 1: 0

  public static void main(java.lang.String[]);
    descriptor: ([Ljava/lang/String;)V
    flags: ACC_PUBLIC, ACC_STATIC
    Code:
      stack=2, locals=1, args_size=1
         0: getstatic     #2                  // Field java/lang/System.out:Ljava/io/PrintStream;
         3: ldc           #3                  // String hello world
         5: invokevirtual #4                  // Method java/io/PrintStream.println:(Ljava/lang/String;)V
         8: return
      LineNumberTable:
        line 4: 0
        line 5: 8
}
SourceFile: &quot;Test.java&quot;                                                                              
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>å­—é¢é‡</strong></p><p><strong>å®šä¹‰ï¼š<strong>å­—é¢é‡å°±æ˜¯æŒ‡</strong>ç”±å­—æ¯ã€æ•°å­—ç­‰æ„æˆçš„å­—ç¬¦ä¸²æˆ–è€…æ•°å€¼å¸¸é‡</strong>ã€‚</p><p>**PSï¼š**å­—é¢é‡åªå¯ä»¥å³å€¼å‡ºç°ã€ç­‰å·å³è¾¹çš„å€¼ã€‘å¦‚ï¼šint a = 1 è¿™é‡Œçš„aä¸ºå·¦å€¼ï¼Œ1ä¸ºå³å€¼ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­1å°±æ˜¯å­—é¢é‡ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">int</span> <span class="token function">compute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//ç¬¦å·å¼•ç”¨ï¼ša å­—é¢é‡ï¼š1</span>
    <span class="token keyword">int</span> b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span><span class="token comment">//ç¬¦å·å¼•ç”¨ï¼šb å­—é¢é‡ï¼š2</span>
    <span class="token class-name">String</span> c <span class="token operator">=</span> <span class="token string">&quot;æœ‰æ¢¦æƒ³çš„è‚¥å®…&quot;</span><span class="token punctuation">;</span><span class="token comment">//ç¬¦å·å¼•ç”¨ï¼šc å­—é¢é‡ï¼šæœ‰æ¢¦æƒ³çš„è‚¥å®…</span>
    <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ç¬¦å·å¼•ç”¨</strong></p><p>ç¬¦å·å¼•ç”¨æ˜¯ç¼–è¯‘åŸç†ä¸­çš„æ¦‚å¿µï¼Œæ˜¯ç›¸å¯¹äºç›´æ¥å¼•ç”¨æ¥è¯´çš„ã€‚ä¸»è¦åŒ…æ‹¬äº†ä»¥ä¸‹ä¸‰ç±»å¸¸é‡ï¼š</p><ul><li><strong>ç±»å’Œæ¥å£çš„å…¨é™å®šå</strong></li><li><strong>å­—æ®µçš„åç§°å’Œæè¿°ç¬¦</strong></li><li><strong>æ–¹æ³•çš„åç§°å’Œæè¿°ç¬¦</strong></li></ul><p><strong>ç¬¦å·å¼•ç”¨åªæœ‰åˆ°è¿è¡Œæ—¶è¢«åŠ è½½åˆ°å†…å­˜åï¼Œè¿™äº›ç¬¦å·æ‰æœ‰å¯¹åº”çš„å†…å­˜åœ°å€ä¿¡æ¯ï¼Œè¿™äº›å¸¸é‡æ± ä¸€æ—¦è¢«è£…å…¥å†…å­˜å°±å˜æˆè¿è¡Œæ—¶å¸¸é‡æ± </strong>ï¼Œä¹Ÿå°±å¼•å‡ºäº†ä¸‹é¢åŠ¨æ€é“¾æ¥çš„æ¦‚å¿µã€‚</p><p>**åŠ¨æ€é“¾æ¥ï¼š**å¯¹åº”çš„ç¬¦å·å¼•ç”¨åœ¨ç¨‹åºåŠ è½½æˆ–è¿è¡Œæ—¶ä¼šè¢«è½¬å˜ä¸ºè¢«åŠ è½½åˆ°å†…å­˜åŒºåŸŸçš„ä»£ç çš„ç›´æ¥å¼•ç”¨ã€‚</p><p>**ä¾‹ï¼š**compute()è¿™ä¸ªç¬¦å·å¼•ç”¨åœ¨è¿è¡Œæ—¶å°±ä¼šè¢«è½¬å˜ä¸ºcompute()æ–¹æ³•å…·ä½“ä»£ç åœ¨å†…å­˜ä¸­çš„åœ°å€ï¼Œä¸»è¦é€šè¿‡å¯¹è±¡å¤´é‡Œçš„ç±»å‹æŒ‡é’ˆå»è½¬æ¢ç›´æ¥å¼•ç”¨ã€‚</p><h5 id="å­—ç¬¦ä¸²å¸¸é‡æ± " tabindex="-1"><a class="header-anchor" href="#å­—ç¬¦ä¸²å¸¸é‡æ± " aria-hidden="true">#</a> å­—ç¬¦ä¸²å¸¸é‡æ± </h5><p>å­—ç¬¦ä¸²çš„åˆ†é…å’Œå…¶ä»–çš„å¯¹è±¡åˆ†é…ä¸€æ ·ï¼Œè€—è´¹é«˜æ˜‚çš„æ—¶é—´ä¸ç©ºé—´ä»£ä»·ï¼Œä½œä¸ºæœ€åŸºç¡€çš„æ•°æ®ç±»å‹ï¼Œå¤§é‡é¢‘ç¹çš„åˆ›å»ºå­—ç¬¦ä¸²ï¼Œæå¤§ç¨‹åº¦åœ°å½±å“ç¨‹åºçš„æ€§èƒ½ã€‚JVMä¸ºäº†æé«˜æ€§èƒ½å’Œå‡å°‘å†…å­˜å¼€é”€ï¼Œåœ¨å®ä¾‹åŒ–å­—ç¬¦ä¸²å¸¸é‡çš„æ—¶å€™è¿›è¡Œäº†ä¸€äº›ä¼˜åŒ–ï¼š</p><ul><li>ä¸ºå­—ç¬¦ä¸²<strong>å¼€è¾Ÿä¸€ä¸ªå­—ç¬¦ä¸²å¸¸é‡æ± ï¼Œç±»ä¼¼äºç¼“å­˜åŒº</strong></li><li>åˆ›å»ºå­—ç¬¦ä¸²å¸¸é‡æ—¶ï¼Œé¦–å…ˆæŸ¥è¯¢å­—ç¬¦ä¸²å¸¸é‡æ± æ˜¯å¦å­˜åœ¨è¯¥å­—ç¬¦ä¸²</li><li>å­˜åœ¨è¯¥å­—ç¬¦ä¸²ï¼Œè¿”å›å¼•ç”¨å®ä¾‹ï¼Œä¸å­˜åœ¨ï¼Œå®ä¾‹åŒ–è¯¥å­—ç¬¦ä¸²å¹¶æ”¾å…¥æ± ä¸­</li></ul><p>ä¸‰ç§å­—ç¬¦ä¸²æ“ä½œ(Jdk1.7 åŠä»¥ä¸Šç‰ˆæœ¬)</p><ol><li><p><strong>ç›´æ¥èµ‹å€¼</strong></p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>String s = &quot;æœ‰æ¢¦æƒ³çš„è‚¥å®…&quot;; // s ï¼šæŒ‡å‘å¸¸é‡æ± ä¸­çš„å¼•ç”¨
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>**PSï¼š**è¿™ç§æ–¹å¼åˆ›å»ºçš„å­—ç¬¦ä¸²å¯¹è±¡ï¼Œ<strong>åªä¼šåœ¨å¸¸é‡æ± ä¸­</strong>ã€‚</p><p>åˆ›å»ºæ­¥éª¤ï¼š</p><p>JVMä¼šå…ˆå»å¸¸é‡æ± ä¸­é€šè¿‡ equals(key) æ–¹æ³•ï¼Œåˆ¤æ–­æ˜¯å¦æœ‰ç›¸åŒçš„å¯¹è±¡ï¼š</p><ul><li><strong>æœ‰</strong>ï¼Œåˆ™<strong>ç›´æ¥è¿”å›è¯¥å¯¹è±¡åœ¨å¸¸é‡æ± ä¸­çš„å¼•ç”¨</strong></li><li><strong>æ²¡æœ‰</strong>ï¼Œåˆ™ä¼šåœ¨<strong>å¸¸é‡æ± ä¸­åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼Œå†è¿”å›å¼•ç”¨</strong></li></ul></li><li><p><strong>new String()æ–¹æ³•åˆ›å»º</strong></p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>String s1 = new String(&quot;æœ‰æ¢¦æƒ³çš„è‚¥å®…&quot;); // s1æŒ‡å‘å†…å­˜ä¸­çš„å¯¹è±¡å¼•ç”¨
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>PSï¼š<strong>è¿™ç§æ–¹å¼ä¼šä¿è¯</strong>å­—ç¬¦ä¸²å¸¸é‡æ± å’Œå †ä¸­éƒ½æœ‰è¿™ä¸ªå¯¹è±¡</strong>ï¼Œæ²¡æœ‰å°±åˆ›å»ºï¼Œæœ€å<strong>è¿”å›å †å†…å­˜ä¸­çš„å¯¹è±¡å¼•ç”¨</strong>ã€‚</p><p><strong>åˆ›å»ºæ­¥éª¤ï¼š</strong></p><p>å› ä¸ºæœ‰&quot;æœ‰æ¢¦æƒ³çš„è‚¥å®…&quot;è¿™ä¸ªå­—é¢é‡ï¼Œæ‰€ä»¥ä¼šå…ˆæ£€æŸ¥å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­æ˜¯å¦å­˜åœ¨æ­¤å­—ç¬¦ä¸²ï¼š</p><ul><li><strong>ä¸å­˜åœ¨</strong>ï¼Œå…ˆåœ¨å­—ç¬¦ä¸²å¸¸é‡æ± é‡Œåˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡ï¼Œå†å»å †å†…å­˜ä¸­åˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡&quot;æœ‰æ¢¦æƒ³çš„è‚¥å®…&quot;</li><li><strong>å­˜åœ¨</strong>ï¼Œå°±ç›´æ¥å»å †å†…å­˜ä¸­åˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡&quot;æœ‰æ¢¦æƒ³çš„è‚¥å®…&quot;ï¼Œ æœ€åï¼Œå°†å†…å­˜ä¸­çš„å¼•ç”¨è¿”å›</li></ul></li><li><p><strong>intern()æ–¹æ³•</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">String</span> s1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">&quot;æœ‰æ¢¦æƒ³çš„è‚¥å®…&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token class-name">String</span> s2 <span class="token operator">=</span> s1<span class="token punctuation">.</span><span class="token function">intern</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//s1.intern()è¿”å›çš„ä¸²æ± ä¸­çš„å¯¹è±¡ï¼Œs1å¼•ç”¨çš„æ˜¯å †ä¸­çš„å¯¹è±¡</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s1 <span class="token operator">==</span> s2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//false</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>**PSï¼š**è¿™ä¸ªæ–¹æ³•æ˜¯å°è¯•å°†å­—ç¬¦ä¸²å¯¹è±¡æ”¾å…¥ä¸²æ± ï¼Œå¦‚æœæœ‰åˆ™ä¸æ”¾å…¥ï¼Œå¦‚æœæ²¡æœ‰åˆ™æ”¾å…¥ä¸²æ± ï¼Œå¹¶æŠŠä¸²æ± ä¸­çš„å¯¹è±¡è¿”å›ã€‚</p><p><strong>åˆ›å»ºæ­¥éª¤ï¼š</strong></p><p>è¿˜æ˜¯ä¼šå»å¸¸é‡æ± æ‰¾çœ‹æœ‰æ²¡æœ‰&quot;æœ‰æ¢¦æƒ³çš„è‚¥å®…&quot;è¿™ä¸ªå­—ç¬¦ä¸²ï¼š</p><ul><li><strong>å­˜åœ¨</strong>ï¼Œåˆ™è¿”å›ä¸²æ± ä¸­çš„å¯¹è±¡å¼•ç”¨</li><li><strong>ä¸å­˜åœ¨</strong>ï¼ŒæŠŠå­—ç¬¦ä¸²æ”¾å…¥ä¸²æ± ï¼Œå¹¶è¿”å›ä¸²æ± ä¸­çš„å¯¹è±¡ å¼•ç”¨</li></ul><p>**PSï¼š**jdk1.6ç‰ˆæœ¬éœ€è¦å°† s1 å¤åˆ¶åˆ°å­—ç¬¦ä¸²å¸¸é‡æ± é‡Œ</p></li></ol><p></p><h5 id="å…«ç§åŸºæœ¬ç±»å‹çš„åŒ…è£…ç±»å’Œå¯¹è±¡æ± " tabindex="-1"><a class="header-anchor" href="#å…«ç§åŸºæœ¬ç±»å‹çš„åŒ…è£…ç±»å’Œå¯¹è±¡æ± " aria-hidden="true">#</a> å…«ç§åŸºæœ¬ç±»å‹çš„åŒ…è£…ç±»å’Œå¯¹è±¡æ± </h5><p>javaä¸­åŸºæœ¬ç±»å‹çš„åŒ…è£…ç±»çš„å¤§éƒ¨åˆ†éƒ½å®ç°äº†å¸¸é‡æ± æŠ€æœ¯ï¼ˆä¸¥æ ¼æ¥è¯´å¯¹è±¡åœ¨å †ä¸Šåº”è¯¥å«å¯¹è±¡æ± ï¼‰ï¼Œè¿™äº›ç±»æ˜¯ Byteã€Shortã€Integerã€Longã€Characterã€Booleanï¼Œå¦å¤–ä¸¤ç§æµ®ç‚¹æ•°ç±»å‹çš„åŒ…è£…ç±»åˆ™æ²¡æœ‰å®ç°ã€‚</p><p>**PSï¼š**Byte,Short,Integer,Long,Characterè¿™5ç§æ•´å‹çš„åŒ…è£…ç±»ä¹Ÿåªæ˜¯åœ¨å¯¹åº”å€¼å°äºç­‰äº127æ—¶æ‰å¯ä½¿ç”¨å¯¹è±¡æ± ï¼Œå› ä¸ºä¸€èˆ¬è¿™ç§æ¯”è¾ƒå°çš„æ•°ç”¨åˆ°çš„æ¦‚ç‡ç›¸å¯¹è¾ƒå¤§ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//1ã€5ç§æ•´å½¢çš„åŒ…è£…ç±»Byte,Short,Integer,Long,Characterçš„å¯¹è±¡ï¼Œåœ¨å€¼å°äº127æ—¶å¯ä»¥ä½¿ç”¨å¯¹è±¡æ± </span>
        <span class="token class-name">Integer</span> i1 <span class="token operator">=</span> <span class="token number">127</span><span class="token punctuation">;</span> <span class="token comment">//PSï¼šè¿™ç§è°ƒç”¨åº•å±‚å®é™…æ˜¯æ‰§è¡Œçš„Integer.valueOf(127)ï¼Œé‡Œé¢ç”¨åˆ°äº†IntegerCacheå¯¹è±¡æ± </span>
        <span class="token class-name">Integer</span> i2 <span class="token operator">=</span> <span class="token number">127</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>i1 <span class="token operator">==</span> i2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è¾“å‡ºtrue</span>

        <span class="token comment">//2ã€å½“å€¼å¤§äº127æ—¶ï¼Œä¸ä¼šä»å¯¹è±¡æ± ä¸­å–å¯¹è±¡</span>
        <span class="token class-name">Integer</span> i3 <span class="token operator">=</span> <span class="token number">128</span><span class="token punctuation">;</span>
        <span class="token class-name">Integer</span> i4 <span class="token operator">=</span> <span class="token number">128</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>i3 <span class="token operator">==</span> i4<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è¾“å‡ºfalse</span>

        <span class="token comment">//3ã€ç”¨newå…³é”®è¯æ–°ç”Ÿæˆå¯¹è±¡ä¸ä¼šä½¿ç”¨å¯¹è±¡æ± </span>
        <span class="token class-name">Integer</span> i5 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Integer</span><span class="token punctuation">(</span><span class="token number">127</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Integer</span> i6 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Integer</span><span class="token punctuation">(</span><span class="token number">127</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>i5 <span class="token operator">==</span> i6<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è¾“å‡ºfalse</span>

        <span class="token comment">//4ã€Booleanç±»ä¹Ÿå®ç°äº†å¯¹è±¡æ± æŠ€æœ¯</span>
        <span class="token class-name">Boolean</span> bool1 <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token class-name">Boolean</span> bool2 <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>bool1 <span class="token operator">==</span> bool2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è¾“å‡ºtrue</span>

        <span class="token comment">//5ã€æµ®ç‚¹ç±»å‹çš„åŒ…è£…ç±»æ²¡æœ‰å®ç°å¯¹è±¡æ± æŠ€æœ¯</span>
        <span class="token class-name">Double</span> d1 <span class="token operator">=</span> <span class="token number">1.0D</span><span class="token punctuation">;</span>
        <span class="token class-name">Double</span> d2 <span class="token operator">=</span> <span class="token number">1.0D</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>d1 <span class="token operator">==</span> d2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è¾“å‡ºfalse</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="stringtableè¯¦è§£-å°±æ˜¯ä¸²æ± " tabindex="-1"><a class="header-anchor" href="#stringtableè¯¦è§£-å°±æ˜¯ä¸²æ± " aria-hidden="true">#</a> StringTableè¯¦è§£(å°±æ˜¯ä¸²æ± )</h3><p>é¦–å…ˆæ¥çœ‹ä¸€ä¸ªä»£ç ç¤ºä¾‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// StringTable [ &quot;a&quot;, &quot;b&quot; ,&quot;ab&quot; ]  hashtable ç»“æ„ï¼Œä¸èƒ½æ‰©å®¹</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Demo1_22</span> <span class="token punctuation">{</span>
    <span class="token comment">// å¸¸é‡æ± ä¸­çš„ä¿¡æ¯ï¼Œéƒ½ä¼šè¢«åŠ è½½åˆ°è¿è¡Œæ—¶å¸¸é‡æ± ä¸­ï¼Œ è¿™æ—¶ a b ab éƒ½æ˜¯å¸¸é‡æ± ä¸­çš„ç¬¦å·ï¼Œè¿˜æ²¡æœ‰å˜ä¸º java å­—ç¬¦ä¸²å¯¹è±¡</span>
    <span class="token comment">// ldc #2 ä¼šæŠŠ a ç¬¦å·å˜ä¸º &quot;a&quot; å­—ç¬¦ä¸²å¯¹è±¡</span>
    <span class="token comment">// ldc #3 ä¼šæŠŠ b ç¬¦å·å˜ä¸º &quot;b&quot; å­—ç¬¦ä¸²å¯¹è±¡</span>
    <span class="token comment">// ldc #4 ä¼šæŠŠ ab ç¬¦å·å˜ä¸º &quot;ab&quot; å­—ç¬¦ä¸²å¯¹è±¡</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> s1 <span class="token operator">=</span> <span class="token string">&quot;a&quot;</span><span class="token punctuation">;</span> <span class="token comment">// æ‡’æƒ°çš„</span>
        <span class="token class-name">String</span> s2 <span class="token operator">=</span> <span class="token string">&quot;b&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> s3 <span class="token operator">=</span> <span class="token string">&quot;ab&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> s4 <span class="token operator">=</span> s1 <span class="token operator">+</span> s2<span class="token punctuation">;</span> <span class="token comment">// new StringBuilder().append(&quot;a&quot;).append(&quot;b&quot;).toString()  new String(&quot;ab&quot;)</span>
        <span class="token comment">// new String ä¼šåœ¨å¸¸é‡æ± å’Œå †å†…å­˜ä¸­åŒæ—¶åˆ›å»ºå¯¹è±¡ï¼Œä½†å¼•ç”¨çš„æ˜¯å †å†…å­˜ä¸­çš„å¼•ç”¨</span>
        <span class="token class-name">String</span> s5 <span class="token operator">=</span> <span class="token string">&quot;a&quot;</span> <span class="token operator">+</span> <span class="token string">&quot;b&quot;</span><span class="token punctuation">;</span>  <span class="token comment">// javac åœ¨ç¼–è¯‘æœŸé—´çš„ä¼˜åŒ–ï¼Œç»“æœå·²ç»åœ¨ç¼–è¯‘æœŸç¡®å®šä¸ºab</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s3 <span class="token operator">==</span> s5<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> ap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// è¿™é‡Œæ³¨æ„ä¸€ä¸‹ï¼Œé€šè¿‡new ç›¸åŠ ï¼Œè¿™é‡Œaï¼Œbéƒ½ä¼šæ£€æŸ¥å¸¸é‡æ± ï¼Œä½†æ˜¯æœ€åç”Ÿæˆçš„ç»“æœ&quot;ab&quot;ä¸ä¼šä¿å­˜åˆ°å¸¸é‡æ± </span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç¼–è¯‘è¿‡ç¨‹ä¸­é‡åˆ°ç¼–ç é—®é¢˜ï¼Œå¯ä»¥é€šè¿‡-encodingæ¥æŒ‡å®šç¼–ç ï¼Œå¦‚ä¸‹ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>javac <span class="token parameter variable">-encoding</span> utf-8 Demo1_22.java
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>æ¥æŸ¥çœ‹ä¸€ä¸‹ç¼–è¯‘åæ–‡ä»¶çš„è¯¦ç»†ä¿¡æ¯ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>Classfile /D:/path/to/Demo1_22.class
  Last modified 2022-5-11; size 776 bytes
  MD5 checksum 141d5699097730cd03bba544e9b27e1c
  Compiled from &quot;Demo1_22.java&quot;
public class cn.itcast.jvm.t1.stringtable.Demo1_22
  minor version: 0
  major version: 52
  flags: ACC_PUBLIC, ACC_SUPER
Constant pool:
   #1 = Methodref          #12.#25        // java/lang/Object.&quot;&lt;init&gt;&quot;:()V
   #2 = String             #26            // a
   #3 = String             #27            // b
   #4 = String             #28            // ab
   #5 = Class              #29            // java/lang/StringBuilder
   #6 = Methodref          #5.#25         // java/lang/StringBuilder.&quot;&lt;init&gt;&quot;:()V
   #7 = Methodref          #5.#30         // java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;
   #8 = Methodref          #5.#31         // java/lang/StringBuilder.toString:()Ljava/lang/String;
   #9 = Fieldref           #32.#33        // java/lang/System.out:Ljava/io/PrintStream;
  #10 = Methodref          #34.#35        // java/io/PrintStream.println:(Z)V
  #11 = Class              #36            // cn/itcast/jvm/t1/stringtable/Demo1_22
  #12 = Class              #37            // java/lang/Object
  #13 = Utf8               &lt;init&gt;
  #14 = Utf8               ()V
  #15 = Utf8               Code
  #16 = Utf8               LineNumberTable
  #17 = Utf8               main
  #18 = Utf8               ([Ljava/lang/String;)V
  #19 = Utf8               StackMapTable
  #20 = Class              #38            // &quot;[Ljava/lang/String;&quot;
  #21 = Class              #39            // java/lang/String
  #22 = Class              #40            // java/io/PrintStream
  #23 = Utf8               SourceFile
  #24 = Utf8               Demo1_22.java
  #25 = NameAndType        #13:#14        // &quot;&lt;init&gt;&quot;:()V
  #26 = Utf8               a
  #27 = Utf8               b
  #28 = Utf8               ab
  #29 = Utf8               java/lang/StringBuilder
  #30 = NameAndType        #41:#42        // append:(Ljava/lang/String;)Ljava/lang/StringBuilder;
  #31 = NameAndType        #43:#44        // toString:()Ljava/lang/String;
  #32 = Class              #45            // java/lang/System
  #33 = NameAndType        #46:#47        // out:Ljava/io/PrintStream;
  #34 = Class              #40            // java/io/PrintStream
  #35 = NameAndType        #48:#49        // println:(Z)V
  #36 = Utf8               cn/itcast/jvm/t1/stringtable/Demo1_22
  #37 = Utf8               java/lang/Object
  #38 = Utf8               [Ljava/lang/String;
  #39 = Utf8               java/lang/String
  #40 = Utf8               java/io/PrintStream
  #41 = Utf8               append
  #42 = Utf8               (Ljava/lang/String;)Ljava/lang/StringBuilder;
  #43 = Utf8               toString
  #44 = Utf8               ()Ljava/lang/String;
  #45 = Utf8               java/lang/System
  #46 = Utf8               out
  #47 = Utf8               Ljava/io/PrintStream;
  #48 = Utf8               println
  #49 = Utf8               (Z)V
{
  public cn.itcast.jvm.t1.stringtable.Demo1_22();
    descriptor: ()V
    flags: ACC_PUBLIC
    Code:
      stack=1, locals=1, args_size=1
         0: aload_0
         1: invokespecial #1                  // Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V
         4: return
      LineNumberTable:
        line 4: 0

  public static void main(java.lang.String[]);
    descriptor: ([Ljava/lang/String;)V
    flags: ACC_PUBLIC, ACC_STATIC
    Code:
      stack=3, locals=6, args_size=1
         0: ldc           #2                  // String a
         2: astore_1
         3: ldc           #3                  // String b
         5: astore_2
         6: ldc           #4                  // String ab
         8: astore_3
         9: new           #5                  // class java/lang/StringBuilder
        12: dup
        13: invokespecial #6                  // Method java/lang/StringBuilder.&quot;&lt;init&gt;&quot;:()V
        16: aload_1
        17: invokevirtual #7                  // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;
        20: aload_2
        21: invokevirtual #7                  // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;
        24: invokevirtual #8                  // Method java/lang/StringBuilder.toString:()Ljava/lang/String;
        27: astore        4
        29: ldc           #4                  // String ab
        31: astore        5
        33: getstatic     #9                  // Field java/lang/System.out:Ljava/io/PrintStream;
        36: aload_3
        37: aload         5
        39: if_acmpne     46
        42: iconst_1
        43: goto          47
        46: iconst_0
        47: invokevirtual #10                 // Method java/io/PrintStream.println:(Z)V
        50: return
      LineNumberTable:
        line 11: 0
        line 12: 3
        line 13: 6
        line 14: 9
        line 15: 29
        line 17: 33
        line 21: 50
      StackMapTable: number_of_entries = 2
        frame_type = 255 /* full_frame */
          offset_delta = 46
          locals = [ class &quot;[Ljava/lang/String;&quot;, class java/lang/String, class java/lang/String, class java/lang/String, class java/lang/String, class java/lang/String ]
          stack = [ class java/io/PrintStream ]
        frame_type = 255 /* full_frame */
          offset_delta = 0
          locals = [ class &quot;[Ljava/lang/String;&quot;, class java/lang/String, class java/lang/String, class java/lang/String, class java/lang/String, class java/lang/String ]
          stack = [ class java/io/PrintStream, int ]
}
SourceFile: &quot;Demo1_22.java&quot;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸‹é¢æ¥çœ‹å‡ é“é¢è¯•é¢˜ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">String</span> s1 <span class="token operator">=</span> <span class="token string">&quot;a&quot;</span><span class="token punctuation">;</span> 
<span class="token class-name">String</span> s2 <span class="token operator">=</span> <span class="token string">&quot;b&quot;</span><span class="token punctuation">;</span> 
<span class="token class-name">String</span> s3 <span class="token operator">=</span> <span class="token string">&quot;a&quot;</span> <span class="token operator">+</span> <span class="token string">&quot;b&quot;</span><span class="token punctuation">;</span> 
<span class="token class-name">String</span> s4 <span class="token operator">=</span> s1 <span class="token operator">+</span> s2<span class="token punctuation">;</span> 
<span class="token class-name">String</span> s5 <span class="token operator">=</span> <span class="token string">&quot;ab&quot;</span><span class="token punctuation">;</span> 
<span class="token class-name">String</span> s6 <span class="token operator">=</span> s4<span class="token punctuation">.</span><span class="token function">intern</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 

<span class="token comment">// é—® </span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s3 <span class="token operator">==</span> s4<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s3 <span class="token operator">==</span> s5<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s3 <span class="token operator">==</span> s6<span class="token punctuation">)</span><span class="token punctuation">;</span> 

<span class="token class-name">String</span> x2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">&quot;c&quot;</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">&quot;d&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token class-name">String</span> x1 <span class="token operator">=</span> <span class="token string">&quot;cd&quot;</span><span class="token punctuation">;</span> 
x2<span class="token punctuation">.</span><span class="token function">intern</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// é—®ï¼Œå¦‚æœè°ƒæ¢äº†ã€æœ€åä¸¤è¡Œä»£ç ã€‘çš„ä½ç½®å‘¢ï¼Œå¦‚æœæ˜¯jdk1.6å‘¢ </span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>x1 <span class="token operator">==</span> x2<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="stringtableå­˜å‚¨ä½ç½®" tabindex="-1"><a class="header-anchor" href="#stringtableå­˜å‚¨ä½ç½®" aria-hidden="true">#</a> StringTableå­˜å‚¨ä½ç½®</h4><p>Java 8 ä¸­çš„å­˜å‚¨ä½ç½®ï¼š</p><img src="/assets/image-20220511132237266-1b4f730d.png" alt="image-20220511132237266" style="zoom:40%;"><p>java 6 ä¸­çš„å­˜å‚¨ä½ç½®ï¼š</p><img src="/assets/image-20220511132330620-006325af.png" alt="image-20220511132330620" style="zoom:40%;"><p>å°†ä¸²æ± è½¬ç§»åˆ°å †å†…å­˜åï¼Œæ›´æœ‰åˆ©äºå†…å­˜çš„å›æ”¶</p><h4 id="stringtableçš„ç‰¹æ€§" tabindex="-1"><a class="header-anchor" href="#stringtableçš„ç‰¹æ€§" aria-hidden="true">#</a> StringTableçš„ç‰¹æ€§</h4><ul><li><p>å¸¸é‡æ± ä¸­çš„å­—ç¬¦ä¸²ä»…æ˜¯ç¬¦å·ï¼Œç¬¬ä¸€æ¬¡ç”¨åˆ°æ—¶æ‰å˜ä¸ºå¯¹è±¡</p></li><li><p>åˆ©ç”¨ä¸²æ± çš„æœºåˆ¶ï¼Œæ¥é¿å…é‡å¤åˆ›å»ºå­—ç¬¦ä¸²å¯¹è±¡</p></li><li><p>å­—ç¬¦ä¸²å˜é‡æ‹¼æ¥çš„åŸç†æ˜¯ StringBuilder ï¼ˆ1.8ï¼‰</p></li><li><p>å­—ç¬¦ä¸²å¸¸é‡æ‹¼æ¥çš„åŸç†æ˜¯ç¼–è¯‘æœŸä¼˜åŒ–</p></li><li><p>å¯ä»¥ä½¿ç”¨ intern æ–¹æ³•ï¼Œä¸»åŠ¨å°†ä¸²æ± ä¸­è¿˜æ²¡æœ‰çš„å­—ç¬¦ä¸²å¯¹è±¡æ”¾å…¥ä¸²æ± </p><ul><li><p>1.8 å°†è¿™ä¸ªå­—ç¬¦ä¸²å¯¹è±¡å°è¯•æ”¾å…¥ä¸²æ± ï¼Œå¦‚æœæœ‰åˆ™å¹¶ä¸ä¼šæ”¾å…¥ï¼Œå¦‚æœæ²¡æœ‰åˆ™æ”¾å…¥ä¸²æ± ï¼Œ ä¼šæŠŠä¸²æ± ä¸­çš„å¯¹è±¡è¿”å›</p></li><li><p>1.6 å°†è¿™ä¸ªå­—ç¬¦ä¸²å¯¹è±¡å°è¯•æ”¾å…¥ä¸²æ± ï¼Œå¦‚æœæœ‰åˆ™å¹¶ä¸ä¼šæ”¾å…¥ï¼Œå¦‚æœæ²¡æœ‰ä¼šæŠŠæ­¤å¯¹è±¡å¤åˆ¶ä¸€ä»½ï¼Œæ”¾å…¥ä¸²æ± ï¼Œ ä¼šæŠŠä¸²æ± ä¸­çš„å¯¹è±¡è¿”å›</p></li></ul></li></ul><h4 id="stringtableè°ƒä¼˜" tabindex="-1"><a class="header-anchor" href="#stringtableè°ƒä¼˜" aria-hidden="true">#</a> StringTableè°ƒä¼˜</h4><p>StringTableçš„å®ç°ç±»ä¼¼äºHashè¡¨ï¼Œé»˜è®¤çš„æ¡¶å¤§å°æ˜¯65535ï¼ˆåœ¨Java11ä¸­ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨å‚æ•°-XX:StringTableSzie=655350 æ¥è¿›è¡Œè°ƒæ•´ã€‚</p><p>å½“é¡¹ç›®ä¸­å­—ç¬¦ä¸²å˜é‡è¾ƒå¤šæ—¶ï¼Œå¯ä»¥é€‚å½“å¢åŠ StringTableçš„å¤§å°ï¼Œæ¥æé«˜è¿è¡Œæ•ˆç‡ã€‚</p><h3 id="ç›´æ¥å†…å­˜" tabindex="-1"><a class="header-anchor" href="#ç›´æ¥å†…å­˜" aria-hidden="true">#</a> ç›´æ¥å†…å­˜</h3><p>ä¼˜ç‚¹ï¼š</p><ul><li><p>å¸¸è§äº NIO æ“ä½œæ—¶ï¼Œç”¨äºæ•°æ®ç¼“å†²åŒº</p></li><li><p>åˆ†é…å›æ”¶æˆæœ¬è¾ƒé«˜ï¼Œä½†è¯»å†™æ€§èƒ½é«˜</p></li><li><p>ä¸å— JVM å†…å­˜å›æ”¶ç®¡ç†</p></li></ul><p>é¦–å…ˆæ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * æ¼”ç¤º ByteBuffer ä½œç”¨
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Demo1_9</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">FROM</span> <span class="token operator">=</span> <span class="token string">&quot;E:\\path\\to\\big-file.mp4&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">TO</span> <span class="token operator">=</span> <span class="token string">&quot;E:\\a.mp4&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> _1Mb <span class="token operator">=</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">io</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// io ç”¨æ—¶ï¼š1535.586957 1766.963399 1359.240226</span>
        <span class="token function">directBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// directBuffer ç”¨æ—¶ï¼š479.295165 702.291454 562.56592</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">directBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">long</span> start <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">nanoTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">FileChannel</span> from <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token constant">FROM</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token class-name">FileChannel</span> <span class="token keyword">to</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span><span class="token constant">TO</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">ByteBuffer</span> bb <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocateDirect</span><span class="token punctuation">(</span>_1Mb<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">int</span> len <span class="token operator">=</span> from<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>bb<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>len <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                bb<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">to</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>bb<span class="token punctuation">)</span><span class="token punctuation">;</span>
                bb<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">long</span> end <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">nanoTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;directBuffer ç”¨æ—¶ï¼š&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>end <span class="token operator">-</span> start<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000_000.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">io</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">long</span> start <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">nanoTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">FileInputStream</span> from <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token constant">FROM</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token class-name">FileOutputStream</span> <span class="token keyword">to</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span><span class="token constant">TO</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> buf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span>_1Mb<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">int</span> len <span class="token operator">=</span> from<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>len <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">to</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">long</span> end <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">nanoTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;io ç”¨æ—¶ï¼š&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>end <span class="token operator">-</span> start<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000_000.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>NIOä¼šå¿«å¾ˆå¤š</p><h4 id="æ–‡ä»¶è¯»å†™æµç¨‹" tabindex="-1"><a class="header-anchor" href="#æ–‡ä»¶è¯»å†™æµç¨‹" aria-hidden="true">#</a> æ–‡ä»¶è¯»å†™æµç¨‹ï¼š</h4><p>ç›´æ¥å†…å­˜æº¢å‡º</p><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token key attr-name">Exception</span> <span class="token value attr-value">in thread &quot;main&quot; java.lang.OutOfMemoryErrorï¼š Direct buffer memory</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ç¦ç”¨æ˜¾ç¤ºçš„åƒåœ¾å›æ”¶</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>-XX:DisableExplicitGC  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="ç›´æ¥å†…å­˜çš„ç”³è¯·é‡Šæ”¾" tabindex="-1"><a class="header-anchor" href="#ç›´æ¥å†…å­˜çš„ç”³è¯·é‡Šæ”¾" aria-hidden="true">#</a> ç›´æ¥å†…å­˜çš„ç”³è¯·é‡Šæ”¾</h4><p>åœ¨Javaä¸­åˆ†é…ç›´æ¥å†…å­˜ï¼Œå¤§æœ‰å¦‚ä¸‹ä¸‰ç§ä¸»è¦æ–¹å¼ï¼š</p><ol><li>Unsafe.allocateMemory()</li><li>ByteBuffer.allocateDirect()</li><li>nativeæ–¹æ³•</li></ol><h5 id="unsafeç±»" tabindex="-1"><a class="header-anchor" href="#unsafeç±»" aria-hidden="true">#</a> Unsafeç±»</h5><p>åœ¨unsafeç±»ä¸­ï¼Œæä¾›äº†ä¸¤ä¸ªæ–¹æ³•æ¥è¿›è¡Œç›´æ¥å†…å­˜çš„åˆ†é…å’Œé‡Šæ”¾</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// ç”³è¯·ç›´æ¥å†…å­˜å†…å­˜</span>
<span class="token keyword">public</span> <span class="token keyword">native</span> <span class="token keyword">long</span> <span class="token function">allocateMemory</span><span class="token punctuation">(</span><span class="token keyword">long</span> var1<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// é‡Šæ”¾ç›´æ¥å†…å­˜</span>
<span class="token keyword">public</span> <span class="token keyword">native</span> <span class="token keyword">void</span> <span class="token function">freeMemory</span><span class="token punctuation">(</span><span class="token keyword">long</span> var1<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸‹é¢ç»™å‡ºä¸€ä¸ªä½¿ç”¨çš„ä¾‹å­ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">static</span> <span class="token keyword">int</span> _1Gb <span class="token operator">=</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">Unsafe</span> unsafe <span class="token operator">=</span> <span class="token class-name">Unsafe</span><span class="token punctuation">.</span><span class="token function">getUnsafe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// åˆ†é…å†…å­˜</span>
    <span class="token keyword">long</span> base <span class="token operator">=</span> unsafe<span class="token punctuation">.</span><span class="token function">allocateMemory</span><span class="token punctuation">(</span>_1Gb<span class="token punctuation">)</span><span class="token punctuation">;</span>
    unsafe<span class="token punctuation">.</span><span class="token function">setMemory</span><span class="token punctuation">(</span>base<span class="token punctuation">,</span> _1Gb<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>in<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// é‡Šæ”¾å†…å­˜</span>
    unsafe<span class="token punctuation">.</span><span class="token function">freeMemory</span><span class="token punctuation">(</span>base<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>in<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="bytebufferç±»" tabindex="-1"><a class="header-anchor" href="#bytebufferç±»" aria-hidden="true">#</a> ByteBufferç±»</h5><p>Unsafeæ˜¯ä¸€ä¸ªååˆ†åŸå§‹çš„åº•å±‚æ–¹æ³•ï¼Œä¸é€‚åˆå¼€å‘è€…ä½¿ç”¨ã€‚è€ŒByteBufferåˆ™æ˜¯ç•™ç»™å¼€å‘è€…ä½¿ç”¨çš„ã€‚ä¸‹é¢æ¥çœ‹ä¸€ä¸‹å…¶å®ç°ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ByteBuffer</span> <span class="token function">allocateDirect</span><span class="token punctuation">(</span><span class="token keyword">int</span> capacity<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">DirectByteBuffer</span><span class="token punctuation">(</span>capacity<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥çœ‹åˆ°ï¼Œä»–åˆ›å»ºäº†ä¸€ä¸ª<code>DirectByteBuffer</code>å¯¹è±¡</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">DirectByteBuffer</span><span class="token punctuation">(</span><span class="token keyword">int</span> cap<span class="token punctuation">)</span> <span class="token punctuation">{</span>                   <span class="token comment">// package-private</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> cap<span class="token punctuation">,</span> cap<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// è®¡ç®—éœ€è¦åˆ†é…å†…å­˜çš„å¤§å°</span>
    <span class="token keyword">boolean</span> pa <span class="token operator">=</span> <span class="token constant">VM</span><span class="token punctuation">.</span><span class="token function">isDirectMemoryPageAligned</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> ps <span class="token operator">=</span> <span class="token class-name">Bits</span><span class="token punctuation">.</span><span class="token function">pageSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">long</span> size <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>cap <span class="token operator">+</span> <span class="token punctuation">(</span>pa <span class="token operator">?</span> ps <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Bits</span><span class="token punctuation">.</span><span class="token function">reserveMemory</span><span class="token punctuation">(</span>size<span class="token punctuation">,</span> cap<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// åˆ†é…ç›´æ¥å†…å­˜</span>
    <span class="token keyword">long</span> base <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        base <span class="token operator">=</span> <span class="token constant">UNSAFE</span><span class="token punctuation">.</span><span class="token function">allocateMemory</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">OutOfMemoryError</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Bits</span><span class="token punctuation">.</span><span class="token function">unreserveMemory</span><span class="token punctuation">(</span>size<span class="token punctuation">,</span> cap<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">throw</span> x<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token constant">UNSAFE</span><span class="token punctuation">.</span><span class="token function">setMemory</span><span class="token punctuation">(</span>base<span class="token punctuation">,</span> size<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// è®¡ç®—å†…å­˜åœ°å€</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>pa <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>base <span class="token operator">%</span> ps <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Round up to page boundary</span>
        address <span class="token operator">=</span> base <span class="token operator">+</span> ps <span class="token operator">-</span> <span class="token punctuation">(</span>base <span class="token operator">&amp;</span> <span class="token punctuation">(</span>ps <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        address <span class="token operator">=</span> base<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// åˆ›å»ºcleaner</span>
    cleaner <span class="token operator">=</span> <span class="token class-name">Cleaner</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Deallocator</span><span class="token punctuation">(</span>base<span class="token punctuation">,</span> size<span class="token punctuation">,</span> cap<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    att <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥çœ‹åˆ°ï¼ŒDirectByteBufferä¹Ÿæ˜¯é€šè¿‡<code>UNSAFE.allocateMemory(size)</code>æ¥ç”³è¯·çš„ç›´æ¥å†…å­˜ç©ºé—´ã€‚é‚£ä¹ˆé‡Šæ”¾ç›´æ¥å†…å­˜çš„åœ¨å“ªé‡Œå‘¢ï¼Ÿ</p><p>å¯ä»¥çœ‹åˆ°è¿™ä¹ˆä¸€è¡Œä»£ç ï¼š<code>cleaner = Cleaner.create(this, new Deallocator(base, size, cap));</code></p><p>Cleanerç»§æ‰¿è‡ª<code>PhantomReference</code>ï¼Œæ‰€ä»¥å½“åƒåœ¾å›æ”¶å™¨åœ¨å›æ”¶<code>DirectByteBuffer</code>è¿™ä¸ªå¯¹è±¡æ—¶ï¼Œå°±ä¼šåŒæ­¥å¯¹cleanerè¿›è¡Œå›æ”¶å·¥ä½œï¼›</p><p>TODO è¡¥å……ä¸€ä¸‹è™šå¼•ç”¨</p><p>Deallocatorçš„å®ç°</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Deallocator</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">long</span> address<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">long</span> size<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> capacity<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">Deallocator</span><span class="token punctuation">(</span><span class="token keyword">long</span> address<span class="token punctuation">,</span> <span class="token keyword">long</span> size<span class="token punctuation">,</span> <span class="token keyword">int</span> capacity<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">assert</span> <span class="token punctuation">(</span>address <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>address <span class="token operator">=</span> address<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>size <span class="token operator">=</span> size<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>capacity <span class="token operator">=</span> capacity<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>address <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// Paranoia</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token constant">UNSAFE</span><span class="token punctuation">.</span><span class="token function">freeMemory</span><span class="token punctuation">(</span>address<span class="token punctuation">)</span><span class="token punctuation">;</span>
        address <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token class-name">Bits</span><span class="token punctuation">.</span><span class="token function">unreserveMemory</span><span class="token punctuation">(</span>size<span class="token punctuation">,</span> capacity<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="åƒåœ¾å›æ”¶-1" tabindex="-1"><a class="header-anchor" href="#åƒåœ¾å›æ”¶-1" aria-hidden="true">#</a> åƒåœ¾å›æ”¶</h2><h3 id="å¦‚ä½•åˆ¤æ–­å¯¹è±¡å¯ä»¥è¢«å›æ”¶" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•åˆ¤æ–­å¯¹è±¡å¯ä»¥è¢«å›æ”¶" aria-hidden="true">#</a> å¦‚ä½•åˆ¤æ–­å¯¹è±¡å¯ä»¥è¢«å›æ”¶ï¼Ÿ</h3><h4 id="å¼•ç”¨è®¡æ•°æ³•" tabindex="-1"><a class="header-anchor" href="#å¼•ç”¨è®¡æ•°æ³•" aria-hidden="true">#</a> å¼•ç”¨è®¡æ•°æ³•</h4><p>æ¯ä¸ªå¯¹è±¡æœ‰ä¸€ä¸ªå¼•ç”¨è®¡æ•°å™¨ï¼Œå½“å¯¹è±¡è¢«å¼•ç”¨ä¸€æ¬¡åˆ™è®¡æ•°å™¨åŠ 1ï¼Œå½“å¯¹è±¡å¼•ç”¨å¤±æ•ˆä¸€æ¬¡åˆ™è®¡æ•°å™¨å‡1ï¼Œå¯¹äºä¸º0çš„å¯¹è±¡æ„å‘³ç€æ˜¯åƒåœ¾å¯¹è±¡ï¼Œå¯ä»¥è¢«GCå›æ”¶ã€‚</p><h4 id="å¯è¾¾æ€§åˆ†æ" tabindex="-1"><a class="header-anchor" href="#å¯è¾¾æ€§åˆ†æ" aria-hidden="true">#</a> å¯è¾¾æ€§åˆ†æ</h4><p>ä»GC Rootsä½œä¸ºèµ·ç‚¹å¼€å§‹æœç´¢ï¼Œé‚£ä¹ˆæ•´ä¸ªè¿é€šå›¾ä¸­çš„å¯¹è±¡ä¾¿éƒ½æ˜¯æ´»å¯¹è±¡ï¼Œå¯¹äºGC Rootsæ— æ³•åˆ°è¾¾çš„å¯¹è±¡ä¾¿æˆäº†åƒåœ¾å›æ”¶çš„å¯¹è±¡ï¼Œéšæ—¶å¯è¢«GCå›æ”¶</p><h4 id="å¯¹å¼•ç”¨è®¡æ•°å’Œå¯è¾¾æ€§åˆ†æç®—æ³•çš„åˆ†æ" tabindex="-1"><a class="header-anchor" href="#å¯¹å¼•ç”¨è®¡æ•°å’Œå¯è¾¾æ€§åˆ†æç®—æ³•çš„åˆ†æ" aria-hidden="true">#</a> å¯¹å¼•ç”¨è®¡æ•°å’Œå¯è¾¾æ€§åˆ†æç®—æ³•çš„åˆ†æ</h4><p>ç›®å‰è™šæ‹ŸæœºåŸºæœ¬éƒ½æ˜¯é‡‡ç”¨<strong>å¯è¾¾æ€§ç®—æ³•</strong>ï¼Œä¸ºä»€ä¹ˆä¸é‡‡ç”¨å¼•ç”¨è®¡æ•°ç®—æ³•å‘¢ï¼Ÿä¸‹é¢å°±è¯´è¯´å¼•ç”¨è®¡æ•°æ³•æ˜¯å¦‚ä½•ç»Ÿè®¡æ‰€æœ‰å¯¹è±¡çš„å¼•ç”¨è®¡æ•°çš„ï¼Œå†å¯¹æ¯”åˆ†æå¯è¾¾æ€§ç®—æ³•æ˜¯å¦‚ä½•è§£å†³å¼•ç”¨æŠ€æœ¯ç®—æ³•çš„ä¸è¶³ã€‚å…ˆç®€å•è¯´è¯´è¿™ä¸¤ä¸ªç®—æ³•ï¼š</p><ul><li><strong>å¼•ç”¨è®¡æ•°ç®—æ³•</strong>ï¼ˆ<a href="https://link.zhihu.com/?target=http%3A//www.memorymanagement.org/glossary/r.html%23reference.counting" target="_blank" rel="noopener noreferrer">reference-counting<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ï¼‰ ï¼šæ¯ä¸ªå¯¹è±¡æœ‰ä¸€ä¸ªå¼•ç”¨è®¡æ•°å™¨ï¼Œå½“å¯¹è±¡è¢«å¼•ç”¨ä¸€æ¬¡åˆ™è®¡æ•°å™¨åŠ 1ï¼Œå½“å¯¹è±¡å¼•ç”¨å¤±æ•ˆä¸€æ¬¡åˆ™è®¡æ•°å™¨å‡1ï¼Œå¯¹äºè®¡æ•°å™¨ä¸º0çš„å¯¹è±¡æ„å‘³ç€æ˜¯åƒåœ¾å¯¹è±¡ï¼Œå¯ä»¥è¢«GCå›æ”¶ã€‚</li><li><strong>å¯è¾¾æ€§ç®—æ³•</strong>(GC Roots Tracing)ï¼šä»GC Rootsä½œä¸ºèµ·ç‚¹å¼€å§‹æœç´¢ï¼Œé‚£ä¹ˆæ•´ä¸ªè¿é€šå›¾ä¸­çš„å¯¹è±¡ä¾¿éƒ½æ˜¯æ´»å¯¹è±¡ï¼Œå¯¹äºGC Rootsæ— æ³•åˆ°è¾¾çš„å¯¹è±¡ä¾¿æˆäº†åƒåœ¾å›æ”¶çš„å¯¹è±¡ï¼Œéšæ—¶å¯è¢«GCå›æ”¶ã€‚</li></ul><p><strong>é‡‡ç”¨å¼•ç”¨è®¡æ•°ç®—æ³•çš„</strong>ç³»ç»Ÿåªéœ€åœ¨æ¯ä¸ªå®ä¾‹å¯¹è±¡åˆ›å»ºä¹‹åˆï¼Œé€šè¿‡è®¡æ•°å™¨æ¥è®°å½•æ‰€æœ‰çš„å¼•ç”¨æ¬¡æ•°å³å¯ã€‚è€Œå¯è¾¾æ€§ç®—æ³•ï¼Œåˆ™éœ€è¦å†æ¬¡GCæ—¶ï¼Œéå†æ•´ä¸ªGCæ ¹èŠ‚ç‚¹æ¥åˆ¤æ–­æ˜¯å¦å›æ”¶ã€‚</p><p>ä¸‹é¢é€šè¿‡ä¸€æ®µä»£ç æ¥å¯¹æ¯”è¯´æ˜ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code> <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GcDemo</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//åˆ†ä¸º6ä¸ªæ­¥éª¤</span>
        <span class="token class-name">GcObject</span> obj1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GcObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//Step 1</span>
        <span class="token class-name">GcObject</span> obj2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GcObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//Step 2</span>

        obj1<span class="token punctuation">.</span>instance <span class="token operator">=</span> obj2<span class="token punctuation">;</span> <span class="token comment">//Step 3</span>
        obj2<span class="token punctuation">.</span>instance <span class="token operator">=</span> obj1<span class="token punctuation">;</span> <span class="token comment">//Step 4</span>

        obj1 <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">//Step 5</span>
        obj2 <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">//Step 6</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">GcObject</span><span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> instance <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¾ˆå¤šæ–‡ç« ä»¥åŠJavaè™šæ‹Ÿæœºç›¸å…³çš„ä¹¦ç±ï¼Œéƒ½ä¼šå‘Šè¯‰ä½ å¦‚æœé‡‡ç”¨å¼•ç”¨è®¡æ•°ç®—æ³•ï¼Œä¸Šè¿°ä»£ç ä¸­obj1å’Œobj2æŒ‡å‘çš„å¯¹è±¡å·²ç»ä¸å¯èƒ½å†è¢«è®¿é—®ï¼Œå½¼æ­¤äº’ç›¸å¼•ç”¨å¯¹æ–¹å¯¼è‡´å¼•ç”¨è®¡æ•°éƒ½ä¸ä¸º0ï¼Œæœ€ç»ˆæ— æ³•è¢«GCå›æ”¶ï¼Œè€Œå¯è¾¾æ€§ç®—æ³•èƒ½è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><p>ä½†è¿™äº›æ–‡ç« å’Œä¹¦ç±å¹¶æ²¡æœ‰çœŸæ­£ä»å†…å­˜è§’åº¦æ¥é˜è¿°è¿™ä¸ªè¿‡ç¨‹æ˜¯å¦‚ä½•ç»Ÿè®¡çš„ï¼Œå¾ˆå¤šæ—¶å€™å¤§å®¶éƒ½åœ¨ç›¸äº’å€Ÿé‰´ã€ç¿»è¯‘ï¼Œå´ä¹Ÿéƒ½æ²¡æœ‰æ˜ç™½ã€‚æˆ–è€…å¹²è„†è£…ä½œè®²æ˜ç™½ï¼Œæˆ–è€…å‡å®šè¯»è€…ä¾ç„¶æ˜ç™½ã€‚ å…¶å®å¾ˆå¤šäººå¹¶ä¸æ˜ç™½ä¸ºä»€ä¹ˆå¼•ç”¨è®¡æ•°æ³•ä¸ä¸º0ï¼Œå¼•ç”¨è®¡æ•°åˆ°åº•æ˜¯å¦‚ä½•ç»´æŠ¤æ‰€æœ‰å¯¹è±¡å¼•ç”¨çš„ï¼Œå¯è¾¾æ€§æ˜¯å¦‚ä½•å¯è¾¾çš„ï¼Ÿ æ¥ä¸‹æ¥ç»“åˆå®ä¾‹ï¼Œä»Javaå†…å­˜æ¨¡å‹ä»¥åŠæ•°å­¦çš„å›¾è®ºçŸ¥è¯†è§’åº¦æ¥è¯´æ˜ï¼Œå¸Œæœ›èƒ½è®©å¤§å®¶å½»åº•æ˜ç™½è¯¥è¿‡ç¨‹ã€‚</p><p><strong>æƒ…å†µï¼ˆä¸€ï¼‰ï¼šå¼•ç”¨è®¡æ•°ç®—æ³•</strong></p><p>å¦‚æœé‡‡ç”¨çš„æ˜¯å¼•ç”¨è®¡æ•°ç®—æ³•ï¼š</p><img src="/assets/b9e5ecd5d1cfb1d045541c1f6e25e92c_720w-8b0c8827.jpg" alt="img" style="zoom:100%;"><p>å†å›åˆ°å‰é¢ä»£ç GcDemoçš„mainæ–¹æ³•å…±åˆ†ä¸º6ä¸ªæ­¥éª¤ï¼š</p><ul><li>Step1ï¼šGcObjectå®ä¾‹1çš„å¼•ç”¨è®¡æ•°åŠ 1ï¼Œå®ä¾‹1çš„å¼•ç”¨è®¡æ•°=1ï¼›</li><li>Step2ï¼šGcObjectå®ä¾‹2çš„å¼•ç”¨è®¡æ•°åŠ 1ï¼Œå®ä¾‹2çš„å¼•ç”¨è®¡æ•°=1ï¼›</li><li>Step3ï¼šGcObjectå®ä¾‹2çš„å¼•ç”¨è®¡æ•°å†åŠ 1ï¼Œå®ä¾‹2çš„å¼•ç”¨è®¡æ•°=2ï¼›</li><li>Step4ï¼šGcObjectå®ä¾‹1çš„å¼•ç”¨è®¡æ•°å†åŠ 1ï¼Œå®ä¾‹1çš„å¼•ç”¨è®¡æ•°=2ï¼›</li></ul><p>æ‰§è¡Œåˆ°Step 4ï¼Œåˆ™GcObjectå®ä¾‹1å’Œå®ä¾‹2çš„å¼•ç”¨è®¡æ•°éƒ½ç­‰äº2ã€‚</p><p>æ¥ä¸‹æ¥ç»§ç»­ç»“æœå›¾ï¼š</p><img src="/assets/3c1246661a548f933cd886070f6c1af1_720w-8c4179e8.jpg" alt="img" style="zoom:100%;"><ul><li>Step5ï¼šæ ˆå¸§ä¸­obj1ä¸å†æŒ‡å‘Javaå †ï¼ŒGcObjectå®ä¾‹1çš„å¼•ç”¨è®¡æ•°å‡1ï¼Œç»“æœä¸º1ï¼›</li><li>Step6ï¼šæ ˆå¸§ä¸­obj2ä¸å†æŒ‡å‘Javaå †ï¼ŒGcObjectå®ä¾‹2çš„å¼•ç”¨è®¡æ•°å‡1ï¼Œç»“æœä¸º1ã€‚</li></ul><p>åˆ°æ­¤ï¼Œå‘ç°GcObjectå®ä¾‹1å’Œå®ä¾‹2çš„è®¡æ•°å¼•ç”¨éƒ½ä¸ä¸º0ï¼Œé‚£ä¹ˆå¦‚æœé‡‡ç”¨çš„å¼•ç”¨è®¡æ•°ç®—æ³•çš„è¯ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªå®ä¾‹æ‰€å çš„å†…å­˜å°†å¾—ä¸åˆ°é‡Šæ”¾ï¼Œè¿™ä¾¿äº§ç”Ÿäº†å†…å­˜æ³„éœ²ã€‚</p><p><strong>æƒ…å†µï¼ˆäºŒï¼‰ï¼šå¯è¾¾æ€§ç®—æ³•</strong></p><p>è¿™æ˜¯ç›®å‰ä¸»æµçš„è™šæ‹Ÿæœºéƒ½æ˜¯é‡‡ç”¨GC Roots Tracingç®—æ³•ï¼Œæ¯”å¦‚Sunçš„Hotspotè™šæ‹Ÿæœºä¾¿æ˜¯é‡‡ç”¨è¯¥ç®—æ³•ã€‚ è¯¥ç®—æ³•çš„æ ¸å¿ƒç®—æ³•æ˜¯ä»GC Rootså¯¹è±¡ä½œä¸ºèµ·å§‹ç‚¹ï¼Œåˆ©ç”¨æ•°å­¦ä¸­å›¾è®ºçŸ¥è¯†ï¼Œå›¾ä¸­å¯è¾¾å¯¹è±¡ä¾¿æ˜¯å­˜æ´»å¯¹è±¡ï¼Œè€Œä¸å¯è¾¾å¯¹è±¡åˆ™æ˜¯éœ€è¦å›æ”¶çš„åƒåœ¾å†…å­˜ã€‚è¿™é‡Œæ¶‰åŠä¸¤ä¸ªæ¦‚å¿µï¼Œä¸€æ˜¯GC Rootsï¼Œä¸€æ˜¯å¯è¾¾æ€§ã€‚</p><p>é‚£ä¹ˆå¯ä»¥ä½œä¸º<strong>GC Rootsçš„å¯¹è±¡</strong>ï¼ˆè§ä¸‹å›¾ï¼‰ï¼š</p><ul><li>è™šæ‹Ÿæœºæ ˆçš„æ ˆå¸§çš„å±€éƒ¨å˜é‡è¡¨æ‰€å¼•ç”¨çš„å¯¹è±¡ï¼›</li><li>æœ¬åœ°æ–¹æ³•æ ˆçš„JNIæ‰€å¼•ç”¨çš„å¯¹è±¡ï¼›</li><li>æ–¹æ³•åŒºçš„é™æ€å˜é‡å’Œå¸¸é‡æ‰€å¼•ç”¨çš„å¯¹è±¡ï¼›</li></ul><p>å…³äº<strong>å¯è¾¾æ€§</strong>çš„å¯¹è±¡ï¼Œä¾¿æ˜¯èƒ½ä¸GC Rootsæ„æˆè¿é€šå›¾çš„å¯¹è±¡ï¼Œå¦‚ä¸‹å›¾ï¼š</p><img src="/assets/22f72b18415405c3e0207925a8de74fa_720w-e49b007c.jpg" alt="img" style="zoom:100%;"><p>ä»ä¸Šå›¾ï¼Œreference1ã€reference2ã€reference3éƒ½æ˜¯GC Rootsï¼Œå¯ä»¥çœ‹å‡ºï¼š</p><ul><li>reference1-&gt; å¯¹è±¡å®ä¾‹1ï¼›</li><li>reference2-&gt; å¯¹è±¡å®ä¾‹2ï¼›</li><li>reference3-&gt; å¯¹è±¡å®ä¾‹4ï¼›</li><li>reference3-&gt; å¯¹è±¡å®ä¾‹4 -&gt; å¯¹è±¡å®ä¾‹6ï¼›</li></ul><p>å¯ä»¥å¾—å‡ºå¯¹è±¡å®ä¾‹1ã€2ã€4ã€6éƒ½å…·æœ‰GC Rootså¯è¾¾æ€§ï¼Œä¹Ÿå°±æ˜¯å­˜æ´»å¯¹è±¡ï¼Œä¸èƒ½è¢«GCå›æ”¶çš„å¯¹è±¡ã€‚</p><p>è€Œå¯¹äºå¯¹è±¡å®ä¾‹3ã€5ç›´æ¥è™½ç„¶è¿é€šï¼Œä½†å¹¶æ²¡æœ‰ä»»ä½•ä¸€ä¸ªGC Rootsä¸ä¹‹ç›¸è¿ï¼Œè¿™ä¾¿æ˜¯GC Rootsä¸å¯è¾¾çš„å¯¹è±¡ï¼Œè¿™å°±æ˜¯GCéœ€è¦å›æ”¶çš„åƒåœ¾å¯¹è±¡ã€‚</p><p>åˆ°è¿™é‡Œï¼Œç›¸ä¿¡å¤§å®¶åº”è¯¥èƒ½å½»åº•æ˜ç™½å¼•ç”¨è®¡æ•°ç®—æ³•å’Œå¯è¾¾æ€§ç®—æ³•çš„åŒºåˆ«å§**ã€‚**</p><p>å†å›è¿‡å¤´æ¥çœ‹çœ‹æœ€å‰é¢çš„å®ä¾‹ï¼ŒGcObjectå®ä¾‹1å’Œå®ä¾‹2è™½ç„¶ä»å¼•ç”¨è®¡æ•°è™½ç„¶éƒ½ä¸ä¸º0ï¼Œä½†ä»å¯è¾¾æ€§ç®—æ³•æ¥çœ‹ï¼Œéƒ½æ˜¯GC Rootsä¸å¯è¾¾çš„å¯¹è±¡ã€‚</p><p>æ€»ä¹‹ï¼Œå¯¹äºå¯¹è±¡ä¹‹é—´å¾ªç¯å¼•ç”¨çš„æƒ…å†µï¼Œå¼•ç”¨è®¡æ•°ç®—æ³•ï¼Œåˆ™GCæ— æ³•å›æ”¶è¿™ä¸¤ä¸ªå¯¹è±¡ï¼Œè€Œå¯è¾¾æ€§ç®—æ³•åˆ™å¯ä»¥æ­£ç¡®å›æ”¶ã€‚</p><h4 id="å¼•ç”¨ç±»å‹" tabindex="-1"><a class="header-anchor" href="#å¼•ç”¨ç±»å‹" aria-hidden="true">#</a> å¼•ç”¨ç±»å‹</h4><p>åœ¨JVMä¸­ï¼Œå¼•ç”¨ç±»å‹ä¸»è¦åˆ†ä¸ºå¼ºå¼•ç”¨ï¼ˆStrong Referenceï¼‰ã€è½¯å¼•ç”¨ï¼ˆSoft Referenceï¼‰ã€å¼±å¼•ç”¨ï¼ˆWeak Referenceï¼‰ã€è™šå¼•ç”¨ï¼ˆPhantom Referenceï¼‰è¿™ 4 ç§å¼•ç”¨å¼ºåº¦ä¾æ¬¡é€æ¸å‡å¼±ã€‚é™¤å¼ºå¼•ç”¨å¤–ï¼Œå…¶ä»– 3 ç§å¼•ç”¨å‡å¯ä»¥åœ¨ java.lang.ref åŒ…ä¸­æ‰¾åˆ°å®ƒä»¬çš„èº«å½±ã€‚å¦‚ä¸‹å›¾ï¼Œæ˜¾ç¤ºäº†è¿™ 3 ç§å¼•ç”¨ç±»å‹å¯¹åº”çš„ç±»ï¼Œå¼€å‘äººå‘˜å¯ä»¥åœ¨åº”ç”¨ç¨‹åºä¸­ç›´æ¥ä½¿ç”¨å®ƒä»¬ã€‚</p><img src="/assets/900fb2c037474f0b8951e22328807b13-22fceafa.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" style="zoom:110%;"><p>Reference å­ç±»ä¸­åªæœ‰ç»ˆç»“å™¨å¼•ç”¨æ˜¯åŒ…å†…å¯è§çš„ï¼Œå…¶ä»– 3 ç§å¼•ç”¨ç±»å‹å‡ä¸º publicï¼Œå¯ä»¥åœ¨åº”ç”¨ç¨‹åºä¸­ç›´æ¥ä½¿ç”¨</p><p><strong>å¼ºå¼•ç”¨ï¼ˆStrongReferenceï¼‰</strong>ï¼šæœ€ä¼ ç»Ÿçš„â€œå¼•ç”¨â€çš„å®šä¹‰ï¼Œæ˜¯æŒ‡åœ¨ç¨‹åºä»£ç ä¹‹ä¸­æ™®éå­˜åœ¨çš„å¼•ç”¨èµ‹å€¼ï¼Œå³ç±»ä¼¼â€œObject obj = new Object()â€è¿™ç§å¼•ç”¨å…³ç³»ã€‚æ— è®ºä»»ä½•æƒ…å†µä¸‹ï¼Œåªè¦å¼ºå¼•ç”¨å…³ç³»è¿˜å­˜åœ¨ï¼Œåƒåœ¾æ”¶é›†å™¨å°±æ°¸è¿œä¸ä¼šå›æ”¶æ‰è¢«å¼•ç”¨çš„å¯¹è±¡ã€‚</p><p><strong>è½¯å¼•ç”¨ï¼ˆSoftReferenceï¼‰</strong>ï¼šåœ¨ç³»ç»Ÿå°†è¦å‘ç”Ÿå†…å­˜æº¢å‡ºä¹‹å‰ï¼Œå°†ä¼šæŠŠè¿™äº›å¯¹è±¡åˆ—å…¥å›æ”¶èŒƒå›´ä¹‹ä¸­è¿›è¡Œç¬¬äºŒæ¬¡å›æ”¶ã€‚å¦‚æœè¿™æ¬¡å›æ”¶åè¿˜æ²¡æœ‰è¶³å¤Ÿçš„å†…å­˜ï¼Œæ‰ä¼šæŠ›å‡ºå†…å­˜æµå‡ºå¼‚å¸¸ã€‚</p><p><strong>å¼±å¼•ç”¨ï¼ˆWeakReferenceï¼‰</strong>ï¼šè¢«å¼±å¼•ç”¨å…³è”çš„å¯¹è±¡åªèƒ½ç”Ÿå­˜åˆ°ä¸‹ä¸€æ¬¡åƒåœ¾æ”¶é›†ä¹‹å‰ã€‚å½“åƒåœ¾æ”¶é›†å™¨å·¥ä½œæ—¶ï¼Œæ— è®ºå†…å­˜ç©ºé—´æ˜¯å¦è¶³å¤Ÿï¼Œéƒ½ä¼šå›æ”¶æ‰è¢«å¼±å¼•ç”¨å…³è”çš„å¯¹è±¡ã€‚</p><p><strong>è™šå¼•ç”¨ï¼ˆPhantomReferenceï¼‰</strong>ï¼šä¸€ä¸ªå¯¹è±¡æ˜¯å¦æœ‰è™šå¼•ç”¨çš„å­˜åœ¨ï¼Œå®Œå…¨ä¸ä¼šå¯¹å…¶ç”Ÿå­˜æ—¶é—´æ„æˆå½±å“ï¼Œä¹Ÿæ— æ³•é€šè¿‡è™šå¼•ç”¨æ¥è·å¾—ä¸€ä¸ªå¯¹è±¡çš„å®ä¾‹ã€‚ä¸ºä¸€ä¸ªå¯¹è±¡è®¾ç½®è™šå¼•ç”¨å…³è”çš„å”¯ä¸€ç›®çš„å°±æ˜¯èƒ½åœ¨è¿™ä¸ªå¯¹è±¡è¢«æ”¶é›†å™¨å›æ”¶æ—¶æ”¶åˆ°ä¸€ä¸ªç³»ç»Ÿé€šçŸ¥ã€‚</p><h5 id="å¼ºå¼•ç”¨-strong-reference" tabindex="-1"><a class="header-anchor" href="#å¼ºå¼•ç”¨-strong-reference" aria-hidden="true">#</a> å¼ºå¼•ç”¨ï¼ˆStrong Referenceï¼‰</h5><p>å¼ºå¼•ç”¨ï¼ˆStrong Referenceï¼‰ â€” ä¸å›æ”¶</p><p>å½“åœ¨ Java è¯­è¨€ä¸­ä½¿ç”¨ new æ“ä½œç¬¦åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œå¹¶å°†å…¶èµ‹å€¼ç»™ä¸€ä¸ªå˜é‡çš„æ—¶å€™ï¼Œè¿™ä¸ªå˜é‡å°±æˆä¸ºæŒ‡å‘è¯¥å¯¹è±¡çš„ä¸€ä¸ªå¼ºå¼•ç”¨ã€‚å¼ºå¼•ç”¨çš„å¯¹è±¡æ˜¯å¯è§¦åŠçš„ï¼Œåƒåœ¾æ”¶é›†å™¨å°±æ°¸è¿œä¸ä¼šå›æ”¶æ‰è¢«å¼•ç”¨çš„å¯¹è±¡ã€‚</p><p>å¼ºå¼•ç”¨å…·å¤‡ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p><ul><li>å¼ºå¼•ç”¨å¯ä»¥ç›´æ¥è®¿é—®ç›®æ ‡å¯¹è±¡ã€‚</li><li>å¼ºå¼•ç”¨æ‰€æŒ‡å‘çš„å¯¹è±¡åœ¨ä»»ä½•æ—¶å€™éƒ½ä¸ä¼šè¢«ç³»ç»Ÿå›æ”¶ï¼Œè™šæ‹Ÿæœºå®æ„¿æŠ›å‡º OOM å¼‚å¸¸ï¼Œä¹Ÿä¸ä¼šå›æ”¶å¼ºå¼•ç”¨æ‰€æŒ‡å‘å¯¹è±¡ã€‚</li><li>å¼ºå¼•ç”¨å¯èƒ½å¯¼è‡´å†…å­˜æ³„æ¼ã€‚</li></ul><h5 id="è½¯å¼•ç”¨-soft-reference" tabindex="-1"><a class="header-anchor" href="#è½¯å¼•ç”¨-soft-reference" aria-hidden="true">#</a> è½¯å¼•ç”¨ï¼ˆSoft Referenceï¼‰</h5><p>è½¯å¼•ç”¨ï¼ˆSoft Referenceï¼‰â€”â€”å†…å­˜ä¸è¶³å³å›æ”¶</p><p>è½¯å¼•ç”¨æ˜¯ç”¨æ¥æè¿°ä¸€äº›è¿˜æœ‰ç”¨ï¼Œä½†éå¿…éœ€çš„å¯¹è±¡ã€‚åªè¢«è½¯å¼•ç”¨å…³è”ç€çš„å¯¹è±¡ï¼Œåœ¨ç³»ç»Ÿå°†è¦å‘ç”Ÿå†…å­˜æº¢å‡ºå¼‚å¸¸å‰ï¼Œä¼šæŠŠè¿™äº›å¯¹è±¡åˆ—è¿›å›æ”¶èŒƒå›´ä¹‹ä¸­è¿›è¡Œç¬¬äºŒæ¬¡å›æ”¶ï¼Œå¦‚æœè¿™æ¬¡å›æ”¶è¿˜æ²¡æœ‰è¶³å¤Ÿçš„å†…å­˜ï¼Œæ‰ä¼šæŠ›å‡ºå†…å­˜æº¢å‡ºå¼‚å¸¸ã€‚</p><p>è½¯å¼•ç”¨é€šå¸¸ç”¨æ¥å®ç°å†…å­˜æ•æ„Ÿçš„ç¼“å­˜ã€‚æ¯”å¦‚ï¼šé«˜é€Ÿç¼“å­˜å°±æœ‰ç”¨åˆ°è½¯å¼•ç”¨ã€‚å¦‚æœè¿˜æœ‰ç©ºé—²å†…å­˜ï¼Œå°±å¯ä»¥æš‚æ—¶ä¿ç•™ç¼“å­˜ï¼Œå½“å†…å­˜ä¸è¶³æ—¶æ¸…ç†æ‰ï¼Œè¿™æ ·å°±ä¿è¯äº†ä½¿ç”¨ç¼“å­˜çš„åŒæ—¶ï¼Œä¸ä¼šè€—å°½å†…å­˜ã€‚</p><p>åƒåœ¾å›æ”¶å™¨åœ¨æŸä¸ªæ—¶åˆ»å†³å®šå›æ”¶è½¯å¯è¾¾çš„å¯¹è±¡çš„æ—¶å€™ï¼Œä¼šæ¸…ç†è½¯å¼•ç”¨ï¼Œå¹¶å¯é€‰åœ°æŠŠå¼•ç”¨å­˜æ”¾åˆ°ä¸€ä¸ªå¼•ç”¨é˜Ÿåˆ—ï¼ˆReference Queueï¼‰ã€‚</p><p>ç±»ä¼¼å¼±å¼•ç”¨ï¼Œåªä¸è¿‡ Java è™šæ‹Ÿæœºä¼šå°½é‡è®©è½¯å¼•ç”¨çš„å­˜æ´»æ—¶é—´é•¿ä¸€äº›ï¼Œè¿«ä¸å¾—å·²æ‰æ¸…ç†ã€‚</p><h5 id="å¼±å¼•ç”¨-weak-reference" tabindex="-1"><a class="header-anchor" href="#å¼±å¼•ç”¨-weak-reference" aria-hidden="true">#</a> å¼±å¼•ç”¨ï¼ˆWeak Referenceï¼‰</h5><p>å¼±å¼•ç”¨ï¼ˆWeak Referenceï¼‰â€”â€”å‘ç°å³å›æ”¶</p><p>å¼±å¼•ç”¨ä¹Ÿæ˜¯ç”¨æ¥æè¿°é‚£äº›éå¿…éœ€å¯¹è±¡ï¼Œåªè¢«å¼±å¼•ç”¨å…³è”çš„å¯¹è±¡åªèƒ½ç”Ÿå­˜åˆ°ä¸‹ä¸€æ¬¡åƒåœ¾æ”¶é›†å‘ç”Ÿä¸ºæ­¢ã€‚åœ¨ç³»ç»Ÿ GC æ—¶ï¼Œåªè¦å‘ç°å¼±å¼•ç”¨ï¼Œä¸ç®¡ç³»ç»Ÿå †ç©ºé—´ä½¿ç”¨æ˜¯å¦å……è¶³ï¼Œéƒ½ä¼šå›æ”¶æ‰åªè¢«å¼±å¼•ç”¨å…³è”çš„å¯¹è±¡ã€‚</p><p>ä½†æ˜¯ï¼Œç”±äºåƒåœ¾å›æ”¶å™¨çš„çº¿ç¨‹é€šå¸¸ä¼˜å…ˆçº§å¾ˆä½ï¼Œå› æ­¤ï¼Œå¹¶ä¸ä¸€å®šèƒ½å¾ˆå¿«åœ°å‘ç°æŒæœ‰å¼±å¼•ç”¨çš„å¯¹è±¡ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¼±å¼•ç”¨å¯¹è±¡å¯ä»¥å­˜åœ¨è¾ƒé•¿çš„æ—¶é—´ã€‚</p><p>å¼±å¼•ç”¨å’Œè½¯å¼•ç”¨ä¸€æ ·ï¼Œåœ¨æ„é€ å¼±å¼•ç”¨æ—¶ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šä¸€ä¸ªå¼•ç”¨é˜Ÿåˆ—ï¼Œå½“å¼±å¼•ç”¨å¯¹è±¡è¢«å›æ”¶æ—¶ï¼Œå°±ä¼šåŠ å…¥æŒ‡å®šçš„å¼•ç”¨é˜Ÿåˆ—ï¼Œé€šè¿‡è¿™ä¸ªé˜Ÿåˆ—å¯ä»¥è·Ÿè¸ªå¯¹è±¡çš„å›æ”¶æƒ…å†µã€‚</p><p>è½¯å¼•ç”¨ã€å¼±å¼•ç”¨éƒ½éå¸¸é€‚åˆæ¥ä¿å­˜é‚£äº›å¯æœ‰å¯æ— çš„ç¼“å­˜æ•°æ®ã€‚å¦‚æœè¿™ä¹ˆåšï¼Œå½“ç³»ç»Ÿå†…å­˜ä¸è¶³æ—¶ï¼Œè¿™äº›ç¼“å­˜æ•°æ®ä¼šè¢«å›æ”¶ï¼Œä¸ä¼šå¯¼è‡´å†…å­˜æº¢å‡ºã€‚è€Œå½“å†…å­˜èµ„æºå……è¶³æ—¶ï¼Œè¿™äº›ç¼“å­˜æ•°æ®åˆå¯ä»¥å­˜åœ¨ç›¸å½“é•¿çš„æ—¶é—´ï¼Œä»è€Œèµ·åˆ°åŠ é€Ÿç³»ç»Ÿçš„ä½œç”¨ã€‚</p><h5 id="è™šå¼•ç”¨-phantom-reference" tabindex="-1"><a class="header-anchor" href="#è™šå¼•ç”¨-phantom-reference" aria-hidden="true">#</a> è™šå¼•ç”¨ï¼ˆPhantom Referenceï¼‰</h5><p>è™šå¼•ç”¨ï¼ˆPhantom Referenceï¼‰â€”â€”å¯¹è±¡å›æ”¶è·Ÿè¸ª</p><p>ä¹Ÿç§°ä¸ºâ€œå¹½çµå¼•ç”¨â€æˆ–è€…â€œå¹»å½±å¼•ç”¨â€ï¼Œæ˜¯æ‰€æœ‰å¼•ç”¨ç±»å‹ä¸­æœ€å¼±çš„ä¸€ä¸ªã€‚</p><p>ä¸€ä¸ªå¯¹è±¡æ˜¯å¦æœ‰è™šå¼•ç”¨çš„å­˜åœ¨ï¼Œå®Œå…¨ä¸ä¼šå†³å®šå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸã€‚å¦‚æœä¸€ä¸ªå¯¹è±¡ä»…æŒæœ‰è™šå¼•ç”¨ï¼Œé‚£ä¹ˆå®ƒå’Œæ²¡æœ‰å¼•ç”¨å‡ ä¹æ˜¯ä¸€æ ·çš„ï¼Œéšæ—¶éƒ½å¯èƒ½è¢«åƒåœ¾å›æ”¶å™¨å›æ”¶ã€‚å®ƒä¸èƒ½å•ç‹¬ä½¿ç”¨ï¼Œä¹Ÿæ— æ³•é€šè¿‡è™šå¼•ç”¨æ¥è·å–è¢«å¼•ç”¨çš„å¯¹è±¡ã€‚<strong>å½“è¯•å›¾é€šè¿‡è™šå¼•ç”¨çš„ get()æ–¹æ³•å–å¾—å¯¹è±¡æ—¶ï¼Œæ€»æ˜¯ null</strong></p><p>ä¸ºä¸€ä¸ªå¯¹è±¡è®¾ç½®è™šå¼•ç”¨å…³è”çš„å”¯ä¸€ç›®çš„åœ¨äºè·Ÿè¸ªåƒåœ¾å›æ”¶è¿‡ç¨‹ã€‚æ¯”å¦‚ï¼šèƒ½åœ¨è¿™ä¸ªå¯¹è±¡è¢«æ”¶é›†å™¨å›æ”¶æ—¶æ”¶åˆ°ä¸€ä¸ªç³»ç»Ÿé€šçŸ¥ã€‚</p><p>è™šå¼•ç”¨å¿…é¡»å’Œå¼•ç”¨é˜Ÿåˆ—ä¸€èµ·ä½¿ç”¨ã€‚è™šå¼•ç”¨åœ¨åˆ›å»ºæ—¶å¿…é¡»æä¾›ä¸€ä¸ªå¼•ç”¨é˜Ÿåˆ—ä½œä¸ºå‚æ•°ã€‚å½“åƒåœ¾å›æ”¶å™¨å‡†å¤‡å›æ”¶ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œå¦‚æœå‘ç°å®ƒè¿˜æœ‰è™šå¼•ç”¨ï¼Œå°±ä¼šåœ¨å›æ”¶å¯¹è±¡åï¼Œå°†è¿™ä¸ªè™šå¼•ç”¨åŠ å…¥å¼•ç”¨é˜Ÿåˆ—ï¼Œä»¥é€šçŸ¥åº”ç”¨ç¨‹åºå¯¹è±¡çš„å›æ”¶æƒ…å†µã€‚</p><p>ç”±äºè™šå¼•ç”¨å¯ä»¥è·Ÿè¸ªå¯¹è±¡çš„å›æ”¶æ—¶é—´ï¼Œå› æ­¤ï¼Œä¹Ÿå¯ä»¥å°†ä¸€äº›èµ„æºé‡Šæ”¾æ“ä½œæ”¾ç½®åœ¨è™šå¼•ç”¨ä¸­æ‰§è¡Œå’Œè®°å½•ã€‚</p><h5 id="ç»ˆç»“å™¨å¼•ç”¨" tabindex="-1"><a class="header-anchor" href="#ç»ˆç»“å™¨å¼•ç”¨" aria-hidden="true">#</a> ç»ˆç»“å™¨å¼•ç”¨</h5><p>å®ƒç”¨äºå®ç°å¯¹è±¡çš„ finalize() æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥ç§°ä¸ºç»ˆç»“å™¨å¼•ç”¨ã€‚æ— éœ€æ‰‹åŠ¨ç¼–ç ï¼Œå…¶å†…éƒ¨é…åˆå¼•ç”¨é˜Ÿåˆ—ä½¿ç”¨ã€‚</p><p>åœ¨ GC æ—¶ï¼Œç»ˆç»“å™¨å¼•ç”¨å…¥é˜Ÿã€‚ç”± Finalizer çº¿ç¨‹é€šè¿‡ç»ˆç»“å™¨å¼•ç”¨æ‰¾åˆ°è¢«å¼•ç”¨å¯¹è±¡è°ƒç”¨å®ƒçš„ finalize()æ–¹æ³•ï¼Œç¬¬äºŒæ¬¡ GC æ—¶æ‰å›æ”¶è¢«å¼•ç”¨çš„å¯¹è±¡</p><h5 id="ä½¿ç”¨ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨ç¤ºä¾‹" aria-hidden="true">#</a> ä½¿ç”¨ç¤ºä¾‹</h5><p>è½¯å¼•ç”¨çš„ä¾‹å­ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SoftReferenceDemo</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> _4MB <span class="token operator">=</span> <span class="token number">4</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token operator">&lt;</span><span class="token class-name">SoftReference</span><span class="token operator">&lt;</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;&gt;</span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// å¼•ç”¨é˜Ÿåˆ—</span>
        <span class="token class-name">ReferenceQueue</span><span class="token operator">&lt;</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> queue <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReferenceQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// å…³è”äº†å¼•ç”¨é˜Ÿåˆ—ï¼Œ å½“è½¯å¼•ç”¨æ‰€å…³è”çš„ byte[]è¢«å›æ”¶æ—¶ï¼Œè½¯å¼•ç”¨è‡ªå·±ä¼šåŠ å…¥åˆ° queue ä¸­å»</span>
            <span class="token class-name">SoftReference</span><span class="token operator">&lt;</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> ref <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SoftReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span>_4MB<span class="token punctuation">]</span><span class="token punctuation">,</span> queue<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>ref<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>ref<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>list<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// ä»é˜Ÿåˆ—ä¸­è·å–æ— ç”¨çš„ è½¯å¼•ç”¨å¯¹è±¡ï¼Œå¹¶ç§»é™¤</span>
        <span class="token class-name">Reference</span><span class="token operator">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> poll <span class="token operator">=</span> queue<span class="token punctuation">.</span><span class="token function">poll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span> poll <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            list<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>poll<span class="token punctuation">)</span><span class="token punctuation">;</span>
            poll <span class="token operator">=</span> queue<span class="token punctuation">.</span><span class="token function">poll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;===========================&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">SoftReference</span><span class="token operator">&lt;</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> reference <span class="token operator">:</span> list<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>reference<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¼±å¼•ç”¨çš„ä¾‹å­ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * æ¼”ç¤ºå¼±å¼•ç”¨
 * -Xmx20m -XX:+PrintGCDetails -verbose:gc
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WeakReferenceDemo</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> _4MB <span class="token operator">=</span> <span class="token number">4</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//  list --&gt; WeakReference --&gt; byte[]</span>
        <span class="token class-name">List</span><span class="token operator">&lt;</span><span class="token class-name">WeakReference</span><span class="token operator">&lt;</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;&gt;</span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">WeakReference</span><span class="token operator">&lt;</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> ref <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeakReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span>_4MB<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>ref<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">WeakReference</span><span class="token operator">&lt;</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> w <span class="token operator">:</span> list<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>w<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;å¾ªç¯ç»“æŸï¼š&quot;</span> <span class="token operator">+</span> list<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="åƒåœ¾å›æ”¶ç®—æ³•" tabindex="-1"><a class="header-anchor" href="#åƒåœ¾å›æ”¶ç®—æ³•" aria-hidden="true">#</a> åƒåœ¾å›æ”¶ç®—æ³•</h3><h4 id="æ ‡è®°-æ¸…é™¤ç®—æ³•" tabindex="-1"><a class="header-anchor" href="#æ ‡è®°-æ¸…é™¤ç®—æ³•" aria-hidden="true">#</a> æ ‡è®°-æ¸…é™¤ç®—æ³•</h4><p>æ ‡è®°/æ¸…é™¤ç®—æ³•ï¼Œå°±æ˜¯å½“å †ä¸­çš„æœ‰æ•ˆå†…å­˜ç©ºé—´ï¼ˆavailable memoryï¼‰è¢«è€—å°½çš„æ—¶å€™ï¼Œå°±ä¼šåœæ­¢æ•´ä¸ªç¨‹åºï¼ˆä¹Ÿè¢«æˆä¸ºstop the worldï¼‰ï¼Œç„¶åè¿›è¡Œä¸¤é¡¹å·¥ä½œï¼Œç¬¬ä¸€é¡¹åˆ™æ˜¯æ ‡è®°ï¼Œç¬¬äºŒé¡¹åˆ™æ˜¯æ¸…é™¤</p><ul><li><p>æ ‡è®°ï¼šæ ‡è®°çš„è¿‡ç¨‹å…¶å®å°±æ˜¯ï¼Œéå†æ‰€æœ‰çš„GC Rootsï¼Œç„¶åå°†æ‰€æœ‰GC Rootså¯è¾¾çš„å¯¹è±¡æ ‡è®°ä¸ºå­˜æ´»çš„å¯¹è±¡ã€‚</p></li><li><p>æ¸…é™¤ï¼šæ¸…é™¤çš„è¿‡ç¨‹å°†éå†å †ä¸­æ‰€æœ‰çš„å¯¹è±¡ï¼Œå°†æ²¡æœ‰æ ‡è®°çš„å¯¹è±¡å…¨éƒ¨æ¸…é™¤æ‰ã€‚</p></li></ul><img src="/assets/watermark_type_ZmFuZ3poZW5naGVpdGk_shadow_10_text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2NjdWFtYW4__size_16_color_FFFFFF_t_70-7156d71a.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" style="zoom:100%;"><p>ä¼˜ç‚¹ï¼š</p><ul><li>ç®—æ³•å®ç°ç®€å•ï¼ˆå¥½åƒä¹Ÿä¸ç®—ä»€ä¹ˆä¼˜ç‚¹ï¼‰</li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li><p>æ•ˆç‡æ¯”è¾ƒä½ï¼ˆé€’å½’ä¸å…¨å †å¯¹è±¡éå†ï¼‰ï¼Œè€Œä¸”åœ¨è¿›è¡ŒGCçš„æ—¶å€™ï¼Œéœ€è¦åœæ­¢åº”ç”¨ç¨‹åºï¼Œ</p></li><li><p>è¿™ç§æ–¹å¼æ¸…ç†å‡ºæ¥çš„ç©ºé—²å†…å­˜æ˜¯ä¸è¿ç»­çš„ï¼Œå†…å­˜çš„å¸ƒå±€è‡ªç„¶ä¼šä¹±ä¸ƒå…«ç³Ÿã€‚è€Œä¸ºäº†åº”ä»˜è¿™ä¸€ç‚¹ï¼ŒJVMå°±ä¸å¾—ä¸ç»´æŒä¸€ä¸ªå†…å­˜çš„ç©ºé—²åˆ—è¡¨ï¼Œè¿™åˆæ˜¯ä¸€ç§å¼€é”€ã€‚è€Œä¸”åœ¨åˆ†é…æ•°ç»„å¯¹è±¡çš„æ—¶å€™ï¼Œå¯»æ‰¾è¿ç»­çš„å†…å­˜ç©ºé—´ä¼šä¸å¤ªå¥½æ‰¾ã€‚</p></li></ul><h4 id="æ ‡è®°-å¤åˆ¶ç®—æ³•" tabindex="-1"><a class="header-anchor" href="#æ ‡è®°-å¤åˆ¶ç®—æ³•" aria-hidden="true">#</a> æ ‡è®°-å¤åˆ¶ç®—æ³•</h4><p>å¤åˆ¶ç®—æ³•æ˜¯é’ˆå¯¹æ ‡è®°â€”æ¸…é™¤ç®—æ³•çš„ç¼ºç‚¹ï¼Œåœ¨å…¶åŸºç¡€ä¸Šè¿›è¡Œæ”¹è¿›è€Œå¾—åˆ°çš„ï¼Œå®ƒå°†å¯ç”¨å†…å­˜æŒ‰å®¹é‡åˆ†ä¸ºå¤§å°ç›¸ç­‰çš„ä¸¤å—ï¼Œæ¯æ¬¡åªä½¿ç”¨å…¶ä¸­çš„ä¸€å—ï¼Œå½“è¿™ä¸€å—çš„å†…å­˜ç”¨å®Œäº†ï¼Œå°±å°†è¿˜å­˜æ´»ç€çš„å¯¹è±¡å¤åˆ¶åˆ°å¦å¤–ä¸€å—å†…å­˜ä¸Šé¢ï¼Œç„¶åå†æŠŠå·²ä½¿ç”¨è¿‡çš„å†…å­˜ç©ºé—´ä¸€æ¬¡æ¸…ç†æ‰ã€‚</p><p><strong>å¦‚æœå¯¹è±¡çš„å­˜æ´»ç‡è¿‡é«˜ï¼Œåœ¨å¤åˆ¶å¯¹è±¡æ—¶èŠ±è´¹çš„æ—¶é—´å°±ä¼šå¾ˆé•¿ï¼Œæ‰€ä»¥ï¼Œæƒ³è¦ä½¿ç”¨å¤åˆ¶ç®—æ³•ï¼Œå¯¹è±¡çš„å­˜æ´»ç‡è¦éå¸¸ä½æ‰è¡Œï¼Œè€Œä¸”è¦å®¢æœ50%çš„å†…å­˜æµªè´¹ã€‚</strong></p><p><img src="/assets/watermark_type_ZmFuZ3poZW5naGVpdGk_shadow_10_text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2NjdWFtYW4__size_16_color_FFFFFF_t_70-16523214515602-6e08ac05.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>ä¼˜ç‚¹ï¼š</p><ul><li><p>æ¯æ¬¡åªå¯¹ä¸€å—å†…å­˜è¿›è¡Œå›æ”¶ï¼Œè¿è¡Œé«˜æ•ˆ</p></li><li><p>åªéœ€ç§»åŠ¨æ ˆé¡¶æŒ‡é’ˆï¼ŒæŒ‰é¡ºåºåˆ†é…å†…å­˜å³å¯ï¼Œå®ç°ç®€å•</p></li><li><p>å†…å­˜å›æ”¶æ—¶ä¸ç”¨è€ƒè™‘å†…å­˜ç¢ç‰‡çš„å‡ºç°</p></li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li>å¯ä¸€æ¬¡æ€§åˆ†é…çš„æœ€å¤§å†…å­˜ç¼©å°äº†ä¸€åŠ</li></ul><h4 id="æ ‡è®°-æ•´ç†ç®—æ³•" tabindex="-1"><a class="header-anchor" href="#æ ‡è®°-æ•´ç†ç®—æ³•" aria-hidden="true">#</a> æ ‡è®°-æ•´ç†ç®—æ³•</h4><p>ä¸ºäº†è§£å†³Copyingç®—æ³•çš„ç¼ºé™·ï¼Œå……åˆ†åˆ©ç”¨å†…å­˜ç©ºé—´ï¼Œæå‡ºäº†Mark-Compactç®—æ³•ã€‚</p><p>ä¸æ ‡è®°/æ¸…é™¤ç®—æ³•éå¸¸ç›¸ä¼¼ï¼Œå®ƒä¹Ÿæ˜¯åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼š<strong>æ ‡è®°å’Œæ•´ç†</strong>ã€‚</p><ul><li><p>**æ ‡è®°ï¼š**å®ƒçš„ç¬¬ä¸€ä¸ªé˜¶æ®µä¸æ ‡è®°/æ¸…é™¤ç®—æ³•æ˜¯ä¸€æ¨¡ä¸€æ ·çš„ï¼Œå‡æ˜¯éå†GC Rootsï¼Œç„¶åå°†å­˜æ´»çš„å¯¹è±¡æ ‡è®°ã€‚</p></li><li><p>**æ•´ç†ï¼š**ç§»åŠ¨æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡ï¼Œä¸”æŒ‰ç…§å†…å­˜åœ°å€æ¬¡åºä¾æ¬¡æ’åˆ—ï¼Œç„¶åå°†æœ«ç«¯å†…å­˜åœ°å€ä»¥åçš„å†…å­˜å…¨éƒ¨å›æ”¶ã€‚å› æ­¤ï¼Œç¬¬äºŒé˜¶æ®µæ‰ç§°ä¸ºæ•´ç†é˜¶æ®µã€‚</p></li></ul><p><img src="/assets/watermark_type_ZmFuZ3poZW5naGVpdGk_shadow_10_text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2NjdWFtYW4__size_16_color_FFFFFF_t_70-16523215733294-d56b33bf.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œæ ‡è®°çš„å­˜æ´»å¯¹è±¡å°†ä¼šè¢«æ•´ç†ï¼ŒæŒ‰ç…§å†…å­˜åœ°å€ä¾æ¬¡æ’åˆ—ï¼Œè€Œæœªè¢«æ ‡è®°çš„å†…å­˜ä¼šè¢«æ¸…ç†æ‰ã€‚å¦‚æ­¤ä¸€æ¥ï¼Œå½“æˆ‘ä»¬éœ€è¦ç»™æ–°å¯¹è±¡åˆ†é…å†…å­˜æ—¶ï¼ŒJVMåªéœ€è¦æŒæœ‰ä¸€ä¸ªå†…å­˜çš„èµ·å§‹åœ°å€å³å¯ï¼Œè¿™æ¯”ç»´æŠ¤ä¸€ä¸ªç©ºé—²åˆ—è¡¨æ˜¾ç„¶å°‘äº†è®¸å¤šå¼€é”€ã€‚</p><p>ä¸éš¾çœ‹å‡ºï¼Œ<strong>æ ‡è®°/æ•´ç†ç®—æ³•ä¸ä»…å¯ä»¥å¼¥è¡¥æ ‡è®°/æ¸…é™¤ç®—æ³•å½“ä¸­ï¼Œå†…å­˜åŒºåŸŸåˆ†æ•£çš„ç¼ºç‚¹ï¼Œä¹Ÿæ¶ˆé™¤äº†å¤åˆ¶ç®—æ³•å½“ä¸­ï¼Œå†…å­˜å‡åŠçš„é«˜é¢ä»£ä»·</strong>ï¼Œå¯è°“æ˜¯ä¸€ä¸¾ä¸¤å¾—ï¼Œä¸€ç®­åŒé›•ï¼Œä¸€çŸ³ä¸¤é¸Ÿï¼Œä¸€ã€‚ã€‚ã€‚ã€‚ä¸€å¥³ä¸¤ç”·ï¼Ÿ</p><p>ä¸è¿‡ä»»ä½•ç®—æ³•éƒ½ä¼šæœ‰å…¶ç¼ºç‚¹ï¼Œ<strong>æ ‡è®°/æ•´ç†ç®—æ³•å”¯ä¸€çš„ç¼ºç‚¹å°±æ˜¯æ•ˆç‡ä¹Ÿä¸é«˜</strong>ï¼Œä¸ä»…è¦æ ‡è®°æ‰€æœ‰å­˜æ´»å¯¹è±¡ï¼Œè¿˜è¦æ•´ç†æ‰€æœ‰å­˜æ´»å¯¹è±¡çš„å¼•ç”¨åœ°å€ã€‚ä»æ•ˆç‡ä¸Šæ¥è¯´ï¼Œæ ‡è®°/æ•´ç†ç®—æ³•è¦ä½äºå¤åˆ¶ç®—æ³•ã€‚</p><h4 id="ä¸‰è‰²æ ‡è®°ç®—æ³•" tabindex="-1"><a class="header-anchor" href="#ä¸‰è‰²æ ‡è®°ç®—æ³•" aria-hidden="true">#</a> ä¸‰è‰²æ ‡è®°ç®—æ³•</h4><p>ä¸‰è‰²æ ‡è®°ç®—æ³•æ˜¯ä¸€ç§åƒåœ¾å›æ”¶çš„æ ‡è®°ç®—æ³•ã€‚å®ƒå¯ä»¥è®©JVMä¸å‘ç”Ÿæˆ–ä»…çŸ­æ—¶é—´å‘ç”ŸSTW(Stop The World)ï¼Œä»è€Œè¾¾åˆ°æ¸…é™¤JVMå†…å­˜åƒåœ¾çš„ç›®çš„ã€‚JVMä¸­çš„CMSã€G1åƒåœ¾å›æ”¶å™¨ æ‰€ä½¿ç”¨åƒåœ¾å›æ”¶ç®—æ³•å³ä¸ºä¸‰è‰²æ ‡è®°æ³•ã€‚</p><p><strong>ä¸‰è‰²æ ‡è®°çš„è¿‡ç¨‹</strong></p><p>é»‘è‰²ï¼šè¡¨ç¤ºå¯¹è±¡å·²ç»è¢«åƒåœ¾æ”¶é›†å™¨è®¿é—®è¿‡äº†ï¼Œä¸”æ˜¯å®‰å…¨å­˜æ´»çš„ã€‚ï¼ˆå½“è¯¥å¯¹è±¡è¢«é‡å¤æ‰«ææ˜¯å¯ä»¥è·³è¿‡ï¼‰</p><p>ç°è‰²ï¼šè¡¨ç¤ºè¯¥å¯¹è±¡è¢«åƒåœ¾æ”¶é›†å™¨æ‰«æè¿‡ï¼Œä½†æ˜¯å¯¹è±¡ä¸Šè¿˜å­˜åœ¨æ²¡æœ‰æ‰«æçš„å¼•ç”¨ã€‚ï¼ˆéœ€è¦åœ¨è¯¥å¯¹è±¡ä¸­å¯»æ‰¾åƒåœ¾ï¼‰</p><p>ç™½è‰²ï¼šè¡¨ç¤ºæœªè¢«åƒåœ¾æ”¶é›†å™¨è®¿é—®è¿‡(åœ¨åˆšå¼€å§‹é˜¶æ®µï¼Œæ‰€æœ‰å¯¹è±¡éƒ½æ˜¯ç™½è‰²ï¼Œè‹¥åˆ†æç»“æŸåä»æ˜¯ç™½è‰²ï¼Œå³ä»£è¡¨ä¸å¯è¾¾)</p><p><img src="/assets/watermark_type_ZHJvaWRzYW5zZmFsbGJhY2s_shadow_50_text_Q1NETiBA5LiA5Y-q5p2_5qCX_size_20_color_FFFFFF_t_70_g_se_x_16-32092feb.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><strong>ä¸‰è‰²æ ‡è®°å­˜åœ¨çš„é—®é¢˜ï¼š</strong></p><p>å¦‚æœåœ¨åƒåœ¾æ”¶é›†å™¨è¿›è¡Œæ ‡è®°çš„è¿‡ç¨‹ä¸­ï¼Œç”¨æˆ·çº¿ç¨‹æ˜¯æš‚åœçš„ï¼Œé‚£ä¹ˆè¿™ä¸ªæ ‡è®°æµç¨‹ä¸ä¼šæœ‰ä»»ä½•é—®é¢˜ã€‚åå°±ååœ¨æ ‡è®°çº¿ç¨‹å’Œç”¨æˆ·çº¿ç¨‹æ˜¯å¹¶å‘æ‰§è¡Œçš„ï¼ˆç”¨æˆ·çº¿ç¨‹åœ¨ä¿®æ”¹å¯¹è±¡ä¸­çš„å¼•ç”¨å…³ç³»ï¼Œè€Œåƒåœ¾æ”¶é›†å™¨åœ¨å¯¹å¯¹è±¡çš„å¼•ç”¨è¿›è¡Œæ ‡è®°ï¼‰ï¼Œè¿™å°±å¯èƒ½å‡ºç°ä¸€ä¸‹ä¸¤ç§åæœï¼š</p><ul><li>å°†åŸæœ¬æ¶ˆäº¡çš„å¯¹è±¡é”™è¯¯çš„æ ‡è®°æˆå­˜æ´»çš„ã€‚</li><li>å°†åŸæœ¬å­˜æ´»çš„å¯¹è±¡é”™è¯¯çš„æ ‡è®°æˆäº†æ¶ˆäº¡ã€‚</li></ul><blockquote><p>å½“ä¸”ä»…å½“ä»¥ä¸‹ä¸¤ä¸ªæ¡ä»¶åŒæ—¶æ»¡è¶³æ—¶ï¼Œä¼šäº§ç”Ÿå¯¹è±¡æ¶ˆå¤±çš„é—®é¢˜ï¼š</p><ul><li>èµ‹å€¼å™¨æ’å…¥äº†ä¸€æ¡æˆ–å¤šæ¡ä»é»‘è‰²ç‹¬äº«åˆ°ç™½è‰²å¯¹è±¡çš„æ–°å¼•ç”¨</li><li>èµ‹å€¼å™¨åˆ é™¤äº†å…¨éƒ¨ä»ç°è‰²å¯¹è±¡åˆ°è¯¥ç™½è‰²å¯¹è±¡çš„ç›´æ¥æˆ–é—´æ¥å¼•ç”¨ã€‚</li></ul></blockquote><p><strong>å¦‚ä½•è§£å†³ï¼Ÿ</strong></p><p>é€šè¿‡è¯»å†™å±éšœæ¥å¤„ç†</p><ul><li>è¯»å±éšœï¼šåœ¨è¯»å–ä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨æ—¶ï¼Œè®°å½•ä¸‹å¼•ç”¨å…³ç³»ã€‚è¿™ä¸ªå¼•ç”¨å¯èƒ½æ˜¯ä»é»‘è‰²åˆ°ç™½è‰²çš„å¼•ç”¨</li><li>å†™å±éšœï¼šåœ¨ç»™å¯¹è±¡ä¸­çš„å˜é‡èµ‹å€¼æ—¶ï¼Œåœ¨èµ‹å€¼å‰å’Œèµ‹å€¼åæ‰§è¡Œä¸€äº›é€»è¾‘ï¼Œè®°å½•å¼•ç”¨å…³ç³»</li></ul><p>åœ¨å¹¶å‘æ ‡è®°çš„è¿‡ç¨‹ä¸­é€šè¿‡è¯»å†™å±éšœæ¥è®°å½•å¼•ç”¨å…³ç³»çš„å˜æ›´ï¼Œåœ¨é‡æ–°æ ‡è®°é˜¶æ®µï¼Œå»é‡æ–°æ ‡è®°è¿™äº›æ•°æ®ã€‚</p><h4 id="æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“" aria-hidden="true">#</a> æ€»ç»“</h4><ul><li><strong>å†…å­˜æ•ˆç‡</strong>ï¼šå¤åˆ¶ç®—æ³•&gt;æ ‡è®°æ¸…é™¤ç®—æ³•&gt;æ ‡è®°å‹ç¼©ç®—æ³•ï¼ˆæ—¶é—´å¤æ‚åº¦ï¼‰</li><li><strong>å†…å­˜æ•´é½åº¦</strong>ï¼šå¤åˆ¶ç®—æ³•=æ ‡è®°æ¸…é™¤ç®—æ³•&gt;æ ‡è®°å‹ç¼©ç®—æ³•</li><li><strong>å†…å­˜åˆ©ç”¨ç‡</strong>ï¼šå¤åˆ¶ç®—æ³•&lt;æ ‡è®°æ¸…é™¤ç®—æ³•=æ ‡è®°å‹ç¼©ç®—æ³•</li></ul><h3 id="åˆ†ä»£åƒåœ¾å›æ”¶" tabindex="-1"><a class="header-anchor" href="#åˆ†ä»£åƒåœ¾å›æ”¶" aria-hidden="true">#</a> åˆ†ä»£åƒåœ¾å›æ”¶</h3><p>JVMåœ¨è¿›è¡Œåƒåœ¾å›æ”¶æ—¶ï¼Œå¹¶ä¸æ˜¯åªä½¿ç”¨æŸä¸€ç§ç®—æ³•ï¼Œè€Œæ˜¯æ‰€æœ‰ç®—æ³•éƒ½ä¼šä½¿ç”¨ï¼Œç”±æ­¤å°±äº§ç”Ÿäº†åˆ†ä»£æ”¶é›†ç®—æ³•ã€‚</p><p>åˆ†ä»£æ”¶é›†ç®—æ³•æ˜¯é’ˆå¯¹å¯¹è±¡çš„ä¸åŒç‰¹æ€§ï¼Œè€Œä½¿ç”¨é€‚åˆçš„ç®—æ³•ï¼Œè¿™é‡Œé¢å¹¶æ²¡æœ‰å®é™…ä¸Šçš„æ–°ç®—æ³•äº§ç”Ÿã€‚<strong>ä¸å…¶è¯´åˆ†ä»£æœé›†ç®—æ³•æ˜¯ç¬¬å››ä¸ªç®—æ³•ï¼Œä¸å¦‚è¯´å®ƒæ˜¯å¯¹å‰ä¸‰ä¸ªç®—æ³•çš„å®é™…åº”ç”¨</strong></p><p>åœ¨å†…å­˜ä¸­å¯¹è±¡å¤§è‡´å¯ä»¥åˆ†ä¸ºä¸‰ç±»ï¼š</p><ul><li><strong>æœç”Ÿå¤•ç­</strong>ï¼šä¾‹å¦‚æ–¹æ³•å†…çš„å±€éƒ¨å˜é‡ï¼Œå¾ªç¯å†…çš„ä¸´æ—¶å˜é‡ç­‰</li><li><strong>è€ä¸æ­»</strong>ï¼šæ—©æ™šè¦æ­»çš„å¯¹è±¡ï¼Œä¾‹å¦‚ç¼“å­˜ã€‚</li><li><strong>æ°¸ç”Ÿ</strong>ï¼šä¾‹å¦‚å¸¸é‡æ± ï¼ŒåŠ è½½çš„ç±»ä¿¡æ¯ç­‰ã€‚</li></ul><p><strong>Javaå †ä¸­å†…å­˜åˆ’åˆ†ï¼š</strong></p><img src="/assets/f113a034a345248ac88c8e7174038ed8-2f6ea2fe.png" alt="Javaå †åˆ’åˆ†" style="zoom:60%;"><p>æ³¨ï¼šåœ¨JDK9ä¸­å¼€å§‹é‡‡ç”¨G1å›æ”¶å™¨ï¼Œå¼€å§‹é‡‡ç”¨äº†æ–°çš„å†…å­˜æ¨¡å‹ï¼Œå¼±åŒ–äº†åˆ†æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„æ¦‚å¿µã€‚</p><h4 id="æ–°ç”Ÿä»£å†…å­˜" tabindex="-1"><a class="header-anchor" href="#æ–°ç”Ÿä»£å†…å­˜" aria-hidden="true">#</a> æ–°ç”Ÿä»£å†…å­˜</h4><p><strong>Minor GC</strong></p><p>å¯¹äºæœç”Ÿå¤•ç­ç±»çš„å¯¹è±¡ï¼Œå­˜æ´»æ—¶é—´çŸ­ï¼Œè¿˜è®°å¾—å¤åˆ¶ç®—æ³•çš„ä½¿ç”¨è¦æ±‚å—ï¼Ÿé‚£å°±æ˜¯å¯¹è±¡å­˜æ´»ç‡ä¸èƒ½å¤ªé«˜ï¼Œå› æ­¤<strong>è¿™ç±»å¯¹è±¡æ˜¯æœ€é€‚åˆä½¿ç”¨å¤åˆ¶ç®—æ³•çš„</strong>ã€‚</p><p>ä½†æ˜¯50%çš„å†…å­˜æµªè´¹æ€ä¹ˆè§£å†³å‘¢ï¼Ÿ</p><p>JVMå°†æ–°ç”Ÿä»£å†…å­˜åˆåˆ’åˆ†äº†3å—åŒºåŸŸï¼Œ80%çš„å†…å­˜ç”¨æ¥ç»™æ–°å»ºå¯¹è±¡åˆ†é…å†…å­˜ï¼Œå¦å¤–ä¸¤å—10%çš„å†…å­˜ä½œä¸ºå¯¹è±¡çš„å¹¸å­˜åŒºã€‚ä¸€æ—¦å‘ç”ŸGCï¼Œå°†å…¶ä¸­ä¸€ä¸ª10%çš„å¹¸å­˜åŒºå’Œ80%çš„EdenåŒºçš„å¯¹è±¡è½¬ç§»åˆ°å¦ä¸€ä¸ª10%çš„å¹¸å­˜åŒºå†…ï¼Œæ¯å¤åˆ¶ä¸€æ¬¡ï¼Œå¹´é¾„åŠ 1ï¼Œæ¥ä¸‹æ¥ï¼Œå‰é¢90%çš„å†…å­˜å°†å…¨éƒ¨è¢«é‡Šæ”¾ï¼Œï¼ˆæ³¨æ„è¿™é‡Œä¼šä¸€è‡´æœ‰ä¸€ä¸ª10%çš„å¹¸å­˜åŒºæ˜¯ç©ºçš„ï¼Œç”¨æ¥åœ¨ä¸‹ä¸€æ¬¡GCä¿å­˜å­˜å¯¹è±¡ï¼‰</p><p>ä½¿ç”¨è¿™æ ·çš„æ–¹å¼ï¼Œæˆ‘ä»¬åªæµªè´¹äº†10%çš„å†…å­˜ï¼Œè¿™ä¸ªæ˜¯å¯ä»¥æ¥å—çš„ï¼Œå› ä¸ºæˆ‘ä»¬æ¢æ¥äº†å†…å­˜çš„æ•´é½æ’åˆ—ä¸GCé€Ÿåº¦ã€‚ä½†æ˜¯è¿™ä¸ªç­–ç•¥çš„å‰ææ˜¯ï¼Œæ¯æ¬¡å­˜æ´»çš„å¯¹è±¡å ç”¨çš„å†…å­˜ä¸èƒ½è¶…è¿‡è¿™10%çš„å¤§å°ï¼Œä¸€æ—¦è¶…è¿‡ï¼Œå¤šå‡ºçš„å¯¹è±¡å°†æ— æ³•å¤åˆ¶ã€‚ä¸‹é¢è€å¹´ä»£å¼€å§‹ç™»åœºäº†ã€‚</p><p>minor GCä¼šè§¦å‘ä¸€æ¬¡ stop the world (minor gc é€šå¸¸æƒ…å†µä¸‹å¾ˆå¿«)</p><h4 id="è€å¹´ä»£å†…å­˜" tabindex="-1"><a class="header-anchor" href="#è€å¹´ä»£å†…å­˜" aria-hidden="true">#</a> è€å¹´ä»£å†…å­˜</h4><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œä»¥ä¸‹ä¸¤ç§æƒ…å†µå‘ç”Ÿçš„æ—¶å€™ï¼Œå¯¹è±¡ä¼šä»æ–°ç”Ÿä»£åŒºåŸŸè½¬åˆ°å¹´è€å¸¦åŒºåŸŸã€‚</p><ul><li><p>åœ¨æ–°ç”Ÿä»£é‡Œçš„æ¯ä¸€ä¸ªå¯¹è±¡ï¼Œéƒ½ä¼šæœ‰ä¸€ä¸ª<strong>å¹´é¾„</strong>ï¼Œå½“è¿™äº›å¯¹è±¡çš„å¹´é¾„åˆ°è¾¾ä¸€å®šç¨‹åº¦æ—¶ï¼ˆå¹´é¾„å°±æ˜¯ç†¬è¿‡çš„GCæ¬¡æ•°ï¼Œæ¯æ¬¡GCå¦‚æœå¯¹è±¡å­˜æ´»ä¸‹æ¥ï¼Œåˆ™å¹´é¾„åŠ 1ï¼Œæœ€å¤§15æ¬¡ï¼‰ï¼Œåˆ™ä¼šè¢«è½¬åˆ°å¹´è€ä»£ï¼Œè€Œè¿™ä¸ªè½¬å…¥å¹´è€ä»£çš„å¹´é¾„å€¼ï¼Œä¸€èˆ¬åœ¨JVMä¸­æ˜¯å¯ä»¥è®¾ç½®çš„ã€‚</p></li><li><p>åœ¨æ–°ç”Ÿä»£å­˜æ´»å¯¹è±¡å ç”¨çš„å†…å­˜è¶…è¿‡10%æ—¶ï¼Œåˆ™å¤šä½™çš„å¯¹è±¡ä¼šæ”¾å…¥å¹´è€ä»£ã€‚è¿™ç§æ—¶å€™ï¼Œå¹´è€ä»£å°±æ˜¯æ–°ç”Ÿä»£çš„â€œå¤‡ç”¨ä»“åº“â€ã€‚</p></li></ul><p>é’ˆå¯¹è€ä¸æ­»å¯¹è±¡çš„ç‰¹æ€§ï¼Œæ˜¾ç„¶ä¸å†é€‚åˆä½¿ç”¨å¤åˆ¶ç®—æ³•ï¼Œå› ä¸ºå®ƒçš„å­˜æ´»ç‡å¤ªé«˜ï¼Œè€Œä¸”ä¸è¦å¿˜äº†ï¼Œå¦‚æœå¹´è€ä»£å†ä½¿ç”¨å¤åˆ¶ç®—æ³•ï¼Œå®ƒå¯æ˜¯æ²¡æœ‰å¤‡ç”¨ä»“åº“çš„ã€‚å› æ­¤ä¸€èˆ¬é’ˆå¯¹<strong>è€ä¸æ­»å¯¹è±¡åªèƒ½é‡‡ç”¨æ ‡è®°/æ•´ç†æˆ–è€…æ ‡è®°/æ¸…é™¤ç®—æ³•</strong>ã€‚</p><p>å½“è€å¹´ä»£çš„ç©ºé—´ä¸è¶³ï¼Œä¼šå…ˆå°è¯•è§¦å‘minor gcï¼Œå¦‚æœè¿˜ä¸è¶³ï¼Œä¼šè§¦å‘full gcï¼Œfull gcæ‰€éœ€çš„æ—¶é—´æ›´é•¿</p><h4 id="æ°¸ä¹…ä»£å†…å­˜" tabindex="-1"><a class="header-anchor" href="#æ°¸ä¹…ä»£å†…å­˜" aria-hidden="true">#</a> æ°¸ä¹…ä»£å†…å­˜</h4><p>æ°¸ä¹…å¸¦å¯¹åº”Javaå†…å­˜ç»“æ„ä¸­çš„æ–¹æ³•åŒºï¼Œè¿™é‡Œæ²¡æœ‰å¤‡ç”¨ä»“åº“ï¼Œæ‰€ä»¥åªèƒ½ä½¿ç”¨æ ‡è®°/æ¸…é™¤å’Œæ ‡è®°/æ•´ç†ç®—æ³•ã€‚</p><h4 id="è·¨ä»£å¼•ç”¨é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#è·¨ä»£å¼•ç”¨é—®é¢˜" aria-hidden="true">#</a> è·¨ä»£å¼•ç”¨é—®é¢˜</h4><p>è·¨ä»£å¼•ç”¨æ˜¯æŒ‡å¹´è½»ä»£çš„å¯¹è±¡å¼•ç”¨è€å¹´ä»£ä¸­çš„å¯¹è±¡ï¼Œè€å¹´ä»£ä¸­çš„å¯¹è±¡ä¹Ÿä¼šå¼•ç”¨å¹´è½»ä»£ä¸­çš„å¯¹è±¡ã€‚é‚£ä¹ˆé—®é¢˜å°±æ¥äº†ï¼ŒJVMåœ¨è¿›è¡ŒMinorGCçš„æ—¶å€™è¿˜è¦å»éå†è€å¹´ä»£çš„ä¹ˆï¼Ÿç­”æ¡ˆå½“ç„¶æ˜¯ä¸èƒ½ï¼Œé‚£ä¹ˆå¦‚ä½•è§£å†³ï¼Ÿ</p><h5 id="è®°å¿†é›†" tabindex="-1"><a class="header-anchor" href="#è®°å¿†é›†" aria-hidden="true">#</a> è®°å¿†é›†</h5><p>è®°å¿†é›†ï¼ˆRemembered Setï¼‰ï¼Œå®ƒæ˜¯åœ¨å¹´è½»ä»£ä¸­å»ºç«‹çš„ä¸€ä¸ªæ•°æ®ç»“æ„ï¼ŒæŠŠè€å¹´ä»£åˆ’åˆ†ä¸ºNä¸ªåŒºåŸŸï¼Œæ ‡å¿—å‡ºå“ªä¸ªåŒºåŸŸä¼šå­˜åœ¨è·¨ä»£å¼•ç”¨ã€‚è¿™æ ·åœ¨è¿›è¡ŒMinorGCçš„æ—¶å€™ï¼Œåªè¦æŠŠè¿™äº›åŒ…å«äº†è·¨ä»£å¼•ç”¨çš„å†…å­˜åŒºåŸŸåŠ å…¥GC Rootsä¸€èµ·æ‰«æå°±è¡Œäº†ã€‚</p><img src="/assets/image-20220521090200352-de3e77c5.png" alt="image-20220521090200352" style="zoom:50%;"><h5 id="å¡è¡¨" tabindex="-1"><a class="header-anchor" href="#å¡è¡¨" aria-hidden="true">#</a> å¡è¡¨</h5><p>å¡è¡¨å®é™…ä¸Šå°±æ˜¯è®°å¿†é›†çš„ä¸€ç§å®ç°æ–¹å¼ï¼Œä¹Ÿæ˜¯ç›®å‰æœ€å¸¸ç”¨çš„ä¸€ç§å®ç°æ–¹å¼ã€‚</p><p>å¯¹äºHotSpotè™šæ‹Ÿæœºæ¥è¯´ï¼Œå¡è¡¨çš„å®ç°æ–¹å¼å°±æ˜¯ä¸€ä¸ªå­—èŠ‚æ•°ç»„ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token constant">CARD_TABLE</span> <span class="token punctuation">[</span><span class="token keyword">this</span> address <span class="token operator">&gt;&gt;</span> <span class="token number">9</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>è¿™æ®µä»£ç ä»£è¡¨ç€å¡è¡¨æ ‡è®°çš„çš„é€»è¾‘ã€‚å®é™…ä¸Šå¡è¡¨å°±æ˜¯æ˜ å°„äº†ä¸€å—å—çš„å†…å­˜åœ°å€ï¼Œè¿™äº›å†…å­˜åœ°å€å—ç§°ä¸ºå¡é¡µï¼Œä»ä»£ç å¯ä»¥çœ‹å‡ºæ¯ä¸ª<strong>å¡é¡µ</strong>çš„å¤§å°å°±æ˜¯2^9=512å­—èŠ‚ã€‚æ•°ç»„çš„0ï¼Œ1å·å…ƒç´ å°±æ˜ å°„ä¸º0x0000ï½0x01FF(0-511)ã€0x0200ï½0x03FF(512-1023)å†…å­˜åœ°å€çš„å¡é¡µã€‚</p><img src="/assets/image-20220521091535223-7bb8cd95.png" alt="image-20220521091535223" style="zoom:50%;"><p>åªè¦ä¸€ä¸ªå¡é¡µå†…çš„å¯¹è±¡å­˜åœ¨ä¸€ä¸ªæˆ–è€…å¤šä¸ªè·¨ä»£å¯¹è±¡æŒ‡é’ˆï¼Œå°±å°†è¯¥ä½ç½®çš„å¡è¡¨æ•°ç»„å…ƒç´ ä¿®æ”¹ä¸º1ï¼Œè¡¨ç¤ºè¿™ä¸ªä½ç½®ä¸ºè„ï¼Œæ²¡æœ‰åˆ™ä¸º0ã€‚åœ¨GCçš„æ—¶å€™ï¼Œå°±ç›´æ¥æŠŠå€¼ä¸º1å¯¹åº”çš„å¡é¡µå¯¹è±¡æŒ‡é’ˆåŠ å…¥GC Rootsä¸€èµ·æ‰«æå³å¯ã€‚æœ‰äº†å¡è¡¨ï¼Œæˆ‘ä»¬å°±ä¸éœ€è¦å»åœ¨å‘ç”ŸMinorGCçš„æ—¶å€™æ‰«ææ•´ä¸ªè€å¹´ä»£äº†ï¼Œæ€§èƒ½å¾—åˆ°äº†æå¤§çš„æå‡ã€‚</p><h5 id="å†™å±éšœ" tabindex="-1"><a class="header-anchor" href="#å†™å±éšœ" aria-hidden="true">#</a> å†™å±éšœ</h5><p>å‰é¢ä»‹ç»çš„éƒ½æ˜¯ä¸€äº›æ€æƒ³ï¼ŒJVMæ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿ</p><p>æ²¡é”™ï¼Œå°±æ˜¯å†™å±éšœã€‚å†™å±éšœç±»ä¼¼äºAOPçš„æ€æƒ³ï¼Œåœ¨JVMä¼šåœ¨<code>å¼•ç”¨ç±»å‹å­—æ®µèµ‹å€¼</code>è¿™ä¸ªåŠ¨ä½œç”Ÿæˆä¸€ä¸ªAroundï¼Œåœ¨èµ‹å€¼å‰ï¼Œèµ‹å€¼åéƒ½ä¼šæ‰§è¡Œä¸€äº›é€»è¾‘ï¼Œå¦‚æ›´æ–°å¡è¡¨ä¿¡æ¯ã€‚ä½†æ˜¯å†™å±éšœä¼šå¸¦æ¥ä¸€äº›æ€§èƒ½å¼€é”€ï¼Œä¸è¿‡å’Œæ‰«æè€å¹´ä»£ç›¸æ¯”ï¼Œè¿™ä¸ªæ€§èƒ½å¼€é”€è¿˜æ˜¯å¯ä»¥æ¥æ”¶çš„ã€‚</p><p>å†™å±éšœè¿˜å­˜åœ¨ä¸€ä¸ªä¼ªå…±äº«é—®é¢˜ï¼Œç°ä»£å¤„ç†å™¨é€šå¸¸æ˜¯ä»¥ç¼“å­˜è¡Œä¸ºå­˜å‚¨å•ä½ï¼Œç¼“å­˜è¡Œé€šå¸¸æ¥è¯´éƒ½æ˜¯64å­—èŠ‚ï¼Œä¸€ä¸ªå¡è¡¨å…ƒç´ 1ä¸ªå­—èŠ‚ï¼Œå ç”¨çš„å¡é¡µå†…å­˜å¤§å°å°±æ˜¯64*512=32KBçš„å¤§å°ã€‚å¦‚æœå¤šçº¿ç¨‹åˆšå¥½æ›´æ–°åˆšå¥½å¤„äºè¿™32KBèŒƒå›´å†…çš„å¯¹è±¡ï¼Œé‚£ä¹ˆå°±ä¼šå¯¹æ€§èƒ½äº§ç”Ÿå½±å“ã€‚</p><p>JDK7ä¹‹åæ–°å¢äº†ä¸€ä¸ªå‚æ•°-XX:+UseCondCardMarkï¼Œä»–ä»£è¡¨æ˜¯å¦å¼€å¯å¡è¡¨æ›´æ–°çš„åˆ¤æ–­ï¼Œæ²¡æœ‰è¢«æ ‡è®°è¿‡æ‰æ ‡è®°ä¸ºè„ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">CARD_TABLE</span> <span class="token punctuation">[</span><span class="token keyword">this</span> address <span class="token operator">&gt;&gt;</span> <span class="token number">9</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> 
  	<span class="token constant">CARD_TABLE</span> <span class="token punctuation">[</span><span class="token keyword">this</span> address <span class="token operator">&gt;&gt;</span> <span class="token number">9</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸€ä¸ªå¡ä¸šå†…æ•°æ®è¢«ä¿®æ”¹å¤šæ¬¡ï¼Œåªæœ‰ç¬¬ä¸€æ¬¡ä¿®æ”¹å¡è¡¨ã€‚ä»è€Œå‡å°‘å¡è¡¨çš„ä¿®æ”¹æ¬¡æ•°</p><h3 id="åƒåœ¾å›æ”¶å™¨" tabindex="-1"><a class="header-anchor" href="#åƒåœ¾å›æ”¶å™¨" aria-hidden="true">#</a> åƒåœ¾å›æ”¶å™¨</h3><p>JVMçš„ç›¸å…³å‚æ•°ï¼š</p><table><thead><tr><th>å«ä¹‰</th><th>å‚æ•°</th></tr></thead><tbody><tr><td>å †åˆå§‹å¤§å°</td><td>-Xms</td></tr><tr><td>å †æœ€å¤§å¤§å°</td><td>-Xmx æˆ– -XX:MaxHeapSize=size</td></tr><tr><td>æ–°ç”Ÿä»£å¤§å°</td><td>-Xmn æˆ– (-XX:NewSize=size + -XX:MaxNewSize=size )</td></tr><tr><td>å¹¸å­˜åŒºæ¯”ä¾‹ï¼ˆåŠ¨æ€ï¼‰</td><td>-XX:InitialSurvivorRatio=ratio å’Œ -XX:+UseAdaptiveSizePolicy</td></tr><tr><td>å¹¸å­˜åŒºæ¯”ä¾‹</td><td>-XX:SurvivorRatio=ratio</td></tr><tr><td>æ™‹å‡é˜ˆå€¼</td><td>-XX:MaxTenuringThreshold=threshold</td></tr><tr><td>æ™‹å‡è¯¦æƒ…</td><td>-XX:+PrintTenuringDistribution</td></tr><tr><td>GCè¯¦æƒ…</td><td>-XX:+PrintGCDetails -verbose:gc</td></tr><tr><td>FullGC å‰ MinorGC</td><td>-XX:+ScavengeBeforeFullGC</td></tr></tbody></table><h4 id="åƒåœ¾å›æ”¶å™¨çš„åˆ†ç±»" tabindex="-1"><a class="header-anchor" href="#åƒåœ¾å›æ”¶å™¨çš„åˆ†ç±»" aria-hidden="true">#</a> åƒåœ¾å›æ”¶å™¨çš„åˆ†ç±»</h4><p>åƒåœ¾æœé›†å™¨å¤§è‡´åˆ†ä¸ºä»¥ä¸‹ä¸‰ç±»ã€‚</p><ul><li><p>ä¸²è¡Œæœé›†å™¨ï¼ˆserial collectorï¼‰ï¼šå®ƒåªæœ‰ä¸€æ¡GCçº¿ç¨‹ï¼Œä¸”å°±åƒå‰é¢è¯´çš„ï¼Œå®ƒåœ¨è¿è¡Œçš„æ—¶å€™éœ€è¦æš‚åœç”¨æˆ·ç¨‹åºï¼ˆstop the worldï¼‰ã€‚</p></li><li><p>å¹¶è¡Œæœé›†å™¨ï¼ˆparallel collectorï¼‰ï¼šå®ƒæœ‰å¤šæ¡GCçº¿ç¨‹ï¼Œä¸”å®ƒä¹Ÿéœ€è¦æš‚åœç”¨æˆ·ç¨‹åºï¼ˆstop the worldï¼‰ã€‚</p></li><li><p>å¹¶å‘æœé›†å™¨ï¼ˆconcurrent collectorï¼‰ï¼šå®ƒæœ‰ä¸€æ¡æˆ–å¤šæ¡GCçº¿ç¨‹ï¼Œä¸”å®ƒéœ€è¦åœ¨éƒ¨åˆ†é˜¶æ®µæš‚åœç”¨æˆ·ç¨‹åºï¼ˆstop the worldï¼‰ï¼Œéƒ¨åˆ†é˜¶æ®µä¸ç”¨æˆ·ç¨‹åºå¹¶å‘æ‰§è¡Œã€‚</p></li></ul><h4 id="hotsportä¸­çš„åƒåœ¾å›æ”¶å™¨" tabindex="-1"><a class="header-anchor" href="#hotsportä¸­çš„åƒåœ¾å›æ”¶å™¨" aria-hidden="true">#</a> HotSportä¸­çš„åƒåœ¾å›æ”¶å™¨</h4><p>åœ¨hotspotJVMä¸­ï¼Œæ¯ä¸€ä¸ªç§ç±»çš„åƒåœ¾æœé›†å™¨éƒ½æœ‰å¯¹åº”çš„å®ç°ï¼Œå¦‚ä¸‹ã€‚</p><ul><li><p>ä¸²è¡Œæœé›†å™¨çš„å®ç°ï¼šserialï¼ˆç”¨äºæ–°ç”Ÿä»£ï¼Œé‡‡ç”¨å¤åˆ¶ç®—æ³•ï¼‰ã€serial oldï¼ˆç”¨äºå¹´è€ä»£ï¼Œé‡‡ç”¨æ ‡è®°/æ•´ç†ç®—æ³•ï¼‰</p></li><li><p>å¹¶è¡Œæœé›†å™¨çš„å®ç°ï¼šParNewï¼ˆç”¨äºæ–°ç”Ÿä»£ï¼Œé‡‡ç”¨å¤åˆ¶ç®—æ³•ï¼‰ã€Parallel Scavengeï¼ˆç”¨äºæ–°ç”Ÿä»£ï¼Œé‡‡ç”¨å¤åˆ¶ç®—æ³•ï¼‰ã€Parallel oldï¼ˆç”¨äºå¹´è€ä»£ï¼Œé‡‡ç”¨æ ‡è®°/æ•´ç†ç®—æ³•ï¼‰</p></li><li><p>å¹¶å‘æœé›†å™¨çš„å®ç°ï¼šconcurrent mark sweep[CMS]ï¼ˆç”¨äºå¹´è€ä»£ï¼Œé‡‡ç”¨æ ‡è®°/æ¸…é™¤ç®—æ³•ï¼‰</p></li></ul><p>å¯ä»¥çœ‹åˆ°ï¼Œä¸Šé¢æ¯ä¸€ç§åƒåœ¾æœé›†å™¨éƒ½æ˜¯é’ˆå¯¹ä¸åŒå†…å­˜åŒºåŸŸæ‰€è®¾è®¡çš„ï¼Œå› ä¸ºå®ƒä»¬é‡‡ç”¨çš„ç®—æ³•ä¸åŒï¼Œå‡¡æ˜¯ç”¨äºæ–°ç”Ÿä»£çš„éƒ½æ˜¯ä½¿ç”¨çš„å¤åˆ¶ç®—æ³•ï¼Œè€Œç”¨äºå¹´è€ä»£çš„éƒ½æ˜¯ä½¿ç”¨çš„æ ‡è®°/æ¸…é™¤æˆ–è€…æ ‡è®°/æ•´ç†ç®—æ³•ã€‚</p><p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬éœ€è¦ç»™JVMçš„æ–°ç”Ÿä»£å’Œå¹´è€ä»£åˆ†åˆ«é€‰æ‹©åƒåœ¾æœé›†å™¨ï¼Œå¯ä»¥çœ‹åˆ°æ— è®ºæ˜¯æ–°ç”Ÿä»£è¿˜æ˜¯å¹´è€ä»£éƒ½åˆ†åˆ«æœ‰ä¸‰ç§å®ç°ï¼Œæ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬åº”è¯¥æœ‰3*3=9ç§é€‰æ‹©ã€‚ä½†æ˜¯ï¼Œäº‹å®å¹¶éå¦‚æ­¤ã€‚</p><p>äº‹å®ä¸Šï¼Œè¿™å…­ç§åƒåœ¾æœé›†å™¨åªæœ‰å…­ç§é€‰æ‹©ï¼Œå› ä¸ºæœ‰çš„åƒåœ¾æœé›†å™¨ç”±äºå…·ä½“å®ç°çš„æ–¹å¼ç­‰ä¸€ç³»åˆ—åŸå› æ— æ³•åœ¨ä¸€èµ·å·¥ä½œï¼Œå¦‚ä¸‹å›¾ã€‚</p><img src="/assets/24191821-c3e4d156f40e46e7aa8f5c23ae017903-e720390d.jpg" alt="img" style="zoom:100%;"><p>é’ˆå¯¹ä¸Šå›¾ï¼Œçº¢çš„å°±æ˜¯ä¸²è¡Œæœé›†å™¨ï¼Œç»¿çš„æ˜¯å¹¶è¡Œæœé›†å™¨ï¼Œå”¯ä¸€ä¸€ä¸ªé»„çš„æ˜¯å¹¶å‘æœé›†å™¨ã€‚ä¸Šé¢ä¸‰ä¸ªæ˜¯æ–°ç”Ÿä»£çš„æœé›†å™¨ï¼Œä¸‹é¢ä¸‰ä¸ªæ˜¯å¹´è€ä»£çš„æœé›†å™¨ã€‚ä¸¤è€…ä¹‹é—´æœ‰è¿çº¿ï¼Œåˆ™è¡¨ç¤ºä¸¤è€…å¯ä»¥é…åˆå·¥ä½œã€‚</p><p>è¿™å…­ç§ç»„åˆå¹¶æ²¡æœ‰è¯´å“ªä¸ªç»„åˆæœ€å¼ºï¼Œå“ªä¸ªç»„åˆæœ€å¼±ï¼Œè¿˜æ˜¯é‚£å¥è¯ï¼Œåªæœ‰æœ€åˆé€‚çš„ï¼Œæ²¡æœ‰æœ€å¥½çš„ã€‚å› æ­¤è¿™å°±éœ€è¦æˆ‘ä»¬å¯¹æ¯ä¸€ç§ç»„åˆæœ‰ä¸€å®šçš„è®¤è¯†ï¼Œæ‰èƒ½åœ¨ä½¿ç”¨çš„æ—¶å€™é€‰æ‹©æ›´é€‚åˆçš„åƒåœ¾æœé›†å™¨ã€‚</p><p>ä¸‹é¢å°±å¼€å§‹æ„ä¹‰ä»‹ç»å›æ”¶å™¨</p><h4 id="serial-åƒåœ¾å›æ”¶å™¨" tabindex="-1"><a class="header-anchor" href="#serial-åƒåœ¾å›æ”¶å™¨" aria-hidden="true">#</a> Serial åƒåœ¾å›æ”¶å™¨</h4><p><strong>ç®—æ³•</strong>ï¼šé‡‡ç”¨å¤åˆ¶ç®—æ³•</p><p><strong>å†…å­˜åŒºåŸŸ</strong>ï¼šé’ˆå¯¹æ–°ç”Ÿä»£è®¾è®¡</p><p><strong>æ‰§è¡Œæ–¹å¼</strong>ï¼šå•çº¿ç¨‹ã€ä¸²è¡Œ</p><p><strong>æ‰§è¡Œè¿‡ç¨‹</strong>ï¼šå½“æ–°ç”Ÿä»£å†…å­˜ä¸å¤Ÿç”¨æ—¶ï¼Œå…ˆ<strong>æš‚åœå…¨éƒ¨ç”¨æˆ·ç¨‹åº</strong>ï¼Œç„¶åå¼€å¯<strong>ä¸€æ¡GCçº¿ç¨‹</strong>ä½¿ç”¨å¤åˆ¶ç®—æ³•å¯¹åƒåœ¾è¿›è¡Œå›æ”¶ï¼Œè¿™ä¸€è¿‡ç¨‹ä¸­å¯èƒ½ä¼šæœ‰ä¸€äº›å¯¹è±¡æå‡åˆ°å¹´è€ä»£</p><p><strong>ç‰¹ç‚¹</strong>ï¼šç”±äºå•çº¿ç¨‹è¿è¡Œï¼Œä¸”æ•´ä¸ªGCé˜¶æ®µéƒ½è¦æš‚åœç”¨æˆ·ç¨‹åºï¼Œå› æ­¤ä¼šé€ æˆåº”ç”¨ç¨‹åºåœé¡¿æ—¶é—´è¾ƒé•¿ï¼Œä½†å¯¹äº<strong>å°è§„æ¨¡</strong>çš„ç¨‹åºæ¥è¯´ï¼Œå´éå¸¸é€‚åˆã€‚</p><p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šå¹³æ—¶çš„å¼€å‘ä¸è°ƒè¯•ç¨‹åºä½¿ç”¨ï¼Œä»¥åŠæ¡Œé¢åº”ç”¨äº¤äº’ç¨‹åºã€‚</p><p>æ‰§è¡Œæµç¨‹ï¼š</p><p><img src="/assets/52efcc60493d41e8acd36f5a6f192122-2-0ef690f2.png" alt="img"></p><p>å¸¸ç”¨å‚æ•°ï¼š</p><ul><li><p>-XX:+UseSerialGCï¼šå¯ç”¨serialåƒåœ¾æ”¶é›†å™¨(è¿™ä¸ªå‚æ•°ä¼šåŒæ—¶å¯ç”¨serialå’Œserial old)</p></li><li><p>-XX:SurvivorRatioï¼š è°ƒæ•´æ–°ç”Ÿä»£ä¸­çš„edenæ¯”ä¾‹ï¼Œé»˜è®¤-XX:SurvivorRatio=8</p></li><li><p>-XX:+PrintGCDetailsï¼š å‘ç”ŸGCæ˜¯æ‰“å°æ—¥å¿—ï¼ˆJDK9ä¹‹å‰æœ‰æ•ˆï¼‰</p></li><li><p>-XX:MaxTenuringThreshold=15ï¼š æ™‹å‡åˆ°è€å¹´ä»£çš„é˜ˆå€¼ï¼ŒParallelé»˜è®¤15ï¼ŒCMSé»˜è®¤6ï¼ŒG1é»˜è®¤15</p></li><li><p>-XX:PretenureSizeThreshold=3145728ï¼š å½“å¯¹è±¡å¤§äºè¯¥å¤§å°åï¼Œç›´æ¥æ™‹å‡åˆ°è€å¹´ä»£ã€‚æ³¨æ„è¿™é‡Œåªèƒ½ä»¥å­—èŠ‚çš„å½¢å¼æŒ‡å®š</p></li></ul><h4 id="serial-old-åƒåœ¾å›æ”¶å™¨" tabindex="-1"><a class="header-anchor" href="#serial-old-åƒåœ¾å›æ”¶å™¨" aria-hidden="true">#</a> Serial Old åƒåœ¾å›æ”¶å™¨</h4><p><strong>ç®—æ³•</strong>ï¼šæ ‡è®°/æ•´ç†ç®—æ³•</p><p><strong>å†…å­˜åŒºåŸŸ</strong>ï¼šé’ˆå¯¹æ–°ç”Ÿä»£è®¾è®¡</p><p>å…¶ä»–ç‰¹æ€§å’ŒSerialç›¸ä¼¼</p><p>å¸¸ç”¨å‚æ•°ï¼š</p><ul><li><p>-XX:+UseSerialGCï¼š Serial + Serial Old</p></li><li><p>-XX:+UseParallelGC,ä½¿ç”¨Parallel Scavenge + Serial Oldæ”¶é›†å™¨ç»„åˆã€‚</p></li><li><p>-XX:+UseConcMarkSweepGC,ä½¿ç”¨ParNew + CMS + Serial Oldæ”¶é›†å™¨ç»„åˆï¼ˆJDK9ä¸­å‚æ•°ï¼‰ã€‚</p></li></ul><h4 id="parnew-åƒåœ¾å›æ”¶å™¨" tabindex="-1"><a class="header-anchor" href="#parnew-åƒåœ¾å›æ”¶å™¨" aria-hidden="true">#</a> ParNew åƒåœ¾å›æ”¶å™¨</h4><p>ParNewæ”¶é›†å™¨å…¶å®å°±æ˜¯Serialæ”¶é›†å™¨çš„å¤šçº¿ç¨‹ç‰ˆæœ¬ï¼Œåœ¨JDK9åŠä»¥åçš„ç‰ˆæœ¬ä½œä¸ºCMSé»˜è®¤çš„æ–°ç”Ÿä»£åƒåœ¾æ”¶é›†å™¨ï¼Œä¸åœ¨æ”¯æŒå•ç‹¬é…ç½®å‚æ•°ã€‚</p><p><strong>ç®—æ³•</strong>ï¼šé‡‡ç”¨æ ‡è®°å¤åˆ¶ç®—æ³•</p><p><strong>å†…å­˜åŒºåŸŸ</strong>ï¼šé’ˆå¯¹æ–°ç”Ÿä»£è®¾è®¡</p><p><strong>æ‰§è¡Œæ–¹å¼</strong>ï¼šå¤šçº¿ç¨‹ã€å¹¶è¡Œ</p><p><strong>æ‰§è¡Œè¿‡ç¨‹</strong>ï¼šå½“æ–°ç”Ÿä»£å†…å­˜ä¸å¤Ÿç”¨æ—¶ï¼Œå…ˆæš‚åœå…¨éƒ¨ç”¨æˆ·ç¨‹åºï¼Œç„¶åå¼€å¯è‹¥å¹²æ¡GCçº¿ç¨‹ä½¿ç”¨å¤åˆ¶ç®—æ³•å¹¶è¡Œè¿›è¡Œåƒåœ¾å›æ”¶ï¼Œè¿™ä¸€è¿‡ç¨‹ä¸­å¯èƒ½ä¼šæœ‰ä¸€äº›å¯¹è±¡æå‡åˆ°å¹´è€ä»£</p><p><strong>ç‰¹ç‚¹</strong>ï¼šé‡‡ç”¨å¤šçº¿ç¨‹å¹¶è¡Œè¿è¡Œï¼Œå› æ­¤ä¼šå¯¹ç³»ç»Ÿçš„å†…æ ¸å¤„ç†å™¨æ•°ç›®æ¯”è¾ƒæ•æ„Ÿã€‚åŒæ ·éœ€è¦STWã€‚åœ¨å•æ ¸CPUä¸Šå…¶æ€§èƒ½å¯ä¸ä¸å¦‚Serial å¥½ã€‚</p><p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šåœ¨ä¸­åˆ°å¤§å‹çš„å †ä¸Šï¼Œä¸”ç³»ç»Ÿå¤„ç†å™¨è‡³å°‘å¤šäºä¸€ä¸ªçš„æƒ…å†µ</p><p>æ‰§è¡Œæµç¨‹ï¼š</p><p><img src="/assets/5329112d6f7c48b296483782c019a4a0-2-efb54668.png" alt="img"></p><p>å¸¸ç”¨å‚æ•°ï¼š</p><ul><li>-XXï¼š+UseParNewGCï¼š å¯ç”¨ParNew+Serial Oldåƒåœ¾æ”¶é›†å™¨ç»„åˆï¼ˆJDK9å–æ¶ˆäº†è¯¥å‚æ•°ï¼‰</li><li>-XX:+UseConcMarkSweepGCï¼š å¯ç”¨ParNew + CMSçš„åƒåœ¾æ”¶é›†å™¨ç»„åˆï¼ˆJDK9å–æ¶ˆäº†è¯¥å‚æ•°ï¼‰</li><li>-XX:ParallelGCThreads=3ï¼šä»£è¡¨åƒåœ¾å›æ”¶çº¿ç¨‹æœ€å¤šå¯ä»¥3æ¡åŒæ—¶è¿è¡Œã€‚</li></ul><h4 id="parallel-scavengeåƒåœ¾å›æ”¶å™¨" tabindex="-1"><a class="header-anchor" href="#parallel-scavengeåƒåœ¾å›æ”¶å™¨" aria-hidden="true">#</a> Parallel Scavengeåƒåœ¾å›æ”¶å™¨</h4><p>Parallelçš„ä¸»è¦å…³æ³¨ç‚¹åœ¨ååé‡ï¼Œå•ä½æ—¶é—´å†…æ”¶é›†çš„åƒåœ¾è¶Šå¤šè¶Šå¥½ã€‚</p><p>é’ˆå¯¹æ–°ç”Ÿä»£ï¼Œé‡‡ç”¨æ ‡è®°å¤åˆ¶ç®—æ³•ã€‚ä¸ParNewç›¸æ¯”ï¼Œå¯æ§åˆ¶çš„å‚æ•°æ›´å¤šã€‚</p><p>å›æ”¶æµç¨‹ï¼š</p><p><img src="/assets/41beb7b8332445f28d26ad0b1ad0b07b-2-adf51123.png" alt="img"></p><p>å¸¸ç”¨å‚æ•°ï¼š</p><ul><li>-XX:+UseParallelGCï¼š å¯ç”¨Parallel Scavenge + Serial Oldç»„åˆæ¨¡å¼</li><li>-XX:+UseParallelOldGCï¼š å¯ç”¨Parallel Scavenge + Parallel Oldç»„åˆæ¨¡å¼</li><li>-XX:ParallelGCThreadsï¼š è®¾ç½®åƒåœ¾æ”¶é›†çº¿ç¨‹æ•°</li><li>-XX:MaxGCPauseMillis=200ï¼š æŒ‡å®šæœ€å¤§åœé¡¿æ—¶é—´ï¼Œé»˜è®¤200æ¯«ç§’</li><li>-XX:GCTimeRatio=99ï¼š ä»£è¡¨åƒåœ¾æ”¶é›†æ—¶é—´æ‰€å æ¯”ä¾‹ï¼Œè®¡ç®—å…¬å¼1/(1+99),</li><li>-XX:+UseAdaptiveSizePolicy: è¿™æ˜¯ä¸€ä¸ªå¼€å…³å‚æ•°ï¼Œå¼€å¯åï¼ŒJVMä¼šæ ¹æ®-XX:MaxGCPauseMillis=200å’Œ-XX:GCTimeRatio=99è¿™ä¸¤ä¸ªå‚æ•°åŠ¨æ€è°ƒæ•´-Xmxã€-Xmsã€-Xmnã€-XX:SurvivorRatioã€-XX:PretenureSizeThresholdç­‰å‚æ•°ï¼Œæ¥æœ€å¤§é™åº¦çš„æå‡ååé‡ã€‚</li></ul><h4 id="parallel-old-åƒåœ¾å›æ”¶å™¨" tabindex="-1"><a class="header-anchor" href="#parallel-old-åƒåœ¾å›æ”¶å™¨" aria-hidden="true">#</a> Parallel Old åƒåœ¾å›æ”¶å™¨</h4><p>é’ˆå¯¹å¹´<strong>è€ä»£è®¾è®¡çš„å¹¶è¡Œæœé›†å™¨</strong>ï¼Œé‡‡ç”¨<strong>æ ‡è®°/æ•´ç†</strong>ç®—æ³•ã€‚</p><p>å¯ä»¥å’Œserial ã€parallel scavenge æ­é…ä½¿ç”¨ã€‚åœ¨JDK8åŠä»¥å‰æ˜¯é»˜è®¤çš„åƒåœ¾æ”¶é›†å™¨ã€‚</p><p>æ‰§è¡Œæµç¨‹å’Œå¸¸ç”¨çš„å‚æ•°ä¸Parallel Scavengeç›¸åŒï¼Œè¿™é‡Œä¸åœ¨ä»‹ç»ã€‚</p><h4 id="cms-åƒåœ¾å›æ”¶å™¨" tabindex="-1"><a class="header-anchor" href="#cms-åƒåœ¾å›æ”¶å™¨" aria-hidden="true">#</a> CMS åƒåœ¾å›æ”¶å™¨</h4><p>CMSæ˜¯é’ˆå¯¹<strong>å¹´è€ä»£</strong>è®¾è®¡çš„æœé›†å™¨ï¼Œå¹¶é‡‡ç”¨<strong>æ ‡è®°/æ¸…é™¤</strong>ç®—æ³•ï¼Œå®ƒä¹Ÿæ˜¯<strong>å”¯ä¸€ä¸€ä¸ª</strong>åœ¨å¹´è€ä»£é‡‡ç”¨<strong>æ ‡è®°/æ¸…é™¤</strong>ç®—æ³•çš„æœé›†å™¨ã€‚</p><p>CMSåƒåœ¾æ”¶é›†å™¨ä¸»è¦åˆ†ä¸ºä»¥ä¸‹äº”ä¸ªé˜¶æ®µã€‚</p><p>â€‹ 1ã€<strong>åˆå§‹æ ‡è®°</strong>ï¼šåªæ ‡è®°å’ŒGCRootsç›´æ¥å…³è”çš„å¯¹è±¡ï¼Œä»¥åŠå¹´è½»ä»£æŒ‡å‘è€å¹´ä»£çš„å¯¹è±¡(éœ€è¦Stop The World)</p><p>â€‹ 2ã€<strong>å¹¶å‘æ ‡è®°</strong>ï¼šå’Œç”¨æˆ·çº¿ç¨‹å¹¶è¡Œæ‰§è¡Œï¼Œæ ¹æ®åˆè¯•æ ‡è®°ç»“æœåšå¯è¾¾æ€§åˆ†æã€‚ï¼ˆä¸‰è‰²æ ‡è®°ï¼‰</p><p>â€‹ 3ã€<strong>é‡æ–°æ ‡è®°</strong>ï¼šéœ€è¦æš‚åœåº”ç”¨ç¨‹åºï¼Œå¤„ç†å¹¶å‘æ ‡è®°ä¸­é”™æ ‡æˆ–æ¼æ ‡çš„å¯¹è±¡ã€‚(ä¸‰è‰²æ ‡è®°å­˜åœ¨çš„é—®é¢˜)</p><p>â€‹ 4ã€<strong>å¹¶å‘æ¸…é™¤</strong>ï¼šå¹¶å‘æ¸…é™¤åƒåœ¾å¯¹è±¡</p><p>â€‹ 5ã€<strong>å¹¶å‘é‡ç½®</strong>ï¼šé‡ç½®æœ¬æ¬¡GCè¿‡ç¨‹ä¸­çš„æ ‡è®°æ•°æ®ã€‚</p><p>CMSä¸»è¦å…³æ³¨ç‚¹åœ¨ç”¨æˆ·ä½“éªŒï¼Œä»–çš„ç»ˆæç›®æ ‡æ˜¯å°½é‡å‡å°‘æ€»ä½“çš„STWçš„æ—¶é—´</p><p>æ‰§è¡Œæµç¨‹ï¼š</p><p><img src="/assets/ea233bd806054640a98cedbe051cde5f-2-a5279663.png" alt="img"></p><p>å¸¸ç”¨å‚æ•°ï¼š</p><ul><li>-XX:+UseConcMarkSweepGCï¼š ä½¿ç”¨ParNew + CMSçš„ç»„åˆ</li><li>-XX:CMSInitiatingOccupancyFraction=92</li><li>-XX:ParallelGCThread=3 åƒåœ¾æ”¶é›†çº¿ç¨‹æ•°</li><li>-XX:SurvivorRatioï¼š è°ƒæ•´æ–°ç”Ÿä»£ä¸­çš„edenæ¯”ä¾‹ï¼Œé»˜è®¤-XX:SurvivorRatio=8</li><li>-XX:MaxTenuringThreshold=15ï¼š æ™‹å‡åˆ°è€å¹´ä»£çš„é˜ˆå€¼ï¼ŒParallelé»˜è®¤15ï¼ŒCMSé»˜è®¤6ï¼ŒG1é»˜è®¤15</li></ul><p>ä¼˜ç‚¹ï¼š</p><ul><li>å¹¶å‘æ”¶é›†ï¼Œä½åœé¡¿</li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li>å¯¹CPUèµ„æºæ•æ„Ÿï¼Œç”¨æˆ·çº¿ç¨‹å’Œåƒåœ¾æ”¶é›†çº¿ç¨‹ä¼šäº‰æŠ¢èµ„æºï¼Œä¼šå¯¹åƒåœ¾æ”¶é›†çš„ååé‡é€ æˆå½±å“ã€‚</li><li>æ ‡è®°æ¸…é™¤ä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡ <ul><li>-XX:+UseCMSCompactAtFullCollectionï¼šå¼€å¯åœ¨å…¨å±€Full GCåæ‰§è¡Œç¢ç‰‡æ•´ç†å·¥ä½œ</li><li>-XX:CMSFullGCsBeforeCompactionï¼šæ§åˆ¶åœ¨å‡ æ¬¡Full GCåè¿›è¡Œä¸€æ¬¡ç¢ç‰‡æ•´ç†ã€‚ï¼ˆæ¯æ¬¡éƒ½æ•´ç†å¼€é”€å¤§ï¼‰</li></ul></li><li>æ— æ³•å¤„ç†æµ®åŠ¨åƒåœ¾ï¼šåˆå§‹æ ‡è®°åï¼Œå †å†…å­˜ä¸­ä¼šäº§ç”Ÿä¸€äº›æ–°çš„GCRootsï¼Œåœ¨å¹¶å‘æ ‡è®°çš„è¿‡ç¨‹ä¸­ï¼Œä¹Ÿä¼šå­˜åœ¨ä¸€äº›æ ‡è®°ä¸ºæ´»åŠ¨çš„å¯¹è±¡å˜ä¸ºåƒåœ¾å¯¹è±¡çš„æƒ…å†µã€‚è¿™äº›åƒåœ¾å¯¹è±¡åœ¨æœ¬æ¬¡åƒåœ¾æ‰«æä¸­æ˜¯æ— æ³•è¢«å›æ”¶çš„ã€‚</li><li>å¹¶å‘å¤±è´¥æ¨¡å¼ï¼Œæ„æ€å°±æ˜¯å†…å­˜å›æ”¶çš„é€Ÿåº¦è¿½ä¸ä¸Šå†…å­˜åˆ†é…çš„é€Ÿåº¦ï¼Œå¯¼è‡´æ²¡æœ‰å†…å­˜å¯ä»¥åˆ†é…ï¼Œè¿™æ—¶å€™å°±ä¼šæš‚åœç”¨æˆ·çº¿ç¨‹ï¼Œå…¨åŠ›æ¸…ç†åƒåœ¾ï¼ŒçŸ¥é“å›æ”¶å®Œæˆæ‰æ¢å¤ç”¨æˆ·çº¿ç¨‹ <ul><li>è¿™é‡Œçš„æ— å†…å­˜åˆ†é…ï¼Œå¯èƒ½æ˜¯æµ®åŠ¨åƒåœ¾é€ æˆçš„ã€‚ä¹Ÿå¯èƒ½æ˜¯å†…å­˜ç¢ç‰‡é—®é¢˜ã€‚</li><li>-XX:CMSInitiatingOccupancyFraction=90 æ§åˆ¶è€å¹´ä»£çš„å†…å­˜å ç”¨æ¯”ä¾‹åˆ°è¾¾å¤šå°‘æ—¶ï¼Œå¼€å¯è€å¹´ä»£çš„åƒåœ¾å›æ”¶</li></ul></li></ul><h4 id="garbage-firståƒåœ¾å›æ”¶å™¨" tabindex="-1"><a class="header-anchor" href="#garbage-firståƒåœ¾å›æ”¶å™¨" aria-hidden="true">#</a> Garbage Firståƒåœ¾å›æ”¶å™¨</h4><p>TODO https://blog.csdn.net/u011381576/article/details/79889804</p><p><a href="https://blog.csdn.net/m0_46897923/article/details/114087384" target="_blank" rel="noopener noreferrer">(44æ¡æ¶ˆæ¯) è™šæ‹Ÿæœºä¸­çš„ç»å…¸åƒåœ¾æ”¶é›†å™¨åŠå¸¸ç”¨å‚æ•°è§£æï¼ˆSerialã€ParNewã€Parallel Scavengeã€Serial Oldã€Parallel Oldã€CMSã€G1ï¼‰_StudentProçš„åšå®¢-CSDNåšå®¢<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>G1(Garbage First)åƒåœ¾æ”¶é›†å™¨æ˜¯å½“ä»Šåƒåœ¾å›æ”¶æŠ€æœ¯æœ€å‰æ²¿çš„æˆæœä¹‹ä¸€ã€‚æ—©åœ¨JDK7å°±å·²åŠ å…¥JVMçš„æ”¶é›†å™¨å¤§å®¶åº­ä¸­ï¼Œæˆä¸ºHotSpoté‡ç‚¹å‘å±•çš„åƒåœ¾å›æ”¶æŠ€æœ¯ã€‚åŒä¼˜ç§€çš„CMSåƒåœ¾å›æ”¶å™¨ä¸€æ ·ï¼ŒG1ä¹Ÿæ˜¯å…³æ³¨æœ€å°æ—¶å»¶çš„åƒåœ¾å›æ”¶å™¨ï¼Œä¹ŸåŒæ ·é€‚åˆå¤§å°ºå¯¸å †å†…å­˜çš„åƒåœ¾æ”¶é›†ï¼Œå®˜æ–¹ä¹Ÿæ¨èä½¿ç”¨G1æ¥ä»£æ›¿é€‰æ‹©CMSã€‚G1æœ€å¤§çš„ç‰¹ç‚¹æ˜¯å¼•å…¥åˆ†åŒºçš„æ€è·¯ï¼Œå¼±åŒ–äº†åˆ†ä»£çš„æ¦‚å¿µï¼Œåˆç†åˆ©ç”¨åƒåœ¾æ”¶é›†å„ä¸ªå‘¨æœŸçš„èµ„æºï¼Œè§£å†³äº†å…¶ä»–æ”¶é›†å™¨ç”šè‡³CMSçš„ä¼—å¤šç¼ºé™·ã€‚</p><p>ä¹‹å‰ä»‹ç»çš„å‡ ç»„åƒåœ¾æ”¶é›†å™¨ç»„åˆï¼Œéƒ½æœ‰å‡ ä¸ªå…±åŒç‚¹ï¼š</p><ol><li>å¹´è½»ä»£ã€è€å¹´ä»£æ˜¯ç‹¬ç«‹ä¸”è¿ç»­çš„å†…å­˜å—ï¼›</li><li>å¹´è½»ä»£æ”¶é›†ä½¿ç”¨å•edenã€åŒsurvivorè¿›è¡Œå¤åˆ¶ç®—æ³•ï¼›</li><li>è€å¹´ä»£æ”¶é›†å¿…é¡»æ‰«ææ•´ä¸ªè€å¹´ä»£åŒºåŸŸï¼›</li><li>éƒ½æ˜¯ä»¥å°½å¯èƒ½å°‘è€Œå—åœ°æ‰§è¡ŒGCä¸ºè®¾è®¡åŸåˆ™ã€‚</li></ol><p>G1åƒåœ¾æ”¶é›†å™¨ä¹Ÿæ˜¯ä»¥å…³æ³¨å»¶è¿Ÿä¸ºç›®æ ‡ã€æœåŠ¡å™¨ç«¯åº”ç”¨çš„åƒåœ¾æ”¶é›†å™¨ï¼Œè¢«HotSpotå›¢é˜Ÿå¯„äºˆå–ä»£CMSçš„ä½¿å‘½ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªéå¸¸å…·æœ‰è°ƒä¼˜æ½œåŠ›çš„åƒåœ¾æ”¶é›†å™¨ã€‚è™½ç„¶G1ä¹Ÿæœ‰ç±»ä¼¼CMSçš„æ”¶é›†åŠ¨ä½œï¼šåˆå§‹æ ‡è®°ã€å¹¶å‘æ ‡è®°ã€é‡æ–°æ ‡è®°ã€æ¸…é™¤ã€è½¬ç§»å›æ”¶ï¼Œå¹¶ä¸”ä¹Ÿä»¥ä¸€ä¸ªä¸²è¡Œæ”¶é›†å™¨åšæ‹…ä¿æœºåˆ¶ï¼Œä½†å•çº¯åœ°ä»¥ç±»ä¼¼å‰ä¸‰ç§çš„è¿‡ç¨‹æè¿°æ˜¾å¾—å¹¶ä¸æ˜¯å¾ˆå¦¥å½“ã€‚äº‹å®ä¸Šï¼ŒG1æ”¶é›†ä¸ä»¥ä¸Šä¸‰ç»„æ”¶é›†å™¨æœ‰å¾ˆå¤§ä¸åŒï¼š</p><ol><li>G1çš„è®¾è®¡åŸåˆ™æ˜¯â€é¦–å…ˆæ”¶é›†å°½å¯èƒ½å¤šçš„åƒåœ¾(Garbage First)â€œã€‚å› æ­¤ï¼ŒG1å¹¶ä¸ä¼šç­‰å†…å­˜è€—å°½(ä¸²è¡Œã€å¹¶è¡Œ)æˆ–è€…å¿«è€—å°½(CMS)çš„æ—¶å€™å¼€å§‹åƒåœ¾æ”¶é›†ï¼Œè€Œæ˜¯åœ¨å†…éƒ¨é‡‡ç”¨äº†å¯å‘å¼ç®—æ³•ï¼Œåœ¨è€å¹´ä»£æ‰¾å‡ºå…·æœ‰é«˜æ”¶é›†æ”¶ç›Šçš„åˆ†åŒºè¿›è¡Œæ”¶é›†ã€‚åŒæ—¶G1å¯ä»¥æ ¹æ®ç”¨æˆ·è®¾ç½®çš„æš‚åœæ—¶é—´ç›®æ ‡è‡ªåŠ¨è°ƒæ•´å¹´è½»ä»£å’Œæ€»å †å¤§å°ï¼Œæš‚åœç›®æ ‡è¶ŠçŸ­å¹´è½»ä»£ç©ºé—´è¶Šå°ã€æ€»ç©ºé—´å°±è¶Šå¤§ï¼›</li><li>G1é‡‡ç”¨å†…å­˜åˆ†åŒº(Region)çš„æ€è·¯ï¼Œå°†å†…å­˜åˆ’åˆ†ä¸ºä¸€ä¸ªä¸ªç›¸ç­‰å¤§å°çš„å†…å­˜åˆ†åŒºï¼Œå›æ”¶æ—¶åˆ™ä»¥åˆ†åŒºä¸ºå•ä½è¿›è¡Œå›æ”¶ï¼Œå­˜æ´»çš„å¯¹è±¡å¤åˆ¶åˆ°å¦ä¸€ä¸ªç©ºé—²åˆ†åŒºä¸­ã€‚ç”±äºéƒ½æ˜¯ä»¥ç›¸ç­‰å¤§å°çš„åˆ†åŒºä¸ºå•ä½è¿›è¡Œæ“ä½œï¼Œå› æ­¤G1å¤©ç„¶å°±æ˜¯ä¸€ç§å‹ç¼©æ–¹æ¡ˆ(å±€éƒ¨å‹ç¼©)ï¼›</li><li>G1è™½ç„¶ä¹Ÿæ˜¯åˆ†ä»£æ”¶é›†å™¨ï¼Œä½†æ•´ä¸ªå†…å­˜åˆ†åŒºä¸å­˜åœ¨ç‰©ç†ä¸Šçš„å¹´è½»ä»£ä¸è€å¹´ä»£çš„åŒºåˆ«ï¼Œä¹Ÿä¸éœ€è¦å®Œå…¨ç‹¬ç«‹çš„survivor(to space)å †åšå¤åˆ¶å‡†å¤‡ã€‚G1åªæœ‰é€»è¾‘ä¸Šçš„åˆ†ä»£æ¦‚å¿µï¼Œæˆ–è€…è¯´æ¯ä¸ªåˆ†åŒºéƒ½å¯èƒ½éšG1çš„è¿è¡Œåœ¨ä¸åŒä»£ä¹‹é—´å‰ååˆ‡æ¢ï¼›</li><li>G1çš„æ”¶é›†éƒ½æ˜¯STWçš„ï¼Œä½†å¹´è½»ä»£å’Œè€å¹´ä»£çš„æ”¶é›†ç•Œé™æ¯”è¾ƒæ¨¡ç³Šï¼Œé‡‡ç”¨äº†æ··åˆ(mixed)æ”¶é›†çš„æ–¹å¼ã€‚å³æ¯æ¬¡æ”¶é›†æ—¢å¯èƒ½åªæ”¶é›†å¹´è½»ä»£åˆ†åŒº(å¹´è½»ä»£æ”¶é›†)ï¼Œä¹Ÿå¯èƒ½åœ¨æ”¶é›†å¹´è½»ä»£çš„åŒæ—¶ï¼ŒåŒ…å«éƒ¨åˆ†è€å¹´ä»£åˆ†åŒº(æ··åˆæ”¶é›†)ï¼Œè¿™æ ·å³ä½¿å †å†…å­˜å¾ˆå¤§æ—¶ï¼Œä¹Ÿå¯ä»¥é™åˆ¶æ”¶é›†èŒƒå›´ï¼Œä»è€Œé™ä½åœé¡¿ã€‚</li></ol><h5 id="g1çš„å†…å­˜æ¨¡å‹" tabindex="-1"><a class="header-anchor" href="#g1çš„å†…å­˜æ¨¡å‹" aria-hidden="true">#</a> G1çš„å†…å­˜æ¨¡å‹</h5><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><img src="/assets/40093686972_25da5b859f_z-2be9490b.jpg" alt="G1åˆ†åŒºç¤ºæ„å›¾" style="zoom:100%;"><p><strong>åˆ†åŒº Region</strong></p><p>G1é‡‡ç”¨äº†åˆ†åŒº(Region)çš„æ€è·¯ï¼Œå°†æ•´ä¸ªå †ç©ºé—´åˆ†æˆè‹¥å¹²ä¸ªå¤§å°ç›¸ç­‰çš„å†…å­˜åŒºåŸŸï¼Œæ¯æ¬¡åˆ†é…å¯¹è±¡ç©ºé—´å°†é€æ®µåœ°ä½¿ç”¨å†…å­˜ã€‚å› æ­¤ï¼Œåœ¨å †çš„ä½¿ç”¨ä¸Šï¼ŒG1å¹¶ä¸è¦æ±‚å¯¹è±¡çš„å­˜å‚¨ä¸€å®šæ˜¯ç‰©ç†ä¸Šè¿ç»­çš„ï¼Œåªè¦é€»è¾‘ä¸Šè¿ç»­å³å¯ï¼›æ¯ä¸ªåˆ†åŒºä¹Ÿä¸ä¼šç¡®å®šåœ°ä¸ºæŸä¸ªä»£æœåŠ¡ï¼Œå¯ä»¥æŒ‰éœ€åœ¨å¹´è½»ä»£å’Œè€å¹´ä»£ä¹‹é—´åˆ‡æ¢ã€‚å¯åŠ¨æ—¶å¯ä»¥é€šè¿‡å‚æ•°<code>-XX:G1HeapRegionSize=n</code>å¯æŒ‡å®šåˆ†åŒºå¤§å°(1MB~32MBï¼Œä¸”å¿…é¡»æ˜¯2çš„å¹‚)ï¼Œé»˜è®¤å°†æ•´å †åˆ’åˆ†ä¸º2048ä¸ªåˆ†åŒºã€‚</p><p><strong>å¡ç‰‡ Card</strong></p><p>åœ¨æ¯ä¸ªåˆ†åŒºå†…éƒ¨åˆè¢«åˆ†æˆäº†è‹¥å¹²ä¸ªå¤§å°ä¸º512 Byteå¡ç‰‡(Card)ï¼Œæ ‡è¯†å †å†…å­˜æœ€å°å¯ç”¨ç²’åº¦æ‰€æœ‰åˆ†åŒºçš„å¡ç‰‡å°†ä¼šè®°å½•åœ¨å…¨å±€å¡ç‰‡è¡¨(Global Card Table)ä¸­ï¼Œåˆ†é…çš„å¯¹è±¡ä¼šå ç”¨ç‰©ç†ä¸Šè¿ç»­çš„è‹¥å¹²ä¸ªå¡ç‰‡ï¼Œå½“æŸ¥æ‰¾å¯¹åˆ†åŒºå†…å¯¹è±¡çš„å¼•ç”¨æ—¶ä¾¿å¯é€šè¿‡è®°å½•å¡ç‰‡æ¥æŸ¥æ‰¾è¯¥å¼•ç”¨å¯¹è±¡(è§RSet)ã€‚æ¯æ¬¡å¯¹å†…å­˜çš„å›æ”¶ï¼Œéƒ½æ˜¯å¯¹æŒ‡å®šåˆ†åŒºçš„å¡ç‰‡è¿›è¡Œå¤„ç†ã€‚</p><p><strong>å † Heap</strong></p><p>G1åŒæ ·å¯ä»¥é€šè¿‡<code>-Xms</code>/<code>-Xmx</code>æ¥æŒ‡å®šå †ç©ºé—´å¤§å°ã€‚å½“å‘ç”Ÿå¹´è½»ä»£æ”¶é›†æˆ–æ··åˆæ”¶é›†æ—¶ï¼Œé€šè¿‡è®¡ç®—GCä¸åº”ç”¨çš„è€—è´¹æ—¶é—´æ¯”ï¼Œè‡ªåŠ¨è°ƒæ•´å †ç©ºé—´å¤§å°ã€‚å¦‚æœGCé¢‘ç‡å¤ªé«˜ï¼Œåˆ™é€šè¿‡å¢åŠ å †å°ºå¯¸ï¼Œæ¥å‡å°‘GCé¢‘ç‡ï¼Œç›¸åº”åœ°GCå ç”¨çš„æ—¶é—´ä¹Ÿéšä¹‹é™ä½ï¼›ç›®æ ‡å‚æ•°<code>-XX:GCTimeRatio</code>å³ä¸ºGCä¸åº”ç”¨çš„è€—è´¹æ—¶é—´æ¯”ï¼ŒG1é»˜è®¤ä¸º9ï¼Œè€ŒCMSé»˜è®¤ä¸º99ï¼Œå› ä¸ºCMSçš„è®¾è®¡åŸåˆ™æ˜¯è€—è´¹åœ¨GCä¸Šçš„æ—¶é—´å°½å¯èƒ½çš„å°‘ã€‚å¦å¤–ï¼Œå½“ç©ºé—´ä¸è¶³ï¼Œå¦‚å¯¹è±¡ç©ºé—´åˆ†é…æˆ–è½¬ç§»å¤±è´¥æ—¶ï¼ŒG1ä¼šé¦–å…ˆå°è¯•å¢åŠ å †ç©ºé—´ï¼Œå¦‚æœæ‰©å®¹å¤±è´¥ï¼Œåˆ™å‘èµ·æ‹…ä¿çš„Full GCã€‚Full GCåï¼Œå †å°ºå¯¸è®¡ç®—ç»“æœä¹Ÿä¼šè°ƒæ•´å †ç©ºé—´ã€‚</p><h5 id="g1çš„åˆ†ä»£æ¨¡å‹" tabindex="-1"><a class="header-anchor" href="#g1çš„åˆ†ä»£æ¨¡å‹" aria-hidden="true">#</a> G1çš„åˆ†ä»£æ¨¡å‹</h5><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒG1ä¾ç„¶ä½¿ç”¨äº†åˆ†ä»£çš„æ€æƒ³ã€‚ä¸å…¶ä»–åƒåœ¾æ”¶é›†å™¨ç±»ä¼¼ï¼ŒG1å°†å†…å­˜åœ¨é€»è¾‘ä¸Šåˆ’åˆ†ä¸ºå¹´è½»ä»£å’Œè€å¹´ä»£ï¼Œå…¶ä¸­å¹´è½»ä»£åˆåˆ’åˆ†ä¸ºEdenç©ºé—´å’ŒSurvivorç©ºé—´ã€‚ä½†å¹´è½»ä»£ç©ºé—´å¹¶ä¸æ˜¯å›ºå®šä¸å˜çš„ï¼Œå½“ç°æœ‰å¹´è½»ä»£åˆ†åŒºå æ»¡æ—¶ï¼ŒJVMä¼šåˆ†é…æ–°çš„ç©ºé—²åˆ†åŒºåŠ å…¥åˆ°å¹´è½»ä»£ç©ºé—´ã€‚</p><p>æ•´ä¸ªå¹´è½»ä»£å†…å­˜ä¼šåœ¨åˆå§‹ç©ºé—´<code>-XX:G1NewSizePercent</code>(é»˜è®¤æ•´å †5%)ä¸æœ€å¤§ç©ºé—´<code>-XX:G1MaxNewSizePercent</code>(é»˜è®¤60%)ä¹‹é—´åŠ¨æ€å˜åŒ–ï¼Œä¸”ç”±å‚æ•°ç›®æ ‡æš‚åœæ—¶é—´<code>-XX:MaxGCPauseMillis</code>(é»˜è®¤200ms)ã€éœ€è¦æ‰©ç¼©å®¹çš„å¤§å°ä»¥åŠåˆ†åŒºçš„å·²è®°å¿†é›†åˆ(RSet)è®¡ç®—å¾—åˆ°ã€‚å½“ç„¶ï¼ŒG1ä¾ç„¶å¯ä»¥è®¾ç½®å›ºå®šçš„å¹´è½»ä»£å¤§å°(å‚æ•°<code>-XX:NewRatio</code>ã€<code>-Xmn</code>)ï¼Œä½†åŒæ—¶æš‚åœç›®æ ‡å°†å¤±å»æ„ä¹‰ã€‚</p><img src="/assets/image-20220512164944416-56a6c1d5.png" alt="image-20220512164944416" style="zoom:80%;"><h5 id="g1çš„åˆ†åŒºæ¨¡å‹" tabindex="-1"><a class="header-anchor" href="#g1çš„åˆ†åŒºæ¨¡å‹" aria-hidden="true">#</a> G1çš„åˆ†åŒºæ¨¡å‹</h5><p>G1å¯¹å†…å­˜çš„ä½¿ç”¨ä»¥åˆ†åŒº(Region)ä¸ºå•ä½ï¼Œè€Œå¯¹å¯¹è±¡çš„åˆ†é…åˆ™ä»¥å¡ç‰‡(Card)ä¸ºå•ä½ã€‚</p><img src="/assets/40093686872_ce639c1121_z-88114224.jpg" alt="G1çš„åˆ†åŒºæ¨¡å‹" style="zoom:100%;"><p><strong>å·¨å‹å¯¹è±¡ Humongous Region</strong></p><p>ä¸€ä¸ªå¤§å°è¾¾åˆ°ç”šè‡³è¶…è¿‡åˆ†åŒºå¤§å°ä¸€åŠçš„å¯¹è±¡ç§°ä¸ºå·¨å‹å¯¹è±¡(Humongous Object)ã€‚å½“çº¿ç¨‹ä¸ºå·¨å‹åˆ†é…ç©ºé—´æ—¶ï¼Œä¸èƒ½ç®€å•åœ¨TLABè¿›è¡Œåˆ†é…ï¼Œå› ä¸ºå·¨å‹å¯¹è±¡çš„ç§»åŠ¨æˆæœ¬å¾ˆé«˜ï¼Œè€Œä¸”æœ‰å¯èƒ½ä¸€ä¸ªåˆ†åŒºä¸èƒ½å®¹çº³å·¨å‹å¯¹è±¡ã€‚å› æ­¤ï¼Œå·¨å‹å¯¹è±¡ä¼šç›´æ¥åœ¨è€å¹´ä»£åˆ†é…ï¼Œæ‰€å ç”¨çš„è¿ç»­ç©ºé—´ç§°ä¸ºå·¨å‹åˆ†åŒº(Humongous Region)ã€‚G1å†…éƒ¨åšäº†ä¸€ä¸ªä¼˜åŒ–ï¼Œä¸€æ—¦å‘ç°æ²¡æœ‰å¼•ç”¨æŒ‡å‘å·¨å‹å¯¹è±¡ï¼Œåˆ™å¯ç›´æ¥åœ¨å¹´è½»ä»£æ”¶é›†å‘¨æœŸä¸­è¢«å›æ”¶ã€‚</p><p>å·¨å‹å¯¹è±¡ä¼šç‹¬å ä¸€ä¸ªã€æˆ–å¤šä¸ªè¿ç»­åˆ†åŒºï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªåˆ†åŒºè¢«æ ‡è®°ä¸ºå¼€å§‹å·¨å‹(StartsHumongous)ï¼Œç›¸é‚»è¿ç»­åˆ†åŒºè¢«æ ‡è®°ä¸ºè¿ç»­å·¨å‹(ContinuesHumongous)ã€‚ç”±äºæ— æ³•äº«å—Labå¸¦æ¥çš„ä¼˜åŒ–ï¼Œå¹¶ä¸”ç¡®å®šä¸€ç‰‡è¿ç»­çš„å†…å­˜ç©ºé—´éœ€è¦æ‰«ææ•´å †ï¼Œå› æ­¤ç¡®å®šå·¨å‹å¯¹è±¡å¼€å§‹ä½ç½®çš„æˆæœ¬éå¸¸é«˜ï¼Œå¦‚æœå¯ä»¥ï¼Œåº”ç”¨ç¨‹åºåº”é¿å…ç”Ÿæˆå·¨å‹å¯¹è±¡ã€‚</p><p><strong>è®°å¿†é›†åˆ Remember Set (RSet)</strong></p><p>åœ¨ä¸²è¡Œå’Œå¹¶è¡Œæ”¶é›†å™¨ä¸­ï¼ŒGCé€šè¿‡æ•´å †æ‰«æï¼Œæ¥ç¡®å®šå¯¹è±¡æ˜¯å¦å¤„äºå¯è¾¾è·¯å¾„ä¸­ã€‚ç„¶è€ŒG1ä¸ºäº†é¿å…STWå¼çš„æ•´å †æ‰«æï¼Œåœ¨æ¯ä¸ªåˆ†åŒºè®°å½•äº†ä¸€ä¸ªå·²è®°å¿†é›†åˆ(RSet)ï¼Œå†…éƒ¨ç±»ä¼¼ä¸€ä¸ªåå‘æŒ‡é’ˆï¼Œè®°å½•å¼•ç”¨åˆ†åŒºå†…å¯¹è±¡çš„å¡ç‰‡ç´¢å¼•ã€‚å½“è¦å›æ”¶è¯¥åˆ†åŒºæ—¶ï¼Œé€šè¿‡æ‰«æåˆ†åŒºçš„RSetï¼Œæ¥ç¡®å®šå¼•ç”¨æœ¬åˆ†åŒºå†…çš„å¯¹è±¡æ˜¯å¦å­˜æ´»ï¼Œè¿›è€Œç¡®å®šæœ¬åˆ†åŒºå†…çš„å¯¹è±¡å­˜æ´»æƒ…å†µã€‚</p><p>äº‹å®ä¸Šï¼Œå¹¶éæ‰€æœ‰çš„å¼•ç”¨éƒ½éœ€è¦è®°å½•åœ¨RSetä¸­ï¼Œå¦‚æœä¸€ä¸ªåˆ†åŒºç¡®å®šéœ€è¦æ‰«æï¼Œé‚£ä¹ˆæ— éœ€RSetä¹Ÿå¯ä»¥æ— é—æ¼çš„å¾—åˆ°å¼•ç”¨å…³ç³»ã€‚é‚£ä¹ˆå¼•ç”¨æºè‡ªæœ¬åˆ†åŒºçš„å¯¹è±¡ï¼Œå½“ç„¶ä¸ç”¨è½å…¥RSetä¸­ï¼›åŒæ—¶ï¼ŒG1 GCæ¯æ¬¡éƒ½ä¼šå¯¹å¹´è½»ä»£è¿›è¡Œæ•´ä½“æ”¶é›†ï¼Œå› æ­¤å¼•ç”¨æºè‡ªå¹´è½»ä»£çš„å¯¹è±¡ï¼Œä¹Ÿä¸éœ€è¦åœ¨RSetä¸­è®°å½•ã€‚æœ€ååªæœ‰è€å¹´ä»£çš„åˆ†åŒºå¯èƒ½ä¼šæœ‰RSetè®°å½•ï¼Œè¿™äº›åˆ†åŒºç§°ä¸ºæ‹¥æœ‰RSetåˆ†åŒº(an RSetâ€™s owning region)ã€‚</p><p><strong>Per Region Table (PRT)</strong></p><p>RSetåœ¨å†…éƒ¨ä½¿ç”¨Per Region Table(PRT)è®°å½•åˆ†åŒºçš„å¼•ç”¨æƒ…å†µã€‚ç”±äºRSetçš„è®°å½•è¦å ç”¨åˆ†åŒºçš„ç©ºé—´ï¼Œå¦‚æœä¸€ä¸ªåˆ†åŒºéå¸¸â€å—æ¬¢è¿â€ï¼Œé‚£ä¹ˆRSetå ç”¨çš„ç©ºé—´ä¼šä¸Šå‡ï¼Œä»è€Œé™ä½åˆ†åŒºçš„å¯ç”¨ç©ºé—´ã€‚G1åº”å¯¹è¿™ä¸ªé—®é¢˜é‡‡ç”¨äº†æ”¹å˜RSetçš„å¯†åº¦çš„æ–¹å¼ï¼Œåœ¨PRTä¸­å°†ä¼šä»¥ä¸‰ç§æ¨¡å¼è®°å½•å¼•ç”¨ï¼š</p><ul><li>ç¨€å°‘ï¼šç›´æ¥è®°å½•å¼•ç”¨å¯¹è±¡çš„å¡ç‰‡ç´¢å¼•</li><li>ç»†ç²’åº¦ï¼šè®°å½•å¼•ç”¨å¯¹è±¡çš„åˆ†åŒºç´¢å¼•</li><li>ç²—ç²’åº¦ï¼šåªè®°å½•å¼•ç”¨æƒ…å†µï¼Œæ¯ä¸ªåˆ†åŒºå¯¹åº”ä¸€ä¸ªæ¯”ç‰¹ä½</li></ul><p>ç”±ä¸Šå¯çŸ¥ï¼Œç²—ç²’åº¦çš„PRTåªæ˜¯è®°å½•äº†å¼•ç”¨æ•°é‡ï¼Œéœ€è¦é€šè¿‡æ•´å †æ‰«ææ‰èƒ½æ‰¾å‡ºæ‰€æœ‰å¼•ç”¨ï¼Œå› æ­¤æ‰«æé€Ÿåº¦ä¹Ÿæ˜¯æœ€æ…¢çš„ã€‚</p><p><strong>æ”¶é›†é›†åˆ (Collect Setï¼ŒCSet)</strong></p><p>æ”¶é›†é›†åˆ(CSet)ä»£è¡¨æ¯æ¬¡GCæš‚åœæ—¶å›æ”¶çš„ä¸€ç³»åˆ—ç›®æ ‡åˆ†åŒºã€‚åœ¨ä»»æ„ä¸€æ¬¡æ”¶é›†æš‚åœä¸­ï¼ŒCSetæ‰€æœ‰åˆ†åŒºéƒ½ä¼šè¢«é‡Šæ”¾ï¼Œå†…éƒ¨å­˜æ´»çš„å¯¹è±¡éƒ½ä¼šè¢«è½¬ç§»åˆ°åˆ†é…çš„ç©ºé—²åˆ†åŒºä¸­ã€‚å› æ­¤æ— è®ºæ˜¯å¹´è½»ä»£æ”¶é›†ï¼Œè¿˜æ˜¯æ··åˆæ”¶é›†ï¼Œå·¥ä½œçš„æœºåˆ¶éƒ½æ˜¯ä¸€è‡´çš„ã€‚å¹´è½»ä»£æ”¶é›†CSetåªå®¹çº³å¹´è½»ä»£åˆ†åŒºï¼Œè€Œæ··åˆæ”¶é›†ä¼šé€šè¿‡å¯å‘å¼ç®—æ³•ï¼Œåœ¨è€å¹´ä»£å€™é€‰å›æ”¶åˆ†åŒºä¸­ï¼Œç­›é€‰å‡ºå›æ”¶æ”¶ç›Šæœ€é«˜çš„åˆ†åŒºæ·»åŠ åˆ°CSetä¸­ã€‚</p><p>å€™é€‰è€å¹´ä»£åˆ†åŒºçš„CSetå‡†å…¥æ¡ä»¶ï¼Œå¯ä»¥é€šè¿‡æ´»è·ƒåº¦é˜ˆå€¼<code>-XX:G1MixedGCLiveThresholdPercent</code>(é»˜è®¤85%)è¿›è¡Œè®¾ç½®ï¼Œä»è€Œæ‹¦æˆªé‚£äº›å›æ”¶å¼€é”€å·¨å¤§çš„å¯¹è±¡ï¼›åŒæ—¶ï¼Œæ¯æ¬¡æ··åˆæ”¶é›†å¯ä»¥åŒ…å«å€™é€‰è€å¹´ä»£åˆ†åŒºï¼Œå¯æ ¹æ®CSetå¯¹å †çš„æ€»å¤§å°å æ¯”<code>-XX:G1OldCSetRegionThresholdPercent</code>(é»˜è®¤10%)è®¾ç½®æ•°é‡ä¸Šé™ã€‚</p><p>ç”±ä¸Šè¿°å¯çŸ¥ï¼ŒG1çš„æ”¶é›†éƒ½æ˜¯æ ¹æ®CSetè¿›è¡Œæ“ä½œçš„ï¼Œå¹´è½»ä»£æ”¶é›†ä¸æ··åˆæ”¶é›†æ²¡æœ‰æ˜æ˜¾çš„ä¸åŒï¼Œæœ€å¤§çš„åŒºåˆ«åœ¨äºä¸¤ç§æ”¶é›†çš„è§¦å‘æ¡ä»¶ã€‚</p><p><strong>å¹´è½»ä»£æ”¶é›†é›†åˆ CSet of Young Collection</strong></p><p>åº”ç”¨çº¿ç¨‹ä¸æ–­æ´»åŠ¨åï¼Œå¹´è½»ä»£ç©ºé—´ä¼šè¢«é€æ¸å¡«æ»¡ã€‚å½“JVMåˆ†é…å¯¹è±¡åˆ°EdenåŒºåŸŸå¤±è´¥(EdenåŒºå·²æ»¡)æ—¶ï¼Œä¾¿ä¼šè§¦å‘ä¸€æ¬¡STWå¼çš„å¹´è½»ä»£æ”¶é›†ã€‚åœ¨å¹´è½»ä»£æ”¶é›†ä¸­ï¼ŒEdenåˆ†åŒºå­˜æ´»çš„å¯¹è±¡å°†è¢«æ‹·è´åˆ°Survivoråˆ†åŒºï¼›åŸæœ‰Survivoråˆ†åŒºå­˜æ´»çš„å¯¹è±¡ï¼Œå°†æ ¹æ®ä»»æœŸé˜ˆå€¼(tenuring threshold)åˆ†åˆ«æ™‹å‡åˆ°PLABä¸­ï¼Œæ–°çš„survivoråˆ†åŒºå’Œè€å¹´ä»£åˆ†åŒºã€‚è€ŒåŸæœ‰çš„å¹´è½»ä»£åˆ†åŒºå°†è¢«æ•´ä½“å›æ”¶æ‰ã€‚</p><p>åŒæ—¶ï¼Œå¹´è½»ä»£æ”¶é›†è¿˜è´Ÿè´£ç»´æŠ¤å¯¹è±¡çš„å¹´é¾„(å­˜æ´»æ¬¡æ•°)ï¼Œè¾…åŠ©åˆ¤æ–­è€åŒ–(tenuring)å¯¹è±¡æ™‹å‡çš„æ—¶å€™æ˜¯åˆ°Survivoråˆ†åŒºè¿˜æ˜¯åˆ°è€å¹´ä»£åˆ†åŒºã€‚å¹´è½»ä»£æ”¶é›†é¦–å…ˆå…ˆå°†æ™‹å‡å¯¹è±¡å°ºå¯¸æ€»å’Œã€å¯¹è±¡å¹´é¾„ä¿¡æ¯ç»´æŠ¤åˆ°å¹´é¾„è¡¨ä¸­ï¼Œå†æ ¹æ®å¹´é¾„è¡¨ã€Survivorå°ºå¯¸ã€Survivorå¡«å……å®¹é‡-XX:TargetSurvivorRatio(é»˜è®¤50%)ã€æœ€å¤§ä»»æœŸé˜ˆå€¼-XX:MaxTenuringThreshold(é»˜è®¤15)ï¼Œè®¡ç®—å‡ºä¸€ä¸ªæ°å½“çš„ä»»æœŸé˜ˆå€¼ï¼Œå‡¡æ˜¯è¶…è¿‡ä»»æœŸé˜ˆå€¼çš„å¯¹è±¡éƒ½ä¼šè¢«æ™‹å‡åˆ°è€å¹´ä»£ã€‚</p><p><strong>æ··åˆæ”¶é›†é›†åˆ CSet of Mixed Collection</strong></p><p>å¹´è½»ä»£æ”¶é›†ä¸æ–­æ´»åŠ¨åï¼Œè€å¹´ä»£çš„ç©ºé—´ä¹Ÿä¼šè¢«é€æ¸å¡«å……ã€‚å½“è€å¹´ä»£å ç”¨ç©ºé—´è¶…è¿‡æ•´å †æ¯”IHOPé˜ˆå€¼-XX:InitiatingHeapOccupancyPercent(é»˜è®¤45%)æ—¶ï¼ŒG1å°±ä¼šå¯åŠ¨ä¸€æ¬¡æ··åˆåƒåœ¾æ”¶é›†å‘¨æœŸã€‚ä¸ºäº†æ»¡è¶³æš‚åœç›®æ ‡ï¼ŒG1å¯èƒ½ä¸èƒ½ä¸€å£æ°”å°†æ‰€æœ‰çš„å€™é€‰åˆ†åŒºæ”¶é›†æ‰ï¼Œå› æ­¤G1å¯èƒ½ä¼šäº§ç”Ÿè¿ç»­å¤šæ¬¡çš„æ··åˆæ”¶é›†ä¸åº”ç”¨çº¿ç¨‹äº¤æ›¿æ‰§è¡Œï¼Œæ¯æ¬¡STWçš„æ··åˆæ”¶é›†ä¸å¹´è½»ä»£æ”¶é›†è¿‡ç¨‹ç›¸ç±»ä¼¼ã€‚</p><p>ä¸ºäº†ç¡®å®šåŒ…å«åˆ°å¹´è½»ä»£æ”¶é›†é›†åˆCSetçš„è€å¹´ä»£åˆ†åŒºï¼ŒJVMé€šè¿‡å‚æ•°æ··åˆå‘¨æœŸçš„æœ€å¤§æ€»æ¬¡æ•°-XX:G1MixedGCCountTarget(é»˜è®¤8)ã€å †åºŸç‰©ç™¾åˆ†æ¯”-XX:G1HeapWastePercent(é»˜è®¤5%)ã€‚é€šè¿‡å€™é€‰è€å¹´ä»£åˆ†åŒºæ€»æ•°ä¸æ··åˆå‘¨æœŸæœ€å¤§æ€»æ¬¡æ•°ï¼Œç¡®å®šæ¯æ¬¡åŒ…å«åˆ°CSetçš„æœ€å°åˆ†åŒºæ•°é‡ï¼›æ ¹æ®å †åºŸç‰©ç™¾åˆ†æ¯”ï¼Œå½“æ”¶é›†è¾¾åˆ°å‚æ•°æ—¶ï¼Œä¸å†å¯åŠ¨æ–°çš„æ··åˆæ”¶é›†ã€‚è€Œæ¯æ¬¡æ·»åŠ åˆ°CSetçš„åˆ†åŒºï¼Œåˆ™é€šè¿‡è®¡ç®—å¾—åˆ°çš„GCæ•ˆç‡è¿›è¡Œå®‰æ’ã€‚</p><h5 id="g1çš„æ”¶é›†å‘¨æœŸ" tabindex="-1"><a class="header-anchor" href="#g1çš„æ”¶é›†å‘¨æœŸ" aria-hidden="true">#</a> G1çš„æ”¶é›†å‘¨æœŸ</h5><p>å¹¶å‘æ ‡è®°å‘¨æœŸæ˜¯G1ä¸­éå¸¸é‡è¦çš„é˜¶æ®µï¼Œè¿™ä¸ªé˜¶æ®µå°†ä¼šä¸ºæ··åˆæ”¶é›†å‘¨æœŸè¯†åˆ«åƒåœ¾æœ€å¤šçš„è€å¹´ä»£åˆ†åŒºã€‚æ•´ä¸ªå‘¨æœŸå®Œæˆæ ¹æ ‡è®°ã€è¯†åˆ«æ‰€æœ‰(å¯èƒ½)å­˜æ´»å¯¹è±¡ï¼Œå¹¶è®¡ç®—æ¯ä¸ªåˆ†åŒºçš„æ´»è·ƒåº¦ï¼Œä»è€Œç¡®å®šGCæ•ˆç‡ç­‰çº§ã€‚</p><p>å½“è¾¾åˆ°IHOPé˜ˆå€¼-XX:InitiatingHeapOccupancyPercent(è€å¹´ä»£å æ•´å †æ¯”ï¼Œé»˜è®¤45%)æ—¶ï¼Œä¾¿ä¼šè§¦å‘å¹¶å‘æ ‡è®°å‘¨æœŸã€‚**æ•´ä¸ªå¹¶å‘æ ‡è®°å‘¨æœŸå°†ç”±åˆå§‹æ ‡è®°(Initial Mark)ã€æ ¹åˆ†åŒºæ‰«æ(Root Region Scanning)ã€å¹¶å‘æ ‡è®°(Concurrent Marking)ã€é‡æ–°æ ‡è®°(Remark)ã€æ¸…é™¤(Cleanup)å‡ ä¸ªé˜¶æ®µç»„æˆã€‚**å…¶ä¸­ï¼Œåˆå§‹æ ‡è®°(éšå¹´è½»ä»£æ”¶é›†ä¸€èµ·æ´»åŠ¨)ã€é‡æ–°æ ‡è®°ã€æ¸…é™¤æ˜¯STWçš„ï¼Œè€Œå¹¶å‘æ ‡è®°å¦‚æœæ¥ä¸åŠæ ‡è®°å­˜æ´»å¯¹è±¡ï¼Œåˆ™å¯èƒ½åœ¨å¹¶å‘æ ‡è®°è¿‡ç¨‹ä¸­ï¼ŒG1åˆè§¦å‘äº†å‡ æ¬¡å¹´è½»ä»£æ”¶é›†ã€‚</p><img src="/assets/563799-20180510163645191-1911681386-039ae7b0.png" alt="img" style="zoom:80%;"><p><strong>åˆå§‹æ ‡è®°ï¼ˆInitial Markï¼‰</strong></p><p>åˆå§‹æ ‡è®°(Initial Mark)è´Ÿè´£æ ‡è®°æ‰€æœ‰èƒ½è¢«ç›´æ¥å¯è¾¾çš„æ ¹å¯¹è±¡(åŸç”Ÿæ ˆå¯¹è±¡ã€å…¨å±€å¯¹è±¡ã€JNIå¯¹è±¡)ï¼Œæ ¹æ˜¯å¯¹è±¡å›¾çš„èµ·ç‚¹ï¼Œå› æ­¤åˆå§‹æ ‡è®°éœ€è¦å°†Mutatorçº¿ç¨‹(Javaåº”ç”¨çº¿ç¨‹)æš‚åœæ‰ï¼Œä¹Ÿå°±æ˜¯éœ€è¦ä¸€ä¸ªSTWçš„æ—¶é—´æ®µã€‚äº‹å®ä¸Šï¼Œå½“è¾¾åˆ°IHOPé˜ˆå€¼æ—¶ï¼ŒG1å¹¶ä¸ä¼šç«‹å³å‘èµ·å¹¶å‘æ ‡è®°å‘¨æœŸï¼Œè€Œæ˜¯ç­‰å¾…ä¸‹ä¸€æ¬¡å¹´è½»ä»£æ”¶é›†ï¼Œåˆ©ç”¨å¹´è½»ä»£æ”¶é›†çš„STWæ—¶é—´æ®µï¼Œå®Œæˆåˆå§‹æ ‡è®°ï¼Œè¿™ç§æ–¹å¼ç§°ä¸ºå€Ÿé“(Piggybacking)ã€‚</p><p><strong>æ ¹åˆ†åŒºæ‰«æï¼ˆRoot Region Scanningï¼‰</strong></p><p>åœ¨åˆå§‹æ ‡è®°æš‚åœç»“æŸåï¼Œå¹´è½»ä»£æ”¶é›†ä¹Ÿå®Œæˆçš„å¯¹è±¡å¤åˆ¶åˆ°Survivorçš„å·¥ä½œï¼Œåº”ç”¨çº¿ç¨‹å¼€å§‹æ´»è·ƒèµ·æ¥ã€‚æ­¤æ—¶ä¸ºäº†ä¿è¯æ ‡è®°ç®—æ³•çš„æ­£ç¡®æ€§ï¼Œæ‰€æœ‰æ–°å¤åˆ¶åˆ°Survivoråˆ†åŒºçš„å¯¹è±¡ï¼Œéƒ½éœ€è¦è¢«æ‰«æå¹¶æ ‡è®°æˆæ ¹ï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºæ ¹åˆ†åŒºæ‰«æ(Root Region Scanning)ï¼ŒåŒæ—¶æ‰«æçš„Suvivoråˆ†åŒºä¹Ÿè¢«ç§°ä¸ºæ ¹åˆ†åŒº(Root Region)ã€‚æ ¹åˆ†åŒºæ‰«æå¿…é¡»åœ¨ä¸‹ä¸€æ¬¡å¹´è½»ä»£åƒåœ¾æ”¶é›†å¯åŠ¨å‰å®Œæˆ(å¹¶å‘æ ‡è®°çš„è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ä¼šè¢«è‹¥å¹²æ¬¡å¹´è½»ä»£åƒåœ¾æ”¶é›†æ‰“æ–­)ï¼Œå› ä¸ºæ¯æ¬¡GCä¼šäº§ç”Ÿæ–°çš„å­˜æ´»å¯¹è±¡é›†åˆã€‚</p><p><strong>å¹¶å‘æ ‡è®°ï¼ˆConcurrent Markingï¼‰</strong></p><p>å¹¶å‘æ ‡è®° Concurrent Markingå’Œåº”ç”¨çº¿ç¨‹å¹¶å‘æ‰§è¡Œï¼Œå¹¶å‘æ ‡è®°çº¿ç¨‹åœ¨å¹¶å‘æ ‡è®°é˜¶æ®µå¯åŠ¨ï¼Œç”±å‚æ•°-XX:ConcGCThreads(é»˜è®¤GCçº¿ç¨‹æ•°çš„1/4ï¼Œå³-XX:ParallelGCThreads/4)æ§åˆ¶å¯åŠ¨æ•°é‡ï¼Œæ¯ä¸ªçº¿ç¨‹æ¯æ¬¡åªæ‰«æä¸€ä¸ªåˆ†åŒºï¼Œä»è€Œæ ‡è®°å‡ºå­˜æ´»å¯¹è±¡å›¾ã€‚åœ¨è¿™ä¸€é˜¶æ®µä¼šå¤„ç†Previous/Nextæ ‡è®°ä½å›¾ï¼Œæ‰«ææ ‡è®°å¯¹è±¡çš„å¼•ç”¨å­—æ®µã€‚åŒæ—¶ï¼Œå¹¶å‘æ ‡è®°çº¿ç¨‹è¿˜ä¼šå®šæœŸæ£€æŸ¥å’Œå¤„ç†STABå…¨å±€ç¼“å†²åŒºåˆ—è¡¨çš„è®°å½•ï¼Œæ›´æ–°å¯¹è±¡å¼•ç”¨ä¿¡æ¯ã€‚å‚æ•°-XX:+ClassUnloadingWithConcurrentMarkä¼šå¼€å¯ä¸€ä¸ªä¼˜åŒ–ï¼Œå¦‚æœä¸€ä¸ªç±»ä¸å¯è¾¾(ä¸æ˜¯å¯¹è±¡ä¸å¯è¾¾)ï¼Œåˆ™åœ¨é‡æ–°æ ‡è®°é˜¶æ®µï¼Œè¿™ä¸ªç±»å°±ä¼šè¢«ç›´æ¥å¸è½½ã€‚æ‰€æœ‰çš„æ ‡è®°ä»»åŠ¡å¿…é¡»åœ¨å †æ»¡å‰å°±å®Œæˆæ‰«æï¼Œå¦‚æœå¹¶å‘æ ‡è®°è€—æ—¶å¾ˆé•¿ï¼Œé‚£ä¹ˆæœ‰å¯èƒ½åœ¨å¹¶å‘æ ‡è®°è¿‡ç¨‹ä¸­ï¼Œåˆç»å†äº†å‡ æ¬¡å¹´è½»ä»£æ”¶é›†ã€‚å¦‚æœå †æ»¡å‰æ²¡æœ‰å®Œæˆæ ‡è®°ä»»åŠ¡ï¼Œåˆ™ä¼šè§¦å‘æ‹…ä¿æœºåˆ¶ï¼Œç»å†ä¸€æ¬¡é•¿æ—¶é—´çš„ä¸²è¡ŒFull GCã€‚</p><p><strong>é‡æ–°æ ‡è®°</strong></p><p>é‡æ–°æ ‡è®°(Remark)æ˜¯æœ€åä¸€ä¸ªæ ‡è®°é˜¶æ®µã€‚åœ¨è¯¥é˜¶æ®µä¸­ï¼ŒG1éœ€è¦ä¸€ä¸ªæš‚åœçš„æ—¶é—´ï¼Œå»å¤„ç†å‰©ä¸‹çš„SATBæ—¥å¿—ç¼“å†²åŒºå’Œæ‰€æœ‰æ›´æ–°ï¼Œæ‰¾å‡ºæ‰€æœ‰æœªè¢«è®¿é—®çš„å­˜æ´»å¯¹è±¡ï¼ŒåŒæ—¶å®‰å…¨å®Œæˆå­˜æ´»æ•°æ®è®¡ç®—ã€‚è¿™ä¸ªé˜¶æ®µä¹Ÿæ˜¯å¹¶è¡Œæ‰§è¡Œçš„ï¼Œé€šè¿‡å‚æ•°-XX:ParallelGCThreadå¯è®¾ç½®GCæš‚åœæ—¶å¯ç”¨çš„GCçº¿ç¨‹æ•°ã€‚åŒæ—¶ï¼Œå¼•ç”¨å¤„ç†ä¹Ÿæ˜¯é‡æ–°æ ‡è®°é˜¶æ®µçš„ä¸€éƒ¨åˆ†ï¼Œæ‰€æœ‰é‡åº¦ä½¿ç”¨å¼•ç”¨å¯¹è±¡(å¼±å¼•ç”¨ã€è½¯å¼•ç”¨ã€è™šå¼•ç”¨ã€æœ€ç»ˆå¼•ç”¨)çš„åº”ç”¨éƒ½ä¼šåœ¨å¼•ç”¨å¤„ç†ä¸Šäº§ç”Ÿå¼€é”€ã€‚</p><p><strong>æ¸…é™¤ Cleanup</strong></p><p>ç´§æŒ¨ç€é‡æ–°æ ‡è®°é˜¶æ®µçš„æ¸…é™¤(Clean)é˜¶æ®µä¹Ÿæ˜¯STWçš„ã€‚Previous/Nextæ ‡è®°ä½å›¾ã€ä»¥åŠPTAMS/NTAMSï¼Œéƒ½ä¼šåœ¨æ¸…é™¤é˜¶æ®µäº¤æ¢è§’è‰²ã€‚æ¸…é™¤é˜¶æ®µä¸»è¦æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</p><p>1ã€RSetæ¢³ç†ï¼Œå¯å‘å¼ç®—æ³•ä¼šæ ¹æ®æ´»è·ƒåº¦å’ŒRSetå°ºå¯¸å¯¹åˆ†åŒºå®šä¹‰ä¸åŒç­‰çº§ï¼ŒåŒæ—¶RSetæ•°ç†ä¹Ÿæœ‰åŠ©äºå‘ç°æ— ç”¨çš„å¼•ç”¨ã€‚å‚æ•°-XX:+PrintAdaptiveSizePolicyå¯ä»¥å¼€å¯æ‰“å°å¯å‘å¼ç®—æ³•å†³ç­–ç»†èŠ‚ï¼›</p><p>2ã€æ•´ç†å †åˆ†åŒºï¼Œä¸ºæ··åˆæ”¶é›†å‘¨æœŸè¯†åˆ«å›æ”¶æ”¶ç›Šé«˜(åŸºäºé‡Šæ”¾ç©ºé—´å’Œæš‚åœç›®æ ‡)çš„è€å¹´ä»£åˆ†åŒºé›†åˆï¼›</p><p>3ã€è¯†åˆ«æ‰€æœ‰ç©ºé—²åˆ†åŒºï¼Œå³å‘ç°æ— å­˜æ´»å¯¹è±¡çš„åˆ†åŒºã€‚è¯¥åˆ†åŒºå¯åœ¨æ¸…é™¤é˜¶æ®µç›´æ¥å›æ”¶ï¼Œæ— éœ€ç­‰å¾…ä¸‹æ¬¡æ”¶é›†å‘¨æœŸã€‚</p><p>å¸¸ç”¨å‚æ•°ï¼š</p><ul><li>-Xss256k,è®¾ç½®è™šæ‹Ÿæœºæ ˆå¤§å°</li><li>-Xmx10m,è®¾ç½®å †æœ€å¤§å†…å­˜</li><li>-Xms10m,è®¾ç½®å †æœ€å°å†…å­˜</li><li>-XX:ConcGCThreads=2,å¹¶å‘æ ‡è®°é˜¶æ®µä½¿ç”¨çº¿ç¨‹æ•°ï¼Œå¯é€‚å½“é«˜ä¸€ç‚¹ã€‚</li><li>-XX:G1NewSizePercen=5,æ–°ç”Ÿä»£å ç”¨å †æœ€å°å€¼ï¼Œé»˜è®¤5%</li><li>-XX:G1MaxNewSizePercent=60,æ–°ç”Ÿä»£å ç”¨æœ€å¤§å€¼ï¼Œé»˜è®¤60%</li><li>-XX:MetaSpaceSize=10m,æ–¹æ³•åŒºæœ€å°å€¼ï¼ˆå…ƒç©ºé—´ï¼‰</li><li>-XX:MaxMetaSpaceSize=10mï¼Œæ–¹æ³•åŒºæœ€å¤§å­ï¼Œé»˜è®¤-1ï¼Œæ²¡æœ‰æœ€å¤§</li><li>-XX:InitiatingHeapOccpancyPercent=92ï¼Œè§¦å‘G1çš„å†…å­˜ä½¿ç”¨ç‡</li><li>-XX:SurvivorRatio=8ï¼ŒEdenåŒºåŸŸæ‰€å 10ä»½ä¸­çš„æ¯”ä¾‹</li><li>-XX:ParallelGCThreads=2,æ”¶é›†çº¿ç¨‹çš„ä¸ªæ•°ä¸€èˆ¬ä¸æœåŠ¡å™¨æ ¸å¿ƒæ•°ç›¸åŒ</li><li>-XX:MaxTenuringThreshold=15,è®¾ç½®è¿›å…¥è€å¹´ä»£å¯¹è±¡çš„å¹´é¾„ã€‚</li><li>-XX:+UseG1GC,ä½¿ç”¨G1æ”¶é›†å™¨</li><li>-XX:MaxGCPauseMillis=200,è®¾ç½®æœ€å¤§åœé¡¿æ—¶é—´ï¼Œé»˜è®¤å°±æ˜¯200æ¯«ç§’</li><li>-XX:G1HeapRegionSize=2ï¼Œè®¾ç½®æ¯ä¸ªRegionçš„å¤§å°ï¼Œè¯¥å€¼å–å€¼èŒƒå›´æ˜¯1-32ï¼Œä¸”å¿…é¡»æ˜¯2çš„næ¬¡å¹‚ï¼Œå½“å¯¹è±¡çš„å€¼è¾¾åˆ°Regionè®¾ç½®çš„å€¼çš„ä¸€åŠæ—¶ï¼Œè¢«è®¾ä¸ºå¤§å¯¹è±¡ä¼šå­˜å…¥humongousåŒºåŸŸï¼Œæ›´å¤§çš„å¯¹è±¡å­˜å‚¨åœ¨Nä¸ªè¿ç»­çš„Humongous Regionä¸­ï¼ŒG1ä¸­çš„å¤§å¤šæ•°è¡Œä¸ºéƒ½æŠŠHumongous Regionçœ‹åšè€å¹´ä»£çš„ä¸€éƒ¨åˆ†ã€‚</li></ul><h3 id="åƒåœ¾å›æ”¶è°ƒä¼˜" tabindex="-1"><a class="header-anchor" href="#åƒåœ¾å›æ”¶è°ƒä¼˜" aria-hidden="true">#</a> åƒåœ¾å›æ”¶è°ƒä¼˜</h3><h2 id="ç±»æ–‡ä»¶ç»“æ„" tabindex="-1"><a class="header-anchor" href="#ç±»æ–‡ä»¶ç»“æ„" aria-hidden="true">#</a> ç±»æ–‡ä»¶ç»“æ„</h2><h2 id="ç±»åŠ è½½å™¨" tabindex="-1"><a class="header-anchor" href="#ç±»åŠ è½½å™¨" aria-hidden="true">#</a> ç±»åŠ è½½å™¨</h2><p>ç›¸å…³åšå®¢ï¼š</p><p>https://www.cnblogs.com/zuoxiaolong/category/508918.html</p><ul><li></li></ul></div><!----><footer class="page-meta"><!----><div class="meta-item update-time"><span class="label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><!----></div><div class="meta-item contributors"><span class="label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="contributor" title="email: 895252461@qq.com">xuliang</span><!--]--><!--]--></div></footer><nav class="page-nav"><a href="/java/java-jvm/JVM%E5%86%85%E5%AD%98%E7%BB%93%E6%9E%84.html" class="nav-link prev" aria-label="JVM å†…å­˜ç»“æ„"><div class="hint"><span class="arrow left"></span>ä¸Šä¸€é¡µ</div><div class="link"><!---->JVM å†…å­˜ç»“æ„</div></a><a href="/java/java-jvm/JVM%E7%B1%BB%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84.html" class="nav-link next" aria-label="ç±»æ–‡ä»¶ç»“æ„"><div class="hint">ä¸‹ä¸€é¡µ<span class="arrow right"></span></div><div class="link">ç±»æ–‡ä»¶ç»“æ„<!----></div></a></nav><!----><!----><!--]--></main><!--]--><!----><!--]--></div><!--]--><!----><!--]--></div>
    <script type="module" src="/assets/app-0de2ad7c.js" defer></script>
  </body>
</html>
